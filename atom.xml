<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>海底捞里没有鱼</title>
  
  <subtitle>平安喜乐，万事胜意。</subtitle>
  <link href="https://smileszh.github.io/atom.xml" rel="self"/>
  
  <link href="https://smileszh.github.io/"/>
  <updated>2024-06-12T08:12:07.620Z</updated>
  <id>https://smileszh.github.io/</id>
  
  <author>
    <name>泡泡</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Biostar workflows</title>
    <link href="https://smileszh.github.io/posts/d08e2cc.html"/>
    <id>https://smileszh.github.io/posts/d08e2cc.html</id>
    <published>2024-06-11T03:00:00.000Z</published>
    <updated>2024-06-12T08:12:07.620Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Guide"><a href="#Guide" class="headerlink" title="Guide"></a>Guide</h1><h2 id="parallel"><a href="#parallel" class="headerlink" title="parallel"></a>parallel</h2><p>当我们有一个文件如下所示：<br><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sample,group,file</span><br><span class="line">control1,control,sample_J1_ABC</span><br><span class="line">control2,control,sample_K2_DEF</span><br><span class="line">control3,control,sample_L3_GHI</span><br><span class="line">heatshock1,treatment,sample_Q1_JKL</span><br><span class="line">heatshock2,treatment,sample_Q2_MNO</span><br><span class="line">heatshock3,treatment,sample_Q3_PQR</span><br></pre></td></tr></table></figure><br>我们想根据列明名去提取变量，并在parallel中运行，我们可以使用<code>--header :</code>以及<code>--colseo ,</code>然后就可以实现以下功能：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> design.csv | parallel --header : --colsep , \</span><br><span class="line">              make -f snpcall.mk   \</span><br><span class="line">              REF=refs/genome.fa   \</span><br><span class="line">              R1=reads/&#123;file&#125;.fq   \  </span><br><span class="line">              BAM=bam/&#123;sample&#125;.bam \</span><br><span class="line">              run</span><br></pre></td></tr></table></figure></p><h2 id="下载基因组数据"><a href="#下载基因组数据" class="headerlink" title="下载基因组数据"></a>下载基因组数据</h2><p>在各个数据库中有大量的数据，可以通过一些工具进行下载：<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2024/06/12/66690c004c319.png"/></div></div></p><h2 id="访问meatadata"><a href="#访问meatadata" class="headerlink" title="访问meatadata"></a>访问meatadata</h2><p>如果我们有NCBI accession number，我们可以通过<code>bio search</code>metadata：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Searches GenBank</span></span><br><span class="line">bio search AF086833</span><br><span class="line"></span><br><span class="line"><span class="comment"># Searches SRA</span></span><br><span class="line">bio search SRR1553425</span><br><span class="line"></span><br><span class="line"><span class="comment"># Searches NCBI Genomes</span></span><br><span class="line">bio search GCA_000005845</span><br><span class="line"></span><br><span class="line"><span class="comment"># Also searches NCBI Genomes</span></span><br><span class="line">bio search ecoli</span><br></pre></td></tr></table></figure></p><h2 id="下载GenBank数据"><a href="#下载GenBank数据" class="headerlink" title="下载GenBank数据"></a>下载GenBank数据</h2><div class="tabs" id="genbank"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="genbank-1">GenBank数据</button><button type="button" class="tab " data-href="genbank-2">genbank.mk</button></ul><div class="tab-contents"><div class="tab-item-content active" id="genbank-1"><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GenBank是NIH基因序列数据库，如果我们有一个Genebank的accession number，我们可以通过`genbank.mk`来下Genebank数据。例如我们想下载`AF086833`的`FASTSA`和`GFF`数据，我们可以通过以下命令：</span><br><span class="line">```bash</span><br><span class="line">make -f src/run/genbank.mk fasta gff ACC=AF086833</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="genbank-2"><p>#</p><h1 id="Downloads-NCBI-data-vie-Entrez-API"><a href="#Downloads-NCBI-data-vie-Entrez-API" class="headerlink" title="Downloads NCBI data vie Entrez API"></a>Downloads NCBI data vie Entrez API</h1><p>#</p><h1 id="Accession-number-at-NCBI"><a href="#Accession-number-at-NCBI" class="headerlink" title="Accession number at NCBI"></a>Accession number at NCBI</h1><p>ACC ?= AF086833</p><h1 id="The-accession-as-a-fasta-file"><a href="#The-accession-as-a-fasta-file" class="headerlink" title="The accession as a fasta file."></a>The accession as a fasta file.</h1><p>REF ?= refs/${ACC}.fa</p><h1 id="The-accession-as-a-genbank-file"><a href="#The-accession-as-a-genbank-file" class="headerlink" title="The accession as a genbank file."></a>The accession as a genbank file.</h1><p>GBK ?= refs/${ACC}.gb</p><h1 id="The-accession-as-a-gff-file"><a href="#The-accession-as-a-gff-file" class="headerlink" title="The accession as a gff file."></a>The accession as a gff file.</h1><p>GFF ?= refs/${ACC}.gff</p><h1 id="Check-the-make-version"><a href="#Check-the-make-version" class="headerlink" title="Check the make version."></a>Check the make version.</h1><p>ifeq ($(origin .RECIPEPREFIX), undefined)<br>  $(error “### Error! Please use GNU Make 4.0 or later ###”)<br>endif</p><h1 id="Makefile-customizations"><a href="#Makefile-customizations" class="headerlink" title="Makefile customizations."></a>Makefile customizations.</h1><p>.DELETE_ON_ERROR:<br>.ONESHELL:<br>SHELL := bash<br>.SHELLFLAGS := -eu -o pipefail -c<br>MAKEFLAGS += —warn-undefined-variables —no-print-directory</p><p>MAKEFLAGS += —warn-undefined-variables —no-print-directory</p><h1 id="Print-usage-information"><a href="#Print-usage-information" class="headerlink" title="Print usage information."></a>Print usage information.</h1><p>usage::<br>    @echo “#”<br>    @echo “# genbank.mk: download sequences from GenBank”<br>    @echo “#”<br>    @echo “# ACC=${ACC}”<br>    @echo “# REF=${REF}”<br>    @echo “# GBK=${GBK}”<br>    @echo “# GFF=${GFF}”<br>    @echo “#”<br>    @echo “# make fasta genbank gff run”<br>    @echo “#”</p><h1 id="Obtain-a-sequence-from-NCBI"><a href="#Obtain-a-sequence-from-NCBI" class="headerlink" title="Obtain a sequence from NCBI."></a>Obtain a sequence from NCBI.</h1><p>${REF}:<br>    mkdir -p $(dir $@)<br>    bio fetch ${ACC} —format fasta &gt; $@</p><p>${GBK}:<br>    mkdir -p $(dir $@)<br>    bio fetch ${ACC} &gt; $@</p><p>${GFF}:<br>    mkdir -p $(dir $@)<br>    bio fetch ${ACC} —format gff &gt; $@</p><h1 id="Download-FASTA-file"><a href="#Download-FASTA-file" class="headerlink" title="Download FASTA file."></a>Download FASTA file.</h1><p>fasta::  ${REF}<br>    @ls -lh ${REF}</p><h1 id="Download-GenBank-file"><a href="#Download-GenBank-file" class="headerlink" title="Download GenBank file."></a>Download GenBank file.</h1><p>genbank::  ${GBK}<br>    @ls -lh ${GBK}</p><h1 id="Download-GFF-file"><a href="#Download-GFF-file" class="headerlink" title="Download GFF file."></a>Download GFF file.</h1><p>gff::  ${GFF}<br>    @ls -lh ${GFF}</p><h1 id="Remove-FASTA-file"><a href="#Remove-FASTA-file" class="headerlink" title="Remove FASTA file."></a>Remove FASTA file.</h1><p>fasta!::<br>    rm -rf ${REF}</p><h1 id="Remove-GenBank-file"><a href="#Remove-GenBank-file" class="headerlink" title="Remove GenBank file."></a>Remove GenBank file.</h1><p>genbank!::<br>    rm -rf ${GBK}</p><h1 id="Remove-GFF-file"><a href="#Remove-GFF-file" class="headerlink" title="Remove GFF file."></a>Remove GFF file.</h1><p>gff!::<br>    rm -rf ${GFF}</p><h1 id="The-run-target-is-FASTA"><a href="#The-run-target-is-FASTA" class="headerlink" title="The run target is FASTA"></a>The run target is FASTA</h1><p>run:: fasta</p><h1 id="Undo-run-target"><a href="#Undo-run-target" class="headerlink" title="Undo run target"></a>Undo run target</h1><p>run!:: fasta!</p><p>test:<br>    make -f src/run/genbank.mk fasta! fasta ACC=${ACC} REF=${REF}<br>    make -f src/run/genbank.mk gff! gff ACC=${ACC} GFF=${GFF}<br>    make -f src/run/genbank.mk genbank! genbank ACC=${ACC} GBK=${GBK}</p><h1 id="Installation-instructions"><a href="#Installation-instructions" class="headerlink" title="Installation instructions"></a>Installation instructions</h1><p>install::<br>    @echo pip install bio —upgrade</p><h1 id="Targets-that-are-not-files"><a href="#Targets-that-are-not-files" class="headerlink" title="Targets that are not files."></a>Targets that are not files.</h1><p>.PHONY: usage install run run! test fasta fasta! genbank genbank! gff gff!</p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div> ]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Guide&quot;&gt;&lt;a href=&quot;#Guide&quot; class=&quot;headerlink&quot; title=&quot;Guide&quot;&gt;&lt;/a&gt;Guide&lt;/h1&gt;&lt;h2 id=&quot;parallel&quot;&gt;&lt;a href=&quot;#parallel&quot; class=&quot;headerlink&quot; titl</summary>
      
    
    
    
    <category term="生物信息学" scheme="https://smileszh.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/"/>
    
    
  </entry>
  
  <entry>
    <title>Makefile基本使用</title>
    <link href="https://smileszh.github.io/posts/b536050b.html"/>
    <id>https://smileszh.github.io/posts/b536050b.html</id>
    <published>2024-05-29T10:00:00.000Z</published>
    <updated>2024-06-07T06:51:06.360Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Makefile简介"><a href="#Makefile简介" class="headerlink" title="Makefile简介"></a>Makefile简介</h1><p><a href="https://makefiletutorial.com/">Makefile</a> 是一个文本文件（默认情况下使用名为 Makefile 的文件），其中列出了按所谓 “target”分组的命令，你可以将其视为应一起执行的命令组。我们用 TAB 缩进字符来表示属于某个目标的命令。<br>默认情况下，make 会同时打印执行的命令和命令本身的结果。如果需要，你可以关闭这种行为，不过通常情况下，你确实希望看到被执行的内容。一开始，同时看到命令和输出结果可能会让人有点困惑，但你的眼睛很快就会习惯的。</p><p>Makefiles支持我们开发工作流，我们希望可以实现以下功能：</p><ol><li>依赖管理—-跳过已经完成的步骤</li><li>重新进入—-从特定点重新启动工作流</li><li>自动化—-使用相同的代码并行运行多个相同的分析</li></ol><p>一个Makefile文件的基本结构如下：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">foo:</span></span><br><span class="line">    echo Hello John!</span><br><span class="line"></span><br><span class="line"><span class="section">bar:</span></span><br><span class="line">    echo Hello Jane!</span><br><span class="line">    echo Hello Everyone!</span><br></pre></td></tr></table></figure><p><code>执行全部代码：</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -f Makefile</span><br></pre></td></tr></table></figure></p><p><code>执行指定代码：</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -f Makefile foo</span><br></pre></td></tr></table></figure><br>Tip: 如果文件名字是Makefile，也可以直接省略-f参数和文件名。</p><p>需要注意的是，Makefile 中的命令必须使用 Tab 键缩进，不能使用空格。不过我们可以通过设置 .RECIPEPREFIX 变量来修改这个行为，例如：</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sets the prefix for commands.</span></span><br><span class="line">.RECIPEPREFIX = &gt;</span><br><span class="line"></span><br><span class="line"><span class="section">foo:</span></span><br><span class="line">&gt; echo Hello John!</span><br><span class="line"></span><br><span class="line"><span class="section">bar:</span></span><br><span class="line">&gt; echo Hello Jane!</span><br><span class="line">&gt; echo Hello Everyone!</span><br></pre></td></tr></table></figure><h1 id="Makefile使用技巧"><a href="#Makefile使用技巧" class="headerlink" title="Makefile使用技巧"></a>Makefile使用技巧</h1><h2 id="好的默认设置"><a href="#好的默认设置" class="headerlink" title="好的默认设置"></a>好的默认设置</h2><div class="tabs" id="makefiles设置"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="makefiles设置-1">Makefiles好用默认设置</button><button type="button" class="tab " data-href="makefiles设置-2">设置解释</button></ul><div class="tab-contents"><div class="tab-item-content active" id="makefiles设置-1"><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SHELL := bash</span><br><span class="line"><span class="section">.ONESHELL:</span></span><br><span class="line">.SHELLFLAGS := -eu -o pipefail -c</span><br><span class="line"><span class="section">.DELETE_ON_ERROR:</span></span><br><span class="line">MAKEFLAGS += --warn-undefined-variables</span><br><span class="line">MAKEFLAGS += --no-builtin-rules</span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(<span class="built_in">origin</span> .RECIPEPREFIX)</span>, undefined)</span><br><span class="line">  <span class="variable">$(<span class="built_in">error</span> This Make does not support .RECIPEPREFIX. Please use GNU Make 4.0 <span class="built_in">or</span> later)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line">.RECIPEPREFIX = &gt;</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="makefiles设置-2"><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deletes dependencies if the command fails.</span></span><br><span class="line"><span class="section">.DELETE_ON_ERROR:</span></span><br></pre></td></tr></table></figure><p>作用：<br>    •    这个指示符告诉 make 如果在执行目标的命令时发生错误，应该删除目标文件。</p><p>好处：<br>    •    保持构建环境的整洁：如果某个构建目标在执行过程中失败，它会删除部分生成的文件，从而避免留下半成品或不完整的文件。<br>    •    避免误用不完整的构建：当构建失败时，目标文件可能是部分生成的，保留这些文件可能会导致后续的构建过程误以为这些文件是完整的，从而造成错误。删除这些文件可以避免这种情况。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Warns about undefined variables.</span></span><br><span class="line">MAKEFLAGS += --warn-undefined-variables --no-builtin-rules</span><br></pre></td></tr></table></figure><p>作用：<br>    •    —warn-undefined-variables: 这个选项会使 make 在使用未定义变量时发出警告。<br>    •    —no-builtin-rules: 这个选项会禁用所有的内建规则和变量，使用者需要在 Makefile 中明确地定义所有需要的规则。</p><p>好处：<br>    •    提高可调试性：<br>    •    —warn-undefined-variables: 当使用未定义变量时发出警告，有助于在构建过程中快速发现和修复拼写错误或遗漏定义的变量。这对于维护大型和复杂的 Makefile 特别有用。<br>    •    增强可控性和可预测性：<br>    •    —no-builtin-rules: 禁用内建规则，确保所有的构建规则都是显式定义的，从而提高 Makefile 的可读性和可维护性。这样可以避免一些隐式规则导致的意外行为，使构建过程更加透明和可预测。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHELL := bash</span><br></pre></td></tr></table></figure><p>作用：<br>    •    这个指示符告诉 make 使用 bash 作为 shell。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">.ONESHELL:</span></span><br></pre></td></tr></table></figure><p>作用：<br>    •    这个指示符告诉 make 在执行目标的命令时，将所有的命令放在同一个 shell 进程中执行。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.SHELLFLAGS := -eu -o pipefail -c</span><br></pre></td></tr></table></figure><p>作用：<br>    <code>-e</code>: 如果任何命令行返回非零状态（失败），则立即退出脚本。<br>    <code>-u</code>: 当执行到未设置的变量时，shell将会报错并退出。<br>    <code>-o pipefail</code>: 这个选项会导致管道（|）中的命令如果有任何一个失败了，整个管道的返回状态都会是失败的。默认情况下，只有最后一个命令的状态会影响整个管道的状态。<br>    <code>-c</code>: 这个标志告诉shell从字符串中读取命令。</p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="“Dry-run”模式"><a href="#“Dry-run”模式" class="headerlink" title="“Dry-run”模式"></a>“Dry-run”模式</h2><p>如果你想要查看 make 命令将执行的命令，而不实际执行它们，可以使用 <code>-n</code> 或 <code>--just-print</code> 选项。这个选项会显示 make 将执行的命令，但不会实际执行它们。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make fastq align -n</span><br></pre></td></tr></table></figure><h2 id="变量命名"><a href="#变量命名" class="headerlink" title="变量命名"></a>变量命名</h2><p>Makefile一般通过${foo}来引用变量，这和bash脚本中是一样的。<br>但在Makefile中，可以使用<code>?=</code>来定义变量，如此定义的变量我们可以在命令控制行中进行控制。</p><p>例如：<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set the value of FOO to bar (if not already set).</span></span><br><span class="line">NAME ?= Jane</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sets the prefix for commands.</span></span><br><span class="line">.RECIPEPREFIX = &gt;</span><br><span class="line"></span><br><span class="line"><span class="section">usage:</span></span><br><span class="line">&gt; echo Hello $&#123;NAME&#125;</span><br></pre></td></tr></table></figure></p><p>我们可以对NAME进行赋值，如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make usage NAME=Joe</span><br></pre></td></tr></table></figure></p><h2 id="隐藏命令"><a href="#隐藏命令" class="headerlink" title="隐藏命令"></a>隐藏命令</h2><p>一般情况下，make会打印出执行的命令，但有时候我们不希望看到这些命令，可以使用<code>@</code>符号来隐藏命令。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sets the prefix for commands.</span></span><br><span class="line">.RECIPEPREFIX = &gt;</span><br><span class="line"></span><br><span class="line"><span class="section">usage:</span></span><br><span class="line">&gt; @echo <span class="string">&quot;Hey Jude&quot;</span></span><br></pre></td></tr></table></figure><h2 id="文本替换"><a href="#文本替换" class="headerlink" title="文本替换"></a>文本替换</h2><p>有时候我们想从路径中提取目录名或文件名，如：</p><ul><li>PATH = data/reads/abc.txt<br>则：</li><li>DIR = $(dir ${PATH})将包含data/reads/</li><li>FNAME = $(notdir ${PATH})将包含abc.txt</li></ul><p>一些常见的使用如下：<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># How to generate patterns</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sets the prefix for commands.</span></span><br><span class="line">.RECIPEPREFIX = &gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set a filename</span></span><br><span class="line">FILE = data/refs/ebola.fa.gz</span><br><span class="line"></span><br><span class="line"><span class="section">demo:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Prints: data/refs/ebola.fa.gz</span></span><br><span class="line">&gt; @echo $&#123;FILE&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Prints: data/refs</span></span><br><span class="line">&gt; @echo <span class="variable">$(<span class="built_in">dir</span> $&#123;FILE&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Prints: ebola.fa.gz</span></span><br><span class="line">&gt; @echo <span class="variable">$(<span class="built_in">notdir</span> $&#123;FILE&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Prints: data/refs/human.fa.gz</span></span><br><span class="line"><span class="comment"># 使用 subst 函数将 FILE 变量中的 ebola 替换为 human，结果为 data/refs/</span></span><br><span class="line">&gt; @echo <span class="variable">$(<span class="built_in">subst</span> ebola,human,$&#123;FILE&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Prints: data/refs/ebola.fa</span></span><br><span class="line"><span class="comment"># 使用 patsubst 函数将 FILE 变量中的以 .gz 结尾的字符串替换为没有 .gz 的字符串，结果为 data/refs/ebola.fa</span></span><br><span class="line">&gt; @echo <span class="variable">$(<span class="built_in">patsubst</span> %.gz,%,$&#123;FILE&#125;)</span></span><br></pre></td></tr></table></figure></p><h2 id="打印说明"><a href="#打印说明" class="headerlink" title="打印说明"></a>打印说明</h2><p>有时候我们想知道自己编写的Makefiles中有哪些作用，我们可以编写一个说明来帮助我们理解。<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set the prefix from tabs to &gt;</span></span><br><span class="line">.RECIPEPREFIX = &gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the project number.</span></span><br><span class="line">PRJN ?= PRJEB31790</span><br><span class="line"></span><br><span class="line"><span class="comment"># Default action is to print usage</span></span><br><span class="line"><span class="section">usage:</span></span><br><span class="line">&gt; @echo <span class="string">&quot;&quot;</span></span><br><span class="line">&gt; @echo <span class="string">&quot;Usage: make data trim PRJN=$&#123;PRJN&#125;&quot;</span></span><br><span class="line">&gt; @echo <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure></p><p>我们可以运行<code>make usage</code>来查看说明。另外，如果我们没有指定“target“，则默认执行第一个“target”。</p><h2 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理"></a>依赖管理</h2><p>Makefile中的依赖管理是非常重要的，我们可以通过依赖管理来跳过已经完成的步骤，从而提高构建速度。</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set the prefix from tabs to &gt;</span></span><br><span class="line">.RECIPEPREFIX = &gt;</span><br><span class="line"></span><br><span class="line"><span class="section">counts.txt:</span></span><br><span class="line">&gt; echo 100 &gt; counts.txt</span><br><span class="line"></span><br><span class="line"><span class="section">names.txt:</span></span><br><span class="line">&gt; echo Joe &gt; names.txt</span><br><span class="line"></span><br><span class="line"><span class="section">results.txt: counts.txt names.txt</span></span><br><span class="line">&gt; cat counts.txt names.txt &gt; results.txt</span><br></pre></td></tr></table></figure><p>如果不存在results.txt文件，make会先生成counts.txt和names.txt文件，然后再生成results.txt文件。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Makefile简介&quot;&gt;&lt;a href=&quot;#Makefile简介&quot; class=&quot;headerlink&quot; title=&quot;Makefile简介&quot;&gt;&lt;/a&gt;Makefile简介&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://makefiletutorial.com/</summary>
      
    
    
    
    <category term="拓展技能" scheme="https://smileszh.github.io/categories/%E6%8B%93%E5%B1%95%E6%8A%80%E8%83%BD/"/>
    
    
  </entry>
  
  <entry>
    <title>Git使用</title>
    <link href="https://smileszh.github.io/posts/ca675cd4.html"/>
    <id>https://smileszh.github.io/posts/ca675cd4.html</id>
    <published>2024-05-02T10:00:00.000Z</published>
    <updated>2024-05-02T15:23:42.216Z</updated>
    
    <content type="html"><![CDATA[<h1 id="安装和初始化配置"><a href="#安装和初始化配置" class="headerlink" title="安装和初始化配置"></a>安装和初始化配置</h1><p><a href="https://git-scm.com/downloads">官网</a>提供了各个电脑系统的安装教程，可按照具体需要进行安装。</p><p><code>安装完成之后，可查看版本信息:</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git -v</span><br></pre></td></tr></table></figure></p><p><code>配置用户名:</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;My Name&quot;</span><br></pre></td></tr></table></figure></p><p><code>配置邮箱:</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.email &quot;mail@example.com&quot;</span><br></pre></td></tr></table></figure></p><p><code>配置默认分支名：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global init.defaultBranch main</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一般我们设置main为默认主分支名</span></span><br></pre></td></tr></table></figure></p><p><code>储存配置:</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global credential.helper store</span><br></pre></td></tr></table></figure></p><p><code>查看配置信息:</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global --list</span><br></pre></td></tr></table></figure></p><h1 id="创建仓库"><a href="#创建仓库" class="headerlink" title="创建仓库"></a>创建仓库</h1><p><code>本地创建:</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git init [project-dir]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">省略[project-dir]则在当前目录创建</span></span><br></pre></td></tr></table></figure></p><p><code>克隆远程仓库:</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone &lt;url&gt;</span><br></pre></td></tr></table></figure></p><h1 id="工作区域和文件状态"><a href="#工作区域和文件状态" class="headerlink" title="工作区域和文件状态"></a>工作区域和文件状态</h1><h2 id="工作区域"><a href="#工作区域" class="headerlink" title="工作区域"></a>工作区域</h2><ul><li><code>工作区（Working Directory）</code>: 就是你在电脑里能实际看到的目录。</li><li><code>暂存区（Stage/Index）</code>: 暂存区也叫索引，用来临时存放未提交的内容，一般在.git目录下的index中。</li><li><code>本地仓库（Repository）</code>: Git在本地的版本库，仓库信息存储在.git这个隐藏目录中。</li><li><code>远程仓库（Remote Repository）</code>: 托管在远程服务器上的仓库。 常用的有 GitHub、 GitLab、 Gitee。</li></ul><h2 id="文件状态"><a href="#文件状态" class="headerlink" title="文件状态"></a>文件状态</h2><ul><li><code>已修改（Modified）</code>：修改了但是没有保存到暂存区的文件。</li><li><code>已暂存（Staged）</code>：修改后已经保存到暂存区的文件。</li><li><code>已提交（Committed）</code> ：把暂存区的文件提交到本地仓库后的状态。</li></ul><p>文件状态描述字符：</p><ul><li><code>未跟踪（Untracked）</code>: ??</li><li><code>已添加暂存（Added）</code>: A</li><li><code>已修改（Modified）</code>: M</li><li><code>已删除（Deleted）</code>: D</li><li><code>重命名（Renamed）</code>: R</li><li><code>已更新未合并（Updated）</code>: U</li></ul><h1 id="查看各工作区域文件"><a href="#查看各工作区域文件" class="headerlink" title="查看各工作区域文件"></a>查看各工作区域文件</h1><p><code>查看工作区文件：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls</span><br></pre></td></tr></table></figure></p><p><code>查看暂存区文件：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出未追踪，还未提交的新的或者修改的文件</span></span><br></pre></td></tr></table></figure></p><p><code>查看仓库文件：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git ls-tree -r HEAD</span><br></pre></td></tr></table></figure></p><p><code>查看所有被git跟踪的文件：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git ls-files</span><br></pre></td></tr></table></figure></p><h1 id="添加和提交文件"><a href="#添加和提交文件" class="headerlink" title="添加和提交文件"></a>添加和提交文件</h1><p><code>添加一个文件到暂存区:</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add &lt;file&gt;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">git add . 就表示添加所有文件到暂存区。</span></span><br></pre></td></tr></table></figure></p><p><code>提交所有暂存区的文件到本地仓库:</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &quot;message&quot;</span><br></pre></td></tr></table></figure></p><p><code>提交所有已修改的文件到本地仓库:</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -am &quot;message&quot;</span><br></pre></td></tr></table></figure></p><p><code>移动一个文件到新的位置:</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git mv &lt;file&gt; &lt;new-file&gt;</span><br></pre></td></tr></table></figure></p><p><code>从工作区和暂存区删除一个文件， 并且将这次删除放入暂存区:</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm &lt;file&gt;</span><br></pre></td></tr></table></figure></p><p><code>从暂存区中删除文件，但是本地工作区文件还在：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm --cached &lt;file&gt;</span><br></pre></td></tr></table></figure></p><p><code>恢复一个文件到之前的版本：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout &lt;commit-id&gt; &lt;file&gt;</span><br></pre></td></tr></table></figure></p><p><code>创建一个新的提交，用来撤销指定的提交，后者的所有变化将被前者抵消，并且应用到当前分支：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert &lt;commit-id&gt;</span><br></pre></td></tr></table></figure></p><p><code>重置当前分支的HEAD为之前的某个提交， 并且删除所有之后的提交：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git reset --mixed &lt;commit-id&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--soft参数表示重置暂存区</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--mixed参数表示重置工作区</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--hard参数表示重置工作区和暂存区</span></span><br></pre></td></tr></table></figure></p><p><code>撤销暂存区的文件，重新放回工作区（git add的反向操作）：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git restore --staged &lt;file&gt;</span><br></pre></td></tr></table></figure></p><p><code>查看提交历史：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --oneline</span><br></pre></td></tr></table></figure></p><h1 id="查看文件差异"><a href="#查看文件差异" class="headerlink" title="查看文件差异"></a>查看文件差异</h1><p><code>比较工作区和暂存区：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff [file]</span><br></pre></td></tr></table></figure></p><p><code>比较工作区和仓库区：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff HEAD [file]</span><br></pre></td></tr></table></figure></p><p><code>比较暂存区和仓库区：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff --cache [file]</span><br></pre></td></tr></table></figure></p><p><code>比较两个版本仓库：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get diff &lt;commit-id&gt; &lt;commit-id&gt; [file]</span><br></pre></td></tr></table></figure></p><h1 id="关联本地仓库和远程仓库"><a href="#关联本地仓库和远程仓库" class="headerlink" title="关联本地仓库和远程仓库"></a>关联本地仓库和远程仓库</h1><p>需要我们先创建好远程仓库，才能才能进行关联。</p><p>当我们没有本地仓库时：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git commit -m &quot;first commit&quot;</span><br><span class="line">git remote add origin &lt;repo-url&gt;</span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure></p><p>当我们已经有本地仓库时：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin &lt;repo-url&gt;</span><br><span class="line">git push -u origin main</span><br></pre></td></tr></table></figure></p><p>查看当前仓库对远程仓库的别名和地址<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote -v</span><br></pre></td></tr></table></figure></p><h1 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h1><p><code>查看所有本地分支：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">当前分支前面会有一个星号*，-r查看远程分支，-a查看所有分支。</span></span><br></pre></td></tr></table></figure></p><p><code>创建一个新的分支：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch &lt;branch-name&gt;</span><br></pre></td></tr></table></figure></p><p><code>删除一个已经合并的分支：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch -d &lt;branch-name&gt;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-D 强制删除</span></span><br></pre></td></tr></table></figure></p><p><code>切换到指定分支：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git &#123;switch | checkout&#125; &lt;branch-name&gt;</span><br></pre></td></tr></table></figure></p><p><code>创建并切换分支：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git &#123;switch | checkout&#125; -b &lt;branch-name&gt;</span><br></pre></td></tr></table></figure></p><p><code>修改分支名称：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -m &lt;name&gt;</span><br></pre></td></tr></table></figure></p><p><code>合并分支（注意所处分支位置）：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git merge --no-ff -m &quot;message&quot; &lt;branch-name&gt;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--no-ff参数表示禁用 Fast Forward模式， 合并后的历史有分支， 能看出曾经做过合并，而-ff参数表示使用 FastForward模式， 合并后的历史会变成一条直线。</span></span><br></pre></td></tr></table></figure></p><p><code>查看分支图：</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --graph --oneline --decorate --all</span><br></pre></td></tr></table></figure></p><h1 id="GitFlow"><a href="#GitFlow" class="headerlink" title="GitFlow"></a>GitFlow</h1><p>GitFlow 是一种流程模型，用于在Git上管理软件开发项目。</p><p><code>主分支（master/main）</code>：代表了项目的稳定版本，每个提交到主分支的代码都应该是经过测试和审核的。<br><code>开发分支（develop)：</code>用于日常开发。所有的功能分支、发布分支和修补分支都应该从开发分支派生出来。<br><code>功能分支（feature）：</code>用于开发单独的功能或者特性。每个功能分支都应该从开发分支派生，并在开发完成后合并回开发分支。<br><code>发布分支（release)：</code>用于准备项目发布。发布分支应该从开发分支派生，并在准备好发布版本后合并回主分支和开发分支。<br><code>热修复分支（hotfix）：</code>用于修复主分支上的紧急问题。热修复分支应该从主分支派生，并在修复完成后，合并回主分支和开发分支。</p><p>注：<a href="https://bu.dusays.com/2024/05/02/6633ae1423520.jpg">Git CheatSheet</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;安装和初始化配置&quot;&gt;&lt;a href=&quot;#安装和初始化配置&quot; class=&quot;headerlink&quot; title=&quot;安装和初始化配置&quot;&gt;&lt;/a&gt;安装和初始化配置&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://git-scm.com/downloads&quot;&gt;官网&lt;/a&gt;</summary>
      
    
    
    
    <category term="拓展技能" scheme="https://smileszh.github.io/categories/%E6%8B%93%E5%B1%95%E6%8A%80%E8%83%BD/"/>
    
    
  </entry>
  
  <entry>
    <title>bookdown使用</title>
    <link href="https://smileszh.github.io/posts/16088ba7.html"/>
    <id>https://smileszh.github.io/posts/16088ba7.html</id>
    <published>2024-04-30T14:00:00.000Z</published>
    <updated>2024-05-03T13:00:37.440Z</updated>
    
    <content type="html"><![CDATA[<h1 id="bookdown初始文件生成"><a href="#bookdown初始文件生成" class="headerlink" title="bookdown初始文件生成"></a>bookdown初始文件生成</h1><p>在RStudio中通过project管理一个bookdown项目，因此需要我们初始化生成bookdown文件，具体步骤如下：</p><ol><li>打开RStudio</li><li>File</li><li>New propject</li><li>New Directory</li><li>Book project using bookdown</li><li>命名文件夹</li><li>Create Project</li></ol><p>新创建的 bookdown项目会包含一些必要的文件和演示文件。接下来我们将具体介绍每个文件的设置。</p><p><img src="https://bu.dusays.com/2024/04/30/6630e88868c19.png" alt="bookdown文件.png" style="zoom:40%;" /> </p><h1 id="主要文件简介"><a href="#主要文件简介" class="headerlink" title="主要文件简介"></a>主要文件简介</h1><h2 id="index-Rmd文件"><a href="#index-Rmd文件" class="headerlink" title="index.Rmd文件"></a>index.Rmd文件</h2><p>一本bookdown书， 一般都有一个<code>index.Rmd</code>文件， 这是最后生成的网站的主页的原始文件， 可以在这个文件中写一些书的说明， 并在开头的YAML元数据部分进行有关设置， 如标题、作者、日期等。一个示例如下：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span> </span><br><span class="line">title<span class="operator">:</span> <span class="string">&quot;PLAU Project Online Viewing and Collaboration&quot;</span></span><br><span class="line">author<span class="operator">:</span> <span class="string">&quot;苏总华&quot;</span></span><br><span class="line">date<span class="operator">:</span> <span class="string">&quot;`r Sys.Date()`&quot;</span></span><br><span class="line">site<span class="operator">:</span> bookdown<span class="operator">::</span>bookdown_site</span><br><span class="line">output<span class="operator">:</span> bookdown<span class="operator">::</span>gitbook</span><br><span class="line">documentclass<span class="operator">:</span> book</span><br><span class="line">bibliography<span class="operator">:</span> <span class="punctuation">[</span>book.bib<span class="punctuation">,</span> packages.bib<span class="punctuation">]</span></span><br><span class="line">biblio<span class="operator">-</span>style<span class="operator">:</span> </span><br><span class="line"><span class="comment"># url: your book url like https://bookdown.org/yihui/bookdown</span></span><br><span class="line"><span class="comment"># cover-image: path to the social sharing image like images/cover.jpg</span></span><br><span class="line">description<span class="operator">:</span> <span class="operator">|</span></span><br><span class="line">  This is an online version of the PLAU project analysis.</span><br><span class="line">link<span class="operator">-</span>citations<span class="operator">:</span> yes</span><br><span class="line">github<span class="operator">-</span>repo<span class="operator">:</span> smileszh<span class="operator">/</span>PLAU</span><br><span class="line"><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Introdution &#123;-&#125;</span></span><br><span class="line"></span><br><span class="line">  Past analysis results can be viewed online<span class="operator">!</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>title: “标题”</li><li>author: “作者”</li><li><p>date: \”r Sys.Date()”   # 自动生成文档创建时间</p></li><li><p>site: bookdown::bookdown_site  #使得RStudio软件能辨认这是一个bookdown图书项目， 从而为其提供一键编译快捷方式</p></li><li>output: bookdown::gitbook # 默认输出格式</li><li>documentclass: book # PDF模版格式</li><li>bibliography: [book.bib, packages.bib] # 指定文献数据库格式</li><li>description: 描述</li><li>github-repo: smileszh/PLAU # repo地址</li></ul><h2 id="bookdown-yml文件"><a href="#bookdown-yml文件" class="headerlink" title="_bookdown.yml文件"></a>_bookdown.yml文件</h2><p>一个bookdown图书项目除了<code>index.Rmd</code>文件之外， 一般还应该有一个<code>_bookdown.yml</code>文件存放与整本书有关的YAML元数据。 例如：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">new_session<span class="operator">:</span> true</span><br><span class="line">book_filename<span class="operator">:</span> <span class="string">&quot;PLAU project&quot;</span></span><br><span class="line">delete_merged_file<span class="operator">:</span> true</span><br><span class="line">output_dir<span class="operator">:</span> <span class="string">&quot;docs&quot;</span></span><br><span class="line">language<span class="operator">:</span></span><br><span class="line">  ui<span class="operator">:</span></span><br><span class="line">    chapter_name<span class="operator">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  label<span class="operator">:</span></span><br><span class="line">    thm<span class="operator">:</span> <span class="string">&#x27;定理&#x27;</span></span><br><span class="line">    def<span class="operator">:</span> <span class="string">&#x27;定义&#x27;</span></span><br><span class="line">    exm<span class="operator">:</span> <span class="string">&#x27;例&#x27;</span></span><br><span class="line">    proof<span class="operator">:</span> <span class="string">&#x27;证明: &#x27;</span></span><br><span class="line">    solution<span class="operator">:</span> <span class="string">&#x27;解: &#x27;</span></span><br><span class="line">    fig<span class="operator">:</span> <span class="string">&#x27;图&#x27;</span></span><br><span class="line">    tab<span class="operator">:</span> <span class="string">&#x27;表&#x27;</span></span><br></pre></td></tr></table></figure><p>其中<code>new_session: true</code>设置很重要， 这使得每一个Rmd文件中的R程序都在一个单独的R会话中独立地运行， 避免了不同Rmd文件之间同名变量和同名标签的互相干扰。 <code>book_filename</code>是最终生成的LaTeX PDF图书或者ePub电子书的主文件名。 <code>language</code>下可以定制一些与章节名、定理名等有关的名称。<code>output_dir: &quot;docs&quot;</code>可以设置渲染后都输出文件夹，默认是<code>_book</code>，但是如果要托管在GitHub page上，一定要设置这个参数，方便GitHub在线查看。</p><h2 id="output-yml文件"><a href="#output-yml文件" class="headerlink" title="_output.yml文件"></a>_output.yml文件</h2><p><code>_output.yml</code>文件， 用于输出格式的设置。 这部分内容也可以包含在<code>index.Rmd</code>的元数据中<code>output</code>条目下面。 例如：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">bookdown<span class="operator">::</span>gitbook<span class="operator">:</span></span><br><span class="line">  toc_depth<span class="operator">:</span> <span class="number">2</span></span><br><span class="line">  css<span class="operator">:</span> style.css</span><br><span class="line">  config<span class="operator">:</span></span><br><span class="line">    toc<span class="operator">:</span></span><br><span class="line">      before<span class="operator">:</span> <span class="operator">|</span></span><br><span class="line">        <span class="operator">&lt;</span>li<span class="operator">&gt;</span><span class="operator">&lt;</span>a href<span class="operator">=</span><span class="string">&quot;./&quot;</span><span class="operator">&gt;</span>A online version of PLAU project<span class="operator">&lt;</span><span class="operator">/</span>a<span class="operator">&gt;</span><span class="operator">&lt;</span><span class="operator">/</span>li<span class="operator">&gt;</span></span><br><span class="line">      after<span class="operator">:</span> <span class="operator">|</span></span><br><span class="line">        <span class="operator">&lt;</span>li<span class="operator">&gt;</span><span class="operator">&lt;</span>a href<span class="operator">=</span><span class="string">&quot;https://github.com/smileszh&quot;</span> target<span class="operator">=</span><span class="string">&quot;blank&quot;</span><span class="operator">&gt;</span>编辑<span class="operator">:</span> 苏总华<span class="operator">&lt;</span><span class="operator">/</span>a<span class="operator">&gt;</span><span class="operator">&lt;</span><span class="operator">/</span>li<span class="operator">&gt;</span></span><br><span class="line">    <span class="comment"># edit: https://github.com/USERNAME/REPO/edit/BRANCH/%s</span></span><br><span class="line">    download<span class="operator">:</span> <span class="punctuation">[</span><span class="string">&quot;pdf&quot;</span><span class="punctuation">,</span> <span class="string">&quot;epub&quot;</span><span class="punctuation">]</span></span><br><span class="line">bookdown<span class="operator">::</span>pdf_book<span class="operator">:</span></span><br><span class="line">  includes<span class="operator">:</span></span><br><span class="line">    in_header<span class="operator">:</span> preamble.tex</span><br><span class="line">  latex_engine<span class="operator">:</span> xelatex</span><br><span class="line">  citation_package<span class="operator">:</span> natbib</span><br><span class="line">  keep_tex<span class="operator">:</span> yes</span><br><span class="line">bookdown<span class="operator">::</span>epub_book<span class="operator">:</span> default</span><br></pre></td></tr></table></figure><p>gitbook、pdf_book和epub_book三种输出格式分别设置了一些输出选项。 在gitbook部分， 设置了目录上方显示的书的主页的链接（<code>before</code>项）和目录下方显示的作者信息。 在<code>in_header</code>部分插入了一部分个性化的HTML代码， 这部分代码是使用本地的数学公式显示支持以免外网不通时数学公式不能显示， 插入的内容将出现在每个生成的HTML文件的head部分。</p><p>在<code>pdf_book</code>部分，设置了通过LaTeX编译整本书为PDF的一些选项。 指定了<code>latex_engine</code>为<code>xelatex</code>， 这对中文支持很重要。 <code>in_header</code>选项要求在LaTeX文件导言部分插入一个<code>preamble.tex</code>文件， 内容如：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">\</span>usepackage<span class="punctuation">&#123;</span>ctex<span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">\</span>usepackage<span class="punctuation">&#123;</span>amsthm<span class="punctuation">,</span>mathrsfs<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">\</span>usepackage<span class="punctuation">&#123;</span>booktabs<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">\</span>usepackage<span class="punctuation">&#123;</span>longtable<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">\</span>makeatletter</span><br><span class="line"><span class="punctuation">\</span>def<span class="punctuation">\</span>thm<span class="operator">@</span>space<span class="operator">@</span>setup<span class="punctuation">&#123;</span>%</span><br><span class="line">  <span class="punctuation">\</span>thm<span class="operator">@</span>preskip<span class="operator">=</span><span class="number">8</span>pt plus <span class="number">2</span>pt minus <span class="number">4</span>pt</span><br><span class="line">  <span class="punctuation">\</span>thm<span class="operator">@</span>postskip<span class="operator">=</span><span class="punctuation">\</span>thm<span class="operator">@</span>preskip</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">\</span>makeatother</span><br></pre></td></tr></table></figure><h1 id="章节结构"><a href="#章节结构" class="headerlink" title="章节结构"></a>章节结构</h1><p>除了<code>index.Rmd</code>文件， 项目中每个.Rmd文件都作为一章。 每个.Rmd文件第一行， 应该是以一个井号和空格开头的一级标题， 后面再加空格然后有大括号内以井号开头的章标签， 如</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 随机数 &#123;#rng&#125;</span><br></pre></td></tr></table></figure><p>这些章标签去掉井号后会作为生成的HTML文件的名字， 所以一定要有章标签， 而且章节标签在全书中都不要重复以免冲突。 文件内可以用两个井号和一个空格开始的行表示节标题， 最后也应该有大括号内以井号开头的节标签，如</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 随机数 &#123;#rng&#125;</span><br><span class="line"></span><br><span class="line">## 均匀随机数发生器 &#123;#rng-unif&#125;</span><br></pre></td></tr></table></figure><p>使用bookdown写书， 一般每章不要太长， 否则编译预览很慢， 读者浏览网页格式也慢。</p><p>内容相近的章节可以作为一个“部分”。 为此， 在一个部分的第一个章节文件的章标题前面增加一行， 以<code># (PART)</code>开头， 以<code>&#123;-&#125;</code>结尾， 中间是部分的名称，如</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># (PART) 随机数和随机模拟 &#123;-&#125;</span><br><span class="line"></span><br><span class="line"># 随机数 &#123;#rng&#125;</span><br></pre></td></tr></table></figure><p>书的最后可以有附录， 附录的章节将显示为<code>A.1</code>, <code>B.1</code>这样的格式。 为此， 在附录章节的第一个文件开头加如下的第一行标题行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># (APPENDIX) 附录 &#123;-&#125;</span><br><span class="line"></span><br><span class="line"># 一些定理的证明 &#123;#formula&#125;</span><br></pre></td></tr></table></figure><h1 id="书的编译"><a href="#书的编译" class="headerlink" title="书的编译"></a>书的编译</h1><p>在<code>index.Rmd</code>或者<code>_bookdown.yml</code>中设置<code>site: bookdown::bookdown_site</code>后， RStudio就能识别这个项目是一个bookdown项目， 这时RStudio会有一个Build窗格，其中有“Build book”快捷图标， 从下拉菜单中选择一个输出格式（包括gitbook、pdf_book、epub_book）， 就可以编译整本书。 对gitbook格式， 即HTML网页格式， 编译完成后会弹出一个预览窗口， 其中的“Open in Browser”按钮可以将内容在操作系统默认的网络浏览器中打开。</p><p>另一种办法是在命令窗口用如下命令编译，以输出gitbook为例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bookdown::render_book(&quot;index.Rmd&quot;, </span><br><span class="line">  output_format=&quot;bookdown::gitbook&quot;)</span><br></pre></td></tr></table></figure><p>编译结果默认保存在<code>_book</code>子目录中， 可以在<code>_bookdown.yml</code>中设置<code>output_dir</code>项改为其它子目录。 编译整本书为pdf_book格式时，如果成功编译， 也会弹出一个PDF预览窗口。 可以在<code>_book</code>子目录中找到这个PDF文件。</p><p> 每次编译都花费很长时间， 所以可以仅编译gitbook格式的一章， 修改满意后再编译整本书。 仅编译一章也需要所有的.Rmd文件都是已经编译过一遍的， 新增的Rmd文件会使得编译单章出错， 每次新增了Rmd文件都应该重新编译整本书， 但是内容修改后不必要重新编译整本书， 可以仅编译单章。</p><p>编译单章现在没有快捷图标， 只能在RStudio控制台（命令行）运行如下命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bookdown::preview_chapter(&quot;chap-name.Rmd&quot;, </span><br><span class="line">  output_format=&quot;bookdown::gitbook&quot;)</span><br></pre></td></tr></table></figure><p>其中<code>chap-name.Rmd</code>是要编译的单章的文件名。 编译完成后在结果目录（默认是<code>_book</code>）中找到相应的HTML文件打开查看， 再次编译后仅需在浏览器中重新载入文件。</p><p>编译单章也不能解决所有的问题， 有些问题还是需要编译整本书， 而章节很多时整本书编译又太慢。 为此， 可以在项目中增加一个临时的部分内容子目录， 如<code>testing</code>子目录， 在子目录中存放相同的设置文件<code>index.Rmd</code>、<code>_bookdown.yml</code>、<code>_output.yml</code>， 以及图形文件、文献数据库文件， 并将要检查的若干章节复制到<code>testing</code>子目录中， 在<code>testing</code>中新建一个bookdown项目， 然后编译其中的整本书。 这在调试部分章节的HTML和PDF输出时很有效。 解决问题后只要将修改过的章节复制回原始的书的目录中。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;bookdown初始文件生成&quot;&gt;&lt;a href=&quot;#bookdown初始文件生成&quot; class=&quot;headerlink&quot; title=&quot;bookdown初始文件生成&quot;&gt;&lt;/a&gt;bookdown初始文件生成&lt;/h1&gt;&lt;p&gt;在RStudio中通过project管理一个</summary>
      
    
    
    
    <category term="拓展技能" scheme="https://smileszh.github.io/categories/%E6%8B%93%E5%B1%95%E6%8A%80%E8%83%BD/"/>
    
    
    <category term="R语言" scheme="https://smileszh.github.io/tags/R%E8%AF%AD%E8%A8%80/"/>
    
    <category term="R包" scheme="https://smileszh.github.io/tags/R%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>ggplot2包</title>
    <link href="https://smileszh.github.io/posts/2ea551a.html"/>
    <id>https://smileszh.github.io/posts/2ea551a.html</id>
    <published>2023-08-08T00:00:00.000Z</published>
    <updated>2023-12-07T13:03:08.207Z</updated>
    
    <content type="html"><![CDATA[<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><details class="folding-tag" green><summary> 所需R包 </summary>              <div class='content'>              <p>{ggplot2}, part of the {tidyverse} package collection<br>{tidyverse} package collection, namely<br>{dplyr} for data wrangling<br>{tibble} for modern data frames<br>{tidyr} for data cleaning<br>{forcats} for handling factors<br>{corrr} for calculating correlation matrices<br>{cowplot} for composing ggplots<br>{ggforce} for sina plots and other cool stuff<br>{ggrepel} for nice text labeling<br>{ggridges} for ridge plots<br>{ggsci} for nice color palettes<br>{ggtext} for advanced text rendering<br>{ggthemes} for additional themes<br>{grid} for creating graphical objects<br>{gridExtra} for additional functions for “grid” graphics<br>{patchwork} for multi-panel plots<br>{prismatic} for manipulating colors<br>{rcartocolor} for great color palettes<br>{scico} for perceptional uniform palettes<br>{showtext} for custom fonts<br>{shiny} for interactive apps a number of packages for interactive visualizations<br>{charter}<br>{echarts4r}<br>{ggiraph}<br>{highcharter}<br>{plotly}</p>              </div>            </details><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># install CRAN packages</span></span><br><span class="line">install.packages<span class="punctuation">(</span></span><br><span class="line">  <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;ggplot2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tibble&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tidyr&quot;</span><span class="punctuation">,</span> <span class="string">&quot;forcats&quot;</span><span class="punctuation">,</span> <span class="string">&quot;purrr&quot;</span><span class="punctuation">,</span> <span class="string">&quot;prismatic&quot;</span><span class="punctuation">,</span> <span class="string">&quot;corrr&quot;</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="string">&quot;cowplot&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ggforce&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ggrepel&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ggridges&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ggsci&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ggtext&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ggthemes&quot;</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="string">&quot;grid&quot;</span><span class="punctuation">,</span> <span class="string">&quot;gridExtra&quot;</span><span class="punctuation">,</span> <span class="string">&quot;patchwork&quot;</span><span class="punctuation">,</span> <span class="string">&quot;rcartocolor&quot;</span><span class="punctuation">,</span> <span class="string">&quot;scico&quot;</span><span class="punctuation">,</span> <span class="string">&quot;showtext&quot;</span><span class="punctuation">,</span> </span><br><span class="line">    <span class="string">&quot;shiny&quot;</span><span class="punctuation">,</span> <span class="string">&quot;plotly&quot;</span><span class="punctuation">,</span> <span class="string">&quot;highcharter&quot;</span><span class="punctuation">,</span> <span class="string">&quot;echarts4r&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># install from GitHub since not on CRAN</span></span><br><span class="line">install.packages<span class="punctuation">(</span>devtools<span class="punctuation">)</span></span><br><span class="line">devtools<span class="operator">::</span>install_github<span class="punctuation">(</span><span class="string">&quot;JohnCoene/charter&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><h1 id="数据集"><a href="#数据集" class="headerlink" title="数据集"></a>数据集</h1><p>本教程中使用来自空气污染致发病率和死亡率研究(nmaps)的数据。为了使作图易于管理，我们将数据限制在芝加哥1997-2000年间。关于这个数据集的更多细节，请参考Roger Peng的书<a href="https://link.springer.com/book/10.1007/978-0-387-78167-9">《环境流行病学中的统计方法》</a>。</p><p>我们能够使用<mark class="hl-label blue">{readr}</mark> 包中的<mark class="hl-label blue">read_csv()</mark> 函数将数据导入R，并通过箭头<mark class="hl-label blue"><-</mark> 将数据赋值给变量<mark class="hl-label blue">chic</mark> 。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chic <span class="operator">&lt;-</span> readr<span class="operator">::</span>read_csv<span class="punctuation">(</span><span class="string">&quot;https://raw.githubusercontent.com/z3tt/ggplot-courses/main/data/chicago-nmmaps-custom.csv&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br>其中 :: 被称为namespace，可以不加载R包就可以使用函数，也可以先加载R包<mark class="hl-label blue">library(readr)</mark> ，再使用函数<mark class="hl-label blue">chic<-read.csv(...)</mark> 。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">tibble<span class="operator">::</span>glimpse<span class="punctuation">(</span>chic<span class="punctuation">)</span></span><br><span class="line">````</span><br><span class="line">```R</span><br><span class="line">## Rows: 1,461</span><br><span class="line">## Columns: 11</span><br><span class="line">## $ city          &lt;chr&gt; &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chic&quot;, &quot;chi…</span><br><span class="line">## $ date          &lt;date&gt; 1997-01-01, 1997-01-02, 1997-01-03, 1997-01-04, 1997-01-05, 1997-01-06, 1997-01-07, 1997-01-08, 1997-01-09, 1997-01-10, 1997-01-11, 1997-01-12, 1997-01-13, 1997-01-14, 1997-01-15, 1997-01-16, 1997-01-17, 1997-01-18, 1997-01-19, 1997-01-20, 1997-01-21, 1997-01-22, 1997-01-23, 1997-01-24, 1997-01-25, 1997-01-26, 1997-01-27, 1997-01-28, 1997-01-29, 1997-01-30, 1997-01-31, 1997-02-01, 1997-02-02, 1997-02-03, 1997-02-04, 1997-02-05, 1997-02-06, 1997-02-07, 1997-02-08, 1997-02-09, 1997-02-10, 1997-02-11, 1997-02-12, 1997-02-13, 1997-02-14, 1997-02-15, 1997-02-16, 1997-02-17, 1997-02-18, 1997-02-19, 1997-02-20, 1997-02-21, 1997-02-22, 1997-02-23, 1997-02-24, 1997-02-25, 199…</span><br><span class="line">## $ temp          &lt;dbl&gt; 36.0, 45.0, 40.0, 51.5, 27.0, 17.0, 16.0, 19.0, 26.0, 16.0, 1.5, 1.0, 3.0, 10.0, 19.0, 9.5, -3.0, 0.0, 14.0, 31.0, 35.0, 36.5, 26.0, 32.0, 14.5, 11.0, 17.0, 2.0, 8.0, 16.5, 31.5, 35.0, 36.5, 30.0, 34.5, 30.0, 26.0, 25.5, 25.5, 26.0, 27.0, 23.5, 21.0, 20.5, 25.5, 20.0, 18.5, 30.0, 48.5, 37.5, 35.5, 36.0, 26.0, 28.0, 21.5, 25.5, 36.5, 34.5, 37.5, 45.5, 35.0, 33.5, 38.0, 33.0, 26.5, 35.5, 39.0, 37.0, 44.0, 37.0, 33.5, 37.5, 26.5, 19.0, 24.5, 45.0, 33.5, 35.5, 46.0, 53.5, 37.5, 32.5, 33.0, 40.5, 44.0, 60.5, 55.5, 43.5, 37.5, 38.5, 44.5, 53.0, 59.5, 62.5, 60.5, 45.0, 34.0, 28.5, 30.0, 30.5, 33.5, 33.5, 38.5, 41.5, 49.0, 43.0, 40.5, 40.0, 45.5, 49.0, 45.0, 43.0, 48.5, 47.5,…</span><br><span class="line">## $ o3            &lt;dbl&gt; 5.659256, 5.525417, 6.288548, 7.537758, 20.760798, 14.940874, 11.920985, 8.678477, 13.355892, 10.448264, 15.866094, 15.115290, 9.381068, 8.029508, 7.066111, 20.113023, 15.363898, 12.713223, 9.616133, 16.840369, 12.758676, 21.024213, 18.665072, 7.131938, 17.167861, 9.960118, 9.167350, 13.613967, 7.945009, 7.660619, 11.882608, 16.676182, 12.032368, 21.849559, 10.887549, 14.894031, 15.957824, 14.391243, 19.749645, 12.397635, 14.193562, 20.492388, 23.091993, 20.171005, 15.453240, 19.526661, 20.019234, 17.297562, 27.013275, 19.055436, 6.890252, 16.313610, 23.015853, 24.990318, 18.939318, 12.526243, 7.962753, 13.194153, 15.178614, 13.860717, 30.992349, 29.260852, 15.413875,…</span><br><span class="line">## $ dewpoint      &lt;dbl&gt; 37.50000, 47.25000, 38.00000, 45.50000, 11.25000, 5.75000, 7.00000, 17.75000, 24.00000, 5.37500, -6.62500, -8.87500, 1.50000, 11.50000, 23.25000, -9.75000, -10.37500, -4.12500, 22.62500, 27.25000, 41.62500, 20.75000, 18.75000, 29.50000, -1.37500, 17.12500, 8.37500, -6.37500, 11.00000, 16.37500, 33.75000, 29.66667, 29.62500, 28.00000, 32.00000, 24.25000, 21.87500, 23.37500, 22.50000, 21.00000, 21.75000, 19.50000, 11.60000, 16.37500, 23.00000, 15.25000, 8.12500, 32.62500, 41.37500, 27.50000, 44.12500, 29.62500, 24.25000, 14.62500, 10.87500, 27.12500, 35.00000, 30.25000, 36.00000, 44.00000, 27.37500, 29.37500, 28.87500, 28.62500, 13.37500, 35.25000, 28.25000, 32.62500, 3…</span><br><span class="line">## $ pm10          &lt;dbl&gt; 13.052268, 41.948600, 27.041751, 25.072573, 15.343121, 9.364655, 20.228428, 33.134819, 12.118381, 24.761534, 18.126151, 16.013770, 34.991079, 64.945403, 26.941955, 27.022906, 18.837025, 31.859740, 30.923168, 19.894566, 27.882017, 18.508762, 11.845698, 26.687346, 16.612825, 21.641455, 22.672498, 28.101180, 51.776607, 48.741462, 24.686329, 23.784943, 27.762150, 21.600928, 17.050900, 10.157749, 15.943086, 33.010704, 14.955909, 30.410449, 23.914813, 22.972347, 12.712336, 22.719836, 35.676001, 28.373076, 15.662430, 38.744847, 27.597166, 17.612211, 29.768805, 7.340321, 7.856717, 7.908915, 17.834350, 41.124012, 34.052583, 19.749350, 26.126759, 28.129506, 9.940940, 15.980970,…</span><br><span class="line">## $ season        &lt;chr&gt; &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winter&quot;, &quot;Winte…</span><br><span class="line">## $ yday          &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157,…</span><br><span class="line">## $ month         &lt;chr&gt; &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Jan&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;Apr&quot;, &quot;Apr&quot;, &quot;Apr&quot;, &quot;Apr&quot;, &quot;Apr&quot;, &quot;Apr…</span><br><span class="line">## $ month_numeric &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8…</span><br><span class="line">## $ year          &lt;dbl&gt; 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997, 1997…</span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head<span class="punctuation">(</span>chic<span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## # A tibble: 10 × 11</span></span><br><span class="line"><span class="comment">##    city  date        temp    o3 dewpoint  pm10 season  yday month month_numeric  year</span></span><br><span class="line"><span class="comment">##    &lt;chr&gt; &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt;</span></span><br><span class="line"><span class="comment">##  1 chic  1997-01-01  36    5.66    37.5  13.1  Winter     1 Jan               1  1997</span></span><br><span class="line"><span class="comment">##  2 chic  1997-01-02  45    5.53    47.2  41.9  Winter     2 Jan               1  1997</span></span><br><span class="line"><span class="comment">##  3 chic  1997-01-03  40    6.29    38    27.0  Winter     3 Jan               1  1997</span></span><br><span class="line"><span class="comment">##  4 chic  1997-01-04  51.5  7.54    45.5  25.1  Winter     4 Jan               1  1997</span></span><br><span class="line"><span class="comment">##  5 chic  1997-01-05  27   20.8     11.2  15.3  Winter     5 Jan               1  1997</span></span><br><span class="line"><span class="comment">##  6 chic  1997-01-06  17   14.9      5.75  9.36 Winter     6 Jan               1  1997</span></span><br><span class="line"><span class="comment">##  7 chic  1997-01-07  16   11.9      7    20.2  Winter     7 Jan               1  1997</span></span><br><span class="line"><span class="comment">##  8 chic  1997-01-08  19    8.68    17.8  33.1  Winter     8 Jan               1  1997</span></span><br><span class="line"><span class="comment">##  9 chic  1997-01-09  26   13.4     24    12.1  Winter     9 Jan               1  1997</span></span><br><span class="line"><span class="comment">## 10 chic  1997-01-10  16   10.4      5.38 24.8  Winter    10 Jan               1  1997</span></span><br></pre></td></tr></table></figure><h1 id="ggplot包"><a href="#ggplot包" class="headerlink" title="ggplot包"></a>ggplot包</h1><blockquote><p>ggplot是一个基于图形语法的声明式创建图形系统。你提供数据，告诉ggplot如何将ggplot映射变量到美学(aestheics)，使用哪些基本图形基元，它处理细节。</p></blockquote><details class="folding-tag" green><summary> ggplot基本元素 </summary>              <div class='content'>              <p>Data: 想去画图的原始数据。<br>Geometries geom<em>: 数据呈现的几何形状。<br>Aesthetics aes(): 几何和统计对象的美学，例如位置、颜色、大小、形状、透明度。<br>Scales scale</em>: 数据和美学维度的映射，例如从数据范围到图形宽度、因子到图形颜色。<br>Statistical transformations stat<em>: 数据吨统计，例如百分位、拟合曲线、加和。<br>Coordinate system coord</em>: 数据的转换。<br>Facets facet_: 数据图表的排列。<br>Visual themes theme(): 主题的视觉默认值，例如背景、网格、轴、默认字体、大小、颜色。</p>              </div>            </details><h1 id="ggplot基础"><a href="#ggplot基础" class="headerlink" title="ggplot基础"></a>ggplot基础</h1><p>首先我们需要加载<mark class="hl-label blue">ggplot2</mark> ，另外也能使用<mark class="hl-label blue">tidyverse包</mark> 进行加载。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># library(tidyverse)</span></span><br></pre></td></tr></table></figure><br>ggplot2的语法是不同于base R，默认的ggplot需要三样东西：数据(data)、美学(aesthetics)和几何图形(geometry)。我们总是通过ggplot(data = df)去定义一个图形对象，告诉ggplot我们要使用这个数据进行工作。多数情况下，你可能想画两个变量，一个X轴、一个Y轴。这些是位置美学，因此我们添加aes(x = var1, y = var2)到ggplot(是的，aes代表美学)。然而，有些时候，我们可能需要指定一个或三个及以上个变量。</p><p><strong>💡我们在aes()外部指定数据，在内部映射变量</strong></p><p>在此，我们将变量date映射到X轴，将变量temp映射到Y轴，然后，我们也能将变量映射到其他美学，比如颜色、大小和形状。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">(</span>g <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/08/64d1b586568f1.png" style="width:600px;"/></div></div><p>啊！仅仅创建了一个面板。为什么？这是因为ggolot2不知道如何去画这个图形—-我们需要指定一个几何图形。<br>ggplot允许你将最近创建的ggobjict赋值给一个自定义变量，本例中称为g，你也能将这个ggobject添加其他的层，要么一次性添加所有层，要么赋值它给相同或不同的变量进而分多次添加。</p><p><strong>💡将一个图形分配给对象时，默认使用括号，这个图形会立刻显示出来。即使用(g &lt;- ggplot(…))代替g &lt;- ggplot()。</strong></p><p>有很多很多的<a href="https://ggplot2.tidyverse.org/reference/">几何图形</a>（称为geoms，因为每一个函数都以geom_开头）默认能够添加到ggplot，甚至还有很多的<a href="https://exts.ggplot2.tidyverse.org/">扩展包</a>可以被添加。让我们告诉ggplot我们想使用哪种风格的图形吧，例如使用geom_point()创建一个散点图。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> geom_point<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/08/64d1b587f39ea.png" style="width:600px;"/></div></div><p>非常好！我们也可以将图形变为线形（不是最好的，但人总是这样），所以使用geom_line()来看看吧。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> geom_line<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/08/64d1b591a5f63.png" style="width:600px;"/></div></div><p>我们也能结合几个几何图形层—-这将是神奇和有趣的开始。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> geom_line<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> geom_point<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/08/64d1b593ee125.png" style="width:600px;"/></div></div></p><h2 id="调整几何图形的属性"><a href="#调整几何图形的属性" class="headerlink" title="调整几何图形的属性"></a>调整几何图形的属性</h2><p>在<mark class="hl-label blue">geom_*</mark> 命令中可以熟练操作视觉美学，例如点的颜色、形状、大小。让我们将所有的点转化为大大火红色钻石！<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> shape <span class="operator">=</span> <span class="string">&quot;diamond&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/08/64d1b58ebe275.png" style="width:600px;"/></div></div><br><strong>💡 ggplot 能够同时识别color和colour，也可以使用简写版本col。</strong></p><p>你能使用<a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf">预设颜色</a>或<a href="https://www.techopedia.com/definition/29788/color-hex-code">十六进制颜色代码</a>，可以同时使用，甚至可以通过rgb()函数使用RGB/RGBA颜色。</p><p>每个geom都有自己的属性(称为参数)，相同的参数可能导致不同的变化，这取决于你使用的geom。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> shape <span class="operator">=</span> <span class="string">&quot;diamond&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="string">&quot;dotted&quot;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">.3</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/08/64d1b58fd46ad.png" style="width:600px;"/></div></div><h2 id="ggplot默认主题替换"><a href="#ggplot默认主题替换" class="headerlink" title="ggplot默认主题替换"></a>ggplot默认主题替换</h2><p>为了进一步说明ggplot的多用途性，让我们通过设置一个不同的内置主题(例如theme_bw())来摆脱灰色的默认ggplot2外观—-通过调用theme_set()。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">theme_set<span class="punctuation">(</span>theme_bw<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">+</span> geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/08/64d1b5916b13f.png" style="width:600px;"/></div></div><p><strong>💡 theme()是一个<a href="https://ggplot2.tidyverse.org/reference/theme.html">基本的命令</a>，能够修改所有的主题参数（文本、矩形和线）。</strong></p><h1 id="坐标轴"><a href="#坐标轴" class="headerlink" title="坐标轴"></a>坐标轴</h1><h2 id="调整坐标轴标题"><a href="#调整坐标轴标题" class="headerlink" title="调整坐标轴标题"></a>调整坐标轴标题</h2><p>我们使用<mark class="hl-label blue">labs()</mark> 为坐标轴（这里是x和y）指定一个字符串，来调整坐标轴标题。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/27/64ea31e0b3611.png" style="width:600px;"/></div></div></p><details class="folding-tag" green><summary> 🧑‍🎄你也可以使用 xlab() 或 ylab() 分别对坐标轴标题进行修改。 </summary>              <div class='content'>              <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  xlab<span class="punctuation">(</span><span class="string">&quot;Year&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  ylab<span class="punctuation">(</span><span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/27/64ea31e0b3611.png" style="width:600px;"/></div></div>              </div>            </details><p>通常你也可以通过添加符号本身来指定符号(这里是“°”)，但下面的代码不仅允许添加符号，还可以添加上标:<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="built_in">expression</span><span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;Temperature (&quot;</span><span class="punctuation">,</span> degree <span class="operator">~</span> <span class="built_in">F</span><span class="punctuation">,</span> <span class="string">&quot;)&quot;</span><span class="operator">^</span><span class="string">&quot;(Hey, why should we use metric units?!)&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/27/64ea368f32830.png" style="width:600px;"/></div></div></p><h2 id="增加坐标轴和坐标轴标题之间的距离"><a href="#增加坐标轴和坐标轴标题之间的距离" class="headerlink" title="增加坐标轴和坐标轴标题之间的距离"></a>增加坐标轴和坐标轴标题之间的距离</h2><mark class="hl-label blue">theme()</mark> 是修改特定主题元素（文本、标题、方框、符号、背景，...）的基本命令。我们会经常使用他们！现在，我们可以通过在theme()调用中覆盖默认的element_text()来改变所有或特定文本元素的属性(这里是轴标题):<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.title.x <span class="operator">=</span> element_text<span class="punctuation">(</span>vjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.title.y <span class="operator">=</span> element_text<span class="punctuation">(</span>vjust <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/29/64ed4d91d9118.png" style="width:600px;"/></div></div><mark class="hl-label blue">vjust</mark> 仅指垂直对齐，其范围通常在0到1之间，但您也可以指定超出该范围的值。请注意，即使我们在y轴上水平移动轴标题，我们也需要指定<mark class="hl-label blue">vjust</mark> (从标签的角度来看这是正确的)。你也可以通过指定两个文本元素的边距来改变距离:<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.title.x <span class="operator">=</span> element_text<span class="punctuation">(</span>margin <span class="operator">=</span> margin<span class="punctuation">(</span>t <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.title.y <span class="operator">=</span> element_text<span class="punctuation">(</span>margin <span class="operator">=</span> margin<span class="punctuation">(</span>r <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/29/64ed4ed54be34.png" style="width:600px;"/></div></div><p>margin()对象中的标签t和r分别指向顶部和右侧。您还可以将四个边距指定为margin(t, r, b, l)。请注意，我们现在必须更改右边距来修改y轴上的空间，而不是底部边距。</p><p><strong>💡记住边顺序的一个好方法是‘t-r-ou-b-l-e’。</strong></p><h2 id="改变坐标轴标题美学"><a href="#改变坐标轴标题美学" class="headerlink" title="改变坐标轴标题美学"></a>改变坐标轴标题美学</h2><p>同样，我们使用 <mark class="hl-label blue">theme()</mark>  函数修改元素 <mark class="hl-label blue">axis.title</mark>  和/或下级元素 <mark class="hl-label blue">axis.title.x</mark> 和<mark class="hl-label blue">axis.title.y</mark> 。在<mark class="hl-label blue">element_text()</mark>  中，我们可以覆盖默认的<mark class="hl-label blue">size</mark> 、<mark class="hl-label blue">color</mark> 和<mark class="hl-label blue">face</mark> ：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                  face <span class="operator">=</span> <span class="string">&quot;italic&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/29/64ed51de0a726.png" style="width:600px;"/></div></div></p><mark class="hl-label blue">face</mark> 参数能使字体<mark class="hl-label blue">bold</mark> 、<mark class="hl-label blue">italic</mark> 甚至是<mark class="hl-label blue">bold.italic</mark> 。<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.title.x <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;sienna&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.title.y <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;orangered&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/29/64ed52fa92bd3.png" style="width:600px;"/></div></div><details class="folding-tag" green><summary> 🧝你也可以使用axis.ttile和axis.title.y。因为axis.title.x会使用来自axis.title的值。展开查看示例: </summary>              <div class='content'>              <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;sienna&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.title.y <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;orangered&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/29/64ed52fa92bd3.png" style="width:600px;"/></div></div>              </div>            </details><p>坐标轴标题和其他属性可以一次性修改，也可以单独进行修改：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.title <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;sienna&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.title.y <span class="operator">=</span> element_text<span class="punctuation">(</span>face <span class="operator">=</span> <span class="string">&quot;bold.italic&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/29/64ed569dd1805.png" style="width:600px;"/></div></div></p><h2 id="改变坐标轴文本美学"><a href="#改变坐标轴文本美学" class="headerlink" title="改变坐标轴文本美学"></a>改变坐标轴文本美学</h2><p>同样，你也可以使用<mark class="hl-label blue">axis.text</mark> 和/或下级元素<mark class="hl-label blue">axis.text.x</mark> 和<mark class="hl-label default">axis.text.y</mark> 去改变坐标轴文本的外观（这里是数字）：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.text <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;dodgerblue&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.text.x <span class="operator">=</span> element_text<span class="punctuation">(</span>face <span class="operator">=</span> <span class="string">&quot;italic&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1ab438115b.png" style="width:600px;"/></div></div></p><h2 id="旋转坐标轴文本"><a href="#旋转坐标轴文本" class="headerlink" title="旋转坐标轴文本"></a>旋转坐标轴文本</h2><p>通过指定角度，可以旋转任何文本元素。使用 hjust 和 vjust 可以调整之后文本的水平位置（0 = 左，1 = 右）和垂直位置（0 = 上，1 = 下）：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.text.x <span class="operator">=</span> element_text<span class="punctuation">(</span>angle <span class="operator">=</span> <span class="number">50</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1acc26110c.png" style="width:600px;"/></div></div></p><h2 id="移除坐标轴文本和刻度线"><a href="#移除坐标轴文本和刻度线" class="headerlink" title="移除坐标轴文本和刻度线"></a>移除坐标轴文本和刻度线</h2><p>也许很少有理由这么做，但可能就是这样：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.ticks.y <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        axis.text.y <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1adaa19659.png" style="width:600px;"/></div></div></p><p>💡<strong>如果你想去掉一个主题元素，总是使用<mark class="hl-label blue">element_bank()</mark> 。</strong></p><h2 id="移除坐标轴标题"><a href="#移除坐标轴标题" class="headerlink" title="移除坐标轴标题"></a>移除坐标轴标题</h2><p>我们能够再次使用<mark class="hl-label blue">theme_blank()</mark> ，但是使用<mark class="hl-label blue">labs()</mark> （<mark class="hl-label blue">xlab()</mark> ）能够更简单的移除标签：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1d48b9c9ac.png" style="width:600px;"/></div></div></p><p>💡<strong>请注意，<mark class="hl-label blue">NULL</mark>  会删除元素（与 <mark class="hl-label blue">element_blank()</mark> 类似），而空引号””将保留轴标题的间距，并且不会打印任何内容。</strong></p><h2 id="限制坐标轴区间"><a href="#限制坐标轴区间" class="headerlink" title="限制坐标轴区间"></a>限制坐标轴区间</h2><p>有时，您想放大数据，仔细观察数据的某个范围。您可以在不对数据进行取子集的情况下做到这一点：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  ylim<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">50</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1d5da6b0e2.png" style="width:600px;"/></div></div></p><p>或者你能使用<mark class="hl-label blue">scale_y_continuous(limits=c(0,50))</mark> 或者<mark class="hl-label blue">coord_cartesian(ylim=c(0,50))</mark> 。前者删除区域外的所有点，第二种调整可见区域，和<mark class="hl-label blue">ylim(c(0,50))</mark> 类似。你可能会想：两个结果最后是一样的吗？其实是不一样的，会有一个重要的不同。比较接下来的两张图：<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1d91b7bea0.png" style="width:600px;"/></div></div></p><p>您可能已经发现，在左侧Y极限周围有一些空的缓冲区，而在右侧，绘制的点一直延伸到边界甚至更远。这完美地说明了子集（左）与缩放（右）的关系。为了说明这一点的重要性，让我们来看看另一种图表类型—箱形图：<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1d9a1a655c.png" style="width:600px;"/></div></div><br>呃，这是因为<mark class="hl-label blue">scale_x|y_continuous()</mark> 先对数据取子集，所以我们会得到完全不同的（而且是错误的，至少如果这不是你的目的的话）的盒图估计值！我希望您现在不必再回到您的旧脚本，检查您是否在绘图时篡改了数据，并在您的报告、论文或毕业论文中报告了错误的统计摘要…</p><h2 id="强制从原点开始绘图"><a href="#强制从原点开始绘图" class="headerlink" title="强制从原点开始绘图"></a>强制从原点开始绘图</h2><p>与此相关，您可以强制R从原点开始绘制图表：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chic_high <span class="operator">&lt;-</span> dplyr<span class="operator">::</span>filter<span class="punctuation">(</span>chic<span class="punctuation">,</span> temp <span class="operator">&gt;</span> <span class="number">25</span><span class="punctuation">,</span> o3 <span class="operator">&gt;</span> <span class="number">20</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>chic_high<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;darkcyan&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature higher than 25°F&quot;</span><span class="punctuation">,</span></span><br><span class="line">       y <span class="operator">=</span> <span class="string">&quot;Ozone higher than 20 ppb&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  expand_limits<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1dc754f54f.png" style="width:600px;"/></div></div></p><details class="folding-tag" green><summary> 🧑‍🎄使用coord_cartesian也会产生相同的结果。展开查看示例： </summary>              <div class='content'>              <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chic_high <span class="operator">&lt;-</span> dplyr<span class="operator">::</span>filter<span class="punctuation">(</span>chic<span class="punctuation">,</span> temp <span class="operator">&gt;</span> <span class="number">25</span><span class="punctuation">,</span> o3 <span class="operator">&gt;</span> <span class="number">20</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>chic_high<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;darkcyan&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature higher than 25°F&quot;</span><span class="punctuation">,</span></span><br><span class="line">       y <span class="operator">=</span> <span class="string">&quot;Ozone higher than 20 ppb&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_cartesian<span class="punctuation">(</span>xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1dc754f54f.png" style="width:600px;"/></div></div>              </div>            </details><p>我们也能真正的强制从原点开始<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic_high<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;darkcyan&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature higher than 25°F&quot;</span><span class="punctuation">,</span></span><br><span class="line">       y <span class="operator">=</span> <span class="string">&quot;Ozone higher than 20 ppb&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  expand_limits<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_cartesian<span class="punctuation">(</span>expand <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> clip <span class="operator">=</span> <span class="string">&quot;off&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1df43685a8.png" style="width:600px;"/></div></div></p><p><strong>💡 在任何坐标系中，参数 clip = “off”总是以 coord_* 开始，允许在面板区域外绘制。</strong></p><p>在这里，我调用它来确保 c(0, 0) 处的刻度线不会被剪切。更多详情，请参阅 Claus Wilke在<a href="https://twitter.com/clauswilke/status/991542952802619392?lang=en">Twitter</a>上发布的主题。</p><h2 id="相同缩放比例的坐标轴"><a href="#相同缩放比例的坐标轴" class="headerlink" title="相同缩放比例的坐标轴"></a>相同缩放比例的坐标轴</h2><p>为了演示，让我们绘制带有随机噪音的温度与温度的对比图。<mark class="hl-label blue">coord_equal()</mark> 是一个具有指定比率的坐标系，该比率表示 y 轴上的单位数相当于 x 轴上的一个单位数。默认值为 ratio = 1，确保 x 轴上的一个单位与 y 轴上的一个单位长度相同：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> temp <span class="operator">+</span> rnorm<span class="punctuation">(</span>nrow<span class="punctuation">(</span>chic<span class="punctuation">)</span><span class="punctuation">,</span> sd <span class="operator">=</span> <span class="number">20</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;sienna&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F) + random noise&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  xlim<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> ylim<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">150</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_fixed<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1e298722ba.png" style="width:600px;"/></div></div></p><p>比值大于 1 时，y 轴上的单位比 x 轴上的单位长，反之亦然：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> temp <span class="operator">+</span> rnorm<span class="punctuation">(</span>nrow<span class="punctuation">(</span>chic<span class="punctuation">)</span><span class="punctuation">,</span> sd <span class="operator">=</span> <span class="number">20</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;sienna&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F) + random noise&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  xlim<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> ylim<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">150</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_fixed<span class="punctuation">(</span>ratio <span class="operator">=</span> <span class="number">1</span><span class="operator">/</span><span class="number">5</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1e39998309.png" style="width:600px;"/></div></div></p><h2 id="使用函数更改标签"><a href="#使用函数更改标签" class="headerlink" title="使用函数更改标签"></a>使用函数更改标签</h2><p>有时，对标签稍作改动会很方便，比如添加单位或百分号，而不用将它们添加到数据中。在这种情况下，您可以使用函数：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>label <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="punctuation">&#123;</span><span class="built_in">return</span><span class="punctuation">(</span>paste<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="string">&quot;Degrees Fahrenheit&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1e4c3af9b5.png" style="width:600px;"/></div></div></p><h1 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h1><h2 id="添加一个标题"><a href="#添加一个标题" class="headerlink" title="添加一个标题"></a>添加一个标题</h2><p>我们能够通过<mark class="hl-label blue">ggtitle()</mark> 函数添加一个标题<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  ggtitle<span class="punctuation">(</span><span class="string">&quot;Temperatures in Chicago&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1e95c9039b.png" style="width:600px;"/></div></div></p><p>或者，你也能使用<mark class="hl-label blue">labs()</mark> 。在这里，您可以添加多个参数，例如额外的副标题、标题和标签（以及之前显示的轴标题）：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span></span><br><span class="line">       title <span class="operator">=</span> <span class="string">&quot;Temperatures in Chicago&quot;</span><span class="punctuation">,</span></span><br><span class="line">       subtitle <span class="operator">=</span> <span class="string">&quot;Seasonal pattern of daily temperatures from 1997 to 2001&quot;</span><span class="punctuation">,</span></span><br><span class="line">       caption <span class="operator">=</span> <span class="string">&quot;Data: NMMAPS&quot;</span><span class="punctuation">,</span></span><br><span class="line">       tag <span class="operator">=</span> <span class="string">&quot;Fig. 1&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1ec0d1b55b.png" style="width:600px;"/></div></div></p><h2 id="标题加粗并在底线处添加空格"><a href="#标题加粗并在底线处添加空格" class="headerlink" title="标题加粗并在底线处添加空格"></a>标题加粗并在底线处添加空格</h2><p>同样，由于我们要修改主题元素的属性，因此我们使用<mark class="hl-label blue">theme()</mark> 函数，并对文本元素<mark class="hl-label blue">axis.title</mark> 和<mark class="hl-label blue">axis.text</mark> 修改字体和边距。以下对主题元素的所有修改不仅适用于标题，也适用于所有其他标签，如<mark class="hl-label blue">plot.subtitle</mark> 、<mark class="hl-label blue">plot.caption</mark> 、<mark class="hl-label blue">plot.tag</mark> 、<mark class="hl-label blue">legend.title</mark> 、<mark class="hl-label blue">legend.text</mark>  以及 <mark class="hl-label blue">axis.title</mark>  和 <mark class="hl-label blue">axis.text</mark> 。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span></span><br><span class="line">       title <span class="operator">=</span> <span class="string">&quot;Temperatures in Chicago&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                  margin <span class="operator">=</span> margin<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                  size <span class="operator">=</span> <span class="number">14</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1ef76a5798.png" style="width:600px;"/></div></div><p><strong>💡 要记住边线参数的顺序，一个很好的方法是 “t-r-oub-l-e”，它类似于四边的第一个字母。</strong></p><h2 id="调整标题位置"><a href="#调整标题位置" class="headerlink" title="调整标题位置"></a>调整标题位置</h2><p>通常情况下，对齐（左、中、右）是通过<mark class="hl-label blue">hjust</mark> （代表水平调整）进行调节。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">       title <span class="operator">=</span> <span class="string">&quot;Temperatures in Chicago&quot;</span><span class="punctuation">,</span></span><br><span class="line">       caption <span class="operator">=</span> <span class="string">&quot;Data: NMMAPS&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>hjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">16</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold.italic&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1f2864d2d4.png" style="width:600px;"/></div></div></p><p>当然，我们也有可能进行垂直方向的调整，其使用<mark class="hl-label blue">vjust</mark> 进行调整。</p><p>自 2019 年起，用户可以根据面板区域（默认）或 <mark class="hl-label blue">plot.title.position</mark> 和<mark class="hl-label blue">plot.caption.position</mark> 指定标题、副标题和标题的对齐方式。实际上，在大多数情况下，后者在设计上是更好的选择，许多人对这项新功能感到非常高兴，因为尤其是对于很长的 Y 轴标签，对齐方式看起来非常糟糕：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">(</span>g <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>label <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="punctuation">&#123;</span><span class="built_in">return</span><span class="punctuation">(</span>paste<span class="punctuation">(</span>x<span class="punctuation">,</span> <span class="string">&quot;Degrees Fahrenheit&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">       title <span class="operator">=</span> <span class="string">&quot;Temperatures in Chicago between 1997 and 2001 in Degrees Fahrenheit&quot;</span><span class="punctuation">,</span></span><br><span class="line">       caption <span class="operator">=</span> <span class="string">&quot;Data: NMMAPS&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">14</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold.italic&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        plot.caption <span class="operator">=</span> element_text<span class="punctuation">(</span>hjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1f482804b7.png" style="width:600px;"/></div></div></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> theme<span class="punctuation">(</span>plot.title.position <span class="operator">=</span> <span class="string">&quot;plot&quot;</span><span class="punctuation">,</span></span><br><span class="line">          plot.caption.position <span class="operator">=</span> <span class="string">&quot;plot&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/01/64f1f4bbc9ff2.png" style="width:600px;"/></div></div><h2 id="标题中使用非传统字体"><a href="#标题中使用非传统字体" class="headerlink" title="标题中使用非传统字体"></a>标题中使用非传统字体</h2><p>您还可以使用不同的字体，而不仅仅是 ggplot 提供的默认字体（不同操作系统提供的字体也不同）。有几个软件包可以帮助您使用安装在机器上的字体（您可能会在办公程序中使用这些字体）。在这里，我使用了<a href="https://github.com/yixuan/showtext">showtext</a>软件包，它可以让我们在R绘图中轻松使用各种类型的字体（TrueType、OpenType、Type 1、web fonts等）。加载软件包后，你还需要导入安装在设备上的字体。我经常使用Google字体，这些字体可以通过函数<mark class="hl-label blue">font_add_google()</mark> 导入，但也可以通过<mark class="hl-label blue">font_add()</mark> 添加其他字体。请注意，即使使用<a href="https://fonts.google.com/">Google字体</a>，也必须安装字体并重启Rstudio才能使用。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>showtext<span class="punctuation">)</span></span><br><span class="line">font_add_google<span class="punctuation">(</span><span class="string">&quot;Gochi Hand&quot;</span><span class="punctuation">,</span> <span class="string">&quot;gochi&quot;</span><span class="punctuation">)</span></span><br><span class="line">font_add_google<span class="punctuation">(</span><span class="string">&quot;Schoolbell&quot;</span><span class="punctuation">,</span> <span class="string">&quot;bell&quot;</span><span class="punctuation">)</span></span><br><span class="line">font_add_google<span class="punctuation">(</span><span class="string">&quot;Covered By Your Grace&quot;</span><span class="punctuation">,</span> <span class="string">&quot;grace&quot;</span><span class="punctuation">)</span></span><br><span class="line">font_add_google<span class="punctuation">(</span><span class="string">&quot;Rock Salt&quot;</span><span class="punctuation">,</span> <span class="string">&quot;rock&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></p><p>现在，我们可以使用—是的，你猜对了—<mark class="hl-label blue">theme()</mark> 来使用这些字体家族：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span></span><br><span class="line">       title <span class="operator">=</span> <span class="string">&quot;Temperatures in Chicago&quot;</span><span class="punctuation">,</span></span><br><span class="line">       subtitle <span class="operator">=</span> <span class="string">&quot;Daily temperatures in °F from 1997 to 2001&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>family <span class="operator">=</span> <span class="string">&quot;gochi&quot;</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">25</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        plot.subtitle <span class="operator">=</span> element_text<span class="punctuation">(</span>family <span class="operator">=</span> <span class="string">&quot;bell&quot;</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f217823270c.png" style="width:600px;"/></div></div></p><p>您也可以为绘图中的所有文本元素设置非默认字体，详情请参阅 “主题 “部分。我将使用 Roboto Condensed 作为以下所有绘图的新字体。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">font_add_google<span class="punctuation">(</span><span class="string">&quot;Roboto Condensed&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Roboto Condensed&quot;</span><span class="punctuation">)</span></span><br><span class="line">theme_set<span class="punctuation">(</span>theme_bw<span class="punctuation">(</span>base_size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">,</span> base_family <span class="operator">=</span> <span class="string">&quot;Roboto Condensed&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br>(之前，本教程使用的是{extrafont}软件包，它在去年之前一直做得很好。突然间，我再也不能添加任何新字体了，而且在换了新笔记本电脑后，软件包根本找不到任何字体……现在我通常建议使用{ragg}软件包。不过，我没能让它在我的主页上发挥作用，所以我使用了{showtext}软件包，它也很不错，唯一的主要区别是，你需要用{showtext}明确导入你想使用的字体。不过，{showtext}似乎并不能很好地解决一些<a href="https://twitter.com/thomasp85/status/1355083725156077571">技术细节问题</a>，所以你可能会在万不得已的情况下才使用这个软件包（)。</p><h2 id="更改多行文本的间距"><a href="#更改多行文本的间距" class="headerlink" title="更改多行文本的间距"></a>更改多行文本的间距</h2><p>你可以使用<mark class="hl-label blue">lineheight</mark> 参数来改变行间距。在本例中，我将行距压缩到了一起（lineheight &lt; 1）。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  ggtitle<span class="punctuation">(</span><span class="string">&quot;Temperatures in Chicago\nfrom 1997 to 2001&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>lineheight <span class="operator">=</span> <span class="number">.8</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">16</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f219cf18c24.png" style="width:600px;"/></div></div></p><h1 id="图例"><a href="#图例" class="headerlink" title="图例"></a>图例</h1><p>我们将根据季节对绘图进行颜色编码。或者用更像ggplot的方式来表述：我们将season变量映射为美学颜色。{ggplot2}的一个优点是，在将变量映射到美学颜色时，它会默认添加一个图例。你可以看到，默认情况下，图例标题是我们在颜色参数中指定的：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span></span><br><span class="line">       aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f286b8c8e27.png" style="width:600px;"/></div></div></p><h2 id="关闭图例"><a href="#关闭图例" class="headerlink" title="关闭图例"></a>关闭图例</h2><p>第一个问题总是：”如何才能去掉图例？</p><p>它是很简单的，总是使用<mark class="hl-label blue">theme(legend.position=none)</mark> <br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span></span><br><span class="line">       aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f287a48a20b.png" style="width:600px;"/></div></div></p><p>你也能根据实际情况使用<mark class="hl-label blue">guides(color=none)</mark> 或者<mark class="hl-label blue">scale_color_discrete(guide=none)</mark> 。更改主题元素会一次性删除所有图例，而使用后一种选项则可以删除特定图例，同时保留其他一些图例：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span></span><br><span class="line">       aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span></span><br><span class="line">           color <span class="operator">=</span> season<span class="punctuation">,</span> shape <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  guides<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f28b94170db.png" style="width:600px;"/></div></div></p><p>例如，在这里，我们保留了形状的图例，而丢弃了颜色的图例。</p><h2 id="移除图例标题"><a href="#移除图例标题" class="headerlink" title="移除图例标题"></a>移除图例标题</h2><p>我们早已学到的，使用<mark class="hl-label blue">element_blank()</mark> :<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.title <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f28f3be91d3.png" style="width:600px;"/></div></div></p><details class="folding-tag" green><summary> 你也可以使用图例名为NULL来实现相同的效果，通过scale_color_discrete(name=NULL)或labs(color = NULL)。展开查看示例： </summary>              <div class='content'>              <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_discrete<span class="punctuation">(</span>name <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f28f3be91d3.png" style="width:600px;"/></div></div><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>color <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f28f3be91d3.png" style="width:600px;"/></div></div>              </div>            </details><h2 id="改变图例位置"><a href="#改变图例位置" class="headerlink" title="改变图例位置"></a>改变图例位置</h2><p>如果不想将图例放在右侧，可以使用 legend.position 作为主题参数。可能的位置有 “顶部”、”右侧”（默认）、”底部 “和 “左侧”。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&quot;top&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f29179cb8a8.png" style="width:600px;"/></div></div></p><p>您也可以通过指定一个具有相对 x 和 y 坐标的向量，将图例置于面板内部，该向量的范围为 0（左侧或底部）到 1（右侧或顶部）：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span></span><br><span class="line">       color <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">.15</span><span class="punctuation">,</span> <span class="number">.15</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;transparent&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f29239a481c.png" style="width:600px;"/></div></div><br>在这里，我还用透明填充覆盖了默认的白色图例背景，以确保图例不会隐藏任何数据点。</p><h2 id="改变图例方向"><a href="#改变图例方向" class="headerlink" title="改变图例方向"></a>改变图例方向</h2><p>如您所见，图例方向默认为垂直，但选择 “顶部 “或 “底部 “位置时，图例方向则为水平。不过，您也可以随意切换方向：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">.5</span><span class="punctuation">,</span> <span class="number">.97</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;transparent&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  guides<span class="punctuation">(</span>color <span class="operator">=</span> guide_legend<span class="punctuation">(</span>direction <span class="operator">=</span> <span class="string">&quot;horizontal&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f293426b80e.png" style="width:600px;"/></div></div></p><h2 id="改变图例标题风格"><a href="#改变图例标题风格" class="headerlink" title="改变图例标题风格"></a>改变图例标题风格</h2><p>你也可以通过主题元素<mark class="hl-label blue">legend.title</mark> 调整图例标题外观：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.title <span class="operator">=</span> element_text<span class="punctuation">(</span>family <span class="operator">=</span> <span class="string">&quot;Playfair&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    color <span class="operator">=</span> <span class="string">&quot;chocolate&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    size <span class="operator">=</span> <span class="number">14</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f2952244f16.png" style="width:600px;"/></div></div></p><h2 id="改变图例标题"><a href="#改变图例标题" class="headerlink" title="改变图例标题"></a>改变图例标题</h2><p>更改图例标题的最简单方法是使用<mark class="hl-label blue">labs()</mark>  图层：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span></span><br><span class="line">       color <span class="operator">=</span> <span class="string">&quot;Seasons\nindicated\nby colors:&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.title <span class="operator">=</span> element_text<span class="punctuation">(</span>family <span class="operator">=</span> <span class="string">&quot;Playfair&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    color <span class="operator">=</span> <span class="string">&quot;chocolate&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    size <span class="operator">=</span> <span class="number">14</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f295d3ac4ad.png" style="width:600px;"/></div></div></p><p>可通过 scale_color_discrete(name = “title”) 或 guides(color = guide_legend(“title”))更改图例细节：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.title <span class="operator">=</span> element_text<span class="punctuation">(</span>family <span class="operator">=</span> <span class="string">&quot;Playfair&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    color <span class="operator">=</span> <span class="string">&quot;chocolate&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    size <span class="operator">=</span> <span class="number">14</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_discrete<span class="punctuation">(</span>name <span class="operator">=</span> <span class="string">&quot;Seasons\nindicated\nby colors:&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f295d3ac4ad.png" style="width:600px;"/></div></div></p><h2 id="改变图例顺序"><a href="#改变图例顺序" class="headerlink" title="改变图例顺序"></a>改变图例顺序</h2><p>我们能够通过改变<mark class="hl-label blue">season</mark> levels完成这个目的。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chic<span class="operator">$</span>season <span class="operator">&lt;-</span></span><br><span class="line">  factor<span class="punctuation">(</span>chic<span class="operator">$</span>season<span class="punctuation">,</span></span><br><span class="line">         levels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Winter&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Spring&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Summer&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Autumn&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f2979bd495a.png" style="width:600px;"/></div></div></p><h2 id="改变图例标签"><a href="#改变图例标签" class="headerlink" title="改变图例标签"></a>改变图例标签</h2><p>我们将通过在<mark class="hl-label blue">scale_color_discrete()</mark> 调用中提供一个名称向量，用months来替换seasons：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_discrete<span class="punctuation">(</span></span><br><span class="line">    name <span class="operator">=</span> <span class="string">&quot;Seasons:&quot;</span><span class="punctuation">,</span></span><br><span class="line">    labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Mar—May&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Jun—Aug&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Sep—Nov&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Dec—Feb&quot;</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.title <span class="operator">=</span> element_text<span class="punctuation">(</span></span><br><span class="line">    family <span class="operator">=</span> <span class="string">&quot;Playfair&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;chocolate&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">14</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="number">2</span></span><br><span class="line">  <span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f2997c0ac6e.png" style="width:600px;"/></div></div></p><h2 id="更改图例中的背景框"><a href="#更改图例中的背景框" class="headerlink" title="更改图例中的背景框"></a>更改图例中的背景框</h2><p>要更改图例键的背景颜色（填充），我们需要调整主题元素<mark class="hl-label blue">legend.key</mark> 的设置：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;darkgoldenrod1&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.title <span class="operator">=</span> element_text<span class="punctuation">(</span>family <span class="operator">=</span> <span class="string">&quot;Playfair&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    color <span class="operator">=</span> <span class="string">&quot;chocolate&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    size <span class="operator">=</span> <span class="number">14</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_discrete<span class="punctuation">(</span><span class="string">&quot;Seasons:&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/02/64f29a3869684.png" style="width:600px;"/></div></div></p><p>如果想完全消除它们，请使用<mark class="hl-label blue">fill=NA</mark> 或<mark class="hl-label blue">fill=“transparent”</mark> 。</p><h2 id="更改图例符号的大小"><a href="#更改图例符号的大小" class="headerlink" title="更改图例符号的大小"></a>更改图例符号的大小</h2><p>如果使用默认尺寸，图例中的点可能会有点模糊，尤其是在没有方框的情况下。要覆盖默认值，可以再次使用<mark class="hl-label blue">guides</mark> ，如下所示：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.title <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;chocolate&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    size <span class="operator">=</span> <span class="number">14</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_discrete<span class="punctuation">(</span><span class="string">&quot;Seasons:&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  guides<span class="punctuation">(</span>color <span class="operator">=</span> guide_legend<span class="punctuation">(</span>override.aes <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4ad8b9d657.png" style="width:600px;"/></div></div></p><h2 id="双层图例"><a href="#双层图例" class="headerlink" title="双层图例"></a>双层图例</h2><p>比方说，您有两个不同的几何形状映射到同一个变量。例如，同一数据的点图层和轴须图层都以颜色为美学特征。默认情况下，点和 “线”都会这样出现在图例中：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_rug<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4afd06f76f.png" style="width:600px;"/></div></div></p><p>你可以使用<mark class="hl-label blue">show.legend=FALSE</mark> 去掉一层图例<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_rug<span class="punctuation">(</span>show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4b0c765830.png" style="width:600px;"/></div></div></p><h2 id="手动添加图例条目"><a href="#手动添加图例条目" class="headerlink" title="手动添加图例条目"></a>手动添加图例条目</h2><p>{ggplot2}不会自动添加图例，除非你将美学（颜色、大小等）映射到变量上。不过，有时候我还是希望添加一个图例，这样就能清楚地知道你在绘制什么。<br>这里是默认图：<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4b180521cf.png" style="width:600px;"/></div></div></p><p>我们可以通过将guide映射到变量来强制生成图例。我们使用<mark class="hl-label blue">aes()</mark> 对线条和点进行映射，而且不是映射到数据集中的变量，而是映射到单个字符串（这样我们就能为每个字符串选择一种颜色）。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_line<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;line&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;points&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_discrete<span class="punctuation">(</span><span class="string">&quot;Type:&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4b33745040.png" style="width:600px;"/></div></div></p><p>我们快成功了，但这不是我们想要的。我们想要灰色和红色！要改变颜色，我们可以使用<mark class="hl-label blue">scale_color_manual()</mark> 。此外，我们还可以使用<mark class="hl-label blue">guides()</mark> 函数覆盖图例美学。</p><p>好了！现在，我们已经绘制了一幅图，图例符号为灰色线和红色点，以及一条灰色线和一个红色点：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_line<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;line&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;points&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_manual<span class="punctuation">(</span>name <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">                     guide <span class="operator">=</span> <span class="string">&quot;legend&quot;</span><span class="punctuation">,</span></span><br><span class="line">                     values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;points&quot;</span> <span class="operator">=</span> <span class="string">&quot;darkorange2&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="string">&quot;line&quot;</span> <span class="operator">=</span> <span class="string">&quot;gray&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  guides<span class="punctuation">(</span>color <span class="operator">=</span> guide_legend<span class="punctuation">(</span>override.aes <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>linetype <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                                  shape <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span> <span class="number">16</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4b4af787ed.png" style="width:600px;"/></div></div></p><h2 id="使用其他风格的图例"><a href="#使用其他风格的图例" class="headerlink" title="使用其他风格的图例"></a>使用其他风格的图例</h2><p>季节等分类变量的默认图例是<mark class="hl-label blue">guide_legend()</mark> ，这在之前的几个示例中都有所体现。如果将连续变量映射为审美变量，{ggplot2} 默认不使用 guide_legend()，而是使用<mark class="hl-label blue">guide_colorbar()</mark> (或<mark class="hl-label blue">guide_colourbar()</mark> </p><p>不过，通过使用<mark class="hl-label blue">guide_legend()</mark> ，您可以强制图例显示给定断点数的离散颜色，就像分类变量一样：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span></span><br><span class="line">       aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  guides<span class="punctuation">(</span>color <span class="operator">=</span> guide_legend<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4b6920d593.png" style="width:600px;"/></div></div></p><p>您还可以使用分档刻度：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span></span><br><span class="line">       aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  guides<span class="punctuation">(</span>color <span class="operator">=</span> guide_bins<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4b7351f809.png" style="width:600px;"/></div></div></p><p>……或作为离散色条的分选标尺：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span></span><br><span class="line">       aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  guides<span class="punctuation">(</span>color <span class="operator">=</span> guide_colorsteps<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4b7d258723.png" style="width:600px;"/></div></div></p><h1 id="背景和网格线"><a href="#背景和网格线" class="headerlink" title="背景和网格线"></a>背景和网格线</h1><p>有一些方法可以通过一个函数改变整个绘图的外观（见下文 “主题 “部分），但如果您只想改变一些元素的颜色，也可以这样做。</p><h2 id="更改面板背景颜色"><a href="#更改面板背景颜色" class="headerlink" title="更改面板背景颜色"></a>更改面板背景颜色</h2><p>要更改面板区域（即绘制数据的区域）的背景色（填充色），需要调整主题元素<mark class="hl-label blue">panel.background</mark> ：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;#1D8565&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span></span><br><span class="line">    fill <span class="operator">=</span> <span class="string">&quot;#64D2AA&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;#64D2AA&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4b9aff10ca.png" style="width:600px;"/></div></div></p><p>请注意，即使我们指定了真正的颜色—面板背景的轮廓—也没有改变。这是因为在<mark class="hl-label blue">panel.background</mark> 的顶部还有一个层，即<mark class="hl-label blue">panel.border</mark> 。不过，请确保在这里使用透明填充，否则您的数据就会隐藏在这一层后面。在下面的示例中，我使用半透明的十六进制颜色作为<mark class="hl-label blue">element_rect</mark> 中的填充参数来说明这一点：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;#1D8565&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.border <span class="operator">=</span> element_rect<span class="punctuation">(</span></span><br><span class="line">    fill <span class="operator">=</span> <span class="string">&quot;#64D2AA99&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;#64D2AA&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4ba915e750.png" style="width:600px;"/></div></div></p><h2 id="改变网格线"><a href="#改变网格线" class="headerlink" title="改变网格线"></a>改变网格线</h2><p>网格线有两种类型：表示刻度线的主要网格线和主要刻度线之间的次要网格线。您可以通过覆盖<mark class="hl-label blue">panel.grid</mark> 的默认值或分别覆盖<mark class="hl-label blue">panel.grid.major</mark> 和<mark class="hl-label blue">panel.grid.minor</mark> 每组网格线的默认值来更改所有网格线。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid.major <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;gray10&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid.minor <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;gray70&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">.25</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4bc1cd5718.png" style="width:600px;"/></div></div></p><p>您甚至可以指定所有四个不同级别的设置：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid.major <span class="operator">=</span> element_line<span class="punctuation">(</span>linewidth <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="string">&quot;dashed&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid.minor <span class="operator">=</span> element_line<span class="punctuation">(</span>linewidth <span class="operator">=</span> <span class="number">.25</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="string">&quot;dotted&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid.major.x <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;red1&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid.major.y <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;blue1&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid.minor.x <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;red4&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid.minor.y <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;blue4&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4bd15c46b1.png" style="width:600px;"/></div></div></p><p>当然，如果你愿意，也可以移除部分或全部网格线：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid.minor <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4bdff69271.png" style="width:600px;"/></div></div></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4be52d3357.png" style="width:600px;"/></div></div><h2 id="更改网格线间距"><a href="#更改网格线间距" class="headerlink" title="更改网格线间距"></a>更改网格线间距</h2><p>此外，您还可以定义主网格线和次网格线之间的分隔：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                     minor_breaks <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">,</span> <span class="number">2.5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4bf0c2ed43.png" style="width:600px;"/></div></div></p><h2 id="更改绘图背景颜色"><a href="#更改绘图背景颜色" class="headerlink" title="更改绘图背景颜色"></a>更改绘图背景颜色</h2><p>同样，要更改绘图区域的背景颜色（填充），需要修改主题元素<mark class="hl-label blue">plot.background</mark> ：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;gray60&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                       color <span class="operator">=</span> <span class="string">&quot;gray30&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4bfebabe40.png" style="width:600px;"/></div></div></p><p>您可以在<mark class="hl-label blue">panel.background</mark> 和<mark class="hl-label blue">plot.background</mark> 中设置相同的颜色，或者将面板的背景填充设置为 “”transparent” “或 NA，从而获得独特的背景颜色：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        plot.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;gray60&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                       color <span class="operator">=</span> <span class="string">&quot;gray30&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f4c16e5ede2.png" style="width:600px;"/></div></div></p><h1 id="边距"><a href="#边距" class="headerlink" title="边距"></a>边距</h1><p>有时，给绘图边距增加一点空间也很有用。与前面的例子类似，我们可以使用 <mark class="hl-label blue">theme()</mark> 函数的一个参数。本例中的参数是<mark class="hl-label blue">plot.margin</mark> 。在上一个示例中，我们已经通过<mark class="hl-label blue">plot.background</mark> 更改背景颜色来说明默认边距。</p><p>现在，让我们在左侧和右侧添加额外的空间。参数<mark class="hl-label blue">plot.margin</mark> 可以处理各种不同的单位（厘米cm、英寸inches等），但需要使用软件包<mark class="hl-label blue">grid</mark> 中的函数<mark class="hl-label blue">unit</mark> 来指定单位。您可以为所有边提供相同的值（最简单的方法是使用rep(x,4)），也可以为每个边提供特定的距离。在这里，我在顶部和底部使用了1厘米的边距，在右侧使用了3厘米的边距，在左侧使用了8厘米的边距。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;gray60&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        plot.margin <span class="operator">=</span> margin<span class="punctuation">(</span>t <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> r <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> b <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> l <span class="operator">=</span> <span class="number">8</span><span class="punctuation">,</span> unit <span class="operator">=</span> <span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f5faa97c389.png" style="width:600px;"/></div></div></p><details class="folding-tag" green><summary> 🧙‍♀️你也可以使用unit()代替margin()。 </summary>              <div class='content'>              <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;gray60&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        plot.margin <span class="operator">=</span> unit<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">8</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f5faa97c389.png" style="width:600px;"/></div></div>              </div>            </details><p>he</p><h1 id="多面板图"><a href="#多面板图" class="headerlink" title="多面板图"></a>多面板图</h1><p>{ggplot2}软件包有两个创建多面板绘图的好函数，称为切面。它们相互关联，但又略有不同：<mark class="hl-label blue">facet_wrap</mark> 主要是根据单一变量创建图形带，而<mark class="hl-label blue">facet_grid</mark> 则是跨越两个变量的网格。</p><h2 id="基于两个变量创建多面版图"><a href="#基于两个变量创建多面版图" class="headerlink" title="基于两个变量创建多面版图"></a>基于两个变量创建多面版图</h2><p>如果有两个变量，则由<mark class="hl-label blue">faceet_grid</mark> 来完成。在这里，变量的顺序决定了行数和列数：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;orangered&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.3</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.text.x <span class="operator">=</span> element_text<span class="punctuation">(</span>angle <span class="operator">=</span> <span class="number">45</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_grid<span class="punctuation">(</span>year <span class="operator">~</span> season<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/04/64f5fe36ad23d.png" style="width:600px;"/></div></div></p><p>你能将<mark class="hl-label blue">facet_grid(year~season)</mark> 改为<mark class="hl-label blue">hefacet_grid(season~year)</mark> ，从而将行排列改为列。</p><h2 id="基于一个变量创建多面板图"><a href="#基于一个变量创建多面板图" class="headerlink" title="基于一个变量创建多面板图"></a>基于一个变量创建多面板图</h2><mark class="hl-label blue">facet_wrap</mark> 可以创建单个变量的多面板图，在前面加上波浪号：<mark class="hl-label blue">facet_wrap(~variable)</mark> 。这些子图的外观由参数<mark class="hl-label blue">ncol</mark> 和<mark class="hl-label blue">nrow</mark> 控制：<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">&lt;-</span></span><br><span class="line">  ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;chartreuse4&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.3</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    theme<span class="punctuation">(</span>axis.text.x <span class="operator">=</span> element_text<span class="punctuation">(</span>angle <span class="operator">=</span> <span class="number">45</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">+</span> facet_wrap<span class="punctuation">(</span><span class="operator">~</span> year<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/05/64f60151d5dba.png" style="width:600px;"/></div></div><p>因此，您可以按照自己的喜好排列图块，而不是以一行矩阵的形式…<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> facet_wrap<span class="punctuation">(</span><span class="operator">~</span> year<span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/05/64f601e38914b.png" style="width:600px;"/></div></div></p><p>……甚至是不对称的网格块：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> facet_wrap<span class="punctuation">(</span><span class="operator">~</span> year<span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span> <span class="operator">+</span> theme<span class="punctuation">(</span>axis.title.x <span class="operator">=</span> element_text<span class="punctuation">(</span>hjust <span class="operator">=</span> <span class="number">.15</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/05/64f602bed7993.png" style="width:600px;"/></div></div></p><h2 id="允许坐标轴自由定义比例"><a href="#允许坐标轴自由定义比例" class="headerlink" title="允许坐标轴自由定义比例"></a>允许坐标轴自由定义比例</h2><p>{ggplot2}中的多面板图默认在每个面板中使用等效比例。但有时您希望让面板自身的数据来决定比例。这通常不是一个好主意，因为它可能会给用户留下错误的数据印象。但有时这确实是有用的，为此您可以设置 <mark class="hl-label blue">scales=free</mark> ：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> facet_wrap<span class="punctuation">(</span><span class="operator">~</span> year<span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> scales <span class="operator">=</span> <span class="string">&quot;free&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/05/64f6044c52e6d.png" style="width:600px;"/></div></div><br>请注意，X 轴和 Y 轴的范围不同！</p><h2 id="当两个变量时使用"><a href="#当两个变量时使用" class="headerlink" title="当两个变量时使用"></a>当两个变量时使用<mark class="hl-label blue">facet_wrap</mark> </h2><p>函数<mark class="hl-label blue">facet_wrap</mark> 也可以使用两个变量：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> facet_wrap<span class="punctuation">(</span>year <span class="operator">~</span> season<span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="number">4</span><span class="punctuation">,</span> scales <span class="operator">=</span> <span class="string">&quot;free_x&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/05/64f60682b16c4.png" style="width:600px;"/></div></div></p><p>使用<mark class="hl-label blue">facet_wrap</mark> 时，你仍然可以控制网格设计：你可以重新排列每行和每列的绘图数量，也可以让所有坐标轴自由移动。相比之下，<mark class="hl-label blue">facet_grid</mark> 也会接受一个自由参数，但只能让它在每列或每行自由移动：</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/05/64f6089573e19.png" style="width:600px;"/></div></div><h2 id="修改带状文本的风格"><a href="#修改带状文本的风格" class="headerlink" title="修改带状文本的风格"></a>修改带状文本的风格</h2><p>通过使用主题，您可以修改条状文本（即每个面的标题）和条状文本框的外观：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> facet_wrap<span class="punctuation">(</span><span class="operator">~</span> year<span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> scales <span class="operator">=</span> <span class="string">&quot;free_x&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>strip.text <span class="operator">=</span> element_text<span class="punctuation">(</span>face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;chartreuse4&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                  hjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">20</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        strip.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;chartreuse3&quot;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="string">&quot;dotted&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/05/64f609c7dbaba.png" style="width:600px;"/></div></div></p><p>以下<a href="https://stackoverflow.com/questions/60332202/conditionally-fill-ggtext-text-boxes-in-facet-wrap">两个函数</a>改编自{ggtext}软件包的作者Claus Wilke，可以与<a href="https://wilkelab.org/ggtext/">{ggtext}</a>提供的<mark class="hl-label blue">element_textbox()</mark> 结合使用，突出显示特定标签。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggtext<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>purrr<span class="punctuation">)</span> <span class="comment">## for %||%</span></span><br><span class="line"></span><br><span class="line">element_textbox_highlight <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>...<span class="punctuation">,</span> hi.labels <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> hi.fill <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">                                      hi.col <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> hi.box.col <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> hi.family <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  structure<span class="punctuation">(</span></span><br><span class="line">    <span class="built_in">c</span><span class="punctuation">(</span>element_textbox<span class="punctuation">(</span>...<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      <span class="built_in">list</span><span class="punctuation">(</span>hi.labels <span class="operator">=</span> hi.labels<span class="punctuation">,</span> hi.fill <span class="operator">=</span> hi.fill<span class="punctuation">,</span> hi.col <span class="operator">=</span> hi.col<span class="punctuation">,</span> hi.box.col <span class="operator">=</span> hi.box.col<span class="punctuation">,</span> hi.family <span class="operator">=</span> hi.family<span class="punctuation">)</span></span><br><span class="line">    <span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    <span class="built_in">class</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;element_textbox_highlight&quot;</span><span class="punctuation">,</span> <span class="string">&quot;element_textbox&quot;</span><span class="punctuation">,</span> <span class="string">&quot;element_text&quot;</span><span class="punctuation">,</span> <span class="string">&quot;element&quot;</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">element_grob.element_textbox_highlight <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>element<span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> ...<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span>label <span class="operator">%in%</span> element<span class="operator">$</span>hi.labels<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    element<span class="operator">$</span>fill <span class="operator">&lt;-</span> element<span class="operator">$</span>hi.fill <span class="operator">%||%</span> element<span class="operator">$</span>fill</span><br><span class="line">    element<span class="operator">$</span>colour <span class="operator">&lt;-</span> element<span class="operator">$</span>hi.col <span class="operator">%||%</span> element<span class="operator">$</span>colour</span><br><span class="line">    element<span class="operator">$</span>box.colour <span class="operator">&lt;-</span> element<span class="operator">$</span>hi.box.col <span class="operator">%||%</span> element<span class="operator">$</span>box.colour</span><br><span class="line">    element<span class="operator">$</span>family <span class="operator">&lt;-</span> element<span class="operator">$</span>hi.family <span class="operator">%||%</span> element<span class="operator">$</span>family</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  NextMethod<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><br>现在，您可以使用它来指定所有文本条：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> facet_wrap<span class="punctuation">(</span>year <span class="operator">~</span> season<span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="number">4</span><span class="punctuation">,</span> scales <span class="operator">=</span> <span class="string">&quot;free_x&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span></span><br><span class="line">    strip.background <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    strip.text <span class="operator">=</span> element_textbox_highlight<span class="punctuation">(</span></span><br><span class="line">      family <span class="operator">=</span> <span class="string">&quot;Arial&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span></span><br><span class="line">      fill <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> box.color <span class="operator">=</span> <span class="string">&quot;chartreuse4&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;chartreuse4&quot;</span><span class="punctuation">,</span></span><br><span class="line">      halign <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> r <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> <span class="string">&quot;pt&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> width <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="string">&quot;npc&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      padding <span class="operator">=</span> margin<span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> margin <span class="operator">=</span> margin<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      hi.labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;1997&quot;</span><span class="punctuation">,</span> <span class="string">&quot;1998&quot;</span><span class="punctuation">,</span> <span class="string">&quot;1999&quot;</span><span class="punctuation">,</span> <span class="string">&quot;2000&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      hi.fill <span class="operator">=</span> <span class="string">&quot;chartreuse4&quot;</span><span class="punctuation">,</span> hi.box.col <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> hi.col <span class="operator">=</span> <span class="string">&quot;white&quot;</span></span><br><span class="line">    <span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/05/64f60f8e349a9.png" style="width:600px;"/></div></div></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> season <span class="operator">==</span> <span class="string">&quot;Summer&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.3</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_wrap<span class="punctuation">(</span><span class="operator">~</span> season<span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;gray40&quot;</span><span class="punctuation">,</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> guide <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span></span><br><span class="line">    axis.text.x <span class="operator">=</span> element_text<span class="punctuation">(</span>angle <span class="operator">=</span> <span class="number">45</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    strip.background <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    strip.text <span class="operator">=</span> element_textbox_highlight<span class="punctuation">(</span></span><br><span class="line">      size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span></span><br><span class="line">      fill <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> box.color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;gray40&quot;</span><span class="punctuation">,</span></span><br><span class="line">      halign <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> r <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="string">&quot;pt&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> width <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="string">&quot;npc&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      padding <span class="operator">=</span> margin<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> margin <span class="operator">=</span> margin<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      hi.labels <span class="operator">=</span> <span class="string">&quot;Summer&quot;</span><span class="punctuation">,</span> hi.family <span class="operator">=</span> <span class="string">&quot;Arial&quot;</span><span class="punctuation">,</span></span><br><span class="line">      hi.fill <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> hi.box.col <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> hi.col <span class="operator">=</span> <span class="string">&quot;white&quot;</span></span><br><span class="line">    <span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/05/64f610572f767.png" style="width:600px;"/></div></div><h2 id="一个面板两个图形"><a href="#一个面板两个图形" class="headerlink" title="一个面板两个图形"></a>一个面板两个图形</h2><p>有几种方法可以组合图形。我认为最简单的方法是托马斯-林-佩德森（Thomas Lin Pedersen）的<a href="https://github.com/thomasp85/patchwork">{patchwork}</a>软件包：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">p1 <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span></span><br><span class="line">                       color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">        geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">        geom_rug<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">        labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p2 <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">        geom_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;gray&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">        geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;darkorange2&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">        labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>patchwork<span class="punctuation">)</span></span><br><span class="line">p1 <span class="operator">+</span> p2</span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/05/64f611b453417.png" style="width:600px;"/></div></div></p><p>我们可以通过 “分割 “两个图来改变顺序（注意，即使一个有图例，一个没有图例，也要对齐！）：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p1 <span class="operator">/</span> p2</span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/05/64f61221a92cd.png" style="width:600px;"/></div></div></p><p>还可以嵌套绘图！<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">(</span>g <span class="operator">+</span> p2<span class="punctuation">)</span> <span class="operator">/</span> p1</span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/05/64f612b46fa82.png" style="width:600px;"/></div></div></p><p>(请注意，尽管只有一幅图包含图例，但这些图还是保持了一致)。</p><p>另外，Claus Wilke 的<a href="https://wilkelab.org/cowplot/articles/introduction.html">{cowplot}</a>软件包提供了合并多个绘图的功能（还有很多其他实用工具）：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>cowplot<span class="punctuation">)</span></span><br><span class="line">plot_grid<span class="punctuation">(</span>plot_grid<span class="punctuation">(</span>g<span class="punctuation">,</span> p1<span class="punctuation">)</span><span class="punctuation">,</span> p2<span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/05/64f613d619ff5.png" style="width:600px;"/></div></div></p><p>…<a href="https://cran.r-project.org/web/packages/gridExtra/vignettes/arrangeGrob.html">{gridExtra}</a>软件包也是如此：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>gridExtra<span class="punctuation">)</span></span><br><span class="line">grid.arrange<span class="punctuation">(</span>g<span class="punctuation">,</span> p1<span class="punctuation">,</span> p2<span class="punctuation">,</span></span><br><span class="line">             layout_matrix <span class="operator">=</span> rbind<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/05/64f6148191b10.png" style="width:600px;"/></div></div></p><p>定义布局的想法同样适用于{patchwork}，它可以创建复杂的组合：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">layout <span class="operator">&lt;-</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">AABBBB#</span></span><br><span class="line"><span class="string">AACCDDE</span></span><br><span class="line"><span class="string">##CCDD#</span></span><br><span class="line"><span class="string">##CC###</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"></span><br><span class="line">p2 <span class="operator">+</span> p1 <span class="operator">+</span> p1 <span class="operator">+</span> g <span class="operator">+</span> p2 <span class="operator">+</span></span><br><span class="line">  plot_layout<span class="punctuation">(</span>design <span class="operator">=</span> layout<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/05/64f6154475eef.png" style="width:600px;"/></div></div></p><h1 id="颜色"><a href="#颜色" class="headerlink" title="颜色"></a>颜色</h1><p>在{ggplot2}中，对于简单的应用来说，使用颜色非常简单。如果想了解更高级的处理方法，你可能应该去看看<a href="https://link.springer.com/book/10.1007/978-0-387-98141-3#otherversion=9780387981406">Hadley的书</a>，里面有很好的介绍。其他有用的资料包括R Cookbook》和Yan Holtz所著<a href="https://r-graph-gallery.com/ggplot2-color.html">《R Graph Gallery》</a>中的 “color “部分。</p><p>{ggplot2}中的颜色有两个主要区别。<mark class="hl-label blue">color</mark> 和<mark class="hl-label blue">fill</mark> 这两个参数都可以</p><ol><li>指定为单一颜色</li><li>指定为变量</li></ol><p>正如你在本教程开头已经看到的，在<mark class="hl-label blue">aes</mark> 内部的变量是由变量编码的，而在美学范围外的变量则是与变量无关的属性。这幅显示每年和每季记录数的完全无意义的图就说明了这一事实：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>year<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_bar<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;grey&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Observations&quot;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&quot;Season:&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f75dc052a88.png" style="width:600px;"/></div></div></p><h2 id="指定单一颜色"><a href="#指定单一颜色" class="headerlink" title="指定单一颜色"></a>指定单一颜色</h2><p>静态单一颜色的使用很简单。我们可以为一个图形指定单一颜色：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f75e7b804e4.png" style="width:600px;"/></div></div></p><p>… 如果同时提供<mark class="hl-label blue">color</mark> （轮廓颜色）和<mark class="hl-label blue">fill</mark> （填充颜色）：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>shape <span class="operator">=</span> <span class="number">21</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> stroke <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">             color <span class="operator">=</span> <span class="string">&quot;#3cc08f&quot;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&quot;#c08f3c&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f75f1cbfb75.png" style="width:600px;"/></div></div></p><p>哥伦比亚大学的 Tian Zheng 制作了一份有用的<a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf">R颜色PDF</a>。当然，您也可以指定十六进制颜色代码（如上例中的字符串）以及RGB或RGBA值（通过<mark class="hl-label blue">rgb()</mark> 函数：rgb(red, green, blue, alpha)）。</p><h2 id="为变量指定颜色"><a href="#为变量指定颜色" class="headerlink" title="为变量指定颜色"></a>为变量指定颜色</h2><p>在 {ggplot2} 中，通过<mark class="hl-label blue">scale_color_*</mark> 和<mark class="hl-label blue">scale_fill_*</mark> 函数可以修改分配给变量的颜色。要在数据中使用颜色，最重要的是要知道所处理的是分类变量还是连续变量。调色板的选择应取决于变量的类型，连续变量应使用连续调色板或发散调色板，分类变量应使用定性调色板：</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f7612f417ec.png" style="width:600px;"/></div></div><center>*Source: “Hands-On Data Visualization” by Jack Dougherty & Ilya Ilyankou*</center><h2 id="定性变量"><a href="#定性变量" class="headerlink" title="定性变量"></a>定性变量</h2><p>定性变量或分类变量代表可划分为不同组（类别）的数据类型。变量还可进一步分为名义变量、顺序变量和二元变量（二分变量）。定性/分类变量的例子有:<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f7653bac30e.png" style="width:600px;"/></div></div></p><center>*Artwork by Allison Horst*</center><p>默认的分类调色板如下所示：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">(</span>ga <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f766e7e9c8a.png" style="width:600px;"/></div></div></p><h2 id="手动选择定性颜色"><a href="#手动选择定性颜色" class="headerlink" title="手动选择定性颜色"></a>手动选择定性颜色</h2><p>您可以通过<mark class="hl-label blue">scale_*_manual()</mark> 函数（<mark class="hl-label blue">*</mark> 可以是<mark class="hl-label blue">color</mark> 、<mark class="hl-label blue">colour</mark> 或<mark class="hl-label blue">fill</mark> ）自行选择一组颜色并将其分配给分类变量。指定颜色的数量必须与类别的数量相匹配：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ga <span class="operator">+</span> scale_color_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;dodgerblue4&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                   <span class="string">&quot;darkolivegreen4&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                   <span class="string">&quot;darkorchid3&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                   <span class="string">&quot;goldenrod1&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f769a12e7bf.png" style="width:600px;"/></div></div><h2 id="使用内置定性调色板"><a href="#使用内置定性调色板" class="headerlink" title="使用内置定性调色板"></a>使用内置定性调色板</h2><p><a href="https://colorbrewer2.org/#type=sequential&amp;scheme=BuGn&amp;n=3">ColorBrewer</a>调色板是一种用于选择地图配色方案的流行在线工具。我们设计了不同的颜色集，以产生外观相似、极具吸引力的颜色方案，颜色范围从三种到十二种不等。这些调色板可作为 {ggplot2} 软件包的内置函数，通过调用<mark class="hl-label blue">scale_*_brewer()</mark> 来应用：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ga <span class="operator">+</span> scale_color_brewer<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;Set1&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f76b375b2ae.png" style="width:600px;"/></div></div></p><p><strong>💡 您可以通过以下方式查看所有可用计划</strong><br><mark class="hl-label blue">RColorBrewer::display.brewer.all()</mark> </p><h2 id="使用扩展软件包中的定性调色板"><a href="#使用扩展软件包中的定性调色板" class="headerlink" title="使用扩展软件包中的定性调色板"></a>使用扩展软件包中的定性调色板</h2><p>有许多扩展软件包可以提供额外的调色板。它们的用途因软件包的设计方式而异。关于 R 中可用调色板的广泛概述，请查看<a href="https://github.com/EmilHvitfeldt/r-color-palettes/blob/master/README.md#comprehensive-list-of-color-palettes-in-r">Emil Hvitfeldt</a>提供的集合。我们还可以使用他的<a href="https://github.com/EmilHvitfeldt/paletteer">{paletteer}</a>软件包，这是一个使用统一语法的 R 色板综合集合。</p><p><strong>例如</strong><br>例如，<a href="https://jrnold.github.io/ggthemes/">{ggthemes}</a>软件包可以让 R 用户访问 Tableau 颜色。Tableau 是一款著名的可视化软件，拥有<a href="https://www.tableau.com/de-de/blog/colors-upgrade-tableau-10-56782">众所周知的调色板</a>。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggthemes<span class="punctuation">)</span></span><br><span class="line">ga <span class="operator">+</span> scale_color_tableau<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f76d6da04bb.png" style="width:600px;"/></div></div></p><p><a href="https://nanx.me/ggsci/articles/ggsci.html">{ggsci}</a>软件包提供科学杂志和科幻主题调色板。想让情节的色彩看起来像发表在《科学》或《自然》杂志上的文章吗？给你！<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggsci<span class="punctuation">)</span></span><br><span class="line">g1 <span class="operator">&lt;-</span> ga <span class="operator">+</span> scale_color_aaas<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">g2 <span class="operator">&lt;-</span> ga <span class="operator">+</span> scale_color_npg<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>patchwork<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">(</span>g1 <span class="operator">+</span> g2<span class="punctuation">)</span> <span class="operator">*</span> theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&quot;top&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f76e13a597f.png" style="width:600px;"/></div></div></p><h2 id="定量变量"><a href="#定量变量" class="headerlink" title="定量变量"></a>定量变量</h2><p>定量变量代表一个可测量的量，因此是数值型的。定量数据还可进一步分为连续数据（可使用浮点数）和离散数据（仅限整数）：<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f76ed3833ea.png" style="width:600px;"/></div></div></p><center>*Artwork by Allison Horst*</center><p>在我们的示例中，我们将把要着色的变量改为臭氧，这是一个与温度密切相关的连续变量（温度越高，臭氧越高）。函数<mark class="hl-label blue">scale_*_gradient()</mark> 是顺序梯度，而<mark class="hl-label blue">scale_*_gradient2()</mark> 是发散梯度。</p><p>下面是连续变量的默认 {ggplot2} 序列颜色方案：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gb <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;Temperature (°F):&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">gb <span class="operator">+</span> scale_color_continuous<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f76fec63d04.png" style="width:600px;"/></div></div></p><p>该代码可生成相同的曲线图：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gb <span class="operator">+</span> scale_color_gradient<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f76fec63d04.png" style="width:600px;"/></div></div></p><p>下面是不同的默认配色方案：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mid <span class="operator">&lt;-</span> mean<span class="punctuation">(</span>chic<span class="operator">$</span>temp<span class="punctuation">)</span>  <span class="comment">## midpoint</span></span><br><span class="line"></span><br><span class="line">gb <span class="operator">+</span> scale_color_gradient2<span class="punctuation">(</span>midpoint <span class="operator">=</span> mid<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f770f184b18.png" style="width:600px;"/></div></div></p><h2 id="手动设置序列颜色方案"><a href="#手动设置序列颜色方案" class="headerlink" title="手动设置序列颜色方案"></a>手动设置序列颜色方案</h2><p>您可以通过<mark class="hl-label blue">scale_*_gradient()</mark> 手动为连续变量设置逐渐变化的调色板：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gb <span class="operator">+</span> scale_color_gradient<span class="punctuation">(</span>low <span class="operator">=</span> <span class="string">&quot;darkkhaki&quot;</span><span class="punctuation">,</span></span><br><span class="line">                          high <span class="operator">=</span> <span class="string">&quot;darkgreen&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f771f0b7424.png" style="width:600px;"/></div></div></p><p>温度数据是正态分布的，因此采用发散颜色方案（而不是顺序颜色）如何……对于发散颜色，您可以使用<mark class="hl-label blue">scale_*_gradient2()</mark> 函数：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gb <span class="operator">+</span> scale_color_gradient2<span class="punctuation">(</span>midpoint <span class="operator">=</span> mid<span class="punctuation">,</span> low <span class="operator">=</span> <span class="string">&quot;#dd8a0b&quot;</span><span class="punctuation">,</span></span><br><span class="line">                           mid <span class="operator">=</span> <span class="string">&quot;grey92&quot;</span><span class="punctuation">,</span> high <span class="operator">=</span> <span class="string">&quot;#32a676&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f773087a9e3.png" style="width:600px;"/></div></div></p><h2 id="美丽的-Viridis-调色板"><a href="#美丽的-Viridis-调色板" class="headerlink" title="美丽的 Viridis 调色板"></a>美丽的 Viridis 调色板</h2><p><a href="https://sjmgarnier.github.io/viridis/articles/intro-to-viridis.html">viridis调色板</a>不仅能让您的绘图看起来漂亮、易于感知，还能让色盲症患者更容易阅读，并能很好地进行灰度打印。您可以使用 {dichromat} 软件包测试各种色盲情况下的绘图效果。</p><p>现在，它们也与 {ggplot2} 一起提供！下面的多面板图展示了四种 viridis 调色板中的三种：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p1 <span class="operator">&lt;-</span> gb <span class="operator">+</span> scale_color_viridis_c<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> ggtitle<span class="punctuation">(</span><span class="string">&quot;&#x27;viridis&#x27; (default)&quot;</span><span class="punctuation">)</span></span><br><span class="line">p2 <span class="operator">&lt;-</span> gb <span class="operator">+</span> scale_color_viridis_c<span class="punctuation">(</span>option <span class="operator">=</span> <span class="string">&quot;inferno&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> ggtitle<span class="punctuation">(</span><span class="string">&quot;&#x27;inferno&#x27;&quot;</span><span class="punctuation">)</span></span><br><span class="line">p3 <span class="operator">&lt;-</span> gb <span class="operator">+</span> scale_color_viridis_c<span class="punctuation">(</span>option <span class="operator">=</span> <span class="string">&quot;plasma&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> ggtitle<span class="punctuation">(</span><span class="string">&quot;&#x27;plasma&#x27;&quot;</span><span class="punctuation">)</span></span><br><span class="line">p4 <span class="operator">&lt;-</span> gb <span class="operator">+</span> scale_color_viridis_c<span class="punctuation">(</span>option <span class="operator">=</span> <span class="string">&quot;cividis&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> ggtitle<span class="punctuation">(</span><span class="string">&quot;&#x27;cividis&#x27;&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>patchwork<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">(</span>p1 <span class="operator">+</span> p2 <span class="operator">+</span> p3 <span class="operator">+</span> p4<span class="punctuation">)</span> <span class="operator">*</span> theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&quot;bottom&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f7743b39b4a.png" style="width:600px;"/></div></div></p><p>离散变量也可以使用 viridis 调色板：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ga <span class="operator">+</span> scale_color_viridis_d<span class="punctuation">(</span>guide <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f774f45e4e0.png,width=600px"/></div></div></p><h2 id="使用扩展软件包中的定量调色板"><a href="#使用扩展软件包中的定量调色板" class="headerlink" title="使用扩展软件包中的定量调色板"></a>使用扩展软件包中的定量调色板</h2><p>许多扩展软件包不仅提供了额外的分类调色板，还提供了顺序、发散甚至循环调色板。在此，我再次向您推荐<a href="https://github.com/EmilHvitfeldt/r-color-palettes/blob/master/README.md#comprehensive-list-of-color-palettes-in-r">Emil Hvitfeldt</a>提供的大量资料，供您了解概况。</p><p><strong>例如</strong><br><a href="https://github.com/Nowosad/rcartocolor">{rcartocolors}</a>包将漂亮的<a href="https://carto.com/carto-colors/">CARTOcolors</a>移植到 {ggplot2}，并包含了我最常用的几个调色板：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>rcartocolor<span class="punctuation">)</span></span><br><span class="line">g1 <span class="operator">&lt;-</span> gb <span class="operator">+</span> scale_color_carto_c<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;BurgYl&quot;</span><span class="punctuation">)</span></span><br><span class="line">g2 <span class="operator">&lt;-</span> gb <span class="operator">+</span> scale_color_carto_c<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;Earth&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">(</span>g1 <span class="operator">+</span> g2<span class="punctuation">)</span> <span class="operator">*</span> theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&quot;bottom&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f7771489c54.png" style="width:600px;"/></div></div></p><p>通过<a href="https://github.com/thomasp85/scico">{scico}</a>软件包，可以访问<a href="https://www.fabiocrameri.ch/colourmaps/">Fabio Crameri开发的调色板</a>。这些调色板不仅美观大方，而且往往与众不同，是一种很好的选择，因为它们在感知上是统一有序的。此外，它们还适用于色觉缺陷者和灰度用户：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>scico<span class="punctuation">)</span></span><br><span class="line">g1 <span class="operator">&lt;-</span> gb <span class="operator">+</span> scale_color_scico<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;berlin&quot;</span><span class="punctuation">)</span></span><br><span class="line">g2 <span class="operator">&lt;-</span> gb <span class="operator">+</span> scale_color_scico<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;hawaii&quot;</span><span class="punctuation">,</span> direction <span class="operator">=</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">(</span>g1 <span class="operator">+</span> g2<span class="punctuation">)</span> <span class="operator">*</span> theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&quot;bottom&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f77818961de.png" style="width:600px;"/></div></div></p><h2 id="事后修改调色板"><a href="#事后修改调色板" class="headerlink" title="事后修改调色板"></a>事后修改调色板</h2><p>自 ggplot2 3.0.0 发布以来，人们可以在将图层映射到数据后修改图层的美观度。或者按照 {ggplot2} 的说法 “使用<mark class="hl-label blue">after_scale()</mark> 标记数据缩放后的映射评估”。</p><p>那么，为什么不首先使用修改后的颜色呢？由于{ggplot2}只能处理一种<mark class="hl-label blue">color</mark> 和一种<mark class="hl-label blue">fill</mark> 比例，因此这是一个有趣的功能。请看下面的示例，我们使用了<a href="https://emilhvitfeldt.github.io/prismatic/">{prismatic}</a>软件包中的<mark class="hl-label blue">clr_negate()</mark> ：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>prismatic<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>date<span class="punctuation">,</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> temp<span class="punctuation">,</span></span><br><span class="line">                 color <span class="operator">=</span> after_scale<span class="punctuation">(</span>clr_negate<span class="punctuation">(</span>color<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">             size <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_scico<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;hawaii&quot;</span><span class="punctuation">,</span> guide <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f779e4d2409.png" style="width:600px;"/></div></div></p><p>使用{prismatic}软件包中的<mark class="hl-label blue">clr_negate()</mark> 、<mark class="hl-label blue">clr_lighten()</mark> 、<mark class="hl-label blue">clr_darken()</mark> 和<mark class="hl-label blue">clr_desaturate()</mark> 等函数，事后更改配色方案尤其有趣。你甚至可以将这些函数组合使用。在这里，我们绘制一个同时拥有<mark class="hl-label blue">color</mark> 和<mark class="hl-label blue">fill</mark> 两个参数的方框图：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>prismatic<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>date<span class="punctuation">,</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_boxplot<span class="punctuation">(</span></span><br><span class="line">    aes<span class="punctuation">(</span>color <span class="operator">=</span> season<span class="punctuation">,</span></span><br><span class="line">        fill <span class="operator">=</span> after_scale<span class="punctuation">(</span>clr_desaturate<span class="punctuation">(</span>clr_lighten<span class="punctuation">(</span>color<span class="punctuation">,</span> <span class="number">.6</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">.6</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    linewidth <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">  <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_brewer<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;Dark2&quot;</span><span class="punctuation">,</span> guide <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f77c2724ccc.png" style="width:600px;"/></div></div></p><p>请注意，您需要在相应的<mark class="hl-label blue">geom_*()</mark> 或<mark class="hl-label blue">stat_*()</mark> 的<mark class="hl-label blue">aes()</mark> 中指定<mark class="hl-label blue">color</mark> 和/或<mark class="hl-label blue">fill</mark> ，才能使<mark class="hl-label blue">after_scale()</mark> 正常工作。</p><p><strong>💡 现在看来这有点复杂—可以简单地同时使用<mark class="hl-label blue">color</mark> 和<mark class="hl-label blue">fill</mark> 比例。是的，这没错，但想想在什么情况下需要多个<mark class="hl-label blue">color</mark> 和/或<mark class="hl-label blue">fill</mark> 刻度。在这种情况下，用<mark class="hl-label blue">color</mark> 调色板的稍暗版本来占用<mark class="hl-label blue">fill</mark> 刻度是毫无意义的。</strong></p><h1 id="主题"><a href="#主题" class="headerlink" title="主题"></a>主题</h1><h2 id="更改总体绘图风格"><a href="#更改总体绘图风格" class="headerlink" title="更改总体绘图风格"></a>更改总体绘图风格</h2><p>您可以使用主题来改变绘图的整体外观。{ggplot2}内置了八个主题：<br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f89d24dc27e.png" style="width:600px;"/></div></div></p><p>有几个软件包提供了额外的主题，有些甚至带有不同的默认调色板。例如，杰弗里-阿诺德（Jeffrey Arnold）创建了{ggthemes}库，其中包含多个模仿流行设计的自定义主题。有关列表，请访问<a href="https://github.com/jrnold/ggthemes">{ggthemes}</a>软件包网站。无需编写任何代码，你就可以改编几种风格，其中一些以风格和美学著称。</p><p>下面是一个使用<mark class="hl-label blue">theme_economist()</mark> 和<mark class="hl-label blue">scale_color_economist()</mark>  复制<a href="https://www.economist.com/">《经济学人》</a>杂志绘图风格的示例：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggthemes<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  ggtitle<span class="punctuation">(</span><span class="string">&quot;Ups and Downs of Chicago&#x27;s Daily Temperatures&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_economist<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_economist<span class="punctuation">(</span>name <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f8a096d1a65.png" style="width:600px;"/></div></div></p><p>另一个例子是 Tufte 的绘图风格，这是一种基于爱德华-塔夫特（Edward Tufte）的《量化信息的可视化显示》一书的极简水墨主题。正是这本书将米纳尔描绘拿破仑进军俄国的图表推广为有史以来最好的统计图之一。塔夫特的图表因其纯粹的风格而闻名于世。但你自己看看吧：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br><span class="line">chic_2000 <span class="operator">&lt;-</span> filter<span class="punctuation">(</span>chic<span class="punctuation">,</span> year <span class="operator">==</span> <span class="number">2000</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>chic_2000<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  ggtitle<span class="punctuation">(</span><span class="string">&quot;Temperature and Ozone Levels During the Year 2000 in Chicago&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_tufte<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/06/64f8a18503cbf.png" style="width:600px;"/></div></div></p><p>我在这里减少了数据点的数量，只是为了适应Tufte的极简主义风格。如果你喜欢这种绘图方式，可以看看这篇<a href="http://motioninsocial.com/tufte/">博客文章</a>，在 R 中绘制几幅 Tufte 图。</p><p>Bob Rudis 制作的<a href="https://github.com/hrbrmstr/hrbrthemes">{hrbrthemes}</a>软件包是另一款具有现代主题和非默认字体预设的软件包，其中包含多个浅色和深色主题：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>hrbrthemes<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> dewpoint<span class="punctuation">)</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  ggtitle<span class="punctuation">(</span><span class="string">&quot;Temperature and Ozone Levels in Chicago&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/07/64f8a2e3a3f7b.png" style="width:600px;"/></div></div></p><h2 id="更改所有文本元素的字体"><a href="#更改所有文本元素的字体" class="headerlink" title="更改所有文本元素的字体"></a>更改所有文本元素的字体</h2><p>要一次性更改所有文本元素的设置，简直易如反掌。所有主题都有一个名为<mark class="hl-label blue">base_family</mark> 的参数：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span></span><br><span class="line">       title <span class="operator">=</span> <span class="string">&quot;Temperatures in Chicago&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">+</span> theme_bw<span class="punctuation">(</span>base_family <span class="operator">=</span> <span class="string">&quot;sans&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/07/64f8b0ecdf9f8.png" style="width:600px;"/></div></div></p><h2 id="更改所有文本元素的大小"><a href="#更改所有文本元素的大小" class="headerlink" title="更改所有文本元素的大小"></a>更改所有文本元素的大小</h2><p>此外，<mark class="hl-label blue">theme_*()</mark> 函数还提供了其他几个<mark class="hl-label blue">base_*</mark> 参数。如果仔细观察一下默认主题（参见下文 “创建并使用自定义主题 “一章），你会发现所有元素的大小都是相对于<mark class="hl-label blue">base_size</mark> 的<mark class="hl-label blue">（rel()）</mark> 。因此，如果您想提高绘图的可读性，只需更改基尺寸即可：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> theme_bw<span class="punctuation">(</span>base_size <span class="operator">=</span> <span class="number">30</span><span class="punctuation">,</span> base_family <span class="operator">=</span> <span class="string">&quot;Roboto Condensed&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/07/64f8b4ab1a238.png" style="width:600px;"/></div></div></p><h2 id="更改所有线条和矩形元素的大小"><a href="#更改所有线条和矩形元素的大小" class="headerlink" title="更改所有线条和矩形元素的大小"></a>更改所有线条和矩形元素的大小</h2><p>同样，您也可以更改所有<mark class="hl-label blue">line</mark> 和<mark class="hl-label blue">rect</mark> 类型元素的大小：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> theme_bw<span class="punctuation">(</span>base_line_size <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> base_rect_size <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/07/64f8b5f16f62c.png" style="width:600px;"/></div></div></p><h2 id="创建自己的主题"><a href="#创建自己的主题" class="headerlink" title="创建自己的主题"></a>创建自己的主题</h2><p>如果要更改整个会话的主题，可以使用<mark class="hl-label blue">theme_set</mark> ，如<mark class="hl-label blue">theme_set(theme_bw())</mark> 。默认主题为<mark class="hl-label blue">theme_gray</mark> 。如果你想创建自己的自定义主题，可以直接从灰色主题中提取代码并修改。请注意，<mark class="hl-label blue">rel()</mark> 函数会改变相对于<mark class="hl-label blue">base_size</mark> 的尺寸。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">theme_gray</span><br></pre></td></tr></table></figure><br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## function (base_size = 11, base_family = &quot;&quot;, base_line_size = base_size/22, </span></span><br><span class="line"><span class="comment">##     base_rect_size = base_size/22) </span></span><br><span class="line"><span class="comment">## &#123;</span></span><br><span class="line"><span class="comment">##     half_line &lt;- base_size/2</span></span><br><span class="line"><span class="comment">##     t &lt;- theme(line = element_line(colour = &quot;black&quot;, linewidth = base_line_size, </span></span><br><span class="line"><span class="comment">##         linetype = 1, lineend = &quot;butt&quot;), rect = element_rect(fill = &quot;white&quot;, </span></span><br><span class="line"><span class="comment">##         colour = &quot;black&quot;, linewidth = base_rect_size, linetype = 1), </span></span><br><span class="line"><span class="comment">##         text = element_text(family = base_family, face = &quot;plain&quot;, </span></span><br><span class="line"><span class="comment">##             colour = &quot;black&quot;, size = base_size, lineheight = 0.9, </span></span><br><span class="line"><span class="comment">##             hjust = 0.5, vjust = 0.5, angle = 0, margin = margin(), </span></span><br><span class="line"><span class="comment">##             debug = FALSE), axis.line = element_blank(), axis.line.x = NULL, </span></span><br><span class="line"><span class="comment">##         axis.line.y = NULL, axis.text = element_text(size = rel(0.8), </span></span><br><span class="line"><span class="comment">##             colour = &quot;grey30&quot;), axis.text.x = element_text(margin = margin(t = 0.8 * </span></span><br><span class="line"><span class="comment">##             half_line/2), vjust = 1), axis.text.x.top = element_text(margin = margin(b = 0.8 * </span></span><br><span class="line"><span class="comment">##             half_line/2), vjust = 0), axis.text.y = element_text(margin = margin(r = 0.8 * </span></span><br><span class="line"><span class="comment">##             half_line/2), hjust = 1), axis.text.y.right = element_text(margin = margin(l = 0.8 * </span></span><br><span class="line"><span class="comment">##             half_line/2), hjust = 0), axis.ticks = element_line(colour = &quot;grey20&quot;), </span></span><br><span class="line"><span class="comment">##         axis.ticks.length = unit(half_line/2, &quot;pt&quot;), axis.ticks.length.x = NULL, </span></span><br><span class="line"><span class="comment">##         axis.ticks.length.x.top = NULL, axis.ticks.length.x.bottom = NULL, </span></span><br><span class="line"><span class="comment">##         axis.ticks.length.y = NULL, axis.ticks.length.y.left = NULL, </span></span><br><span class="line"><span class="comment">##         axis.ticks.length.y.right = NULL, axis.title.x = element_text(margin = margin(t = half_line/2), </span></span><br><span class="line"><span class="comment">##             vjust = 1), axis.title.x.top = element_text(margin = margin(b = half_line/2), </span></span><br><span class="line"><span class="comment">##             vjust = 0), axis.title.y = element_text(angle = 90, </span></span><br><span class="line"><span class="comment">##             margin = margin(r = half_line/2), vjust = 1), axis.title.y.right = element_text(angle = -90, </span></span><br><span class="line"><span class="comment">##             margin = margin(l = half_line/2), vjust = 0), legend.background = element_rect(colour = NA), </span></span><br><span class="line"><span class="comment">##         legend.spacing = unit(2 * half_line, &quot;pt&quot;), legend.spacing.x = NULL, </span></span><br><span class="line"><span class="comment">##         legend.spacing.y = NULL, legend.margin = margin(half_line, </span></span><br><span class="line"><span class="comment">##             half_line, half_line, half_line), legend.key = element_rect(fill = &quot;grey95&quot;, </span></span><br><span class="line"><span class="comment">##             colour = NA), legend.key.size = unit(1.2, &quot;lines&quot;), </span></span><br><span class="line"><span class="comment">##         legend.key.height = NULL, legend.key.width = NULL, legend.text = element_text(size = rel(0.8)), </span></span><br><span class="line"><span class="comment">##         legend.text.align = NULL, legend.title = element_text(hjust = 0), </span></span><br><span class="line"><span class="comment">##         legend.title.align = NULL, legend.position = &quot;right&quot;, </span></span><br><span class="line"><span class="comment">##         legend.direction = NULL, legend.justification = &quot;center&quot;, </span></span><br><span class="line"><span class="comment">##         legend.box = NULL, legend.box.margin = margin(0, 0, 0, </span></span><br><span class="line"><span class="comment">##             0, &quot;cm&quot;), legend.box.background = element_blank(), </span></span><br><span class="line"><span class="comment">##         legend.box.spacing = unit(2 * half_line, &quot;pt&quot;), panel.background = element_rect(fill = &quot;grey92&quot;, </span></span><br><span class="line"><span class="comment">##             colour = NA), panel.border = element_blank(), panel.grid = element_line(colour = &quot;white&quot;), </span></span><br><span class="line"><span class="comment">##         panel.grid.minor = element_line(linewidth = rel(0.5)), </span></span><br><span class="line"><span class="comment">##         panel.spacing = unit(half_line, &quot;pt&quot;), panel.spacing.x = NULL, </span></span><br><span class="line"><span class="comment">##         panel.spacing.y = NULL, panel.ontop = FALSE, strip.background = element_rect(fill = &quot;grey85&quot;, </span></span><br><span class="line"><span class="comment">##             colour = NA), strip.clip = &quot;inherit&quot;, strip.text = element_text(colour = &quot;grey10&quot;, </span></span><br><span class="line"><span class="comment">##             size = rel(0.8), margin = margin(0.8 * half_line, </span></span><br><span class="line"><span class="comment">##                 0.8 * half_line, 0.8 * half_line, 0.8 * half_line)), </span></span><br><span class="line"><span class="comment">##         strip.text.x = NULL, strip.text.y = element_text(angle = -90), </span></span><br><span class="line"><span class="comment">##         strip.text.y.left = element_text(angle = 90), strip.placement = &quot;inside&quot;, </span></span><br><span class="line"><span class="comment">##         strip.placement.x = NULL, strip.placement.y = NULL, strip.switch.pad.grid = unit(half_line/2, </span></span><br><span class="line"><span class="comment">##             &quot;pt&quot;), strip.switch.pad.wrap = unit(half_line/2, </span></span><br><span class="line"><span class="comment">##             &quot;pt&quot;), plot.background = element_rect(colour = &quot;white&quot;), </span></span><br><span class="line"><span class="comment">##         plot.title = element_text(size = rel(1.2), hjust = 0, </span></span><br><span class="line"><span class="comment">##             vjust = 1, margin = margin(b = half_line)), plot.title.position = &quot;panel&quot;, </span></span><br><span class="line"><span class="comment">##         plot.subtitle = element_text(hjust = 0, vjust = 1, margin = margin(b = half_line)), </span></span><br><span class="line"><span class="comment">##         plot.caption = element_text(size = rel(0.8), hjust = 1, </span></span><br><span class="line"><span class="comment">##             vjust = 1, margin = margin(t = half_line)), plot.caption.position = &quot;panel&quot;, </span></span><br><span class="line"><span class="comment">##         plot.tag = element_text(size = rel(1.2), hjust = 0.5, </span></span><br><span class="line"><span class="comment">##             vjust = 0.5), plot.tag.position = &quot;topleft&quot;, plot.margin = margin(half_line, </span></span><br><span class="line"><span class="comment">##             half_line, half_line, half_line), complete = TRUE)</span></span><br><span class="line"><span class="comment">##     ggplot_global$theme_all_null %+replace% t</span></span><br><span class="line"><span class="comment">## &#125;</span></span><br><span class="line"><span class="comment">## &lt;bytecode: 0x7fb89d268170&gt;</span></span><br><span class="line"><span class="comment">## &lt;environment: namespace:ggplot2&gt;</span></span><br></pre></td></tr></table></figure></p><p>现在，让我们修改默认主题功能，看看结果如何：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">theme_custom <span class="operator">&lt;-</span> <span class="keyword">function</span> <span class="punctuation">(</span>base_size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">,</span> base_family <span class="operator">=</span> <span class="string">&quot;Roboto Condensed&quot;</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  half_line <span class="operator">&lt;-</span> base_size<span class="operator">/</span><span class="number">2</span></span><br><span class="line">  theme<span class="punctuation">(</span></span><br><span class="line">    line <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span></span><br><span class="line">                        linetype <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> lineend <span class="operator">=</span> <span class="string">&quot;butt&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    rect <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        linewidth <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    text <span class="operator">=</span> element_text<span class="punctuation">(</span>family <span class="operator">=</span> base_family<span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;plain&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> base_size<span class="punctuation">,</span></span><br><span class="line">                        lineheight <span class="operator">=</span> <span class="number">.9</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span></span><br><span class="line">                        angle <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> margin <span class="operator">=</span> margin<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span> debug <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.line <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.line.x <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    axis.line.y <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    axis.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> base_size <span class="operator">*</span> <span class="number">1.1</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;gray30&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.text.x <span class="operator">=</span> element_text<span class="punctuation">(</span>margin <span class="operator">=</span> margin<span class="punctuation">(</span>t <span class="operator">=</span> <span class="number">.8</span> <span class="operator">*</span> half_line<span class="operator">/</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                               vjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.text.x.top <span class="operator">=</span> element_text<span class="punctuation">(</span>margin <span class="operator">=</span> margin<span class="punctuation">(</span>b <span class="operator">=</span> <span class="number">.8</span> <span class="operator">*</span> half_line<span class="operator">/</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                   vjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.text.y <span class="operator">=</span> element_text<span class="punctuation">(</span>margin <span class="operator">=</span> margin<span class="punctuation">(</span>r <span class="operator">=</span> <span class="number">.8</span> <span class="operator">*</span> half_line<span class="operator">/</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                               hjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.text.y.right <span class="operator">=</span> element_text<span class="punctuation">(</span>margin <span class="operator">=</span> margin<span class="punctuation">(</span>l <span class="operator">=</span> <span class="number">.8</span> <span class="operator">*</span> half_line<span class="operator">/</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                     hjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.ticks <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;gray30&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">.7</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.ticks.length <span class="operator">=</span> unit<span class="punctuation">(</span>half_line <span class="operator">/</span> <span class="number">1.5</span><span class="punctuation">,</span> <span class="string">&quot;pt&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.ticks.length.x <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    axis.ticks.length.x.top <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    axis.ticks.length.x.bottom <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    axis.ticks.length.y <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    axis.ticks.length.y.left <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    axis.ticks.length.y.right <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    axis.title.x <span class="operator">=</span> element_text<span class="punctuation">(</span>margin <span class="operator">=</span> margin<span class="punctuation">(</span>t <span class="operator">=</span> half_line<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                vjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> size <span class="operator">=</span> base_size <span class="operator">*</span> <span class="number">1.3</span><span class="punctuation">,</span></span><br><span class="line">                                face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.title.x.top <span class="operator">=</span> element_text<span class="punctuation">(</span>margin <span class="operator">=</span> margin<span class="punctuation">(</span>b <span class="operator">=</span> half_line<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                    vjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.title.y <span class="operator">=</span> element_text<span class="punctuation">(</span>angle <span class="operator">=</span> <span class="number">90</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                                margin <span class="operator">=</span> margin<span class="punctuation">(</span>r <span class="operator">=</span> half_line<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                size <span class="operator">=</span> base_size <span class="operator">*</span> <span class="number">1.3</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    axis.title.y.right <span class="operator">=</span> element_text<span class="punctuation">(</span>angle <span class="operator">=</span> <span class="operator">-</span><span class="number">90</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                                      margin <span class="operator">=</span> margin<span class="punctuation">(</span>l <span class="operator">=</span> half_line<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    legend.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    legend.spacing <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">.4</span><span class="punctuation">,</span> <span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    legend.spacing.x <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    legend.spacing.y <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    legend.margin <span class="operator">=</span> margin<span class="punctuation">(</span><span class="number">.2</span><span class="punctuation">,</span> <span class="number">.2</span><span class="punctuation">,</span> <span class="number">.2</span><span class="punctuation">,</span> <span class="number">.2</span><span class="punctuation">,</span> <span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    legend.key <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;gray95&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    legend.key.size <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">1.2</span><span class="punctuation">,</span> <span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    legend.key.height <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    legend.key.width <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    legend.text <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> rel<span class="punctuation">(</span><span class="number">.8</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    legend.text.align <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    legend.title <span class="operator">=</span> element_text<span class="punctuation">(</span>hjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    legend.title.align <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    legend.position <span class="operator">=</span> <span class="string">&quot;right&quot;</span><span class="punctuation">,</span></span><br><span class="line">    legend.direction <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    legend.justification <span class="operator">=</span> <span class="string">&quot;center&quot;</span><span class="punctuation">,</span></span><br><span class="line">    legend.box <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    legend.box.margin <span class="operator">=</span> margin<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    legend.box.background <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    legend.box.spacing <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">.4</span><span class="punctuation">,</span> <span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    panel.border <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;gray30&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                fill <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">.7</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    panel.grid.major <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;gray90&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    panel.grid.minor <span class="operator">=</span> element_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;gray90&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span></span><br><span class="line">                                    linetype <span class="operator">=</span> <span class="string">&quot;dashed&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    panel.spacing <span class="operator">=</span> unit<span class="punctuation">(</span>base_size<span class="punctuation">,</span> <span class="string">&quot;pt&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    panel.spacing.x <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    panel.spacing.y <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    panel.ontop <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">    strip.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;gray30&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    strip.text <span class="operator">=</span> element_text<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> base_size<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    strip.text.x <span class="operator">=</span> element_text<span class="punctuation">(</span>margin <span class="operator">=</span> margin<span class="punctuation">(</span>t <span class="operator">=</span> half_line<span class="punctuation">,</span></span><br><span class="line">                                                b <span class="operator">=</span> half_line<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    strip.text.y <span class="operator">=</span> element_text<span class="punctuation">(</span>angle <span class="operator">=</span> <span class="operator">-</span><span class="number">90</span><span class="punctuation">,</span></span><br><span class="line">                                margin <span class="operator">=</span> margin<span class="punctuation">(</span>l <span class="operator">=</span> half_line<span class="punctuation">,</span></span><br><span class="line">                                                r <span class="operator">=</span> half_line<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    strip.text.y.left <span class="operator">=</span> element_text<span class="punctuation">(</span>angle <span class="operator">=</span> <span class="number">90</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    strip.placement <span class="operator">=</span> <span class="string">&quot;inside&quot;</span><span class="punctuation">,</span></span><br><span class="line">    strip.placement.x <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    strip.placement.y <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    strip.switch.pad.grid <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.1</span><span class="punctuation">,</span> <span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    strip.switch.pad.wrap <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.1</span><span class="punctuation">,</span> <span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    plot.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    plot.title <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> base_size <span class="operator">*</span> <span class="number">1.8</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span></span><br><span class="line">                              vjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span></span><br><span class="line">                              margin <span class="operator">=</span> margin<span class="punctuation">(</span>b <span class="operator">=</span> half_line <span class="operator">*</span> <span class="number">1.2</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    plot.title.position <span class="operator">=</span> <span class="string">&quot;panel&quot;</span><span class="punctuation">,</span></span><br><span class="line">    plot.subtitle <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> base_size <span class="operator">*</span> <span class="number">1.3</span><span class="punctuation">,</span></span><br><span class="line">                                 hjust <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                                 margin <span class="operator">=</span> margin<span class="punctuation">(</span>b <span class="operator">=</span> half_line <span class="operator">*</span> <span class="number">.9</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    plot.caption <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> rel<span class="punctuation">(</span><span class="number">0.9</span><span class="punctuation">)</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                                margin <span class="operator">=</span> margin<span class="punctuation">(</span>t <span class="operator">=</span> half_line <span class="operator">*</span> <span class="number">.9</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    plot.caption.position <span class="operator">=</span> <span class="string">&quot;panel&quot;</span><span class="punctuation">,</span></span><br><span class="line">    plot.tag <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> rel<span class="punctuation">(</span><span class="number">1.2</span><span class="punctuation">)</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    plot.tag.position <span class="operator">=</span> <span class="string">&quot;topleft&quot;</span><span class="punctuation">,</span></span><br><span class="line">    plot.margin <span class="operator">=</span> margin<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span>base_size<span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    complete <span class="operator">=</span> <span class="literal">TRUE</span></span><br><span class="line">  <span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>💡 您只能覆盖所有要更改的元素的默认值。我在这里列出了所有元素，这样你就可以看到你可以更改所有元素！</strong></p><p>面板、网格线以及坐标轴刻度、文本和标题都采用了新的美学设计：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">theme_set<span class="punctuation">(</span>theme_custom<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> guides<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/07/64f8b8488d019.png" style="width:600px;"/></div></div></p><p>强烈推荐使用这种方式更改地块设计！只需更改一次，您就可以快速更改绘图中的任何元素。您可以在几秒钟内将所有结果绘制成风格一致的图表，并根据其他需要进行调整（例如，在演示文稿中使用更大的字体或满足期刊要求）。</p><h2 id="更新当前主题"><a href="#更新当前主题" class="headerlink" title="更新当前主题"></a>更新当前主题</h2><p>您还可以使用<mark class="hl-label blue">theme_update()</mark> 设置快速更改：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">theme_custom <span class="operator">&lt;-</span> theme_update<span class="punctuation">(</span>panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;gray60&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> guides<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/07/64f8b901903cf.png" style="width:600px;"/></div></div></p><p>在进一步的练习中，我们将使用自己的主题，使用白色填充，不使用小网格线：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">theme_custom <span class="operator">&lt;-</span> theme_update<span class="punctuation">(</span></span><br><span class="line">  panel.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  panel.grid.major <span class="operator">=</span> element_line<span class="punctuation">(</span>linewidth <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  panel.grid.minor <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></p><h1 id="线条"><a href="#线条" class="headerlink" title="线条"></a>线条</h1><h2 id="添加水平或垂直线"><a href="#添加水平或垂直线" class="headerlink" title="添加水平或垂直线"></a>添加水平或垂直线</h2><p>您可能希望突出显示给定的范围或阈值，这可以使用<mark class="hl-label blue">geom_hline()</mark> （用于 “水平线”）或 <mark class="hl-label blue">geom_vline()</mark> （用于 “垂直线”）在定义的坐标上绘制一条线：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">73</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64f9f99a0b6df.png" style="width:600px;"/></div></div></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> dewpoint<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;dodgerblue&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Dewpoint&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">+</span></span><br><span class="line">  geom_vline<span class="punctuation">(</span>aes<span class="punctuation">(</span>xintercept <span class="operator">=</span> median<span class="punctuation">(</span>temp<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span></span><br><span class="line">             color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="string">&quot;dashed&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_hline<span class="punctuation">(</span>aes<span class="punctuation">(</span>yintercept <span class="operator">=</span> median<span class="punctuation">(</span>dewpoint<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span></span><br><span class="line">             color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> linetype <span class="operator">=</span> <span class="string">&quot;dashed&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64f9f9f9cb3bc.png" style="width:600px;"/></div></div><p>如果要添加斜率不是 0 或 1 的直线，则需要使用<mark class="hl-label blue">geom_abline()</mark> 。例如，如果要使用截距和斜率参数添加回归线，就需要使用<mark class="hl-label blue">geom_abline()</mark> ：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">reg <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>dewpoint <span class="operator">~</span> temp<span class="punctuation">,</span> data <span class="operator">=</span> chic<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">+</span></span><br><span class="line">  geom_abline<span class="punctuation">(</span>intercept <span class="operator">=</span> coefficients<span class="punctuation">(</span>reg<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">              slope <span class="operator">=</span> coefficients<span class="punctuation">(</span>reg<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">              color <span class="operator">=</span> <span class="string">&quot;darkorange2&quot;</span><span class="punctuation">,</span> </span><br><span class="line">              linewidth <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>title <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&quot;y = &quot;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span>coefficients<span class="punctuation">(</span>reg<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                      <span class="string">&quot; * x + &quot;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span>coefficients<span class="punctuation">(</span>reg<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64f9fa124152e.png" style="width:60px;"/></div></div></p><p>稍后，我们将学习如何使用<mark class="hl-label blue">stat_smooth(method=lm)</mark> 命令添加线性拟合。不过，可能还有其他原因需要添加一条具有给定斜率的直线，我们可以这样做🧜🏻‍♂️。</p><h2 id="在图中添加线"><a href="#在图中添加线" class="headerlink" title="在图中添加线"></a>在图中添加线</h2><p>以前的方法总是覆盖绘图面板的整个范围，但有时人们只想突出显示某个区域或使用线条进行注释。在这种情况下，<mark class="hl-label blue">geom_linerange()</mark> 就能帮上忙：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span></span><br><span class="line">  <span class="comment">## vertical line</span></span><br><span class="line">  geom_linerange<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">50</span><span class="punctuation">,</span> ymin <span class="operator">=</span> <span class="number">20</span><span class="punctuation">,</span> ymax <span class="operator">=</span> <span class="number">55</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 color <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  <span class="comment">## horizontal line</span></span><br><span class="line">  geom_linerange<span class="punctuation">(</span>aes<span class="punctuation">(</span>xmin <span class="operator">=</span> <span class="operator">-</span><span class="literal">Inf</span><span class="punctuation">,</span> xmax <span class="operator">=</span> <span class="number">25</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 color <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64f9faa48a1a8.png" style="width:600px;"/></div></div></p><p>或者使用<mark class="hl-label blue">annotate(geom=segment)</mark> 来绘制斜率在 0 和 1 之间的直线：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span>geom <span class="operator">=</span> <span class="string">&quot;segment&quot;</span><span class="punctuation">,</span> </span><br><span class="line">           x <span class="operator">=</span> <span class="number">50</span><span class="punctuation">,</span> xend <span class="operator">=</span> <span class="number">75</span><span class="punctuation">,</span></span><br><span class="line">                   y <span class="operator">=</span> <span class="number">20</span><span class="punctuation">,</span> yend <span class="operator">=</span> <span class="number">45</span><span class="punctuation">,</span></span><br><span class="line">               color <span class="operator">=</span> <span class="string">&quot;purple&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64f9fb9613872.png" style="width:600px;"/></div></div></p><h2 id="在绘图中添加曲线和箭头"><a href="#在绘图中添加曲线和箭头" class="headerlink" title="在绘图中添加曲线和箭头"></a>在绘图中添加曲线和箭头</h2><mark class="hl-label blue">annotate(geom=curve)</mark> 添加曲线。如果你喜欢，也可以添加直线：<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span>geom <span class="operator">=</span> <span class="string">&quot;curve&quot;</span><span class="punctuation">,</span>x <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">60</span><span class="punctuation">,</span> xend <span class="operator">=</span> <span class="number">75</span><span class="punctuation">,</span> yend <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">             color <span class="operator">=</span> <span class="string">&quot;tan&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span>geom <span class="operator">=</span> <span class="string">&quot;curve&quot;</span><span class="punctuation">,</span> </span><br><span class="line">           x <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">60</span><span class="punctuation">,</span> xend <span class="operator">=</span> <span class="number">75</span><span class="punctuation">,</span> yend <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">             curvature <span class="operator">=</span> <span class="operator">-</span><span class="number">0.7</span><span class="punctuation">,</span> angle <span class="operator">=</span> <span class="number">45</span><span class="punctuation">,</span></span><br><span class="line">             color <span class="operator">=</span> <span class="string">&quot;darkgoldenrod1&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span>geom <span class="operator">=</span> <span class="string">&quot;curve&quot;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">60</span><span class="punctuation">,</span> xend <span class="operator">=</span> <span class="number">75</span><span class="punctuation">,</span> yend <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">             curvature <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64f9fd96af76b.png" style="width:600px;"/></div></div><p>同样的几何图形也可以用来画箭头：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span>geom <span class="operator">=</span> <span class="string">&quot;curve&quot;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">60</span><span class="punctuation">,</span> xend <span class="operator">=</span> <span class="number">75</span><span class="punctuation">,</span> yend <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">             color <span class="operator">=</span> <span class="string">&quot;tan&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> </span><br><span class="line">             arrow <span class="operator">=</span> arrow<span class="punctuation">(</span><span class="built_in">length</span> <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.07</span><span class="punctuation">,</span> <span class="string">&quot;npc&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  annotate<span class="punctuation">(</span>geom <span class="operator">=</span> <span class="string">&quot;curve&quot;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">55</span><span class="punctuation">,</span> xend <span class="operator">=</span> <span class="number">70</span><span class="punctuation">,</span> yend <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">             curvature <span class="operator">=</span> <span class="operator">-</span><span class="number">0.7</span><span class="punctuation">,</span> angle <span class="operator">=</span> <span class="number">45</span><span class="punctuation">,</span></span><br><span class="line">             color <span class="operator">=</span> <span class="string">&quot;darkgoldenrod1&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">             arrow <span class="operator">=</span> arrow<span class="punctuation">(</span><span class="built_in">length</span> <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.03</span><span class="punctuation">,</span> <span class="string">&quot;npc&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                           type <span class="operator">=</span> <span class="string">&quot;closed&quot;</span><span class="punctuation">,</span></span><br><span class="line">                           ends <span class="operator">=</span> <span class="string">&quot;both&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64f9fe0990aac.png" style="width:600px;"/></div></div></p><h1 id="文本"><a href="#文本" class="headerlink" title="文本"></a>文本</h1><h2 id="为数据添加标签"><a href="#为数据添加标签" class="headerlink" title="为数据添加标签"></a>为数据添加标签</h2><p>有时，我们想给数据点贴标签。为了避免文本标签的叠加和挤占，我们使用原始数据的 1% 样本，平均代表四个季节。我们正在使用<mark class="hl-label blue">geom_label()</mark> ，它带有一个名为<mark class="hl-label blue">label</mark> 的新美学：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">set.seed<span class="punctuation">(</span><span class="number">2020</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">sample <span class="operator">&lt;-</span> chic <span class="operator">|&gt;</span></span><br><span class="line">  dplyr<span class="operator">::</span>group_by<span class="punctuation">(</span>season<span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  dplyr<span class="operator">::</span>sample_frac<span class="punctuation">(</span><span class="number">0.01</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## code without pipes:</span></span><br><span class="line"><span class="comment">## sample &lt;- sample_frac(group_by(chic, season), .01)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>sample<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_label<span class="punctuation">(</span>aes<span class="punctuation">(</span>label <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="operator">-</span><span class="number">.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  xlim<span class="punctuation">(</span>as.Date<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;1997-01-01&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;2000-12-31&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  ylim<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">90</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64f9ff95ced6f.png" style="width:600px;"/></div></div></p><p>好吧，避免标签重叠的方法并不奏效。不过别担心，我们马上就能解决！</p><details class="folding-tag" green><summary> 💁如果不喜欢标签周围的方框，也可以使用 geom_text()。展开查看示例。 </summary>              <div class='content'>              <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>sample<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>label <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">,</span> fontface <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span></span><br><span class="line">            hjust <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="operator">-</span><span class="number">.25</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  xlim<span class="punctuation">(</span>as.Date<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;1997-01-01&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;2000-12-31&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  ylim<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">90</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa00533e3bc.png" style="width:600px;"/></div></div>              </div>            </details><p>{ggrepel}软件包为{ggplot2}提供了一些很棒的实用工具，如上面的示例中，它为{ggplot2}提供了<mark class="hl-label blue">geom</mark> ，用于排斥重叠的文本。我们只需将<mark class="hl-label blue">geom_text()</mark> 替换为<mark class="hl-label blue">geom_text_repel()</mark> ，将<mark class="hl-label blue">geom_label()</mark> 替换为<mark class="hl-label blue">geom_label_repel()</mark> 即可：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggrepel<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>sample<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_label_repel<span class="punctuation">(</span>aes<span class="punctuation">(</span>label <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">,</span> fontface <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa0159c8dec.png" style="width:600px;"/></div></div></p><p>填充后的方框可能看起来更漂亮，因此我们将<mark class="hl-label blue">season</mark> 映射为<mark class="hl-label blue">fill</mark> ，而不是<mark class="hl-label blue">color</mark> ，并为文本设置白色：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>sample<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>data <span class="operator">=</span> chic<span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_label_repel<span class="punctuation">(</span>aes<span class="punctuation">(</span>label <span class="operator">=</span> season<span class="punctuation">,</span> fill <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                   color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> fontface <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span></span><br><span class="line">                   segment.color <span class="operator">=</span> <span class="string">&quot;grey30&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa024f6bc5c.png" style="width:600px;"/></div></div></p><p>通过使用<mark class="hl-label blue">geom_text_repel()</mark> ，这也适用于纯文本标签。请查看所有<a href="https://ggrepel.slowkow.com/articles/examples.html">使用示例</a>。</p><h2 id="添加文本注释"><a href="#添加文本注释" class="headerlink" title="添加文本注释"></a>添加文本注释</h2><p>在 ggplot 中添加注释有多种方法。我们可以再次使用<mark class="hl-label blue">annotate(geom=text)</mark> 、<mark class="hl-label blue">annotate(geom=label)</mark> 、<mark class="hl-label blue">geom_text()</mark> 或<mark class="hl-label blue">geom_label()</mark> <br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">&lt;-</span></span><br><span class="line">  ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> dewpoint<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>alpha <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Dewpoint&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">+</span> </span><br><span class="line">  annotate<span class="punctuation">(</span>geom <span class="operator">=</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="number">25</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">60</span><span class="punctuation">,</span> fontface <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                label <span class="operator">=</span> <span class="string">&quot;This is a useful annotation&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa03797a923.png" style="width:600px;"/></div></div></p><p>但是，现在 ggplot 为每个数据点绘制了一个文本标签—即 1,461 个标签，你只能看到一个！您可以将<mark class="hl-label blue">stat</mark> 参数设置为<mark class="hl-label blue">unique</mark> 来解决这个问题：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">25</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">60</span><span class="punctuation">,</span></span><br><span class="line">                label <span class="operator">=</span> <span class="string">&quot;This is a useful annotation&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            stat <span class="operator">=</span> <span class="string">&quot;unique&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa042aa9074.png" style="width:600px;"/></div></div></p><p>当然，我们也可以更改显示文本的属性：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">25</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">60</span><span class="punctuation">,</span></span><br><span class="line">                label <span class="operator">=</span> <span class="string">&quot;This is a useful annotation&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            stat <span class="operator">=</span> <span class="string">&quot;unique&quot;</span><span class="punctuation">,</span> family <span class="operator">=</span> <span class="string">&quot;Bangers&quot;</span><span class="punctuation">,</span></span><br><span class="line">            size <span class="operator">=</span> <span class="number">7</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;darkcyan&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa092518481.png" style="width:600px;"/></div></div></p><p>如果您使用其中一个面函数来可视化数据，可能会遇到麻烦。首先，您可能只想包含一次注释：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ann <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span></span><br><span class="line">  o3 <span class="operator">=</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">  temp <span class="operator">=</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">  season <span class="operator">=</span> factor<span class="punctuation">(</span><span class="string">&quot;Summer&quot;</span><span class="punctuation">,</span> levels <span class="operator">=</span> levels<span class="punctuation">(</span>chic<span class="operator">$</span>season<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  label <span class="operator">=</span> <span class="string">&quot;Here is enough space\nfor some annotations.&quot;</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">&lt;-</span></span><br><span class="line">  ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> o3<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Ozone&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>data <span class="operator">=</span> ann<span class="punctuation">,</span> aes<span class="punctuation">(</span>label <span class="operator">=</span> label<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            size <span class="operator">=</span> <span class="number">7</span><span class="punctuation">,</span> fontface <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span></span><br><span class="line">            family <span class="operator">=</span> <span class="string">&quot;Roboto Condensed&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_wrap<span class="punctuation">(</span><span class="operator">~</span>season<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa0ddec9d51.png" style="width:600px;"/></div></div></p><p>另一个挑战是分面与自由刻度的结合，这可能会削减你的文字：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">23</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">97</span><span class="punctuation">,</span></span><br><span class="line">                label <span class="operator">=</span> <span class="string">&quot;This is not a useful annotation&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> fontface <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_wrap<span class="punctuation">(</span><span class="operator">~</span>season<span class="punctuation">,</span> scales <span class="operator">=</span> <span class="string">&quot;free_x&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa0eae47fd5.png" style="width:600px;"/></div></div></p><p>一种解决方案是事先计算出坐标轴的中点，这里是<mark class="hl-label blue">x</mark> ：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ann <span class="operator">&lt;-</span></span><br><span class="line">  chic <span class="operator">|&gt;</span></span><br><span class="line">  dplyr<span class="operator">::</span>group_by<span class="punctuation">(</span>season<span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  dplyr<span class="operator">::</span>summarize<span class="punctuation">(</span></span><br><span class="line">    o3 <span class="operator">=</span> <span class="built_in">min</span><span class="punctuation">(</span>o3<span class="punctuation">,</span> na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">          <span class="punctuation">(</span><span class="built_in">max</span><span class="punctuation">(</span>o3<span class="punctuation">,</span> na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">-</span> <span class="built_in">min</span><span class="punctuation">(</span>o3<span class="punctuation">,</span> na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">/</span> <span class="number">2</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ann</span><br></pre></td></tr></table></figure><br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## # A tibble: 4 × 2</span></span><br><span class="line"><span class="comment">##   season    o3</span></span><br><span class="line"><span class="comment">##   &lt;fct&gt;  &lt;dbl&gt;</span></span><br><span class="line"><span class="comment">## 1 Winter  21.5</span></span><br><span class="line"><span class="comment">## 2 Spring  31.0</span></span><br><span class="line"><span class="comment">## 3 Summer  29.2</span></span><br><span class="line"><span class="comment">## 4 Autumn  23.3</span></span><br></pre></td></tr></table></figure></p><p>……并使用合计数据指定注释的位置：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>data <span class="operator">=</span> ann<span class="punctuation">,</span></span><br><span class="line">            aes<span class="punctuation">(</span>x <span class="operator">=</span> o3<span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">97</span><span class="punctuation">,</span></span><br><span class="line">                label <span class="operator">=</span> <span class="string">&quot;This is a useful annotation&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> fontface <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_wrap<span class="punctuation">(</span><span class="operator">~</span>season<span class="punctuation">,</span> scales <span class="operator">=</span> <span class="string">&quot;free_x&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa10f4abace.png" style="width:600px;"/></div></div></p><p>不过，还有一种更简单的方法（在固定坐标方面）—但也需要花些时间熟记代码。{grid}软件包与{ggplot2}的<mark class="hl-label blue">annotation_custom()</mark> 结合使用，可以根据比例坐标指定位置，其中 0 代表低，1 代表高。<mark class="hl-label blue">grobTree()</mark> 创建网格图形对象，<mark class="hl-label blue">textGrob</mark> 创建文本图形对象。当您有多个不同比例的绘图时，这种方法的价值尤为明显。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>grid<span class="punctuation">)</span></span><br><span class="line">my_grob <span class="operator">&lt;-</span> grobTree<span class="punctuation">(</span>textGrob<span class="punctuation">(</span><span class="string">&quot;This text stays in place!&quot;</span><span class="punctuation">,</span></span><br><span class="line">                             x <span class="operator">=</span> <span class="number">.1</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">.9</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                             gp <span class="operator">=</span> gpar<span class="punctuation">(</span>col <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                       fontsize <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">                                       fontface <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">+</span></span><br><span class="line">  annotation_custom<span class="punctuation">(</span>my_grob<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_wrap<span class="punctuation">(</span><span class="operator">~</span>season<span class="punctuation">,</span> scales <span class="operator">=</span> <span class="string">&quot;free_x&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_y_continuous<span class="punctuation">(</span>limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa11fe23f65.png" style="width:600px;"/></div></div></p><h2 id="使用-Markdown-和-HTML-渲染注释"><a href="#使用-Markdown-和-HTML-渲染注释" class="headerlink" title="使用 Markdown 和 HTML 渲染注释"></a>使用 Markdown 和 HTML 渲染注释</h2><p>我们再次使用 Claus Wilke 的 {ggtext} 软件包，该软件包旨在改进 {ggplot2} 的文本渲染支持。<a href="https://wilkelab.org/ggtext/">{ggtext}</a>软件包定义了两个新的主题元素：<mark class="hl-label blue">element_markdown()</mark> 和 <mark class="hl-label blue">element_textbox()</mark> 。<mark class="hl-label blue">geom_richtext()</mark> 可替代<mark class="hl-label blue">geom_text()</mark> 和<mark class="hl-label blue">geom_label()</mark> ，并将文本渲染为标记符…</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggtext<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">lab_md <span class="operator">&lt;-</span> <span class="string">&quot;This plot shows **temperature** in *°F* versus **ozone level** in *ppm*&quot;</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">+</span></span><br><span class="line">  geom_richtext<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">35</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> label <span class="operator">=</span> lab_md<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                stat <span class="operator">=</span> <span class="string">&quot;unique&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa13b18204d.png" style="width:600px;"/></div></div><p>… 或 html：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lab_html <span class="operator">&lt;-</span> <span class="string">&quot;&amp;#9733; This plot shows &lt;b style=&#x27;color:red;&#x27;&gt;temperature&lt;/b&gt; in &lt;i&gt;°F&lt;/i&gt; versus &lt;b style=&#x27;color:blue;&#x27;&gt;ozone level&lt;/b&gt;in &lt;i&gt;ppm&lt;/i&gt; &amp;#9733;&quot;</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">+</span></span><br><span class="line">  geom_richtext<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">33</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> label <span class="operator">=</span> lab_html<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                stat <span class="operator">=</span> <span class="string">&quot;unique&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa142f0f217.png" style="width:600px;"/></div></div></p><p>geom 附带了许多可以修改的细节，例如角度（默认的<mark class="hl-label blue">geom_text()</mark> 和<mark class="hl-label blue">geom_label()</mark> 无法修改）、方框属性和文本属性。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span></span><br><span class="line">  geom_richtext<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">25</span><span class="punctuation">,</span> label <span class="operator">=</span> lab_md<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                stat <span class="operator">=</span> <span class="string">&quot;unique&quot;</span><span class="punctuation">,</span> angle <span class="operator">=</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">                color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span></span><br><span class="line">                label.color <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> hjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> vjust <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                family <span class="operator">=</span> <span class="string">&quot;Playfair Display&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa151ed7482.png" style="width:600px;"/></div></div></p><p>来自 {ggtext} 软件包的另一个 geom 是<mark class="hl-label blue">geom_textbox()</mark> 。该 geom 允许对字符串进行动态包装，这对信息框和字幕等较长的注释非常有用。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lab_long <span class="operator">&lt;-</span> <span class="string">&quot;**Lorem ipsum dolor**&lt;br&gt;&lt;i style=&#x27;font-size:8pt;color:red;&#x27;&gt;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.&lt;br&gt;Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.&lt;/i&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">+</span></span><br><span class="line">  geom_textbox<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="number">40</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> label <span class="operator">=</span> lab_long<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               width <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">15</span><span class="punctuation">,</span> <span class="string">&quot;lines&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> stat <span class="operator">=</span> <span class="string">&quot;unique&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa1697f2fcb.png" style="width:600px;"/></div></div><br>请注意，既不能旋转文本框（始终水平），也不能更改文本的对齐方式（始终左对齐）。</p><h1 id="坐标系"><a href="#坐标系" class="headerlink" title="坐标系"></a>坐标系</h1><h2 id="翻转图片"><a href="#翻转图片" class="headerlink" title="翻转图片"></a>翻转图片</h2><p>翻转图片非常容易。我在这里添加了 coord_flip()，这就是翻转绘图所需的全部功能。这在使用几何图形表示分类数据（例如条形图或下面示例中的方框图和胡须图）时最有意义：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> season<span class="punctuation">,</span> y <span class="operator">=</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_boxplot<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;indianred&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Season&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_flip<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa17b339542.png" style="width:600px;"/></div></div></p><details class="folding-tag" green><summary> 💁自{ggplot2}3.0.0版起，也可以通过参数orientation = y水平绘制几何图形。展开查看示例。 </summary>              <div class='content'>              <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> o3<span class="punctuation">,</span> y <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_boxplot<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;indianred&quot;</span><span class="punctuation">,</span> orientation <span class="operator">=</span> <span class="string">&quot;y&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Ozone&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Season&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa17b339542.png" style="width:600px;"/></div></div>              </div>            </details><h2 id="固定轴"><a href="#固定轴" class="headerlink" title="固定轴"></a>固定轴</h2><p>我们可以固定笛卡尔坐标系的纵横比，并强制沿 x 轴和 y 轴对单位进行物理表示：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone Level&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_x_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">80</span><span class="punctuation">,</span> by <span class="operator">=</span> <span class="number">20</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_fixed<span class="punctuation">(</span>ratio <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa192807040.png" style="width:600px;"/></div></div></p><p>这样不仅可以确保坐标轴上的固定步长，还可以确保导出的绘图看起来符合预期。不过，如果您没有使用合适的纵横比，您保存的绘图可能会包含大量空白：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone Level&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_x_continuous<span class="punctuation">(</span>breaks <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">80</span><span class="punctuation">,</span> by <span class="operator">=</span> <span class="number">20</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_fixed<span class="punctuation">(</span>ratio <span class="operator">=</span> <span class="number">1</span><span class="operator">/</span><span class="number">3</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.background <span class="operator">=</span> element_rect<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;grey80&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa199027c42.png" style="width:600px;"/></div></div></p><h2 id="逆转轴"><a href="#逆转轴" class="headerlink" title="逆转轴"></a>逆转轴</h2><p>您还可以分别使用<mark class="hl-label blue">scale_x_reverse()</mark> 或<mark class="hl-label blue">scale_y_reverse()</mark> 轻松地反转坐标轴：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_y_reverse<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa1a54454c6.png" style="width:600px;"/></div></div></p><details class="folding-tag" green><summary> 💁请注意，这只适用于连续数据。如果要反转分类数据，请使用forcats软件包中的fct_rev()函数。展开查看示例。} <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## the default</span></span><br><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_jitter<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure> {% image https://bu.dusays.com/2023/09/08/64fa1b511e951.png </summary>              <div class='content'>              <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>forcats<span class="punctuation">)</span></span><br><span class="line">set.seed<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> fct_rev<span class="punctuation">(</span>season<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_jitter<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa1ba2a9f9e.png" style="width:600px;"/></div></div>              </div>            </details><h2 id="转换轴线"><a href="#转换轴线" class="headerlink" title="转换轴线"></a>转换轴线</h2><p>… 或者使用<mark class="hl-label blue">scale_y_log10()</mark> 或<mark class="hl-label blue">scale_y_sqrt()</mark> 转换默认线性映射。下面是一个 log10 转换轴的示例（在这种情况下会引入 NA，因此要小心）：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_y_log10<span class="punctuation">(</span>lim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0.1</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa1cca1a066.png" style="width:600px;"/></div></div></p><h2 id="将图片环化"><a href="#将图片环化" class="headerlink" title="将图片环化"></a>将图片环化</h2><p>此外，还可以通过调用<mark class="hl-label blue">coord_polar()</mark> 对坐标系进行圆化（极化？）<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">chic <span class="operator">|&gt;</span></span><br><span class="line">  dplyr<span class="operator">::</span>group_by<span class="punctuation">(</span>season<span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  dplyr<span class="operator">::</span>summarize<span class="punctuation">(</span>o3 <span class="operator">=</span> median<span class="punctuation">(</span>o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  ggplot<span class="punctuation">(</span>aes<span class="punctuation">(</span>x <span class="operator">=</span> season<span class="punctuation">,</span> y <span class="operator">=</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_col<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Median Ozone Level&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    coord_polar<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    guides<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa1dbd6724d.png" style="width:600px;"/></div></div></p><p>这种坐标系还可以绘制饼图：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">chic_sum <span class="operator">&lt;-</span></span><br><span class="line">  chic <span class="operator">|&gt;</span></span><br><span class="line">  dplyr<span class="operator">::</span>mutate<span class="punctuation">(</span>o3_avg <span class="operator">=</span> median<span class="punctuation">(</span>o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  dplyr<span class="operator">::</span>filter<span class="punctuation">(</span>o3 <span class="operator">&gt;</span> o3_avg<span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  dplyr<span class="operator">::</span>mutate<span class="punctuation">(</span>n_all <span class="operator">=</span> n<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  dplyr<span class="operator">::</span>group_by<span class="punctuation">(</span>season<span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  dplyr<span class="operator">::</span>summarize<span class="punctuation">(</span>rel <span class="operator">=</span> n<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">/</span> unique<span class="punctuation">(</span>n_all<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>chic_sum<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> rel<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_col<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Proportion of Days Exceeding\nthe Median Ozone Level&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_polar<span class="punctuation">(</span>theta <span class="operator">=</span> <span class="string">&quot;y&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_brewer<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;Set1&quot;</span><span class="punctuation">,</span> name <span class="operator">=</span> <span class="string">&quot;Season:&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.ticks <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa1e2783ace.png" style="width:600px;"/></div></div><p>我建议在笛卡尔坐标系（默认坐标系）下也查看相同代码的结果，以了解<mark class="hl-label blue">coord_polar()</mark> 和<mark class="hl-label blue">theta</mark> 背后的逻辑：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic_sum<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> rel<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_col<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Proportion of Days Exceeding\nthe Median Ozone Level&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  <span class="comment">#coord_polar(theta = &quot;y&quot;) +</span></span><br><span class="line">  scale_fill_brewer<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;Set1&quot;</span><span class="punctuation">,</span> name <span class="operator">=</span> <span class="string">&quot;Season:&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>axis.ticks <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa1eb57bc78.png" style="width:600px;"/></div></div></p><h1 id="图表类型"><a href="#图表类型" class="headerlink" title="图表类型"></a>图表类型</h1><h2 id="箱性图的替代方案"><a href="#箱性图的替代方案" class="headerlink" title="箱性图的替代方案"></a>箱性图的替代方案</h2><p>方框图很棒，但也可能非常无聊。另外，即使您习惯于箱形图，也要记住，可能有很多人在看您的图时从未见过箱形图和须状图。</p><details class="folding-tag" green><summary> 💁展开，简要回顾箱形图和须线图。 </summary>              <div class='content'>              <p>箱-须图（有时简称箱图）是一种类似直方图的数据显示方法，由 J. Tukey 发明。中间粗线表示中位数，也称为四分位数 Q2。方框的界限由下四分位数 Q1 和上四分位数 Q3 决定。因此，方框包含 50%的数据，称为 “四分位数间距”（IQR）。晶须的长度由不被视为异常值的最极端值（即四分位数间距的 3/2 倍以内的值）决定。</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa20ed91d6a.png" style="width:600px;"/></div></div>              </div>            </details><p>还有其他方法，但首先我们要绘制一个普通的箱形图：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">&lt;-</span></span><br><span class="line">  ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> season<span class="punctuation">,</span> y <span class="operator">=</span> o3<span class="punctuation">,</span></span><br><span class="line">                   color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Season&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    scale_color_brewer<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;Dark2&quot;</span><span class="punctuation">,</span> guide <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">+</span> geom_boxplot<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa2191d76a5.png" style="width:600px;"/></div></div></p><ol><li>替代方案：点阵图<br>让我们只绘制原始数据中的每个数据点：<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> geom_point<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa223d9dc6a.png" style="width:600px;"/></div></div></li></ol><p>不仅乏味，而且没有信息量。为了改善情节，可以增加透明度，以解决情节过多的问题：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> geom_point<span class="punctuation">(</span>alpha <span class="operator">=</span> <span class="number">.1</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/08/64fa22e14a284.png" style="width:600px;"/></div></div></p><p>然而，在这里设置透明度是很困难的，因为要么重叠度太高，要么极值不明显。很糟糕，所以让我们试试其他方法。</p><ol><li>替代方案：抖动点图<br>尝试给数据添加一点抖动。我喜欢在内部可视化中使用这种方法，但要小心使用抖动，因为你是在故意给数据添加噪音，这可能会导致对数据的误读。<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> geom_jitter<span class="punctuation">(</span>width <span class="operator">=</span> <span class="number">.3</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb48813f99e.png" style="width:600px;"/></div></div></li></ol><ol><li><p>替代方案：小提琴图<br>小提琴图（Violin plots）与箱形图类似，只是使用核密度来显示数据最多的地方，是一种有用的可视化方法。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> geom_violin<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;gray80&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb49509f7ec.png" style="width:600px;"/></div></div></li><li><p>替代方案 将小提琴图与抖动相结合<br>当然，我们可以将估计密度和原始数据点两者结合起来：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> geom_violin<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;gray80&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_jitter<span class="punctuation">(</span>alpha <span class="operator">=</span> <span class="number">.25</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">.3</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    coord_flip<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb49d8531b2.png" style="width:600px;"/></div></div></li></ol><p><a href="https://ggforce.data-imaginist.com/">{ggforce}</a>软件包提供了所谓的 sina 函数，抖动的宽度由数据的密度分布控制，这使得抖动在视觉上更有吸引力：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggforce<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">+</span> geom_violin<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;gray80&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_sina<span class="punctuation">(</span>alpha <span class="operator">=</span> <span class="number">.25</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    coord_flip<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb4a8653683.png" style="width:600px;"/></div></div></p><ol><li>替代方案 将小提琴图与方框图相结合<br>为了便于估算量化值，我们还可以在方框图的小提琴内部添加方框，以表示 25% 四分位数、中位数和 75% 四分位数：<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> geom_violin<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_boxplot<span class="punctuation">(</span>outlier.alpha <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> coef <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                 color <span class="operator">=</span> <span class="string">&quot;gray40&quot;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">.2</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    scale_fill_brewer<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;Dark2&quot;</span><span class="punctuation">,</span> guide <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    coord_flip<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb4b3d9d493.png" style="width:600px;"/></div></div></li></ol><h2 id="为绘图创建-Rug-表示法"><a href="#为绘图创建-Rug-表示法" class="headerlink" title="为绘图创建 Rug 表示法"></a>为绘图创建 Rug 表示法</h2><p>轴须图表示单个定量变量的数据，以沿坐标轴的标记形式显示。在大多数情况下，除散点图或热图之外，它还用于直观显示一个或两个变量的总体分布情况：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span></span><br><span class="line">                 color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_rug<span class="punctuation">(</span>show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb4c4f3a00e.png" style="width:600px;"/></div></div></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_rug<span class="punctuation">(</span>sides <span class="operator">=</span> <span class="string">&quot;r&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.3</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb4cc463987.png" style="width:600px;"/></div></div><h2 id="创建相关性矩阵"><a href="#创建相关性矩阵" class="headerlink" title="创建相关性矩阵"></a>创建相关性矩阵</h2><p>有几个软件包可以创建相关矩阵图，其中一些还使用了{ggplot2}基础架构，从而返回 ggplots。下面我将向大家展示如何在不使用扩展软件包的情况下创建相关矩阵图。</p><p>第一步是创建相关矩阵。在这里，我们使用的是 {corrr} 软件包，它可以很好地与管道配合使用，但也有很多其他软件。我们使用皮尔逊相关矩阵，因为所有变量的分布都比较正态（如果变量的分布模式不同，也可以考虑使用斯皮尔曼相关矩阵）。请注意，由于相关矩阵有冗余信息，因此我们将其中一半设置为<mark class="hl-label blue">NA</mark> 。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">corm <span class="operator">&lt;-</span></span><br><span class="line">  chic <span class="operator">|&gt;</span></span><br><span class="line">  dplyr<span class="operator">::</span>select<span class="punctuation">(</span>temp<span class="punctuation">,</span> dewpoint<span class="punctuation">,</span> pm10<span class="punctuation">,</span> o3<span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  corrr<span class="operator">::</span>correlate<span class="punctuation">(</span>diagonal <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  corrr<span class="operator">::</span>shave<span class="punctuation">(</span>upper <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">corm</span><br></pre></td></tr></table></figure><br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## # A tibble: 4 × 5</span></span><br><span class="line"><span class="comment">##   term      temp dewpoint   pm10    o3</span></span><br><span class="line"><span class="comment">##   &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span></span><br><span class="line"><span class="comment">## 1 temp         1    0.958  0.368 0.535</span></span><br><span class="line"><span class="comment">## 2 dewpoint    NA    1      0.327 0.454</span></span><br><span class="line"><span class="comment">## 3 pm10        NA   NA      1     0.206</span></span><br><span class="line"><span class="comment">## 4 o3          NA   NA     NA     1</span></span><br></pre></td></tr></table></figure></p><p>现在，我们使用 {tidyr} 软件包中的<mark class="hl-label blue">pivot_longer()</mark> 函数将得到的矩阵转换为长格式。我们还将直接格式化标签，并为上三角加上空引号。请注意，我使用了<mark class="hl-label blue">sprintf()</mark> 来确保标签始终显示两位数。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">corm <span class="operator">&lt;-</span> corm <span class="operator">|&gt;</span></span><br><span class="line">  tidyr<span class="operator">::</span>pivot_longer<span class="punctuation">(</span></span><br><span class="line">    cols <span class="operator">=</span> <span class="operator">-</span>term<span class="punctuation">,</span></span><br><span class="line">    names_to <span class="operator">=</span> <span class="string">&quot;colname&quot;</span><span class="punctuation">,</span></span><br><span class="line">    values_to <span class="operator">=</span> <span class="string">&quot;corr&quot;</span></span><br><span class="line">  <span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  dplyr<span class="operator">::</span>mutate<span class="punctuation">(</span></span><br><span class="line">    rowname <span class="operator">=</span> forcats<span class="operator">::</span>fct_inorder<span class="punctuation">(</span>term<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    colname <span class="operator">=</span> forcats<span class="operator">::</span>fct_inorder<span class="punctuation">(</span>colname<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    label <span class="operator">=</span> dplyr<span class="operator">::</span>if_else<span class="punctuation">(</span><span class="built_in">is.na</span><span class="punctuation">(</span>corr<span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> sprintf<span class="punctuation">(</span><span class="string">&quot;%1.2f&quot;</span><span class="punctuation">,</span> corr<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## # A tibble: 16 × 5</span></span><br><span class="line"><span class="comment">##    term     colname    corr rowname  label </span></span><br><span class="line"><span class="comment">##    &lt;chr&gt;    &lt;fct&gt;     &lt;dbl&gt; &lt;fct&gt;    &lt;chr&gt; </span></span><br><span class="line"><span class="comment">##  1 temp     temp      1     temp     &quot;1.00&quot;</span></span><br><span class="line"><span class="comment">##  2 temp     dewpoint  0.958 temp     &quot;0.96&quot;</span></span><br><span class="line"><span class="comment">##  3 temp     pm10      0.368 temp     &quot;0.37&quot;</span></span><br><span class="line"><span class="comment">##  4 temp     o3        0.535 temp     &quot;0.53&quot;</span></span><br><span class="line"><span class="comment">##  5 dewpoint temp     NA     dewpoint &quot;&quot;    </span></span><br><span class="line"><span class="comment">##  6 dewpoint dewpoint  1     dewpoint &quot;1.00&quot;</span></span><br><span class="line"><span class="comment">##  7 dewpoint pm10      0.327 dewpoint &quot;0.33&quot;</span></span><br><span class="line"><span class="comment">##  8 dewpoint o3        0.454 dewpoint &quot;0.45&quot;</span></span><br><span class="line"><span class="comment">##  9 pm10     temp     NA     pm10     &quot;&quot;    </span></span><br><span class="line"><span class="comment">## 10 pm10     dewpoint NA     pm10     &quot;&quot;    </span></span><br><span class="line"><span class="comment">## 11 pm10     pm10      1     pm10     &quot;1.00&quot;</span></span><br><span class="line"><span class="comment">## 12 pm10     o3        0.206 pm10     &quot;0.21&quot;</span></span><br><span class="line"><span class="comment">## 13 o3       temp     NA     o3       &quot;&quot;    </span></span><br><span class="line"><span class="comment">## 14 o3       dewpoint NA     o3       &quot;&quot;    </span></span><br><span class="line"><span class="comment">## 15 o3       pm10     NA     o3       &quot;&quot;    </span></span><br><span class="line"><span class="comment">## 16 o3       o3        1     o3       &quot;1.00&quot;</span></span><br></pre></td></tr></table></figure></p><p>我们将使用<mark class="hl-label blue">geom_tile()</mark> 绘制热图，使用<mark class="hl-label blue">geom_text()</mark> 绘制标签：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>corm<span class="punctuation">,</span> aes<span class="punctuation">(</span>rowname<span class="punctuation">,</span> fct_rev<span class="punctuation">(</span>colname<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 fill <span class="operator">=</span> corr<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_tile<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>aes<span class="punctuation">(</span>label <span class="operator">=</span> label<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_fixed<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb703b6c2f2.png" style="width:600px;"/></div></div></p><p>我喜欢使用发散的调色板—重要的是，刻度要以零相关性为中心！白色表示数据缺失。此外，我还喜欢热图周围没有网格线和衬垫，标签的颜色取决于底层填充物<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>corm<span class="punctuation">,</span> aes<span class="punctuation">(</span>rowname<span class="punctuation">,</span> fct_rev<span class="punctuation">(</span>colname<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 fill <span class="operator">=</span> corr<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_tile<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_text<span class="punctuation">(</span>aes<span class="punctuation">(</span></span><br><span class="line">    label <span class="operator">=</span> label<span class="punctuation">,</span></span><br><span class="line">    color <span class="operator">=</span> <span class="built_in">abs</span><span class="punctuation">(</span>corr<span class="punctuation">)</span> <span class="operator">&lt;</span> <span class="number">.75</span></span><br><span class="line">  <span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_fixed<span class="punctuation">(</span>expand <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_manual<span class="punctuation">(</span></span><br><span class="line">    values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;white&quot;</span><span class="punctuation">,</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    guide <span class="operator">=</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">  <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_distiller<span class="punctuation">(</span></span><br><span class="line">    palette <span class="operator">=</span> <span class="string">&quot;PuOr&quot;</span><span class="punctuation">,</span> na.value <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span></span><br><span class="line">    direction <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> limits <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    name <span class="operator">=</span> <span class="string">&quot;Pearson\nCorrelation:&quot;</span></span><br><span class="line">  <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.border <span class="operator">=</span> element_rect<span class="punctuation">(</span>color <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.position <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">.85</span><span class="punctuation">,</span> <span class="number">.8</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb706b6fd2c.png" style="width:600px;"/></div></div></p><h2 id="创建等高线图"><a href="#创建等高线图" class="headerlink" title="创建等高线图"></a>创建等高线图</h2><p>等值线图是显示数值等距的好方法。我们可以用它来对数据进行分选，显示观测值的密度：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>temp<span class="punctuation">,</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_density_2d<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="string">&quot;Ozone Level&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb708d4616f.png" style="width:600px;"/></div></div></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>temp<span class="punctuation">,</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_density_2d_filled<span class="punctuation">(</span>show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_cartesian<span class="punctuation">(</span>expand <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="string">&quot;Ozone Level&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb70ddbe0d0.png" style="width:600px;"/></div></div><p>但现在，我们正在绘制三维数据。我们将绘制露点（即空气中水蒸气凝结成液态露水的温度）与温度和臭氧水平相关的临界值：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## interpolate data</span></span><br><span class="line">fld <span class="operator">&lt;-</span> with<span class="punctuation">(</span>chic<span class="punctuation">,</span> akima<span class="operator">::</span>interp<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> o3<span class="punctuation">,</span> z <span class="operator">=</span> dewpoint<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## prepare data in long format</span></span><br><span class="line">df <span class="operator">&lt;-</span> fld<span class="operator">$</span>z <span class="operator">|&gt;</span></span><br><span class="line">  tibble<span class="operator">::</span>as_tibble<span class="punctuation">(</span>.name_repair <span class="operator">=</span> <span class="string">&quot;universal_quiet&quot;</span><span class="punctuation">)</span> <span class="operator">|&gt;</span> </span><br><span class="line">  dplyr<span class="operator">::</span>mutate<span class="punctuation">(</span>x <span class="operator">=</span> dplyr<span class="operator">::</span>row_number<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  tidyr<span class="operator">::</span>pivot_longer<span class="punctuation">(</span></span><br><span class="line">    cols <span class="operator">=</span> <span class="operator">-</span>x<span class="punctuation">,</span></span><br><span class="line">    names_to <span class="operator">=</span> <span class="string">&quot;y&quot;</span><span class="punctuation">,</span></span><br><span class="line">    names_transform <span class="operator">=</span> <span class="built_in">as.integer</span><span class="punctuation">,</span></span><br><span class="line">    values_to <span class="operator">=</span> <span class="string">&quot;Dewpoint&quot;</span><span class="punctuation">,</span> </span><br><span class="line">    names_prefix <span class="operator">=</span> <span class="string">&quot;...&quot;</span><span class="punctuation">,</span></span><br><span class="line">    values_drop_na <span class="operator">=</span> <span class="literal">TRUE</span></span><br><span class="line">  <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data <span class="operator">=</span> df<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> x<span class="punctuation">,</span> y <span class="operator">=</span> y<span class="punctuation">,</span> z <span class="operator">=</span> Dewpoint<span class="punctuation">)</span><span class="punctuation">)</span>  <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone Level&quot;</span><span class="punctuation">,</span></span><br><span class="line">       color <span class="operator">=</span> <span class="string">&quot;Dewpoint&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">+</span> stat_contour<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> after_stat<span class="punctuation">(</span>level<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb7109b4f8e.png" style="width:600px;"/></div></div></p><p>惊喜 根据定义，拔模点在大多数情况下等于测量温度。</p><p>这些线条表示不同等级的露点，但这幅图并不美观，而且由于边框缺失，很难阅读。让我们尝试使用 viridis 调色板绘制一幅瓦片图，对臭氧水平和温度的每种组合的露点进行编码：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> geom_tile<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> Dewpoint<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    scale_fill_viridis_c<span class="punctuation">(</span>option <span class="operator">=</span> <span class="string">&quot;inferno&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb7123b325d.png" style="width:600px;"/></div></div><p>如果我们将等高线图和瓦片图结合起来，填充等高线下的区域，效果会如何？<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">+</span> geom_tile<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> Dewpoint<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    stat_contour<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">.7</span><span class="punctuation">,</span> bins <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    scale_fill_viridis_c<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb713825e31.png" style="width:600px;"/></div></div></p><h2 id="创建计数热图"><a href="#创建计数热图" class="headerlink" title="创建计数热图"></a>创建计数热图</h2><p>与第一幅等高线图类似，我们也可以通过<mark class="hl-label blue">geom_hex()</mark> ，轻松显示按六边形网格划分的点的计数或密度：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>temp<span class="punctuation">,</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_hex<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_distiller<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;YlOrRd&quot;</span><span class="punctuation">,</span> direction <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone Level&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb7151b69bf.png" style="width:600px;"/></div></div></p><p>通常情况下，结果图中会出现白线。可以通过将颜色映射到<mark class="hl-label blue">after_stat(count)</mark> （默认值）或 <mark class="hl-label blue">after_stat(density)</mark> 来解决这个问题…<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>temp<span class="punctuation">,</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_hex<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> after_stat<span class="punctuation">(</span>count<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_distiller<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;YlOrRd&quot;</span><span class="punctuation">,</span> direction <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_distiller<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;YlOrRd&quot;</span><span class="punctuation">,</span> direction <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone Level&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb7169a86dc.png" style="width:600px;"/></div></div></p><p>… 或为所有六边形单元格设置相同的轮廓颜色：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>temp<span class="punctuation">,</span> o3<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_hex<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;grey&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_distiller<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;YlOrRd&quot;</span><span class="punctuation">,</span> direction <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone Level&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb7186c981b.png" style="width:600px;"/></div></div></p><p>还可以更改默认的分档，以增加或减少六边形单元的数量：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>temp<span class="punctuation">,</span> o3<span class="punctuation">,</span> fill <span class="operator">=</span> after_stat<span class="punctuation">(</span>density<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_hex<span class="punctuation">(</span>bins <span class="operator">=</span> <span class="number">50</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;grey&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_distiller<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;YlOrRd&quot;</span><span class="punctuation">,</span> direction <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone Level&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb71a170b1d.png" style="width:600px;"/></div></div></p><p>如果想使用规则网格，也可以使用<mark class="hl-label blue">geom_bin2d()</mark> ，它可以将数据汇总到基于<mark class="hl-label blue">bins</mark> 的矩形网格单元中：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>temp<span class="punctuation">,</span> o3<span class="punctuation">,</span> fill <span class="operator">=</span> after_stat<span class="punctuation">(</span>density<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_bin2d<span class="punctuation">(</span>bins <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;grey&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_distiller<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;YlOrRd&quot;</span><span class="punctuation">,</span> direction <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone Level&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb71b5773a2.png" style="width:600px;"/></div></div></p><h2 id="创建山脊图"><a href="#创建山脊图" class="headerlink" title="创建山脊图"></a>创建山脊图</h2><p>山脊图是一种新型图形，目前非常流行。</p><p>虽然您可以使用基本的 {ggplot2} 命令来创建这些图，但由于流行，我们开发了一个软件包，可以更轻松地创建这些图： {ggridges}。我们将在这里使用这个软件包。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggridges<span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> factor<span class="punctuation">(</span>year<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   geom_density_ridges<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;gray90&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb71c9707d6.png" style="width:600px;"/></div></div><p>你可以分别使用参数<mark class="hl-label blue">rel_min_height</mark> 和<mark class="hl-label blue">scale</mark> 来轻松指定重叠部分和尾部。该软件包还自带主题（但我更喜欢创建自己的主题，参见 “创建和使用自定义主题 “一章）。此外，我们还会根据年份改变颜色，使其更吸引人。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> factor<span class="punctuation">(</span>year<span class="punctuation">)</span><span class="punctuation">,</span> fill <span class="operator">=</span> year<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_density_ridges<span class="punctuation">(</span>alpha <span class="operator">=</span> <span class="number">.8</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span></span><br><span class="line">                      scale <span class="operator">=</span> <span class="number">2.5</span><span class="punctuation">,</span> rel_min_height <span class="operator">=</span> <span class="number">.01</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  guides<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_ridges<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb72239b7af.png" style="width:600px;"/></div></div></p><p>您也可以使用低于 1 的缩放参数值来消除重叠（但这与脊图的理念相悖……）。下面是一个额外使用 viridis 颜色梯度和内置主题的示例：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> season<span class="punctuation">,</span> fill <span class="operator">=</span> after_stat<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_density_ridges_gradient<span class="punctuation">(</span>scale <span class="operator">=</span> <span class="number">.9</span><span class="punctuation">,</span> gradient_lwd <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span></span><br><span class="line">                               color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_viridis_c<span class="punctuation">(</span>option <span class="operator">=</span> <span class="string">&quot;plasma&quot;</span><span class="punctuation">,</span> name <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Season&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_ridges<span class="punctuation">(</span>font_family <span class="operator">=</span> <span class="string">&quot;Roboto Condensed&quot;</span><span class="punctuation">,</span> grid <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb7236857e3.png" style="width:600px;"/></div></div></p><p>我们还可以比较每条山脊线的几个组别，并根据组别进行着色。这与马克-贝尔尊斯（Marc Belzunces）的想法不谋而合。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## only plot extreme season using dplyr from the tidyverse</span></span><br><span class="line">ggplot<span class="punctuation">(</span>data <span class="operator">=</span> dplyr<span class="operator">::</span>filter<span class="punctuation">(</span>chic<span class="punctuation">,</span> season <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Summer&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Winter&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">         aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> year<span class="punctuation">,</span> fill <span class="operator">=</span> paste<span class="punctuation">(</span>year<span class="punctuation">,</span> season<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_density_ridges<span class="punctuation">(</span>alpha <span class="operator">=</span> <span class="number">.7</span><span class="punctuation">,</span> rel_min_height <span class="operator">=</span> <span class="number">.01</span><span class="punctuation">,</span></span><br><span class="line">                      color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> from <span class="operator">=</span> <span class="operator">-</span><span class="number">5</span><span class="punctuation">,</span> to <span class="operator">=</span> <span class="number">95</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_fill_cyclical<span class="punctuation">(</span>breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;1997 Summer&quot;</span><span class="punctuation">,</span> <span class="string">&quot;1997 Winter&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                      labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>`<span class="number">1997</span> Summer` = &quot;Summer&quot;,</span><br><span class="line">                                 `1997 Winter` = &quot;Winter&quot;),</span><br><span class="line">                      values = c(&quot;tomato&quot;, &quot;dodgerblue&quot;),</span><br><span class="line">                      name = &quot;Season:&quot;, guide = &quot;legend&quot;) +</span><br><span class="line">  theme_ridges(grid = FALSE) +</span><br><span class="line">  labs(x = &quot;Temperature (°F)&quot;, y = &quot;Year&quot;)</span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb724f84fa6.png" style="width:600px;"/></div></div></p><p>在<mark class="hl-label blue">geom_density_ridges()</mark> 命令中使用<mark class="hl-label =binline">stat</mark> ，{ggridges}软件包还可以帮助创建不同组别的直方图：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> factor<span class="punctuation">(</span>year<span class="punctuation">)</span><span class="punctuation">,</span> fill <span class="operator">=</span> year<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_density_ridges<span class="punctuation">(</span>stat <span class="operator">=</span> <span class="string">&quot;binline&quot;</span><span class="punctuation">,</span> bins <span class="operator">=</span> <span class="number">25</span><span class="punctuation">,</span> scale <span class="operator">=</span> <span class="number">.9</span><span class="punctuation">,</span></span><br><span class="line">                      draw_baseline <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> show.legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_minimal<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Season&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb725fefc1e.png" style="width:600px;"/></div></div></p><h1 id="使用色带（AUC、CI-等）"><a href="#使用色带（AUC、CI-等）" class="headerlink" title="使用色带（AUC、CI 等）"></a>使用色带（AUC、CI 等）</h1><p>这并不是一个完美的数据集，但使用ribbon 可以很有用。在这个示例中，我们将使用 filter() 函数创建一个 30 天的运行平均值，这样我们的数据带就不会太嘈杂。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chic<span class="operator">$</span>o3run <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>stats<span class="operator">::</span>filter<span class="punctuation">(</span>chic<span class="operator">$</span>o3<span class="punctuation">,</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">/</span><span class="number">30</span><span class="punctuation">,</span> <span class="number">30</span><span class="punctuation">)</span><span class="punctuation">,</span> sides <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> o3run<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   geom_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;chocolate&quot;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">.8</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb727d74ed0.png" style="width:600px;"/></div></div><p>如果我们使用<mark class="hl-label blue">geom_ribbon()</mark> 函数填充曲线下方的区域，效果会如何？<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> o3run<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   geom_ribbon<span class="punctuation">(</span>aes<span class="punctuation">(</span>ymin <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> ymax <span class="operator">=</span> o3run<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               fill <span class="operator">=</span> <span class="string">&quot;orange&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.4</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   geom_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;chocolate&quot;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">.8</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb7296ba5e4.png" style="width:600px;"/></div></div></p><p>表示曲线下面积<a href="https://en.wikipedia.org/wiki/Area_under_the_curve_(pharmacokinetics">（AUC）</a>)很好，但这并不是使用 geom_ribbon() 的常规方法。</p><details class="folding-tag" green><summary> 💁 实际上，geom_area() 是实现同样效果的更好方法。 </summary>              <div class='content'>              <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> o3run<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   geom_area<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;chocolate&quot;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">.8</span><span class="punctuation">,</span></span><br><span class="line">             fill <span class="operator">=</span> <span class="string">&quot;orange&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.4</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb7296ba5e4.png" style="width:600px;"/></div></div>              </div>            </details><p>取而代之的是，我们画一条带状线，使我们的数据上下各有一个标准差：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">chic<span class="operator">$</span>mino3 <span class="operator">&lt;-</span> chic<span class="operator">$</span>o3run <span class="operator">-</span> sd<span class="punctuation">(</span>chic<span class="operator">$</span>o3run<span class="punctuation">,</span> na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">chic<span class="operator">$</span>maxo3 <span class="operator">&lt;-</span> chic<span class="operator">$</span>o3run <span class="operator">+</span> sd<span class="punctuation">(</span>chic<span class="operator">$</span>o3run<span class="punctuation">,</span> na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> o3run<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   geom_ribbon<span class="punctuation">(</span>aes<span class="punctuation">(</span>ymin <span class="operator">=</span> mino3<span class="punctuation">,</span> ymax <span class="operator">=</span> maxo3<span class="punctuation">)</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">,</span></span><br><span class="line">               fill <span class="operator">=</span> <span class="string">&quot;darkseagreen3&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;transparent&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   geom_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;aquamarine4&quot;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">.7</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Ozone&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb72eb7f4a9.png" style="width:600px;"/></div></div></p><h1 id="平滑图"><a href="#平滑图" class="headerlink" title="平滑图"></a>平滑图</h1><p>使用 {ggplot2} 为数据添加平滑处理非常简单。</p><h2 id="默认值-添加-LOESS-或-GAM-平滑处理"><a href="#默认值-添加-LOESS-或-GAM-平滑处理" class="headerlink" title="默认值 添加 LOESS 或 GAM 平滑处理"></a>默认值 添加 LOESS 或 GAM 平滑处理</h2><p>您只需使用<mark class="hl-label blue">stat_smooth()</mark> ，甚至不需要公式。如果点数少于 1000 个，则添加 LOESS（局部加权散点图平滑，<mark class="hl-label blue">method=loess</mark> ），否则添加 GAM（广义相加模型，<mark class="hl-label gam">method=</mark> ）。由于我们有超过 1000 个点，所以平滑是基于 GAM ：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;gray40&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  stat_smooth<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> </span><br></pre></td></tr></table></figure><br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## `geom_smooth()` using method = &#x27;gam&#x27; and formula = &#x27;y ~ s(x, bs = &quot;cs&quot;)&#x27;</span></span><br></pre></td></tr></table></figure></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb74636abcb.png" style="width:600px;"/></div></div><p><strong>💡 在大多数情况下，我们希望点位于色带的顶部，因此请确保在添加点之前调用平滑。</strong></p><h2 id="添加线性拟合"><a href="#添加线性拟合" class="headerlink" title="添加线性拟合"></a>添加线性拟合</h2><p>虽然默认是 LOESS 或 GAM 平滑，但也可以轻松添加标准线性拟合：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> temp<span class="punctuation">,</span> y <span class="operator">=</span> dewpoint<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;gray40&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   stat_smooth<span class="punctuation">(</span>method <span class="operator">=</span> <span class="string">&quot;lm&quot;</span><span class="punctuation">,</span> se <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">               color <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">1.3</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">   labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Dewpoint&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb7526e13fe.png" style="width:600px;"/></div></div></p><h2 id="指定平滑公式"><a href="#指定平滑公式" class="headerlink" title="指定平滑公式"></a>指定平滑公式</h2><p>{ggplot2} 允许您指定要使用的模型。也许你想使用多项式回归？<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> o3<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;gray40&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.3</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_smooth<span class="punctuation">(</span></span><br><span class="line">    method <span class="operator">=</span> <span class="string">&quot;lm&quot;</span><span class="punctuation">,</span></span><br><span class="line">    formula <span class="operator">=</span> y <span class="operator">~</span> x <span class="operator">+</span> I<span class="punctuation">(</span>x<span class="operator">^</span><span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span> I<span class="punctuation">(</span>x<span class="operator">^</span><span class="number">3</span><span class="punctuation">)</span> <span class="operator">+</span> I<span class="punctuation">(</span>x<span class="operator">^</span><span class="number">4</span><span class="punctuation">)</span> <span class="operator">+</span> I<span class="punctuation">(</span>x<span class="operator">^</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">    fill <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span></span><br><span class="line">  <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Ozone Level&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb75f7ea31f.png" style="width:600px;"/></div></div></p><details class="folding-tag" green><summary> 💁 咦，geom_smooth()？geom和stat之间有重要区别，但在这里用哪个并不重要。展开以比较两者。 </summary>              <div class='content'>              <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> o3<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;gray40&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.3</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_smooth<span class="punctuation">(</span>stat <span class="operator">=</span> <span class="string">&quot;smooth&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">## the default</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Ozone Level&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb76e5ba58d.png" style="width:600px;"/></div></div><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> o3<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;gray40&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.3</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  stat_smooth<span class="punctuation">(</span>geom <span class="operator">=</span> <span class="string">&quot;smooth&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="comment">## the default</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Ozone Level&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb76e5ba58d.png" style="width:600px;"/></div></div>              </div>            </details><p>或者，假设您想增加 GAM 维度（在平滑的基础上增加一些额外的摆动）：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cols <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;darkorange2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="string">&quot;dodgerblue3&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;gray40&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">.3</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  stat_smooth<span class="punctuation">(</span>aes<span class="punctuation">(</span>col <span class="operator">=</span> <span class="string">&quot;1000&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">              method <span class="operator">=</span> <span class="string">&quot;gam&quot;</span><span class="punctuation">,</span></span><br><span class="line">              formula <span class="operator">=</span> y <span class="operator">~</span> s<span class="punctuation">(</span>x<span class="punctuation">,</span> k <span class="operator">=</span> <span class="number">1000</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">              se <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">1.3</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  stat_smooth<span class="punctuation">(</span>aes<span class="punctuation">(</span>col <span class="operator">=</span> <span class="string">&quot;100&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">              method <span class="operator">=</span> <span class="string">&quot;gam&quot;</span><span class="punctuation">,</span></span><br><span class="line">              formula <span class="operator">=</span> y <span class="operator">~</span> s<span class="punctuation">(</span>x<span class="punctuation">,</span> k <span class="operator">=</span> <span class="number">100</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">              se <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  stat_smooth<span class="punctuation">(</span>aes<span class="punctuation">(</span>col <span class="operator">=</span> <span class="string">&quot;10&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">              method <span class="operator">=</span> <span class="string">&quot;gam&quot;</span><span class="punctuation">,</span></span><br><span class="line">              formula <span class="operator">=</span> y <span class="operator">~</span> s<span class="punctuation">(</span>x<span class="punctuation">,</span> k <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">              se <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">.8</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_manual<span class="punctuation">(</span>name <span class="operator">=</span> <span class="string">&quot;k&quot;</span><span class="punctuation">,</span> values <span class="operator">=</span> cols<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb7920cf067.png" style="width:600px;"/></div></div></p><h1 id="交互式绘图"><a href="#交互式绘图" class="headerlink" title="交互式绘图"></a>交互式绘图</h1><p>以下库集列出了可与 {ggplot2} 结合使用或单独使用的库，用于在 R 中创建交互式可视化（通常利用现有 JavaScript 库）。</p><h2 id="ggplot2-和-shiny-的组合"><a href="#ggplot2-和-shiny-的组合" class="headerlink" title="{ggplot2}和{shiny}的组合"></a>{ggplot2}和{shiny}的组合</h2><p>{shiny}是<a href="https://posit.co/">RStudio</a>的一个软件包，它让使用R构建交互式网络应用变得异常简单。如需了解相关介绍和实例，请访问<a href="https://shiny.posit.co/">Shiny</a>主页。</p><p>要了解其潜在用途，可以查看 Hello Shiny 示例。这是第一个：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>shiny<span class="punctuation">)</span></span><br><span class="line">runExample<span class="punctuation">(</span><span class="string">&quot;01_hello&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></p><p>当然，我们也可以在这些应用程序中使用 ggplots。本例展示了添加一些交互式用户体验的可能性：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runExample<span class="punctuation">(</span><span class="string">&quot;04_mpg&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></p><h2 id="通过-plotly-和-ggplot2-Plot-ly"><a href="#通过-plotly-和-ggplot2-Plot-ly" class="headerlink" title="通过 {plotly} 和 {ggplot2} Plot.ly"></a>通过 {plotly} 和 {ggplot2} Plot.ly</h2><p><a href="https://chart-studio.plotly.com/feed/#/">Plot.ly</a>是一款用于创建在线交互式图形和网络应用的工具。{plotly}软件包可以让你直接从{ggplot2}绘图中创建这些图形，而且工作流程出奇地简单，<a href="https://plotly-r.com/">可以在R中完成</a>。不过，你的一些主题设置可能会被更改，之后需要手动修改。此外，遗憾的是，创建能很好缩放的面图或真正的多面板图并不简单。<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">g <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>date<span class="punctuation">,</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;grey&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>color <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_brewer<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;Dark2&quot;</span><span class="punctuation">,</span> guide <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><br><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb7c714f6f0.png" style="width:600px;"/></div></div></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>plotly<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggplotly<span class="punctuation">(</span>g<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb7ceab0d2e.png" style="width:600px;"/></div></div><p>例如，这里保留了整体主题设置，但再次添加了图例。</p><h2 id="ggiraph-和-ggplot2"><a href="#ggiraph-和-ggplot2" class="headerlink" title="ggiraph 和 ggplot2"></a>ggiraph 和 ggplot2</h2><p><a href="https://davidgohel.github.io/ggiraph/index.html">{ggiraph}</a>是一个 R 软件包，可用于创建动态 {ggplot2} 图形。您可以在图形中添加工具提示、动画和 JavaScript 操作。在 Shiny 应用程序中使用该软件包时，还可以选择图形元素。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>ggiraph<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">g <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>chic<span class="punctuation">,</span> aes<span class="punctuation">(</span>date<span class="punctuation">,</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_line<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;grey&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point_interactive<span class="punctuation">(</span></span><br><span class="line">    aes<span class="punctuation">(</span>color <span class="operator">=</span> season<span class="punctuation">,</span> tooltip <span class="operator">=</span> season<span class="punctuation">,</span> data_id <span class="operator">=</span> season<span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_brewer<span class="punctuation">(</span>palette <span class="operator">=</span> <span class="string">&quot;Dark2&quot;</span><span class="punctuation">,</span> guide <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">girafe<span class="punctuation">(</span>ggobj <span class="operator">=</span> g<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb7ebedbf49.png" style="width:600px;"/></div></div><h2 id="Highcharts-通过-highcharter"><a href="#Highcharts-通过-highcharter" class="headerlink" title="Highcharts 通过 {highcharter}"></a>Highcharts 通过 {highcharter}</h2><p><a href="https://www.highcharts.com/">Highcharts</a>是一个用于交互式图表制作的软件库，它是另一个用纯JavaScript编写的可视化库，已被移植到R语言中。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>highcharter<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">hchart<span class="punctuation">(</span>chic<span class="punctuation">,</span> <span class="string">&quot;scatter&quot;</span><span class="punctuation">,</span> hcaes<span class="punctuation">(</span>x <span class="operator">=</span> date<span class="punctuation">,</span> y <span class="operator">=</span> temp<span class="punctuation">,</span> group <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb7fa570a6b.png" style="width:600px;"/></div></div><h2 id="Echarts-通过-echarts4r"><a href="#Echarts-通过-echarts4r" class="headerlink" title="Echarts 通过 {echarts4r}"></a>Echarts 通过 {echarts4r}</h2><p><a href="https://echarts.apache.org/en/index.html">Apache ECharts</a>是一个免费、功能强大的图表和可视化库，提供了一种构建直观、交互式和高度可定制图表的简单方法。尽管它是用纯 JavaScript 编写的，但由于 John Coene 的功劳，人们可以通过 <a href="https://echarts4r.john-coene.com/">{echarts4r}</a>库在 R 中使用它。请查看令人印象深刻的示例图库或软件包开发者<a href="https://john-coene.com/">John Coene</a>制作的<a href="https://johncoene.shinyapps.io/fopi-contest/">应用程序</a>。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>echarts4r<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">chic <span class="operator">|&gt;</span></span><br><span class="line">  e_charts<span class="punctuation">(</span>date<span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  e_scatter<span class="punctuation">(</span>temp<span class="punctuation">,</span> symbol_size <span class="operator">=</span> <span class="number">7</span><span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  e_visual_map<span class="punctuation">(</span>temp<span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  e_y_axis<span class="punctuation">(</span>name <span class="operator">=</span> <span class="string">&quot;Temperature (°F)&quot;</span><span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  e_legend<span class="punctuation">(</span><span class="literal">FALSE</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/09/64fb8102872b2.png" style="width:600px;"/></div></div><h2 id="Chart-js-通过-charter"><a href="#Chart-js-通过-charter" class="headerlink" title="Chart.js 通过 {charter}"></a>Chart.js 通过 {charter}</h2><p><a href="https://github.com/JohnCoene/charter">charter</a>是 John Coene 开发的另一个软件包，可以在 R 中使用 JavaScript 可视化库。通过该软件包，您可以借助<a href="https://www.chartjs.org/">Charts.js框架</a>构建交互式图表。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>charter<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">chic<span class="operator">$</span>date_num <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>chic<span class="operator">$</span>date<span class="punctuation">)</span></span><br><span class="line"><span class="comment">## doesn&#x27;t work with class date</span></span><br><span class="line"></span><br><span class="line">chart<span class="punctuation">(</span>data <span class="operator">=</span> chic<span class="punctuation">,</span> caes<span class="punctuation">(</span>date_num<span class="punctuation">,</span> temp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  c_scatter<span class="punctuation">(</span>caes<span class="punctuation">(</span>color <span class="operator">=</span> season<span class="punctuation">,</span> group <span class="operator">=</span> season<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  c_colors<span class="punctuation">(</span>RColorBrewer<span class="operator">::</span>brewer.pal<span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span> name <span class="operator">=</span> <span class="string">&quot;Dark2&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p>(该示例在 Rmarkdown 中不起作用)。</p><h1 id="备注、提示和资源"><a href="#备注、提示和资源" class="headerlink" title="备注、提示和资源"></a>备注、提示和资源</h1><h2 id="在循环和函数中使用-ggplot2"><a href="#在循环和函数中使用-ggplot2" class="headerlink" title="在循环和函数中使用 ggplot2"></a>在循环和函数中使用 ggplot2</h2><p>lattice 和 ggplot2 中基于网格的图形函数会创建一个图形对象。在命令行下交互使用这些函数时，结果会自动打印出来，但在 <mark class="hl-label blue">source()</mark> 中或自己的函数中，则需要显式<mark class="hl-label blue">print()</mark> 语句，即我们大多数示例中的<mark class="hl-label blue">print(g)</mark> 。另请参见<a href="https://cran.r-project.org/doc/FAQ/R-FAQ.html#Why-do-lattice_002ftrellis-graphics-not-work_003f">R的问答页面</a>。</p><h2 id="其他资源"><a href="#其他资源" class="headerlink" title="其他资源"></a>其他资源</h2><ul><li><a href="https://ggplot2-book.org/">“ggplot2: Elegant Graphics for Data Analysis”</a> by Hadley Wickham, available via open-access!</li><li><a href="http://serialmentor.com/dataviz/">“Fundamentals of Data Visualization”</a> by Claus O. Wilke about data visualization in general but using - - {ggplot2}. (You can find the codes on <a href="https://github.com/clauswilke/dataviz">his GitHub profile</a>.)</li><li><a href="http://www.cookbook-r.com/Graphs/">“Cookbook for R”</a> by Winston Chang with recipes to produce R plots</li><li>Gallery of the Top <a href="http://r-statistics.co/Top50-Ggplot2-Visualizations-MasterList-R-Code.html">50 ggplot2 visualizations</a></li><li>Gallery of <a href="https://exts.ggplot2.tidyverse.org/gallery/">{ggplot2} extension packages</a></li><li><a href="https://cran.r-project.org/web/packages/ggplot2/vignettes/extending-ggplot2.html">How to extend {ggplot2}</a> by Hadley Wickham</li><li>The fantastic <a href="https://www.rfordatasci.com/">R4DS Online Learning Community</a> that offers help and mentoring for all things related to - the content of the <a href="https://www.cedricscherer.com/2019/08/05/a-ggplot2-tutorial-for-beautiful-plotting-in-r/r4ds.had.co.nz/">“R for Data Science” book</a> by Hadley Wickham</li><li><a href="https://github.com/rfordatascience/tidytuesday">#TidyTuesday</a>, a weekly social data project focusing on ggplots—check also <a href="https://twitter.com/hashtag/TidyTuesday?lang=en">#TidyTuesday</a> on Twitter and <a href="https://www.nsgrantham.com/tidytuesdayrocks">this collection of contributions by Neil Grantham</a></li><li>A two-part, 4.5-hours tutorial series by Thomas Linn Pedersen (<a href="https://www.youtube.com/watch?v=h29g21z0a68">Part 1</a> | <a href="https://www.youtube.com/watch?v=0m4yywqNPVY">Part 2</a>)</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;准备&quot;&gt;&lt;a href=&quot;#准备&quot; class=&quot;headerlink&quot; title=&quot;准备&quot;&gt;&lt;/a&gt;准备&lt;/h1&gt;&lt;details class=&quot;folding-tag&quot; green&gt;&lt;summary&gt; 所需R包 &lt;/summary&gt;
            </summary>
      
    
    
    
    <category term="生物信息学" scheme="https://smileszh.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/"/>
    
    
    <category term="R语言" scheme="https://smileszh.github.io/tags/R%E8%AF%AD%E8%A8%80/"/>
    
    <category term="R包" scheme="https://smileszh.github.io/tags/R%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>GOplot包</title>
    <link href="https://smileszh.github.io/posts/65ebd0df.html"/>
    <id>https://smileszh.github.io/posts/65ebd0df.html</id>
    <published>2023-07-03T18:00:00.000Z</published>
    <updated>2023-09-04T18:06:37.639Z</updated>
    
    <content type="html"><![CDATA[<h1 id="加载数据"><a href="#加载数据" class="headerlink" title="加载数据"></a>加载数据</h1><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Load the library. -------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>GOplot<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the dataset. --------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">data<span class="punctuation">(</span>EC<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the result from a functions analysis. -------------------------------</span></span><br><span class="line"></span><br><span class="line">head<span class="punctuation">(</span>EC<span class="operator">$</span>david<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get a list of selected genes and their logFC. ---------------------------</span></span><br><span class="line"></span><br><span class="line">head<span class="punctuation">(</span>EC<span class="operator">$</span>genelist<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate the plotting object --------------------------------------------</span></span><br><span class="line"></span><br><span class="line">circ <span class="operator">&lt;-</span> circle_dat<span class="punctuation">(</span>EC<span class="operator">$</span>david<span class="punctuation">,</span> EC<span class="operator">$</span>genelist<span class="punctuation">)</span></span><br></pre></td></tr></table></figure><h1 id="柱状图GObar"><a href="#柱状图GObar" class="headerlink" title="柱状图GObar"></a>柱状图GObar</h1><div class="tabs" id="柱状图gobar"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="柱状图gobar-1">例图</button><button type="button" class="tab " data-href="柱状图gobar-2">代码</button></ul><div class="tab-contents"><div class="tab-item-content active" id="柱状图gobar-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a309ba7ff08.png" style="width:600px;"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a30f7aba78b.png" style="width:600px;"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a30f71c861c.png" style="width:600px;"/></div></div></div><div class="tab-item-content" id="柱状图gobar-2"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Barplot -----------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate a simple barplot</span></span><br><span class="line">GOBar<span class="punctuation">(</span>subset<span class="punctuation">(</span>circ<span class="punctuation">,</span> category <span class="operator">==</span> <span class="string">&#x27;BP&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Facet the barplot according to the categories of the terms </span></span><br><span class="line">GOBar<span class="punctuation">(</span>circ<span class="punctuation">,</span> display <span class="operator">=</span> <span class="string">&#x27;multiple&#x27;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Facet the barplot, add a title and change the colour scale for the z-score</span></span><br><span class="line">GOBar<span class="punctuation">(</span>circ<span class="punctuation">,</span> display <span class="operator">=</span> <span class="string">&#x27;multiple&#x27;</span><span class="punctuation">,</span> </span><br><span class="line">      title <span class="operator">=</span> <span class="string">&#x27;Z-score coloured barplot&#x27;</span><span class="punctuation">,</span> </span><br><span class="line">      zsc.col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;yellow&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="气泡图GObubble"><a href="#气泡图GObubble" class="headerlink" title="气泡图GObubble"></a>气泡图GObubble</h1><div class="tabs" id="气泡图gobubble"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="气泡图gobubble-1">例图</button><button type="button" class="tab " data-href="气泡图gobubble-2">代码</button></ul><div class="tab-contents"><div class="tab-item-content active" id="气泡图gobubble-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a31ff468c29.png" style="width:600px;"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a310cc2c3b9.png" style="width:600px;"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a310cc2c533.png" style="width:600px;"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a310cc2c3e5.png" style="width:600px;"/></div></div></div><div class="tab-item-content" id="气泡图gobubble-2"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Bubble plot -------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate the bubble plot with a label threshold of 3</span></span><br><span class="line">GOBubble<span class="punctuation">(</span>circ<span class="punctuation">,</span> labels <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Add a title, change the colour of the circles, facet the plot according to the categories and change the label threshold</span></span><br><span class="line">GOBubble<span class="punctuation">(</span>circ<span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&#x27;Bubble plot&#x27;</span><span class="punctuation">,</span> </span><br><span class="line">         colour <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;orange&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;darkred&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;gold&#x27;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">         display <span class="operator">=</span> <span class="string">&#x27;multiple&#x27;</span><span class="punctuation">,</span> </span><br><span class="line">         labels <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># Colour the background according to the category</span></span><br><span class="line">GOBubble<span class="punctuation">(</span>circ<span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&#x27;Bubble plot with background colour&#x27;</span><span class="punctuation">,</span> </span><br><span class="line">         display <span class="operator">=</span> <span class="string">&#x27;multiple&#x27;</span><span class="punctuation">,</span></span><br><span class="line">         bg.col <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> </span><br><span class="line">         labels <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># Reduce redundant terms with a gene overlap &gt;= 0.75...</span></span><br><span class="line">reduced_circ <span class="operator">&lt;-</span> reduce_overlap<span class="punctuation">(</span>circ<span class="punctuation">,</span> overlap <span class="operator">=</span> <span class="number">0.75</span><span class="punctuation">)</span></span><br><span class="line">GOBubble<span class="punctuation">(</span>reduced_circ<span class="punctuation">,</span> labels <span class="operator">=</span> <span class="number">2.8</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="圈图GOCircle"><a href="#圈图GOCircle" class="headerlink" title="圈图GOCircle"></a>圈图GOCircle</h1><div class="tabs" id="圈图gocircle"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="圈图gocircle-1">例图</button><button type="button" class="tab " data-href="圈图gocircle-2">代码</button></ul><div class="tab-contents"><div class="tab-item-content active" id="圈图gocircle-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a313b7d6ceb.png" style="width:600px;"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a313b7d6ee3.png" style="width:600px;"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a313b7d6ceb.png" style="width:600px;"/></div></div></div><div class="tab-item-content" id="圈图gocircle-2"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GOcircle ----------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Generate a circular visualization of the results of gene- annotation enrichment analysis</span></span><br><span class="line">GOCircle<span class="punctuation">(</span>circ<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate a circular visualization of selected terms</span></span><br><span class="line">IDs <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;GO:0007507&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;GO:0001568&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;GO:0001944&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;GO:0048729&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;GO:0048514&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;GO:0005886&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;GO:0008092&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;GO:0008047&#x27;</span><span class="punctuation">)</span></span><br><span class="line">GOCircle<span class="punctuation">(</span>circ<span class="punctuation">,</span> nsub <span class="operator">=</span> IDs<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate a circular visualization for 10 terms</span></span><br><span class="line">GOCircle<span class="punctuation">(</span>circ<span class="punctuation">,</span> nsub <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="圈图GOChrod"><a href="#圈图GOChrod" class="headerlink" title="圈图GOChrod"></a>圈图GOChrod</h1><div class="tabs" id="圈图gochrod"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="圈图gochrod-1">例图</button><button type="button" class="tab " data-href="圈图gochrod-2">代码</button></ul><div class="tab-contents"><div class="tab-item-content active" id="圈图gochrod-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a316d993705.png" style="width:600px;"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a31982d8e0b.png" style="width:600px;"/></div></div></div><div class="tab-item-content" id="圈图gochrod-2"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GOChrod -----------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Dataset -----------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Define a list of genes which you think are interesting to look at. The item EC$genes of the toy </span></span><br><span class="line"><span class="comment"># sample contains the data frame of selected genes and their logFC. Have a look...</span></span><br><span class="line">head<span class="punctuation">(</span>EC<span class="operator">$</span>genes<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Since we have a lot of significantly enriched processes we selected some specific ones (EC$process)</span></span><br><span class="line">EC<span class="operator">$</span>process</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the plot chord. ------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The genes and process parameters are optional</span></span><br><span class="line">chord <span class="operator">&lt;-</span> chord_dat<span class="punctuation">(</span>data <span class="operator">=</span> circ<span class="punctuation">,</span> genes <span class="operator">=</span> EC<span class="operator">$</span>genes<span class="punctuation">,</span> process <span class="operator">=</span> EC<span class="operator">$</span>process<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">GOChord<span class="punctuation">(</span>chord<span class="punctuation">,</span> space <span class="operator">=</span> <span class="number">0.02</span><span class="punctuation">,</span> gene.order <span class="operator">=</span> <span class="string">&#x27;logFC&#x27;</span><span class="punctuation">,</span> gene.space <span class="operator">=</span> <span class="number">0.25</span><span class="punctuation">,</span> gene.size <span class="operator">=</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Display only genes which are assigned to at least three processes</span></span><br><span class="line">GOChord<span class="punctuation">(</span>chord<span class="punctuation">,</span> limit <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> gene.order <span class="operator">=</span> <span class="string">&#x27;logFC&#x27;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="热图GOHeat"><a href="#热图GOHeat" class="headerlink" title="热图GOHeat"></a>热图GOHeat</h1><div class="tabs" id="goheat"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="goheat-1">例图</button><button type="button" class="tab " data-href="goheat-2">代码</button></ul><div class="tab-contents"><div class="tab-item-content active" id="goheat-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a38be654929.png" style="width:600px;"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a38b6abbb5d.png" style="width:600px;"/></div></div></div><div class="tab-item-content" id="goheat-2"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GOHeat ------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">chord <span class="operator">&lt;-</span> chord_dat<span class="punctuation">(</span>data <span class="operator">=</span> circ<span class="punctuation">,</span> genes <span class="operator">=</span> EC<span class="operator">$</span>genes<span class="punctuation">,</span> process <span class="operator">=</span> EC<span class="operator">$</span>process<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># First, we use the chord object without logFC column to create the heatmap</span></span><br><span class="line">GOHeat<span class="punctuation">(</span>chord<span class="punctuation">[</span><span class="punctuation">,</span><span class="operator">-</span><span class="number">8</span><span class="punctuation">]</span><span class="punctuation">,</span> nlfc <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Now we create the heatmap with logFC values and user-defined colour scale</span></span><br><span class="line">GOHeat<span class="punctuation">(</span>chord<span class="punctuation">,</span> nlfc <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> fill.col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;red&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;yellow&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;green&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="聚类图GOCluster"><a href="#聚类图GOCluster" class="headerlink" title="聚类图GOCluster"></a>聚类图GOCluster</h1><div class="tabs" id="聚类图"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="聚类图-1">例图</button><button type="button" class="tab " data-href="聚类图-2">代码</button></ul><div class="tab-contents"><div class="tab-item-content active" id="聚类图-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a38d4e26e8b.png" style="width:600px;"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a38d5ac5d79.png" style="width:600px;"/></div></div></div><div class="tab-item-content" id="聚类图-2"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GOCluster ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">GOCluster<span class="punctuation">(</span>circ<span class="punctuation">,</span> EC<span class="operator">$</span>process<span class="punctuation">,</span> clust.by <span class="operator">=</span> <span class="string">&#x27;logFC&#x27;</span><span class="punctuation">,</span> term.width <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">GOCluster<span class="punctuation">(</span>circ<span class="punctuation">,</span> EC<span class="operator">$</span>process<span class="punctuation">,</span> clust.by <span class="operator">=</span> <span class="string">&#x27;term&#x27;</span><span class="punctuation">,</span> lfc.col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;darkgoldenrod1&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;black&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;cyan1&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="Venn图GOVenn"><a href="#Venn图GOVenn" class="headerlink" title="Venn图GOVenn"></a>Venn图GOVenn</h1><div class="tabs" id="venn图"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="venn图-1">例图</button><button type="button" class="tab " data-href="venn图-2">代码</button></ul><div class="tab-contents"><div class="tab-item-content active" id="venn图-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/04/64a390ef605c5.png" style="width:600px;"/></div></div></div><div class="tab-item-content" id="venn图-2"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GOVenn ------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">l1 <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>circ<span class="punctuation">,</span> term <span class="operator">==</span> <span class="string">&#x27;heart development&#x27;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>genes<span class="punctuation">,</span>logFC<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">l2 <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>circ<span class="punctuation">,</span> term <span class="operator">==</span> <span class="string">&#x27;plasma membrane&#x27;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>genes<span class="punctuation">,</span>logFC<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">l3 <span class="operator">&lt;-</span> subset<span class="punctuation">(</span>circ<span class="punctuation">,</span> term <span class="operator">==</span> <span class="string">&#x27;tissue morphogenesis&#x27;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>genes<span class="punctuation">,</span>logFC<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">GOVenn<span class="punctuation">(</span>l1<span class="punctuation">,</span>l2<span class="punctuation">,</span>l3<span class="punctuation">,</span> label <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;heart development&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;plasma membrane&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;tissue morphogenesis&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p>在线作图：<a href="https://wwalter.shinyapps.io/Venn/">VennDiagram</a></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;加载数据&quot;&gt;&lt;a href=&quot;#加载数据&quot; class=&quot;headerlink&quot; title=&quot;加载数据&quot;&gt;&lt;/a&gt;加载数据&lt;/h1&gt;&lt;figure class=&quot;highlight r&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;s</summary>
      
    
    
    
    <category term="生物信息学" scheme="https://smileszh.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/"/>
    
    
    <category term="R语言" scheme="https://smileszh.github.io/tags/R%E8%AF%AD%E8%A8%80/"/>
    
    <category term="R包" scheme="https://smileszh.github.io/tags/R%E5%8C%85/"/>
    
    <category term="基因注释" scheme="https://smileszh.github.io/tags/%E5%9F%BA%E5%9B%A0%E6%B3%A8%E9%87%8A/"/>
    
    <category term="GO/KEGG" scheme="https://smileszh.github.io/tags/GO-KEGG/"/>
    
  </entry>
  
  <entry>
    <title>基因功能富集分析</title>
    <link href="https://smileszh.github.io/posts/b3231219.html"/>
    <id>https://smileszh.github.io/posts/b3231219.html</id>
    <published>2023-07-02T03:30:00.000Z</published>
    <updated>2023-07-18T12:26:56.496Z</updated>
    
    <content type="html"><![CDATA[<h1 id="基因功能富集分析算法"><a href="#基因功能富集分析算法" class="headerlink" title="基因功能富集分析算法"></a>基因功能富集分析算法</h1><p><img src="https://bu.dusays.com/2023/06/13/64885e43e32b2.png" alt="基因富集方法.png" style="zoom: 50%;" /></p><div class="tabs" id="功能富集分析算法"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="功能富集分析算法-1">ORA:过代表分析</button><button type="button" class="tab " data-href="功能富集分析算法-2">FCS:功能分类打分</button><button type="button" class="tab " data-href="功能富集分析算法-3">PT:通路拓扑结构分析</button><button type="button" class="tab " data-href="功能富集分析算法-4">NT:网络拓扑结构分析</button></ul><div class="tab-contents"><div class="tab-item-content active" id="功能富集分析算法-1"><div class="note info modern"><p>over-representation analysis: 先计数基因列表与基因功能集共同的基因,并利用2×2列联表,进行Fisher精确检验。根据超几何分布来检验基因列表中的基因在待测功能集中是否显著富集。</p></div><p>优点：</p><ul><li>比较完备的统计学理论,输出结果比较稳健、可靠</li></ul><p>缺点：</p><ul><li>它仅仅使用了基因的数目信息，而没有利用基因表达水平或表达差异值</li><li>通常仅使用最显著的基因序列，而忽略差异不显著的基因, 导致检测灵敏性的降低</li><li>将每一个基因进行同等对待，它忽视了基因在通路内部生物学意义的不同，以及基因间复杂的相互作用</li><li>假设通路与通路间是独立的，但这个前提假设是不太准确的</li></ul><details class="folding-tag" green><summary> GO/KEGG统计学方法详解 </summary>              <div class='content'>              <p><strong>目前有很多工具和数据库提供ORA的使用，常见的就是GO富集分析和KEGG富集分析。我们通常通过处理二代测序和芯片测序得到的数据，进而设置一定对阈值，如差异倍数或P值，得到的一组我们感兴趣的基因，进而导入这个基因的ID，对这些基因进行注释。</strong></p><ul><li><p>GO富集分析将导入的每一个基因分别对应的CC、BP、MM进行罗列，使用超几何分布来确定这些对应的通路是否是显著性富集：</p><script type="math/tex; mode=display">P = 1-\sum_{i=0}^{k-1}\frac{C^i_MC^{n-i}_{N-M}}{C^n_N}</script><p>N: GO注释数据库中的总基因数<br>M：数据库中属于某个GO子类的基因数<br>n: 进行GO富集分析的基因总数目<br>k: n中属于M的数目</p></li><li><p>KEGG富集分析结果结果体现在由于处理导致个体或组基因表达发生较大改变，导致<strong>通路</strong>有较大改变。原理和上面类似。</p></li></ul>              </div>            </details></div><div class="tab-item-content" id="功能富集分析算法-2"><div class="note info modern"><p>functional class scoring: 以GSEA为例, 对基因表达谱中的所有基因按照与表型的差异表达程度排序,再利用KS检验对待测功能基因集打分,利用随机重排得到背景分布,找出显著富集的功能基因集。</p></div><p>优点：</p><ul><li>考虑到了基因表达值的属性信息问题</li><li>以待测基因功能集为对象来进行检验，使得检测结果更加灵敏及更有针对性</li></ul><p>缺点：</p><ul><li>独立分析每一条通路，但同一个基因可能涉及多条通路，不同通路间的基因出现重叠，所以可能会导致别的通路由于重叠基因问题，也出现显著富集现象。</li><li>仍把待测基因功能集中的每个基因作为独立的个体, 忽略了基因的生物学属性和基因间的复杂相互作用关系。 </li></ul><details class="folding-tag" green><summary> GSEA统计学方法详解 </summary>              <div class='content'>              <p><strong>GSEA是常用的一种FCS方法. 其基本思路是首先基于表达差异值对全基因组基因进行排序得到基因列表, 然后检验待测基因功能集中的基因相对于随机情况而言, 是否显著地位于基因列表的顶端或底端, 即待测基因集的表达水平在案例和对照实验状态下是否发生了明显的变化.具体而言, GSEA 首先计算了每个基因的表达水平与案例和对照两种状态下的关联系数,并对关联系数从高到低进行了排序; 然后, 针对一特定的待测基因功能集, 根据其中每个基因的排序情况,利用加权的近似KS检验, 获得待测基因功能集在排序列表中的KS检验值————也即待测基因功能集的统计值; 为检验观察统计值的显著性, GSEA 通过对样本的随机排列来获得统计值的背景分布, 并利用该分布来评估观察统计值的P值.除对样本的随机排列外, 在样本量较少的情况下, GSEA也可用对基因的随机排列来估算待测基因功能集的显著水平。</strong></p><p><img src="https://bu.dusays.com/2023/07/03/64a1a7846284f.png" alt="GSEA.png"></p>              </div>            </details></div><div class="tab-item-content" id="功能富集分析算法-3"><div class="note info modern"><p>pathway topology: 以Pathway-Express为例,根据上下游关系对通路进行打分,上游通路影响因子较大,对待测基因功能集根据影响因子进行打分,然后根据统计检验模型计算显著程度。</p></div><p>优点：</p><ul><li>基于PT的基因功能富集算法对研究一些比较完善、拓扑结构完整的通路会有更强的显著性。</li></ul><p>缺点：</p><ul><li>研究较少，信息不完善的通路稳健型较差</li></ul></div><div class="tab-item-content" id="功能富集分析算法-4"><div class="note info modern"><p>network topology: 以NEA为例,将基因列表或基因表达谱和待测基因功能集放入生物网络中,计算感兴趣的基因与待测基因功能集在网络之间的最短距离,通过对网络重调得到背景分布,找出显著富集的基因功能集。</p></div><p>优点：</p><ul><li>加入了系统层面的基因重要性程度及关联信息等属性数据，使得预测结果更加准确可靠</li></ul><p>缺点：</p><ul><li>更多信息的加入也容易导致算法过于复杂，计算速度较慢，实现难度也就更大。</li></ul></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="富集分析在线工具"><a href="#富集分析在线工具" class="headerlink" title="富集分析在线工具"></a>富集分析在线工具</h1><div class="tabs" id="富集分析在线工具"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="富集分析在线工具-1">KOBAS</button><button type="button" class="tab " data-href="富集分析在线工具-2">WebGestalt</button><button type="button" class="tab " data-href="富集分析在线工具-3">Enrichr</button><button type="button" class="tab " data-href="富集分析在线工具-4">TAM2.0</button><button type="button" class="tab " data-href="富集分析在线工具-5">SCPortalen</button></ul><div class="tab-contents"><div class="tab-item-content active" id="富集分析在线工具-1"><p><a href="http://kobas.cbi.pku.edu.cn/">KOBAS</a></p><ul><li>基因/蛋白功能注释（注释模块）和功能基因集富集（富集模块）的在线工具</li><li>注释模块：输入基因列表，从通路、疾病、基因本体论等多个数据库中提取基因功能注释信息</li><li>富集模块：输入基因列表或基因表达数据，根据多种方法生成富集的基因集、对应的名称、P值或富集概率和富集分数 </li><li>支持microarray和RNA-Seq数据的分析</li></ul></div><div class="tab-item-content" id="富集分析在线工具-2"><p><a href="https://www.webgestalt.org/">WebGestalt</a> </p><ul><li>功能富集分析在线工具</li><li>支持三种富集分析方法：ORA、GSEA、NTA</li></ul></div><div class="tab-item-content" id="富集分析在线工具-3"><p><a href="https://maayanlab.cloud/Enrichr/">Enrichr</a></p><ul><li>综合性基因富集分析在线工具</li><li>支持BED格式和基因列表的输入</li><li>富集分析的数据库包括Transcription（转录）, Pathways（通路）, Ontologies（GO）, Diseases/Drugs（疾病/药物）, Cell types（细胞类型）, Misc（未分类数据集）, Legacy, Crowd</li></ul></div><div class="tab-item-content" id="富集分析在线工具-4"><p><a href="http://www.lirmed.com/tam2/">TAM2.0</a></p><ul><li>miRNA富集网站</li><li>将miRNA分为六大类：miRNA-family sets（miRNA家族），miRNA cluster sets（miRNA聚类），miRNA-disease（miRNA疾病），miRNA-function sets（miRNA功能），miRNA-TF sets（miRNA与转录因子），tissue specificity sets（组织特异性）。</li><li>“Analysis”：对一个miRNA列表，以数据库miRNA集为背景进行富集分析</li><li>“Comparison”：对一组上调和下调的miRNA列表，评估上下调的miRNA与疾病发生或抑制的关系</li><li>“Query”：通过关键词查询相关的miRNA集</li></ul></div><div class="tab-item-content" id="富集分析在线工具-5"><p><a href="http://single-cell.riken.jp/SCPortalen_Database/Home/">SCPortalen</a></p><ul><li>单细胞分析在线工具</li></ul></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="GO-KEGG富集分析"><a href="#GO-KEGG富集分析" class="headerlink" title="GO/KEGG富集分析"></a>GO/KEGG富集分析</h1><div class="tabs" id="go/kegg富集分析"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="go/kegg富集分析-1">GO简介</button><button type="button" class="tab " data-href="go/kegg富集分析-2">单基因GO/KEGG富集分析在线工具</button><button type="button" class="tab " data-href="go/kegg富集分析-3">多基因GO/KEGG富集分析在线工具</button></ul><div class="tab-contents"><div class="tab-item-content active" id="go/kegg富集分析-1"><p><a href="http://geneontology.org/">GO</a></p><blockquote><p>Gene Ontology: GO的初衷就是希望提供一个能对基因和基因产物特性相关的术语或词义 进行描绘及解释的工作平台，从而使生物信息学研究者对基因和基因产物的数据能够进行统一的归纳、处理、解释和共享，便于我们理解和沟通。 基因本体涉及的基因和基因产物词汇分为三大类，涵盖生物学的三个方面。</p></blockquote><p><strong>GO term 分类</strong></p><ul><li><p><strong>细胞组分</strong>（cellular component）：细胞的每个部分和细胞外环境。<mark class="hl-label green">在哪里发挥作用：往往用于描述基因在细胞上的定位信息，当研究者关注一些特殊的亚细胞定位研究的时候具有重要的意义。</mark> </p></li><li><p><strong>分子功能</strong>（molecular function）：可以描述为分子水平的活性（activity），如催化（catalytic）或结合（binding）活性等。<mark class="hl-label green">做什么工作：用于描述蛋白的实际作用方式，当研究者更关注整个生物学事件中蛋白作用方式上的变化时，可以考虑从这个角度切入。</mark> </p></li><li><p><strong>生物过程</strong>（biological process）：是指由一个或多个分子功能有序组合而产生的系列事件，一般一个过程是由多个不同的步骤组成。<mark class="hl-label green">目的是什么：更贴近表型，往往可以很好地描述样本的实际情况。</mark> </p></li></ul></div><div class="tab-item-content" id="go/kegg富集分析-2"><details class="folding-tag" cyan><summary> 通路数据库 KEGG </summary>              <div class='content'>              <p>1 进入<a href="https://www.genome.jp/kegg/">官网</a>，选择GENES数据库</p><p><img src="https://bu.dusays.com/2023/06/13/64887f9303e67.png" alt="单基因1.png"  /></p><p>2 输入查询单个基因信息</p><p><img src="https://bu.dusays.com/2023/06/13/648880cd8c041.png" alt="单基因2——tets.png"  /></p><p>3 查看输出结果</p><p><img src="https://bu.dusays.com/2023/06/20/6491b9e2a8e95.png" alt="Screenshot 2023-06-20 at 22.38.04.png"></p><p>4 可选择涉及通路具体查看</p><p><img src="https://bu.dusays.com/2023/06/13/64887f9307fcd.png" alt="单基因4.png" style="zoom:50%;" /></p><p>5 可返回主页搜索基因名查看多物种基因富集信息</p><p><img src="https://bu.dusays.com/2023/06/13/64887f930f999.png" alt="单基因5.png"  /></p><p><img src="https://bu.dusays.com/2023/06/13/64887f9303eeb.png" alt="单基因6.png"  /></p>              </div>            </details><details class="folding-tag" cyan><summary> 通路数据库 Reactome </summary>              <div class='content'>              <ul><li>通路知识的可视化、解释和分析提供直观的生物信息学工具。</li><li>Reactome是reaction（反应）+ ome（组）的合成词，反应可以被视为途径的“步骤”。Reactome将“反应”定义为生物学中任何改变生物分子状态的事件， 涉及催化剂的结合、活化、易位、降解和经典生物化学事件。因此，Reactome数据模型的核心单元是反应（reaction），参与反应的实体（核酸、蛋白质、复合物剂和小分子）形成生物相互作用的网络并被分组成通路。</li></ul><p>1 进入<a href="https://reactome.org/">官网</a>，选择Pathway Browser</p><p><img src="https://bu.dusays.com/2023/06/18/648de316e5c13.png" alt="react_4.png"></p><p>2 输入相关信息查看结果</p><p><img src="https://bu.dusays.com/2023/06/18/648de316e5bca.png" alt="react_5.png"></p><p>3 也可进入Analysis Tools进行多个基因通路查看</p><p><img src="https://bu.dusays.com/2023/06/18/648de316e5cad.png" alt="reacctome_1.png"></p><p><img src="https://bu.dusays.com/2023/06/18/648de316e654f.png" alt="reactome_2.png"></p><p><img src="https://bu.dusays.com/2023/06/18/648de316e9490.png" alt="reactome_3.png"></p>              </div>            </details><details class="folding-tag" cyan><summary> GeneCards </summary>              <div class='content'>              <p><a href="https://www.genecards.org/">GeneCards</a></p><ul><li>人类基因数据库</li></ul><p><img src="https://bu.dusays.com/2023/06/18/648de5698bf4d.png" alt="Screenshot 2023-06-18 at 00.52.36.png"><br><img src="https://bu.dusays.com/2023/06/18/648de5698bf4d.png" alt="Screenshot 2023-06-18 at 00.53.16.png"></p>              </div>            </details><details class="folding-tag" cyan><summary> Uniprot </summary>              <div class='content'>              <p><a href="https://www.uniprot.org/">Uniprot</a></p><p>1 输入基因</p><p><img src="https://bu.dusays.com/2023/06/18/648de75d8f607.png" alt="Screenshot 2023-06-18 at 00.57.30.png"></p><p>2 选择需要的结果</p><p><img src="https://bu.dusays.com/2023/06/18/648de75d330d0.png" alt="Screenshot 2023-06-18 at 00.57.45.png"></p><p>3 详细查看需要的信息</p><p><img src="https://bu.dusays.com/2023/06/18/648de75d330d0.png" alt="Screenshot 2023-06-18 at 01.01.44.png"></p>              </div>            </details></div><div class="tab-item-content" id="go/kegg富集分析-3"><details class="folding-tag" cyan><summary> DAVID </summary>              <div class='content'>              <p><a href="https://david.ncifcrf.gov/">DAVID</a>数据库</p><ul><li>主要用于差异基因的功能和通路富集分析</li></ul><p>1 打开官网，选择Functional Annotation</p><p><img src="https://bu.dusays.com/2023/06/18/648df0cbddbc9.png" alt="Screenshot 2023-06-18 at 01.23.01.png"  /></p><p>2 输入需要分析的基因集</p><p><img src="https://bu.dusays.com/2023/06/18/648df0cbbc11c.png" alt="Screenshot 2023-06-18 at 01.19.19.png"  /></p><p>3 选择物种</p><p><img src="https://bu.dusays.com/2023/06/18/648df0cbb80e7.png" alt="Screenshot 2023-06-18 at 01.19.57.png"  /></p><p>4 选择背景基因集</p><p><img src="https://bu.dusays.com/2023/06/18/648df0cbb82c3.png" alt="Screenshot 2023-06-18 at 01.20.37.png"  /></p><p>5 查看结果信息</p><p><img src="https://bu.dusays.com/2023/06/18/648df0cbb80e7.png" alt="Screenshot 2023-06-18 at 01.21.32.png"  /></p>              </div>            </details><details class="folding-tag" cyan><summary> Metascape </summary>              <div class='content'>              <p><a href="https://metascape.org/gp/#/main/step1">Metascape</a>数据库</p><p>1 输入基因集</p><p><img src="https://bu.dusays.com/2023/06/20/6491bc5b88978.png" alt="Screenshot 2023-06-20 at 22.43.07.png"></p><p>2 选择物种信息</p><p><img src="https://bu.dusays.com/2023/06/20/6491bc5b85776.png" alt="Screenshot 2023-06-20 at 22.43.51.png"></p><p>3 查看分析结果</p><p><img src="https://bu.dusays.com/2023/06/20/6491bc5b7e12d.png" alt="Screenshot 2023-06-20 at 22.45.32.png"></p>              </div>            </details></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><details class="folding-tag" ><summary> 参考资料 </summary>              <div class='content'>              <p><strong>文献</strong><br><a href="https://kns.cnki.net/kcms2/article/abstract?v=3uoqIhG8C44YLTlOAiTRKibYlV5Vjs7ijP0rjQD-AVm8oHBO0FTadqb8FqjcBpcDcidf-ZdGEi_ZrsFmD6Gl7-0hyOUbZkl8&amp;uniplatform=NZKPT">王潇,尹天舒,李柏逸等.基因功能富集分析的研究进展[J].中国科学:生命科学,2016,46(04):363-373.</a></p><p><strong>资料</strong><br><a href="https://space.bilibili.com/254040065?spm_id_from=333.337.0.0">解螺旋</a><br><a href="https://www.bilibili.com/video/BV1MN4y1V7Gv/?spm_id_from=333.880.my_history.page.click&amp;vd_source=2fc0eac1995e2bcd209e8b17b7174cd8">方超学长</a></p><p><strong>数据</strong><br><a href="https://yun.console.xlj0.com/s/yDbsk">模拟数据</a></p>              </div>            </details>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;基因功能富集分析算法&quot;&gt;&lt;a href=&quot;#基因功能富集分析算法&quot; class=&quot;headerlink&quot; title=&quot;基因功能富集分析算法&quot;&gt;&lt;/a&gt;基因功能富集分析算法&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;https://bu.dusays.com/2023/0</summary>
      
    
    
    
    <category term="生物信息学" scheme="https://smileszh.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/"/>
    
    
    <category term="R语言" scheme="https://smileszh.github.io/tags/R%E8%AF%AD%E8%A8%80/"/>
    
    <category term="数据库" scheme="https://smileszh.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="富集分析" scheme="https://smileszh.github.io/tags/%E5%AF%8C%E9%9B%86%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>R语言绘图</title>
    <link href="https://smileszh.github.io/posts/839f439e.html"/>
    <id>https://smileszh.github.io/posts/839f439e.html</id>
    <published>2023-06-30T18:00:00.000Z</published>
    <updated>2023-12-08T12:46:53.311Z</updated>
    
    <content type="html"><![CDATA[<h1 id="热图"><a href="#热图" class="headerlink" title="热图"></a>热图</h1><h2 id="差异基因热图绘制"><a href="#差异基因热图绘制" class="headerlink" title="差异基因热图绘制"></a>差异基因热图绘制</h2><div class="tabs" id="差异基因热图"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="差异基因热图-1">结果展示</button><button type="button" class="tab " data-href="差异基因热图-2">所需数据</button><button type="button" class="tab " data-href="差异基因热图-3">代码</button><button type="button" class="tab " data-href="差异基因热图-4">备注</button></ul><div class="tab-contents"><div class="tab-item-content active" id="差异基因热图-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/01/649f167cd0737.png" style="width:300px;"/></div></div></div><div class="tab-item-content" id="差异基因热图-2"><p><a href="https://tooc.web.xlj0.com/uploads/R%E8%AF%AD%E8%A8%80%E7%BB%98%E5%9B%BE/results.csv">DESeq2或edgeR差异表达分析后数据</a></p></div><div class="tab-item-content" id="差异基因热图-3"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Create heat map from a differential expression count table.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Load the library.</span></span><br><span class="line">suppressPackageStartupMessages<span class="punctuation">(</span>library<span class="punctuation">(</span>gplots<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the file that contains the counts.</span></span><br><span class="line">count_file <span class="operator">=</span> <span class="string">&quot;results.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the output file.</span></span><br><span class="line">output_file <span class="operator">=</span> <span class="string">&quot;heatmap.pdf&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Inform the user.</span></span><br><span class="line">print<span class="punctuation">(</span><span class="string">&quot;# Tool: Create Heatmap &quot;</span><span class="punctuation">)</span></span><br><span class="line">print<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;# Input: &quot;</span><span class="punctuation">,</span> count_file<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">print<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;# Output: &quot;</span><span class="punctuation">,</span> output_file<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># FDR cutoff.</span></span><br><span class="line">MIN_FDR <span class="operator">=</span> <span class="number">0.05</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Plot width</span></span><br><span class="line">WIDTH <span class="operator">=</span> <span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Plot height.</span></span><br><span class="line">HEIGHT <span class="operator">=</span> <span class="number">13</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the margins</span></span><br><span class="line">MARGINS <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">9</span><span class="punctuation">,</span> <span class="number">12</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Relative heights of the rows in the plot.</span></span><br><span class="line">LHEI <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Read normalized counts from the standard input.</span></span><br><span class="line">data <span class="operator">=</span> read.csv<span class="punctuation">(</span>count_file<span class="punctuation">,</span> header<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">,</span> as.is<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Subset data for values under a treshold.</span></span><br><span class="line">data <span class="operator">=</span> subset<span class="punctuation">(</span>data<span class="punctuation">,</span> data<span class="operator">$</span>FDR <span class="operator">&lt;=</span> MIN_FDR<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The heatmap row names will be taken from the first column.</span></span><br><span class="line">row_names <span class="operator">=</span> data<span class="punctuation">[</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The code assumes that the normalized data matrix is listed to the right of the falsePos column.</span></span><br><span class="line">idx <span class="operator">=</span> which<span class="punctuation">(</span>colnames<span class="punctuation">(</span>data<span class="punctuation">)</span> <span class="operator">==</span> <span class="string">&quot;falsePos&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The normalized counts are on the right size.</span></span><br><span class="line">counts <span class="operator">=</span> data<span class="punctuation">[</span><span class="punctuation">,</span> idx <span class="operator">:</span> ncol<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the data from the second column on.</span></span><br><span class="line">values <span class="operator">=</span> as.matrix<span class="punctuation">(</span>counts<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Adds a little noise to each element to avoid the</span></span><br><span class="line"><span class="comment"># clustering function failure on zero variance rows.</span></span><br><span class="line">values <span class="operator">=</span> jitter<span class="punctuation">(</span>values<span class="punctuation">,</span> factor <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> amount <span class="operator">=</span> <span class="number">0.00001</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Normalize each row to a z-score</span></span><br><span class="line">zscores <span class="operator">=</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span> <span class="operator">:</span> nrow<span class="punctuation">(</span>values<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  row <span class="operator">=</span> values<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="punctuation">]</span></span><br><span class="line">  zrow <span class="operator">=</span> <span class="punctuation">(</span>row <span class="operator">-</span> mean<span class="punctuation">(</span>row<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">/</span> sd<span class="punctuation">(</span>row<span class="punctuation">)</span></span><br><span class="line">  zscores <span class="operator">=</span> rbind<span class="punctuation">(</span>zscores<span class="punctuation">,</span> zrow<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the row names on the zscores.</span></span><br><span class="line">row.names<span class="punctuation">(</span>zscores<span class="punctuation">)</span> <span class="operator">=</span> row_names</span><br><span class="line"></span><br><span class="line"><span class="comment"># Turn the data into a matrix for heatmap2.</span></span><br><span class="line">zscores <span class="operator">=</span> as.matrix<span class="punctuation">(</span>zscores<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the color palette.</span></span><br><span class="line">col <span class="operator">=</span> greenred</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a PDF device</span></span><br><span class="line">pdf<span class="punctuation">(</span>output_file<span class="punctuation">,</span> width <span class="operator">=</span> WIDTH<span class="punctuation">,</span> height <span class="operator">=</span> HEIGHT<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">heatmap.2<span class="punctuation">(</span>zscores<span class="punctuation">,</span> col<span class="operator">=</span>col<span class="punctuation">,</span> density.info<span class="operator">=</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span> Colv<span class="operator">=</span><span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    dendrogram<span class="operator">=</span><span class="string">&quot;row&quot;</span><span class="punctuation">,</span> trace<span class="operator">=</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span> margins<span class="operator">=</span>MARGINS<span class="punctuation">,</span> lhei<span class="operator">=</span>LHEI<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="差异基因热图-4"><ul><li>设置差异基因筛选条件为FDR &lt; 0.05, 还可以根据需要设置差异倍数，筛选出需要画图的基因</li><li>代码默认归一化的矩阵在”falsePos”列的右侧，如果不一致，需另行调整代码</li></ul></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="火山图"><a href="#火山图" class="headerlink" title="火山图"></a>火山图</h1><div class="tabs" id="火山图"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="火山图-1">结果展示</button><button type="button" class="tab " data-href="火山图-2">所需数据</button><button type="button" class="tab " data-href="火山图-3">代码</button></ul><div class="tab-contents"><div class="tab-item-content active" id="火山图-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/24/650fac2561f55.png" style="width:300px;"/></div></div></div><div class="tab-item-content" id="火山图-2"><p><a href="https://tooc.web.xlj0.com/uploads/R%E8%AF%AD%E8%A8%80%E7%BB%98%E5%9B%BE/%E7%81%AB%E5%B1%B1%E5%9B%BE.csv">火山图数据</a></p></div><div class="tab-item-content" id="火山图-3"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># Loading library</span></span><br><span class="line">library<span class="punctuation">(</span>tidyverse<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>readxl<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Import data</span></span><br><span class="line">data <span class="operator">&lt;-</span> read_xlsx<span class="punctuation">(</span><span class="string">&quot;全部数据.xlsx&quot;</span><span class="punctuation">)</span></span><br><span class="line">summary<span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line">str<span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pretreat data</span></span><br><span class="line">data<span class="operator">$</span>Status<span class="punctuation">[</span>data<span class="operator">$</span>LOG2FC <span class="operator">&gt;</span> <span class="number">1.2</span> <span class="operator">&amp;</span> data<span class="operator">$</span>P.value<span class="operator">&lt;</span><span class="number">0.05</span> <span class="operator">&amp;</span> data<span class="operator">$</span>OPLSDA.VIP <span class="operator">&gt;</span> <span class="number">1</span> <span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&quot;Up-regulated&quot;</span></span><br><span class="line">data<span class="operator">$</span>Status<span class="punctuation">[</span>data<span class="operator">$</span>LOG2FC <span class="operator">&lt;</span> <span class="operator">-</span><span class="number">1.2</span> <span class="operator">&amp;</span> data<span class="operator">$</span>P.value<span class="operator">&lt;</span><span class="number">0.05</span> <span class="operator">&amp;</span> data<span class="operator">$</span>OPLSDA.VIP <span class="operator">&gt;</span> <span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&quot;Down-regulated&quot;</span></span><br><span class="line">data<span class="operator">$</span>Status<span class="punctuation">[</span><span class="built_in">is.na</span><span class="punctuation">(</span>data<span class="operator">$</span>Status<span class="punctuation">)</span><span class="punctuation">]</span>  <span class="operator">&lt;-</span> <span class="string">&quot;Insignificant Change&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Plot volcano chart</span></span><br><span class="line">ggplot<span class="punctuation">(</span>data <span class="operator">=</span> data<span class="punctuation">,</span> aes<span class="punctuation">(</span>LOG2FC<span class="punctuation">,</span><span class="operator">-</span>log10<span class="punctuation">(</span>P.value<span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> Status<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_hline<span class="punctuation">(</span>yintercept <span class="operator">=</span> <span class="operator">-</span>log10<span class="punctuation">(</span><span class="number">0.05</span><span class="punctuation">)</span><span class="punctuation">,</span>linetype <span class="operator">=</span> <span class="string">&quot;dashed&quot;</span><span class="punctuation">,</span>color <span class="operator">=</span><span class="string">&quot;#999999&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_vline<span class="punctuation">(</span>xintercept <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span>linetype <span class="operator">=</span> <span class="string">&quot;dashed&quot;</span><span class="punctuation">,</span>color <span class="operator">=</span><span class="string">&quot;#999999&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>aes<span class="punctuation">(</span>size<span class="operator">=</span> OPLSDA.VIP<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  scale_size<span class="punctuation">(</span><span class="built_in">range</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_manual<span class="punctuation">(</span>values <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;dodgerblue&quot;</span><span class="punctuation">,</span><span class="string">&quot;gray&quot;</span><span class="punctuation">,</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="韦恩图"><a href="#韦恩图" class="headerlink" title="韦恩图"></a>韦恩图</h1><div class="tabs" id="韦恩图"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="韦恩图-1">结果展示</button><button type="button" class="tab " data-href="韦恩图-2">所需数据</button><button type="button" class="tab " data-href="韦恩图-3">代码</button></ul><div class="tab-contents"><div class="tab-item-content active" id="韦恩图-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/10/28/653d1ebd2e8a0.jpg" style="width:300px;"/></div></div></div><div class="tab-item-content" id="韦恩图-2"><p><a href="https://tooc.web.xlj0.com/uploads/R%E8%AF%AD%E8%A8%80%E7%BB%98%E5%9B%BE/NaB_T1VSNaB_C1_down.targetList.xls">韦恩图数据1</a></p><p><a href="https://tooc.web.xlj0.com/uploads/R%E8%AF%AD%E8%A8%80%E7%BB%98%E5%9B%BE/NaB_T1VSNaB_C1_up.targetList.xls">韦恩图数据2</a></p></div><div class="tab-item-content" id="韦恩图-3"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>tidyverse<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>VennDiagram<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">k9_up <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;NaB_T1VSNaB_C1_up.targetList.xls&quot;</span><span class="punctuation">)</span></span><br><span class="line">k9_down <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;NaB_T1VSNaB_C1_down.targetList.xls&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">H3K9ac_up <span class="operator">&lt;-</span> unique<span class="punctuation">(</span>k9_up<span class="punctuation">)</span></span><br><span class="line">H3K9ac_down <span class="operator">&lt;-</span> unique<span class="punctuation">(</span>k9_down<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>H3K9ac_up<span class="operator">$</span>V1<span class="punctuation">,</span> H3K9ac_down<span class="operator">$</span>V1<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">venn.diagram<span class="punctuation">(</span>data<span class="punctuation">,</span> fill <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#FFB5BF&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#97C8E0&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">             alpha <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> label.col <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">             cex <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span> cat.col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#FFB5BF&quot;</span><span class="punctuation">,</span> <span class="string">&quot;#97C8E0&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">             cat.cex <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> cat.fontface <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">,</span></span><br><span class="line">             label.cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">,</span></span><br><span class="line">             filename <span class="operator">=</span> <span class="string">&quot;~/Desktop/H3K9ac_ven.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">             category <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;UP&quot;</span><span class="punctuation">,</span> <span class="string">&quot;DOWN&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="九象限图"><a href="#九象限图" class="headerlink" title="九象限图"></a>九象限图</h1><div class="tabs" id="九象限图"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="九象限图-1">结果展示</button><button type="button" class="tab " data-href="九象限图-2">所需数据</button><button type="button" class="tab " data-href="九象限图-3">代码</button></ul><div class="tab-contents"><div class="tab-item-content active" id="九象限图-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/11/10/654de63140f21.png" style="width:300px;"/></div></div></div><div class="tab-item-content" id="九象限图-2"><p><a href="https://tooc.web.xlj0.com/uploads/R%E8%AF%AD%E8%A8%80%E7%BB%98%E5%9B%BE/common.csv">九象限图</a></p></div><div class="tab-item-content" id="九象限图-3"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># load package ------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>tidyverse<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># loda data ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">com <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&quot;common.csv&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># clean data --------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">com<span class="operator">$</span>DEG <span class="operator">&lt;-</span> ifelse<span class="punctuation">(</span>com<span class="operator">$</span>RNA_log2FC <span class="operator">&gt;</span> <span class="number">1</span> <span class="operator">&amp;</span> com<span class="operator">$</span>H3K9ac_log2FC <span class="operator">&gt;</span> <span class="number">1</span><span class="punctuation">,</span> <span class="string">&quot;UP-UP&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  ifelse<span class="punctuation">(</span>com<span class="operator">$</span>RNA_log2FC <span class="operator">&lt;</span> <span class="operator">-</span><span class="number">1</span> <span class="operator">&amp;</span> com<span class="operator">$</span>H3K9ac_log2FC <span class="operator">&lt;</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span> <span class="string">&quot;DOWN-DOWN&quot;</span><span class="punctuation">,</span></span><br><span class="line">                         ifelse<span class="punctuation">(</span>com<span class="operator">$</span>RNA_log2FC <span class="operator">&gt;</span> <span class="number">1</span> <span class="operator">&amp;</span> com<span class="operator">$</span>H3K9ac_log2FC <span class="operator">&lt;</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span> <span class="string">&quot;UP-DOWN&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                ifelse<span class="punctuation">(</span>com<span class="operator">$</span>RNA_log2FC <span class="operator">&lt;</span> <span class="operator">-</span><span class="number">1</span> <span class="operator">&amp;</span> com<span class="operator">$</span>H3K9ac_log2FC <span class="operator">&gt;</span> <span class="number">1</span><span class="punctuation">,</span> <span class="string">&quot;DOWN-UP&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                       <span class="string">&quot;NONE&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># plot image --------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">ggplot<span class="punctuation">(</span>com<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> RNA_log2FC<span class="punctuation">,</span> y<span class="operator">=</span>H3K9ac_log2FC<span class="punctuation">,</span> colour<span class="operator">=</span>DEG<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_point<span class="punctuation">(</span>alpha<span class="operator">=</span><span class="number">0.85</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_vline<span class="punctuation">(</span>xintercept<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span>lty<span class="operator">=</span><span class="number">4</span><span class="punctuation">,</span>col<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span>lwd<span class="operator">=</span><span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_hline<span class="punctuation">(</span>yintercept<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span>lty<span class="operator">=</span><span class="number">4</span><span class="punctuation">,</span>col<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span>lwd<span class="operator">=</span><span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  scale_color_manual<span class="punctuation">(</span>values<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;steelblue&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;#03BF7D&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;gray&#x27;</span><span class="punctuation">,</span>  <span class="string">&#x27;#AEAF31&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;brown&#x27;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme_bw<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">  guides<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  theme<span class="punctuation">(</span>plot.margin <span class="operator">=</span> unit<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  labs<span class="punctuation">(</span>x<span class="operator">=</span><span class="string">&quot;RNA-Seq_log2FC&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ggsave<span class="punctuation">(</span><span class="string">&quot;H3K9ac_com.pdf&quot;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span> units <span class="operator">=</span> <span class="string">&quot;cm&quot;</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="散点图-箱线图-小提琴图-t检验-循环"><a href="#散点图-箱线图-小提琴图-t检验-循环" class="headerlink" title="散点图+箱线图+小提琴图+t检验+循环"></a>散点图+箱线图+小提琴图+t检验+循环</h1><div class="tabs" id="混合图"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="混合图-1">结果展示</button><button type="button" class="tab " data-href="混合图-2">所需数据</button><button type="button" class="tab " data-href="混合图-3">代码</button></ul><div class="tab-contents"><div class="tab-item-content active" id="混合图-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/12/08/65730d0031ff1.png" style="width:300px;"/></div></div></div><div class="tab-item-content" id="混合图-2"><p><a href="https://tooc.web.xlj0.com/uploads/R%E8%AF%AD%E8%A8%80%E7%BB%98%E5%9B%BE/qrt-pcr.xlsx">混合图</a></p></div><div class="tab-item-content" id="混合图-3"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>readxl<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>tidyverse<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggpubr<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>gridExtra<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pcr <span class="operator">&lt;-</span> read_xlsx<span class="punctuation">(</span><span class="string">&quot;qrt-pcr.xlsx&quot;</span><span class="punctuation">)</span></span><br><span class="line">pcr<span class="operator">$</span>Group <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>pcr<span class="operator">$</span>Group<span class="punctuation">,</span> levels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;control&quot;</span><span class="punctuation">,</span> <span class="string">&quot;butyrate&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">pcr<span class="operator">$</span>Gene <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>pcr<span class="operator">$</span>Gene<span class="punctuation">,</span> levels <span class="operator">=</span> paste0<span class="punctuation">(</span><span class="string">&quot;HDAC&quot;</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="number">11</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">HDAC <span class="operator">&lt;-</span> paste0<span class="punctuation">(</span><span class="string">&quot;HDAC&quot;</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="number">11</span><span class="punctuation">)</span></span><br><span class="line">plots <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> HDAC<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  plots<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>pcr<span class="punctuation">[</span>pcr<span class="operator">$</span>Gene <span class="operator">==</span> i<span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> Group<span class="punctuation">,</span> y <span class="operator">=</span> Expression<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_point<span class="punctuation">(</span>color<span class="operator">=</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">               size<span class="operator">=</span><span class="number">5</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">    geom_violin<span class="punctuation">(</span>aes<span class="punctuation">(</span>fill <span class="operator">=</span> Group<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                color <span class="operator">=</span> <span class="string">&quot;gray&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.4</span><span class="punctuation">,</span></span><br><span class="line">                scale <span class="operator">=</span> <span class="string">&quot;width&quot;</span><span class="punctuation">,</span></span><br><span class="line">                linewidth <span class="operator">=</span> <span class="number">0.6</span><span class="punctuation">,</span></span><br><span class="line">                trim <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">    geom_boxplot<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> </span><br><span class="line">                 outlier.color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">                 width <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">,</span></span><br><span class="line">                 size <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">,</span></span><br><span class="line">                 fill <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    geom_signif<span class="punctuation">(</span>comparisons <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;control&quot;</span><span class="punctuation">,</span> <span class="string">&quot;butyrate&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                y_position <span class="operator">=</span> <span class="built_in">max</span><span class="punctuation">(</span>pcr<span class="punctuation">[</span>pcr<span class="operator">$</span>Gene <span class="operator">==</span> i<span class="punctuation">,</span> <span class="punctuation">]</span><span class="operator">$</span>Expression<span class="operator">+</span><span class="number">0.1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                map_signif_level <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span></span><br><span class="line">                test <span class="operator">=</span> <span class="string">&quot;t.test&quot;</span><span class="punctuation">,</span></span><br><span class="line">                textsize <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    guides<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">    theme_bw<span class="punctuation">(</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">    labs<span class="punctuation">(</span>x <span class="operator">=</span> i<span class="punctuation">,</span> y <span class="operator">=</span> <span class="string">&quot;Relative expression of mRNA&quot;</span><span class="punctuation">)</span><span class="operator">+</span></span><br><span class="line">    ylim<span class="punctuation">(</span><span class="literal">NA</span><span class="punctuation">,</span> <span class="built_in">max</span><span class="punctuation">(</span>pcr<span class="punctuation">[</span>pcr<span class="operator">$</span>Gene <span class="operator">==</span> i<span class="punctuation">,</span> <span class="punctuation">]</span><span class="operator">$</span>Expression<span class="operator">+</span><span class="number">0.2</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">    theme<span class="punctuation">(</span>axis.title.x <span class="operator">=</span> element_text<span class="punctuation">(</span>size <span class="operator">=</span> <span class="number">12</span><span class="punctuation">,</span> face <span class="operator">=</span> <span class="string">&quot;bold&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">          panel.grid <span class="operator">=</span> element_blank<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">do.call<span class="punctuation">(</span><span class="string">&quot;grid.arrange&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span>plots<span class="punctuation">,</span> ncol<span class="operator">=</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="多次拟合曲线"><a href="#多次拟合曲线" class="headerlink" title="多次拟合曲线"></a>多次拟合曲线</h1><div class="tabs" id="混合图"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="混合图-1">结果展示</button><button type="button" class="tab " data-href="混合图-2">所需数据</button><button type="button" class="tab " data-href="混合图-3">代码</button></ul><div class="tab-contents"><div class="tab-item-content active" id="混合图-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/12/08/65730ef57b1ff.png" style="width:300px;"/></div></div></div><div class="tab-item-content" id="混合图-2"><p><a href="https://tooc.web.xlj0.com/uploads/R%E8%AF%AD%E8%A8%80%E7%BB%98%E5%9B%BE/HPY%E6%95%B0%E6%8D%AE.xlsx">多次拟合曲线</a></p></div><div class="tab-item-content" id="混合图-3"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>tidyverse<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>readxl<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HPY  <span class="operator">&lt;-</span> read_xlsx<span class="punctuation">(</span><span class="string">&quot;HPY数据.xlsx“)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ggplot(HPY, aes(x = Time, y = HPY, linetype=Type)) +</span></span><br><span class="line"><span class="string">  geom_smooth(se = FALSE, color = &quot;</span>black<span class="string">&quot;, method = &quot;</span>lm<span class="string">&quot;, formula = y ~ poly(x, degree = 4)) +</span></span><br><span class="line"><span class="string">  xlab(&quot;</span>Time <span class="punctuation">(</span>day<span class="punctuation">)</span><span class="string">&quot;) +</span></span><br><span class="line"><span class="string">  ylab(&quot;</span>HPY <span class="punctuation">(</span>µg<span class="operator">/</span>ml<span class="punctuation">)</span><span class="string">&quot;)+</span></span><br><span class="line"><span class="string">  scale_y_continuous() +</span></span><br><span class="line"><span class="string">  theme_bw()+</span></span><br><span class="line"><span class="string">  theme(legend.title = element_blank(),</span></span><br><span class="line"><span class="string">        legend.position = c(0.9, 0.9),</span></span><br><span class="line"><span class="string">        panel.grid = element_blank(),</span></span><br><span class="line"><span class="string">        plot.margin = margin(1, 1, 1, 1, unit = &quot;</span>cm<span class="string">&quot;))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">fit1 &lt;- lm(HPY ~ poly(Time, degree = 4),</span></span><br><span class="line"><span class="string">           data = HPY[HPY$Type == &quot;</span>primiparous<span class="string">&quot;,])</span></span><br><span class="line"><span class="string">summary(fit1)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">fit2 &lt;- lm(HPY ~ poly(Time, degree = 4),</span></span><br><span class="line"><span class="string">           data = HPY[HPY$Type == &quot;</span>mutiparous<span class="string">&quot;,])</span></span><br><span class="line"><span class="string">summary(fit2)</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;热图&quot;&gt;&lt;a href=&quot;#热图&quot; class=&quot;headerlink&quot; title=&quot;热图&quot;&gt;&lt;/a&gt;热图&lt;/h1&gt;&lt;h2 id=&quot;差异基因热图绘制&quot;&gt;&lt;a href=&quot;#差异基因热图绘制&quot; class=&quot;headerlink&quot; title=&quot;差异基因热图绘制&quot;</summary>
      
    
    
    
    <category term="生物信息学" scheme="https://smileszh.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/"/>
    
    
    <category term="R语言" scheme="https://smileszh.github.io/tags/R%E8%AF%AD%E8%A8%80/"/>
    
    <category term="R绘图" scheme="https://smileszh.github.io/tags/R%E7%BB%98%E5%9B%BE/"/>
    
  </entry>
  
  <entry>
    <title>差异基因表法分析</title>
    <link href="https://smileszh.github.io/posts/1085fed1.html"/>
    <id>https://smileszh.github.io/posts/1085fed1.html</id>
    <published>2023-06-30T15:00:00.000Z</published>
    <updated>2024-06-07T06:48:02.160Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DESeq2"><a href="#DESeq2" class="headerlink" title="DESeq2"></a>DESeq2</h1><div class="tabs" id="deseq2"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="deseq2-1">所需数据</button><button type="button" class="tab " data-href="deseq2-2">R代码</button><button type="button" class="tab " data-href="deseq2-3">输出数据</button><button type="button" class="tab " data-href="deseq2-4">备注</button></ul><div class="tab-contents"><div class="tab-item-content active" id="deseq2-1"><p><a href="https://tooc.web.xlj0.com/uploads/%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90/counts.csv">原始Counts数据</a><br><a href="https://tooc.web.xlj0.com/uploads/%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90/design.csv">样本分组信息</a></p></div><div class="tab-item-content" id="deseq2-2"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Differential expression analysis with the DESeq2 package.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># https://bioconductor.org/packages/release/bioc/html/DESeq2.html</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Command line install: mamba install bioconductor-deseq2</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">DESIGN_FILE <span class="operator">=</span> <span class="string">&quot;design.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the file that contains the counts.</span></span><br><span class="line">COUNTS_FILE <span class="operator">=</span> <span class="string">&quot;counts.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The output file.</span></span><br><span class="line">OUTPUT_FILE <span class="operator">=</span> <span class="string">&quot;deseq2.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install the optparse package automatically.</span></span><br><span class="line"><span class="keyword">if</span><span class="punctuation">(</span><span class="operator">!</span>require<span class="punctuation">(</span>optparse<span class="punctuation">,</span> quietly<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  install.packages<span class="punctuation">(</span><span class="string">&quot;optparse&quot;</span><span class="punctuation">,</span> repos<span class="operator">=</span><span class="string">&quot;http://cran.us.r-project.org&quot;</span><span class="punctuation">)</span></span><br><span class="line">  library<span class="punctuation">(</span>optparse<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Command line options.</span></span><br><span class="line">option_list <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span> </span><br><span class="line"></span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-d&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--design_file&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> action<span class="operator">=</span><span class="string">&quot;store&quot;</span><span class="punctuation">,</span> default<span class="operator">=</span>DESIGN_FILE<span class="punctuation">,</span> dest<span class="operator">=</span><span class="string">&quot;design_file&quot;</span><span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">,</span></span><br><span class="line">              help<span class="operator">=</span><span class="string">&quot;the design file for the samples [%default]&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-c&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--counts&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> action<span class="operator">=</span><span class="string">&quot;store&quot;</span><span class="punctuation">,</span> default<span class="operator">=</span>COUNTS_FILE<span class="punctuation">,</span> dest<span class="operator">=</span><span class="string">&quot;counts_file&quot;</span><span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">,</span></span><br><span class="line">              help<span class="operator">=</span><span class="string">&quot;input counts file  [%default]&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-o&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--out&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> action<span class="operator">=</span><span class="string">&quot;store&quot;</span><span class="punctuation">,</span> default<span class="operator">=</span>OUTPUT_FILE<span class="punctuation">,</span> dest<span class="operator">=</span><span class="string">&quot;output_file&quot;</span><span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">,</span></span><br><span class="line">              help<span class="operator">=</span><span class="string">&quot;the  results file  [%default]&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-f&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--factor_name&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> action<span class="operator">=</span><span class="string">&quot;store&quot;</span><span class="punctuation">,</span> default<span class="operator">=</span><span class="string">&quot;group&quot;</span><span class="punctuation">,</span> dest<span class="operator">=</span><span class="string">&quot;factor_name&quot;</span><span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">,</span></span><br><span class="line">              help<span class="operator">=</span><span class="string">&quot;the factor column name in the design file [%default]&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  </span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-s&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--sample_name&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> action<span class="operator">=</span><span class="string">&quot;store&quot;</span><span class="punctuation">,</span> default<span class="operator">=</span><span class="string">&quot;sample&quot;</span><span class="punctuation">,</span> dest<span class="operator">=</span><span class="string">&quot;sample_name&quot;</span><span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">,</span></span><br><span class="line">              help<span class="operator">=</span><span class="string">&quot;the sample column name in the design file [%default]&quot;</span><span class="punctuation">)</span></span><br><span class="line">  </span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Parse the options.</span></span><br><span class="line">opt <span class="operator">=</span> parse_args<span class="punctuation">(</span>OptionParser<span class="punctuation">(</span>option_list<span class="operator">=</span>option_list<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the file that contains the counts.</span></span><br><span class="line">counts_file <span class="operator">=</span> opt<span class="operator">$</span>counts_file</span><br><span class="line"></span><br><span class="line"><span class="comment"># The sample file is in CSV format and must have the headers &quot;sample&quot; and &quot;condition&quot;.</span></span><br><span class="line">design_file <span class="operator">=</span> opt<span class="operator">$</span>design_file</span><br><span class="line"></span><br><span class="line"><span class="comment"># The output file.</span></span><br><span class="line">output_file <span class="operator">=</span> opt<span class="operator">$</span>output_file</span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the factor column</span></span><br><span class="line">factor_name <span class="operator">=</span> opt<span class="operator">$</span>factor_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the sample column</span></span><br><span class="line">sample_name <span class="operator">=</span> opt<span class="operator">$</span>sample_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># Inform the user.</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Running DESeq2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Design:&quot;</span><span class="punctuation">,</span> design_file<span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Counts:&quot;</span><span class="punctuation">,</span> counts_file<span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Read the design file.</span></span><br><span class="line">inp <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span>design_file<span class="punctuation">,</span> strip.white <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check the sample column name.</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Sample column:&quot;</span><span class="punctuation">,</span> sample_name<span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span>sample_name <span class="operator">%in%</span> colnames<span class="punctuation">(</span>inp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  stop<span class="punctuation">(</span><span class="string">&quot;# Sample column: &quot;</span><span class="punctuation">,</span> sample_name<span class="punctuation">,</span> <span class="string">&quot; not found in design file (use -s).&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check the factor column name.</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Factor column:&quot;</span><span class="punctuation">,</span> factor_name<span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span>factor_name <span class="operator">%in%</span> colnames<span class="punctuation">(</span>inp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  stop<span class="punctuation">(</span><span class="string">&quot;# Factor column: &quot;</span><span class="punctuation">,</span> factor_name<span class="punctuation">,</span> <span class="string">&quot; not found in design file (use -f).&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new data frame to work with.</span></span><br><span class="line">df <span class="operator">=</span> data.frame<span class="punctuation">(</span></span><br><span class="line">  sample <span class="operator">=</span> inp<span class="punctuation">[</span><span class="punctuation">,</span> sample_name<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  groups <span class="operator">=</span> inp<span class="punctuation">[</span><span class="punctuation">,</span> factor_name<span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The default groups come from the design</span></span><br><span class="line">groups <span class="operator">=</span> unique<span class="punctuation">(</span>df<span class="operator">$</span>group<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new data frame to work with.</span></span><br><span class="line">df <span class="operator">=</span> data.frame<span class="punctuation">(</span></span><br><span class="line">  sample <span class="operator">=</span> inp<span class="punctuation">[</span><span class="punctuation">,</span> sample_name<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  groups <span class="operator">=</span> inp<span class="punctuation">[</span><span class="punctuation">,</span> factor_name<span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The default groups come from the design</span></span><br><span class="line">groups <span class="operator">=</span> unique<span class="punctuation">(</span>df<span class="operator">$</span>groups <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Print information on the groups</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>grp <span class="keyword">in</span> groups<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  n_grp <span class="operator">&lt;-</span> <span class="built_in">sum</span><span class="punctuation">(</span>df<span class="operator">$</span>groups <span class="operator">==</span> grp<span class="punctuation">)</span></span><br><span class="line">  cat<span class="punctuation">(</span><span class="string">&quot;# Group&quot;</span><span class="punctuation">,</span> grp<span class="punctuation">,</span> <span class="string">&quot;has&quot;</span><span class="punctuation">,</span> n_grp<span class="punctuation">,</span> <span class="string">&quot;samples.\n&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Turn conditions into factors.</span></span><br><span class="line">df<span class="operator">$</span>group <span class="operator">=</span> factor<span class="punctuation">(</span>df<span class="operator">$</span>group<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The first level should correspond to the first entry in the file</span></span><br><span class="line"><span class="comment"># Required later when building a model.</span></span><br><span class="line">df<span class="operator">$</span>group <span class="operator">=</span> relevel<span class="punctuation">(</span>df<span class="operator">$</span>group<span class="punctuation">,</span> toString<span class="punctuation">(</span>df<span class="operator">$</span>group<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Isolate the sample names.</span></span><br><span class="line">sample_names <span class="operator">=</span> df<span class="operator">$</span>sample</span><br><span class="line"></span><br><span class="line"><span class="comment"># Read the data from input file.</span></span><br><span class="line">count_df <span class="operator">=</span> read.csv<span class="punctuation">(</span>counts_file<span class="punctuation">,</span> strip.white <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Created rounded integers for the count data</span></span><br><span class="line">count_data <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>count_df<span class="punctuation">[</span><span class="punctuation">,</span> sample_names<span class="punctuation">,</span> drop<span class="operator">=</span><span class="built_in">F</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Column names should be carried over. Skip sample names and FDR</span></span><br><span class="line">other_cols <span class="operator">=</span> <span class="built_in">names</span><span class="punctuation">(</span>count_df<span class="punctuation">)</span><span class="punctuation">[</span><span class="operator">!</span><span class="built_in">names</span><span class="punctuation">(</span>count_df<span class="punctuation">)</span> <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span>sample_names<span class="punctuation">,</span> <span class="string">&quot;FDR&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Carry over all additional columns not in sample names.</span></span><br><span class="line">row_data <span class="operator">=</span> count_df<span class="punctuation">[</span><span class="punctuation">,</span> other_cols<span class="punctuation">,</span> drop<span class="operator">=</span><span class="built_in">F</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Running DESeq2</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Bioconductor packages used in the script.</span></span><br><span class="line">bio.p <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;DESeq2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tibble&quot;</span><span class="punctuation">,</span> <span class="string">&quot;dplyr&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tools&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load Bioconductor packages</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Initializing &quot;</span><span class="punctuation">,</span> bio.p<span class="punctuation">,</span> <span class="string">&quot;...&quot;</span><span class="punctuation">)</span></span><br><span class="line">status <span class="operator">=</span> suppressPackageStartupMessages<span class="punctuation">(</span></span><br><span class="line">  lapply<span class="punctuation">(</span>bio.p<span class="punctuation">,</span> library<span class="punctuation">,</span> character.only <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot; done\n&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create DESEq2 dataset.</span></span><br><span class="line">dds <span class="operator">=</span> DESeqDataSetFromMatrix<span class="punctuation">(</span></span><br><span class="line">  countData <span class="operator">=</span> count_data<span class="punctuation">,</span></span><br><span class="line">  rowData <span class="operator">=</span> row_data<span class="punctuation">,</span></span><br><span class="line">  colData <span class="operator">=</span> df<span class="punctuation">,</span></span><br><span class="line">  design <span class="operator">=</span> <span class="operator">~</span>group</span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Number of rows before</span></span><br><span class="line">n_start <span class="operator">=</span> nrow<span class="punctuation">(</span>dds<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove rows with no counts</span></span><br><span class="line">keep <span class="operator">&lt;-</span> rowSums<span class="punctuation">(</span>counts<span class="punctuation">(</span>dds<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">&gt;</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># At least 3 samples with a count of 10 or higher</span></span><br><span class="line"><span class="comment"># keep &lt;- rowSums(counts(dds) &gt;= 10) &gt;= 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Apply the filtering</span></span><br><span class="line">dds <span class="operator">&lt;-</span> dds<span class="punctuation">[</span>keep<span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Run deseq</span></span><br><span class="line">dds <span class="operator">=</span> DESeq<span class="punctuation">(</span>dds<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the normalized counts.</span></span><br><span class="line">normed <span class="operator">=</span> counts<span class="punctuation">(</span>dds<span class="punctuation">,</span> normalized<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Round normalized counts to a single digit.</span></span><br><span class="line">normed <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>normed<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Format the results.</span></span><br><span class="line">res <span class="operator">=</span> results<span class="punctuation">(</span>dds<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The rest of the code is about formatting the output dataframe.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The first columns that carry over from the input.</span></span><br><span class="line">start <span class="operator">=</span>  dplyr<span class="operator">::</span>as_tibble<span class="punctuation">(</span>rowData<span class="punctuation">(</span>dds<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span> other_cols<span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The main tibble</span></span><br><span class="line">data <span class="operator">=</span> bind_cols<span class="punctuation">(</span>start<span class="punctuation">,</span> as_tibble<span class="punctuation">(</span>res<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the foldChange column.</span></span><br><span class="line">data<span class="operator">$</span>foldChange <span class="operator">=</span> <span class="number">2</span> <span class="operator">^</span> data<span class="operator">$</span>log2FoldChange</span><br><span class="line"></span><br><span class="line"><span class="comment"># Rename the columns.</span></span><br><span class="line">data <span class="operator">=</span>  dplyr<span class="operator">::</span>rename<span class="punctuation">(</span>data<span class="punctuation">,</span> PValue<span class="operator">=</span>pvalue<span class="punctuation">,</span> FDR<span class="operator">=</span>padj<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set all NA values to 1.</span></span><br><span class="line">data<span class="operator">$</span>FDR<span class="punctuation">[</span><span class="built_in">is.na</span><span class="punctuation">(</span>data<span class="operator">$</span>FDR<span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a real adjusted pvalue</span></span><br><span class="line">data<span class="operator">$</span>PAdj <span class="operator">=</span> p.adjust<span class="punctuation">(</span>data<span class="operator">$</span>PValue<span class="punctuation">,</span> method<span class="operator">=</span><span class="string">&quot;hochberg&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the additional columns that we wish to present.</span></span><br><span class="line">data<span class="operator">$</span>baseMeanA <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">data<span class="operator">$</span>baseMeanB <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Combine the normed matrix with the results</span></span><br><span class="line">total <span class="operator">&lt;-</span> bind_cols<span class="punctuation">(</span>data<span class="punctuation">,</span> normed<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sort again by P-value.</span></span><br><span class="line">total <span class="operator">=</span> arrange<span class="punctuation">(</span>total<span class="punctuation">,</span> FDR<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Compute the false discovery counts on the sorted table.</span></span><br><span class="line">total<span class="operator">$</span>falsePos <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span>nrow<span class="punctuation">(</span>total<span class="punctuation">)</span> <span class="operator">*</span> total<span class="operator">$</span>FDR</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sample names for condition A and B</span></span><br><span class="line">col_names_A <span class="operator">&lt;-</span> sample_names <span class="punctuation">[</span>df<span class="operator">$</span>group <span class="operator">==</span> groups<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">col_names_B <span class="operator">&lt;-</span> sample_names <span class="punctuation">[</span>df<span class="operator">$</span>group <span class="operator">==</span> groups<span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#col_names_A = unlist(df %&gt;% filter(group==groups[1]) %&gt;% select(sample))</span></span><br><span class="line"><span class="comment">#col_names_B = unlist(df %&gt;% filter(group==groups[2]) %&gt;% select(sample))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the individual baseMean columns.</span></span><br><span class="line">total<span class="operator">$</span>baseMeanA <span class="operator">=</span> rowMeans<span class="punctuation">(</span>total<span class="punctuation">[</span><span class="punctuation">,</span> col_names_A<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>baseMeanB <span class="operator">=</span> rowMeans<span class="punctuation">(</span>total<span class="punctuation">[</span><span class="punctuation">,</span> col_names_B<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Bringing some sanity to numbers. Round columns to fewer digits.</span></span><br><span class="line">total<span class="operator">$</span>foldChange <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>foldChange<span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>log2FoldChange <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>log2FoldChange<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>baseMean  <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>baseMean<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>baseMeanA <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>baseMeanA<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>baseMeanB <span class="operator">=</span>  <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>baseMeanB<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>lfcSE <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>lfcSE<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>stat <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>stat<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>FDR <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>FDR<span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>falsePos <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>falsePos<span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Reorganize columns names to make more sense.</span></span><br><span class="line">new_cols <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>other_cols<span class="punctuation">,</span> </span><br><span class="line">             <span class="string">&quot;baseMean&quot;</span><span class="punctuation">,</span><span class="string">&quot;baseMeanA&quot;</span><span class="punctuation">,</span><span class="string">&quot;baseMeanB&quot;</span><span class="punctuation">,</span></span><br><span class="line">             <span class="string">&quot;foldChange&quot;</span><span class="punctuation">,</span> <span class="string">&quot;log2FoldChange&quot;</span><span class="punctuation">,</span></span><br><span class="line">             <span class="string">&quot;lfcSE&quot;</span><span class="punctuation">,</span><span class="string">&quot;stat&quot;</span><span class="punctuation">,</span><span class="string">&quot;PValue&quot;</span><span class="punctuation">,</span><span class="string">&quot;PAdj&quot;</span><span class="punctuation">,</span> </span><br><span class="line">             <span class="string">&quot;FDR&quot;</span><span class="punctuation">,</span><span class="string">&quot;falsePos&quot;</span><span class="punctuation">,</span> col_names_A<span class="punctuation">,</span> col_names_B<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Slice the dataframe with new columns.</span></span><br><span class="line">total <span class="operator">=</span> total<span class="punctuation">[</span><span class="punctuation">,</span> new_cols<span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Count the number of significant results.</span></span><br><span class="line">n_total <span class="operator">=</span> nrow<span class="punctuation">(</span>total<span class="punctuation">)</span></span><br><span class="line">fdr_count <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">(</span>total<span class="operator">$</span>FDR <span class="operator">&lt;</span> <span class="number">0.05</span><span class="punctuation">,</span> na.rm<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">fdr_frac <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>fdr_count<span class="operator">/</span>n_total<span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line">pval_count <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">(</span>total<span class="operator">$</span>PValue <span class="operator">&lt;</span> <span class="number">0.05</span><span class="punctuation">,</span> na.rm<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">pval_frac <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>pval_count<span class="operator">/</span>n_total<span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Reformat these columns as string.</span></span><br><span class="line">total<span class="operator">$</span>PAdj <span class="operator">=</span> formatC<span class="punctuation">(</span>total<span class="operator">$</span>PAdj<span class="punctuation">,</span> format <span class="operator">=</span> <span class="string">&quot;e&quot;</span><span class="punctuation">,</span> digits <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>PValue <span class="operator">=</span> formatC<span class="punctuation">(</span>total<span class="operator">$</span>PValue<span class="punctuation">,</span> format <span class="operator">=</span> <span class="string">&quot;e&quot;</span><span class="punctuation">,</span> digits <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Write the results to the standard output.</span></span><br><span class="line">write.csv<span class="punctuation">(</span>total<span class="punctuation">,</span> file<span class="operator">=</span>output_file<span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Inform the user.</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Input:&quot;</span><span class="punctuation">,</span> n_start<span class="punctuation">,</span> <span class="string">&quot;rows\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Removed:&quot;</span><span class="punctuation">,</span> n_start<span class="operator">-</span>n_total<span class="punctuation">,</span> <span class="string">&quot;rows\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Fitted:&quot;</span><span class="punctuation">,</span> n_total<span class="punctuation">,</span> <span class="string">&quot;rows\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Significant PVal:&quot;</span><span class="punctuation">,</span> pval_count<span class="punctuation">,</span> <span class="string">&quot;(&quot;</span><span class="punctuation">,</span> pval_frac<span class="punctuation">,</span> <span class="string">&quot;%)\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Significant FDRs:&quot;</span><span class="punctuation">,</span> fdr_count<span class="punctuation">,</span> <span class="string">&quot;(&quot;</span><span class="punctuation">,</span> fdr_frac<span class="punctuation">,</span> <span class="string">&quot;%)\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Results:&quot;</span><span class="punctuation">,</span> output_file<span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="deseq2-3"><p><a href="https://tooc.web.xlj0.com/uploads/%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90/results.csv">result</a></p></div><div class="tab-item-content" id="deseq2-4"><p>Deseq2的输出中，<strong>Padj</strong>实际上是<strong>FDR</strong>! 一般我们认为：PAdj进行多重检验所使用的方法是<strong>hochberg</strong>, FDR进行多重检验的方法是<strong>Benjamini &amp; Hochberg</strong>。所以在代码中我们进行了转换操作。</p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><details class="folding-tag" ><summary> 数据结果说明 </summary>              <div class='content'>              <p><strong>name</strong> - the feature identity. It must be unique within the column. It may be a gene name, transcript name, or exon - whatever the feature we chose to quantify.<br><strong>baseMean</strong> - the average normalized expression level across samples. It measures how much total signal is present across both conditions.<br><strong>baseMeanA</strong> - the average normalized expression level across the first condition. It measures how much total signal is there for condition A.<br><strong>baseMeanB</strong> - the average normalized expression level across the first condition. It measures how much total signal is there for condition B.<br><strong>foldChange</strong> - the ratio of baseMeanB/baseMeanA. Very important to always be aware that in the fold change means B/A (second condition/first condition)<br><strong>log2FoldChange</strong> - the second logarithm of foldChange. Log 2 transformations are convenient as they transform the changes onto a uniform scale. A four-fold increase after transformation is 2. A four-fold decrease (1/4) after log 2 transform is -2. This property makes it much easier to compare the magnitude of up/down changes.<br><strong>PValue</strong> - the uncorrected p-value of the likelihood of observing the effect of the size foldChange (or larger) by chance alone. This p-value is not corrected for multiple comparisons.<br><strong>PAdj</strong> - the multiple comparisons corrected PValue (via the Hochberg method). This probability of having at least one false positive when accounting for all comparisons made. This value is usually overly conservative in genomics.<br><strong>FDR</strong> - the False Discovery Rate - this column represents the fraction of false discoveries for all the rows above the row where the value is listed. For example, if in row number 300 the FDR is 0.05, it means that if you were cut the table at this row and accept all genes at and above it as differentially expressed then, 300 * 0.05 = 15 genes out of the 300 are likely to be false positives. The values in this column are also called q-values.<br><strong>falsePos</strong> - this column is derived directly from FDR and represents the number of false positives in the rows above. It is computed as RowIndex * FDR and is there to provide a direct interpretation of FDR.<br>The following columns represent the normalized matrix of the original count data in this case, 3 and 3 conditions.</p>              </div>            </details><h1 id="edgeR"><a href="#edgeR" class="headerlink" title="edgeR"></a>edgeR</h1><div class="tabs" id="edger"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="edger-1">所需数据</button><button type="button" class="tab " data-href="edger-2">R代码</button><button type="button" class="tab " data-href="edger-3">输出数据</button></ul><div class="tab-contents"><div class="tab-item-content active" id="edger-1"><p><a href="https://tooc.web.xlj0.com/uploads/%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90/counts.csv">原始Counts数据</a><br><a href="https://tooc.web.xlj0.com/uploads/%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90/design.csv">样本分组信息</a></p></div><div class="tab-item-content" id="edger-2"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Differential expression analysis with the edgeR package.</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># https://bioconductor.org/packages/release/bioc/html/edgeR.html</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the library</span></span><br><span class="line">library<span class="punctuation">(</span>edgeR<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the file that contains the counts.</span></span><br><span class="line">counts_file <span class="operator">=</span> <span class="string">&quot;counts.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The sample file is in CSV format and must have the headers &quot;sample&quot; and &quot;condition&quot;.</span></span><br><span class="line">design_file <span class="operator">=</span> <span class="string">&quot;design.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The final result file.</span></span><br><span class="line">output_file <span class="operator">=</span> <span class="string">&quot;results.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Read the sample file.</span></span><br><span class="line">colData <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span>design_file<span class="punctuation">,</span> stringsAsFactors<span class="operator">=</span><span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Turn conditions into factors.</span></span><br><span class="line">colData<span class="operator">$</span>condition <span class="operator">=</span> factor<span class="punctuation">(</span>colData<span class="operator">$</span>condition<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The first level should correspond to the first entry in the file!</span></span><br><span class="line"><span class="comment"># Required when building a model.</span></span><br><span class="line">colData<span class="operator">$</span>condition <span class="operator">=</span> relevel<span class="punctuation">(</span>colData<span class="operator">$</span>condition<span class="punctuation">,</span> toString<span class="punctuation">(</span>colData<span class="operator">$</span>condition<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Isolate the sample names.</span></span><br><span class="line">sample_names <span class="operator">&lt;-</span> colData<span class="operator">$</span>sample</span><br><span class="line"></span><br><span class="line"><span class="comment"># Read the data from the standard input.</span></span><br><span class="line">df <span class="operator">=</span> read.csv<span class="punctuation">(</span>counts_file<span class="punctuation">,</span> header<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span> row.names<span class="operator">=</span><span class="number">1</span> <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Created rounded integers for the count data</span></span><br><span class="line">counts <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>df<span class="punctuation">[</span><span class="punctuation">,</span> sample_names<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Other columns in the dataframe that are not sample information. </span></span><br><span class="line">otherCols <span class="operator">=</span> df<span class="punctuation">[</span><span class="operator">!</span><span class="punctuation">(</span><span class="built_in">names</span><span class="punctuation">(</span>df<span class="punctuation">)</span> <span class="operator">%in%</span> sample_names<span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Using the same naming as in the library.</span></span><br><span class="line">group <span class="operator">&lt;-</span> colData<span class="operator">$</span>condition</span><br><span class="line"></span><br><span class="line"><span class="comment"># Creates a DGEList object from a table of counts and group.</span></span><br><span class="line">dge <span class="operator">&lt;-</span> DGEList<span class="punctuation">(</span>counts<span class="operator">=</span>counts<span class="punctuation">,</span> group<span class="operator">=</span>group<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Maximizes the negative binomial conditional common likelihood to estimate a common dispersion value across all genes.</span></span><br><span class="line">dis <span class="operator">&lt;-</span> estimateCommonDisp<span class="punctuation">(</span>dge<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Estimates tagwise dispersion values by an empirical Bayes method based on weighted conditional maximum likelihood.</span></span><br><span class="line">tag <span class="operator">&lt;-</span> estimateTagwiseDisp<span class="punctuation">(</span>dis<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Compute genewise exact tests for differences in the means between the groups.</span></span><br><span class="line">etx <span class="operator">&lt;-</span> exactTest<span class="punctuation">(</span>tag<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Extracts the most differentially expressed genes.</span></span><br><span class="line">etp <span class="operator">&lt;-</span> topTags<span class="punctuation">(</span>etx<span class="punctuation">,</span> n<span class="operator">=</span>nrow<span class="punctuation">(</span>counts<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the scale of the data</span></span><br><span class="line">scale <span class="operator">=</span> dge<span class="operator">$</span>samples<span class="operator">$</span>lib.size <span class="operator">*</span> dge<span class="operator">$</span>samples<span class="operator">$</span>norm.factors</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the normalized counts</span></span><br><span class="line">normed <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>t<span class="punctuation">(</span>t<span class="punctuation">(</span>counts<span class="punctuation">)</span><span class="operator">/</span>scale<span class="punctuation">)</span> <span class="operator">*</span> mean<span class="punctuation">(</span>scale<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Turn the DESeq2 results into a data frame.</span></span><br><span class="line">data <span class="operator">=</span> merge<span class="punctuation">(</span>otherCols<span class="punctuation">,</span> etp<span class="operator">$</span>table<span class="punctuation">,</span> by<span class="operator">=</span><span class="string">&quot;row.names&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create column placeholders.</span></span><br><span class="line">data<span class="operator">$</span>baseMean <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">data<span class="operator">$</span>baseMeanA <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">data<span class="operator">$</span>baseMeanB <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">data<span class="operator">$</span>foldChange <span class="operator">=</span> <span class="number">2</span> <span class="operator">^</span> data<span class="operator">$</span>logFC</span><br><span class="line">data<span class="operator">$</span>falsePos <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Rename the column.</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">[</span><span class="built_in">names</span><span class="punctuation">(</span>data<span class="punctuation">)</span><span class="operator">==</span><span class="string">&quot;logFC&quot;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span><span class="string">&quot;log2FoldChange&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Compute the adjusted p-value</span></span><br><span class="line">data<span class="operator">$</span>PAdj <span class="operator">=</span> p.adjust<span class="punctuation">(</span>data<span class="operator">$</span>PValue<span class="punctuation">,</span> method<span class="operator">=</span><span class="string">&quot;hochberg&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Rename the first columns for consistency with other methods.</span></span><br><span class="line">colnames<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&quot;name&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a merged output that contains the normalized counts.</span></span><br><span class="line">total <span class="operator">&lt;-</span> merge<span class="punctuation">(</span>data<span class="punctuation">,</span> normed<span class="punctuation">,</span> by.x<span class="operator">=</span><span class="string">&#x27;name&#x27;</span><span class="punctuation">,</span> by.y<span class="operator">=</span><span class="string">&quot;row.names&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sort the data for the output. </span></span><br><span class="line">total <span class="operator">=</span> total<span class="punctuation">[</span>with<span class="punctuation">(</span>total<span class="punctuation">,</span> order<span class="punctuation">(</span>PValue<span class="punctuation">,</span> <span class="operator">-</span>foldChange<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Compute the false discovery counts on the sorted table.</span></span><br><span class="line">data<span class="operator">$</span>falsePos <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span>nrow<span class="punctuation">(</span>data<span class="punctuation">)</span> <span class="operator">*</span> data<span class="operator">$</span>FDR</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sample names for condition A</span></span><br><span class="line">col_names_A <span class="operator">=</span> data.frame<span class="punctuation">(</span>split<span class="punctuation">(</span>colData<span class="punctuation">,</span> colData<span class="operator">$</span>condition<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sample names for condition B</span></span><br><span class="line">col_names_B <span class="operator">=</span> data.frame<span class="punctuation">(</span>split<span class="punctuation">(</span>colData<span class="punctuation">,</span> colData<span class="operator">$</span>condition<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the individual baseMean columns.</span></span><br><span class="line">total<span class="operator">$</span>baseMeanA <span class="operator">=</span> rowMeans<span class="punctuation">(</span>total<span class="punctuation">[</span><span class="punctuation">,</span> col_names_A<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>baseMeanB <span class="operator">=</span> rowMeans<span class="punctuation">(</span>total<span class="punctuation">[</span><span class="punctuation">,</span> col_names_B<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>baseMean <span class="operator">=</span> total<span class="operator">$</span>baseMeanA <span class="operator">+</span> total<span class="operator">$</span>baseMeanB</span><br><span class="line"></span><br><span class="line"><span class="comment"># Round the numbers</span></span><br><span class="line">total<span class="operator">$</span>foldChange <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>foldChange<span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>FDR <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>FDR<span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>PAdj <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>PAdj<span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>logCPM <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>logCPM<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>log2FoldChange <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>log2FoldChange<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>baseMean <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>baseMean<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>baseMeanA <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>baseMeanA<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>baseMeanB <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>baseMeanB<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>falsePos <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>falsePos<span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Reformat these columns as string.</span></span><br><span class="line">total<span class="operator">$</span>PAdj <span class="operator">=</span> formatC<span class="punctuation">(</span>total<span class="operator">$</span>PAdj<span class="punctuation">,</span> format <span class="operator">=</span> <span class="string">&quot;e&quot;</span><span class="punctuation">,</span> digits <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>PValue <span class="operator">=</span> formatC<span class="punctuation">(</span>total<span class="operator">$</span>PValue<span class="punctuation">,</span> format <span class="operator">=</span> <span class="string">&quot;e&quot;</span><span class="punctuation">,</span> digits <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Reorganize columns names to make more sense.</span></span><br><span class="line">new_cols <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;name&quot;</span><span class="punctuation">,</span> <span class="built_in">names</span><span class="punctuation">(</span>otherCols<span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&quot;baseMean&quot;</span><span class="punctuation">,</span><span class="string">&quot;baseMeanA&quot;</span><span class="punctuation">,</span><span class="string">&quot;baseMeanB&quot;</span><span class="punctuation">,</span><span class="string">&quot;foldChange&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="string">&quot;log2FoldChange&quot;</span><span class="punctuation">,</span><span class="string">&quot;logCPM&quot;</span><span class="punctuation">,</span><span class="string">&quot;PValue&quot;</span><span class="punctuation">,</span><span class="string">&quot;PAdj&quot;</span><span class="punctuation">,</span> <span class="string">&quot;FDR&quot;</span><span class="punctuation">,</span><span class="string">&quot;falsePos&quot;</span><span class="punctuation">,</span>col_names_A<span class="punctuation">,</span> col_names_B<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Slice the dataframe with new columns.</span></span><br><span class="line">total <span class="operator">=</span> total<span class="punctuation">[</span><span class="punctuation">,</span> new_cols<span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Write the result to the standard output.</span></span><br><span class="line">write.csv<span class="punctuation">(</span>total<span class="punctuation">,</span> file<span class="operator">=</span>output_file<span class="punctuation">,</span> row.names<span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">,</span> <span class="built_in">quote</span><span class="operator">=</span><span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Inform the user.</span></span><br><span class="line">print<span class="punctuation">(</span><span class="string">&quot;# Tool: edgeR&quot;</span><span class="punctuation">)</span></span><br><span class="line">print<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;# Design: &quot;</span><span class="punctuation">,</span> design_file<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">print<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;# Input: &quot;</span><span class="punctuation">,</span> counts_file<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">print<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;# Output: &quot;</span><span class="punctuation">,</span> output_file<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="edger-3"><p><a href="https://tooc.web.xlj0.com/uploads/%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90/results_edger.csv">result</a></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><details class="folding-tag" ><summary> 数据结果说明 </summary>              <div class='content'>              <p><strong>name</strong> - the feature identity. It must be unique within the column. It may be a gene name, transcript name, or exon - whatever the feature we chose to quantify.<br><strong>baseMean</strong> - the average normalized expression level across samples. It measures how much total signal is present across both conditions.<br><strong>baseMeanA</strong> - the average normalized expression level across the first condition. It measures how much total signal is there for condition A.<br><strong>baseMeanB</strong> - the average normalized expression level across the first condition. It measures how much total signal is there for condition B.<br><strong>foldChange</strong> - the ratio of baseMeanB/baseMeanA. Very important to always be aware that in the fold change means B/A (second condition/first condition)<br><strong>log2FoldChange</strong> - the second logarithm of foldChange. Log 2 transformations are convenient as they transform the changes onto a uniform scale. A four-fold increase after transformation is 2. A four-fold decrease (1/4) after log 2 transform is -2. This property makes it much easier to compare the magnitude of up/down changes.<br><strong>PValue</strong> - the uncorrected p-value of the likelihood of observing the effect of the size foldChange (or larger) by chance alone. This p-value is not corrected for multiple comparisons.<br><strong>PAdj</strong> - the multiple comparisons corrected PValue (via the Hochberg method). This probability of having at least one false positive when accounting for all comparisons made. This value is usually overly conservative in genomics.<br><strong>FDR</strong> - the False Discovery Rate - this column represents the fraction of false discoveries for all the rows above the row where the value is listed. For example, if in row number 300 the FDR is 0.05, it means that if you were cut the table at this row and accept all genes at and above it as differentially expressed then, 300 * 0.05 = 15 genes out of the 300 are likely to be false positives. The values in this column are also called q-values.<br><strong>falsePos</strong> - this column is derived directly from FDR and represents the number of false positives in the rows above. It is computed as RowIndex * FDR and is there to provide a direct interpretation of FDR.<br>The following columns represent the normalized matrix of the original count data in this case, 3 and 3 conditions.</p>              </div>            </details>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;DESeq2&quot;&gt;&lt;a href=&quot;#DESeq2&quot; class=&quot;headerlink&quot; title=&quot;DESeq2&quot;&gt;&lt;/a&gt;DESeq2&lt;/h1&gt;&lt;div class=&quot;tabs&quot; id=&quot;deseq2&quot;&gt;&lt;ul class=&quot;nav-tabs&quot;&gt;&lt;butto</summary>
      
    
    
    
    <category term="生物信息学" scheme="https://smileszh.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/"/>
    
    
    <category term="R语言" scheme="https://smileszh.github.io/tags/R%E8%AF%AD%E8%A8%80/"/>
    
    <category term="差异表法分析" scheme="https://smileszh.github.io/tags/%E5%B7%AE%E5%BC%82%E8%A1%A8%E6%B3%95%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>Mac终端：服务器与本地文件交互</title>
    <link href="https://smileszh.github.io/posts/b21fca77.html"/>
    <id>https://smileszh.github.io/posts/b21fca77.html</id>
    <published>2023-06-30T08:00:00.000Z</published>
    <updated>2023-06-30T09:10:16.363Z</updated>
    
    <content type="html"><![CDATA[<h1 id="从服务器下载文件到本地"><a href="#从服务器下载文件到本地" class="headerlink" title="从服务器下载文件到本地"></a>从服务器下载文件到本地</h1><ol><li>打开Mac终端</li><li>使用scp命令下载文件</li></ol><div class="tabs" id="scp"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="scp-1">命令💻</button><button type="button" class="tab " data-href="scp-2">参数解释🗣️</button></ul><div class="tab-contents"><div class="tab-item-content active" id="scp-1"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r xiaosu@10.10.140.xxx:~xiaosu/gorden /Users/xiaosu/Desktop</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="scp-2"><div class="table-container"><table><thead><tr><th style="text-align:center">参数</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">-r</td><td style="text-align:center">如下载的是文件夹需使用此参数，如果是文件可不使用此参数</td></tr><tr><td style="text-align:center">xiaosu@10.10.140.xxx</td><td style="text-align:center">服务器地址</td></tr><tr><td style="text-align:center">~xiaosu/gorden</td><td style="text-align:center">输入服务器中要下载的文件路径</td></tr><tr><td style="text-align:center">/Users/xiaosu/Desktop</td><td style="text-align:center">输入本地地址，必须是全局路径</td></tr></tbody></table></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><script async id="asciicast-ypnQv3nx22hIDB1V58Kop4o7j" src="https://asciinema.org/a/ypnQv3nx22hIDB1V58Kop4o7j.js"></script>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;从服务器下载文件到本地&quot;&gt;&lt;a href=&quot;#从服务器下载文件到本地&quot; class=&quot;headerlink&quot; title=&quot;从服务器下载文件到本地&quot;&gt;&lt;/a&gt;从服务器下载文件到本地&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;打开Mac终端&lt;/li&gt;
&lt;li&gt;使用scp命令下载文件</summary>
      
    
    
    
    <category term="生活兴趣" scheme="https://smileszh.github.io/categories/%E7%94%9F%E6%B4%BB%E5%85%B4%E8%B6%A3/"/>
    
    
    <category term="Mac" scheme="https://smileszh.github.io/tags/Mac/"/>
    
    <category term="Terminal" scheme="https://smileszh.github.io/tags/Terminal/"/>
    
  </entry>
  
  <entry>
    <title>生信数据格式</title>
    <link href="https://smileszh.github.io/posts/795e1915.html"/>
    <id>https://smileszh.github.io/posts/795e1915.html</id>
    <published>2023-06-29T09:00:00.000Z</published>
    <updated>2024-05-28T04:21:24.123Z</updated>
    
    <content type="html"><![CDATA[<h1 id="GENBANK"><a href="#GENBANK" class="headerlink" title="GENBANK"></a>GENBANK</h1><div class="tabs" id="genbank"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="genbank-1">简介</button><button type="button" class="tab " data-href="genbank-2">常用代码</button></ul><div class="tab-contents"><div class="tab-item-content active" id="genbank-1"><p>GenBank是一个由美国国家生物技术信息中心（NCBI）维护的数据库，它是一个免费的数据库，包含了大量的核酸序列和蛋白质序列。这些数据包括了基因组、mRNA、EST、蛋白质等。GenBank数据库中的数据是以文本的形式存储的，每一条序列数据都有一个唯一的标识符，这个标识符是一个以“LOCUS”开头的行，后面跟着这条序列的名字。GenBank数据库中的数据是以一种叫做GenBank格式的格式存储的，这种格式是一种文本格式，它包含了序列的名字、序列的长度、序列的来源、序列的特征等信息。</p><ul><li>例如文件NC_045512包含以下信息：<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">LOCUS       NC_045512              29903 bp ss-RNA     linear   VRL 18-JUL-2020</span><br><span class="line">DEFINITION  Severe acute respiratory syndrome coronavirus 2 isolate Wuhan-Hu-1,</span><br><span class="line">            complete genome.</span><br><span class="line">ACCESSION   NC_045512</span><br><span class="line">VERSION     NC_045512.2</span><br><span class="line">DBLINK      BioProject: PRJNA485481</span><br><span class="line">KEYWORDS    RefSeq.</span><br><span class="line">SOURCE      Severe acute respiratory syndrome coronavirus 2 (SARS-CoV-2)</span><br><span class="line">  ORGANISM  Severe acute respiratory syndrome coronavirus 2</span><br><span class="line">            Viruses; Riboviria; Orthornavirae; Pisuviricota; Pisoniviricetes;</span><br><span class="line">            Nidovirales; Cornidovirineae; Coronaviridae; Orthocoronavirinae;</span><br><span class="line">            Betacoronavirus; Sarbecovirus.</span><br><span class="line">REFERENCE   1  (bases 1 to 29903)</span><br><span class="line">  AUTHORS   Wu,F., Zhao,S., Yu,B., Chen,Y.M., Wang,W., Song,Z.G., Hu,Y.,</span><br><span class="line">            Tao,Z.W., Tian,J.H., Pei,Y.Y., Yuan,M.L., Zhang,Y.L., Dai,F.H.,</span><br><span class="line">            Liu,Y., Wang,Q.M., Zheng,J.J., Xu,L., Holmes,E.C. and Zhang,Y.Z.</span><br><span class="line">  TITLE     A new coronavirus associated with human respiratory disease in</span><br><span class="line">            China</span><br><span class="line">  JOURNAL   Nature 579 (7798), 265-269 (2020)</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure></li></ul></div><div class="tab-item-content" id="genbank-2"><p><code>获取GenBank文件</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bio fetch NC_045512 &gt; NC_045512.gb</span><br></pre></td></tr></table></figure></p><p><code>GeneBank转为fasta</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat NC_045512.gb | bio fasta &gt; NC_045512.fa</span><br></pre></td></tr></table></figure></p><p><code>GeneBank转为gff3</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat NC_045512.gb | bio gff &gt; NC_045512.gff</span><br></pre></td></tr></table></figure></p><p><code>GeneBank中提取基因序列</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat NC_045512.gb | bio fasta --gene S</span><br></pre></td></tr></table></figure></p><p><code>GeneBank中提取CDS序列</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat NC_045512.gb | bio fasta --type CDS</span><br></pre></td></tr></table></figure></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div> <h1 id="FASTA"><a href="#FASTA" class="headerlink" title="FASTA"></a>FASTA</h1><div class="tabs" id="fasta"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="fasta-1">简介</button><button type="button" class="tab " data-href="fasta-2">常用代码</button></ul><div class="tab-contents"><div class="tab-item-content active" id="fasta-1"><p>FASTA格式一种记录序列的格式，是一种纯文本格式，用于存储核酸序列和蛋白质序列。FASTA格式的文件以“&gt;”开头，后面跟着这条序列的名字，然后是这条序列的序列信息。FASTA格式的文件可以包含多条序列，每一条序列都以“&gt;”开头。</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;NC_045512.2 Severe acute respiratory syndrome coronavirus 2 isolate</span><br><span class="line">ATTAAAGGTTTATACCTTCCCAGGTAACAAACCAACCAACTTTCGATCTCTTGTAGATCTGTTCTCTAAA</span><br><span class="line">CGAACTTTAAAATCTGTGTGGCTGTCACTCGGCTGCATGCTTAGTGCACTCACGCAGTATAATTAATAAC</span><br><span class="line">TAATTACTGTCGTTGACAGGACACGAGTAACTCGTCTATCTTCTGCAGGCTGCTTACGGTTTCGTCCGTG</span><br><span class="line">TTGCAGCCGATCATCAGCACATCTAGGTTTCGTCCGGGTGTGACCGAAAGGTAAGATGGAGAGCCTTGTC</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="fasta-2"><p><code>根据ID获取FASTA文件</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bio fetch NC_045512 -format fasta</span><br></pre></td></tr></table></figure></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div> <h1 id="FASTQ"><a href="#FASTQ" class="headerlink" title="FASTQ"></a>FASTQ</h1><div class="tabs" id="fastq"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="fastq-1">简介</button></ul><div class="tab-contents"><div class="tab-item-content active" id="fastq-1"><p>通过测序，一般拿到的数据是<strong>.fastq</strong>或者<strong>.fq</strong>的原始数据格式，该数据包含所有的reads信息，其中一条reads主要包含以下4行信息：</p><ul><li><p>第一行主要储存序列测序时的坐标等信息，可用于区分来源；</p></li><li><p>第二行是测序得到的序列信息，一般用ATCGN来表示，其中N表示荧光信号干扰无法判断到底是哪个碱基;</p></li><li><p>第三行以“+”开始，可以储存一些附加信息，一般是空的；</p></li><li><p>第四行储存的是质量信息，与第2行的碱基序列是一一对应的，其中的每一个符号对应的ASCII值成为phred值，可以简单理解为对应位置碱基的质量值，越大说明测序的质量越好。不同的版本对应的不同。</p></li></ul><p><img src="https://bu.dusays.com/2023/06/29/649ce796a5a28.png" alt="fastq.png"></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="GTF"><a href="#GTF" class="headerlink" title="GTF"></a>GTF</h1><div class="tabs" id="gtf"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="gtf-1">简介</button></ul><div class="tab-contents"><div class="tab-item-content active" id="gtf-1"><p>gtf格式是一种用来注释金银的数据格式，一般用来注释基因组的结构信息，包括基因的位置、外显子的位置、内含子的位置等。gtf格式的文件是一种文本文件，它包含了一些列的注释信息，每一行都是一个注释信息，每一行都包含了一些列的信息，这些信息之间用制表符分隔。gtf格式的文件一般包含了一些列的信息，这些信息包括了基因的名字、基因的来源、基因的类型、基因的位置等。</p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="SAM"><a href="#SAM" class="headerlink" title="SAM"></a>SAM</h1><div class="tabs" id="sam"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="sam-1">简介</button></ul><div class="tab-contents"><div class="tab-item-content active" id="sam-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/09/27/65139179eac55.png" style="width:800px;"/></div></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;GENBANK&quot;&gt;&lt;a href=&quot;#GENBANK&quot; class=&quot;headerlink&quot; title=&quot;GENBANK&quot;&gt;&lt;/a&gt;GENBANK&lt;/h1&gt;&lt;div class=&quot;tabs&quot; id=&quot;genbank&quot;&gt;&lt;ul class=&quot;nav-tabs&quot;&gt;&lt;</summary>
      
    
    
    
    <category term="生物信息学" scheme="https://smileszh.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/"/>
    
    
    <category term="数据格式" scheme="https://smileszh.github.io/tags/%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>RNA-Seq</title>
    <link href="https://smileszh.github.io/posts/7acd0447.html"/>
    <id>https://smileszh.github.io/posts/7acd0447.html</id>
    <published>2023-06-29T08:00:00.000Z</published>
    <updated>2024-06-10T15:10:01.527Z</updated>
    
    <content type="html"><![CDATA[<h1 id="RNA-Seq指南"><a href="#RNA-Seq指南" class="headerlink" title="RNA-Seq指南"></a>RNA-Seq指南</h1><h2 id="RNA-Seq参考"><a href="#RNA-Seq参考" class="headerlink" title="RNA-Seq参考"></a>RNA-Seq参考</h2><h3 id="根据基因组进行量化"><a href="#根据基因组进行量化" class="headerlink" title="根据基因组进行量化"></a>根据基因组进行量化</h3><p>RNA-Seq根据基因组进行量化时，参考数据是基因组序列，基因组注释文件是基因组的注释信息，包括基因的位置、外显子的位置、基因的功能等信息。该方法将对齐文件与注释相交叉，以产生“计数”，然后过滤这些计数以保留统计上显著的结果。定量矩阵代表对齐与标记为转录本一部分的区间重叠（交集）的次数。</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2024/06/07/6662c38b4ccfa.png"/></div></div><p>在通过参考基因组和注释信息对读段进行映射，然后再进行表达量估算时候，又有两种不同的基因表达量分析方法。</p><ol><li><strong>基因水平分析</strong>：</li></ol><ul><li>这种分析方法把一个基因的所有转录本（即由基因的不同区域（外显子）组成的不同版本）视为一个整体。</li><li>在这种分析中，不区分各个不同的转录本，而是将它们合并为一个单一的序列，这个序列包括了该基因的所有外显子。</li><li>这个合并的序列被认为是“代表性”的，但它可能并不对应于任何实际存在的单一转录本，它更像是一个虚拟的总和。</li><li>对于某些研究目的而言，这种简化的方法足够用来获取有意义的数据，尤其是当研究的重点是基因整体活动水平时。</li></ul><ol><li><strong>转录本水平分析</strong>：</li></ol><ul><li>与基因水平分析不同，转录本水平分析关注于每个单独的转录本。</li><li>这种方法不会将不同的转录本合并，而是独立地测量每一个转录本的表达量。</li><li>这允许研究者观察到基因内部异构体（即同一基因的不同转录本版本）的丰度变化，这些变化可能对细胞功能和调控至关重要。</li></ul><h3 id="根据转录组进行分类"><a href="#根据转录组进行分类" class="headerlink" title="根据转录组进行分类"></a>根据转录组进行分类</h3><p>RNA-Seq根据转录组进行量化时，参考数据将是每个转录本的 FASTA 文件。分类将把每个读取分配给一个转录本，从而解决过程中的歧义。每个转录本的量化矩阵将表示读取被归类为该特定转录本的次数。</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2024/06/07/6662c3d560ec8.png"/></div></div><p>目前主流的能够实现基于分类的RNA-Seq工作的软件有：</p><ul><li><strong>Salmon</strong></li><li><strong>Kallisto</strong></li></ul><p>我们也能从参考基因组及注释文件中使用<code>gffread</code>工具生成转录组的FASTA文件。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">conda install gffread</span><br><span class="line"></span><br><span class="line"><span class="comment"># Extract the transcripts.</span></span><br><span class="line">gffread -w refs/transcripts.fa -g refs/22.fa refs/22.gtf</span><br></pre></td></tr></table></figure></p><h2 id="参考基因组"><a href="#参考基因组" class="headerlink" title="参考基因组"></a>参考基因组</h2><p>通常情况下，当我们下载一个参考基因组后，我们需要知道一些基本信息，比如基因组的大小、基因组的组成、基因组的注释信息等。这些信息对于我们后续的分析非常重要。</p><h3 id="参考基因组大小"><a href="#参考基因组大小" class="headerlink" title="参考基因组大小"></a>参考基因组大小</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seqkit stats *.fa</span><br></pre></td></tr></table></figure><p>输出：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file        format  <span class="built_in">type</span>  num_seqs        sum_len  min_len       avg_len      max_len</span><br><span class="line">genomic.fa  FASTA   DNA        194  3,099,750,718      970  15,978,096.5  248,956,422</span><br></pre></td></tr></table></figure><br>有194个序列（染色体+特定基因组序列标识符），总长度为3,099,750,718bp，最短序列为970bp，最长序列为248,956,422bp，平均序列长度为15,978,096.5bp。</p><h3 id="有多少个染色体"><a href="#有多少个染色体" class="headerlink" title="有多少个染色体"></a>有多少个染色体</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> *.fa | grep <span class="string">&quot;&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Ensemble GRCh38w为例，统计染色体数。（结果为22+X+Y+MT=25）</span></span><br><span class="line"><span class="built_in">cat</span> *.fa | grep <span class="string">&quot;&gt;*chromosome*&quot;</span> | <span class="built_in">wc</span> -l</span><br></pre></td></tr></table></figure><h3 id="每个染色体的长度"><a href="#每个染色体的长度" class="headerlink" title="每个染色体的长度"></a>每个染色体的长度</h3><p>可通过samtools faidx命令获取每个染色体的长度。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">samtools faidx *.fa</span><br><span class="line"><span class="built_in">cat</span> *.fa.fai</span><br></pre></td></tr></table></figure><br>输出：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1       248956422       56      60      61</span><br><span class="line">10      133797422       253105810       60      61</span><br><span class="line">11      135086622       389133248       60      61</span><br><span class="line">12      133275309       526471372       60      61</span><br><span class="line">13      114364328       661967995       60      61</span><br><span class="line">14      107043718       778238454       60      61</span><br><span class="line">15      101991189       887066292       60      61</span><br><span class="line">16      90338345        990757392       60      61</span><br><span class="line">17      83257441        1082601434      60      61</span><br><span class="line">18      80373285        1167246557      60      61</span><br><span class="line">···</span><br><span class="line">···</span><br></pre></td></tr></table></figure></p><p><code>第一行</code>：染色体名称。<br><code>第二行</code>：染色体长度，表示这个染色体的总长度。<br><code>第三行</code>：染色体的偏移量，这是染色体序列在FASTA文件中的起始字节位置。这意味着，如果你想定位到第10号染色体的序列开头，你需要从文件的开头跳过253,105,810个字节。<br><code>第四行</code>：每行序列的长度，<strong>60</strong>，这表示在FASTA文件中，每行表示的序列的字符数是60。这不包括行末的换行符。<br><code>第五行</code>：每行的长度，<strong>61</strong>，这个数字比序列的长度多1，说明每行的结束包括了一个换行符（通常是<code>\n</code>），所以每行的实际长度是61个字符。</p><h2 id="参考基因组注释文件"><a href="#参考基因组注释文件" class="headerlink" title="参考基因组注释文件"></a>参考基因组注释文件</h2><div class="tabs" id="注释文件"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="注释文件-1">参考基因组注释文件</button><button type="button" class="tab " data-href="注释文件-2">参考基因组注释遗传标记类型查看</button></ul><div class="tab-contents"><div class="tab-item-content active" id="注释文件-1"><p>参考基因组常见的注释文件格式有GTF（Gene Transfer Format）和 GFF（General Feature Format），两者都是文本格式的文件。这些文件包括了基因组上各种遗传标记的详细信息。<br>在RNA-Seq分析中，基因和转录本的注释通常是最核心的信息，因为它们直接关系到后续分析中的表达量计算和差异表达分析。基因级别的注释可以提供关于哪些基因在样本中被表达的信息，而转录本级别的注释则可以提供更细致的信息，比如不同的剪接变体。</p><p>然而，是否只需要基因和转录本的遗传标记信息取决于分析的具体目的：</p><ol><li><p><strong>基因表达定量</strong>: 如果只需要进行基因水平的表达量分析，那么基因的注释信息可能就足够了。</p></li><li><p><strong>转录本表达定量和剪接分析</strong>: 如果要进行转录本水平的表达分析或者分析剪接变异，就必须要有转录本以及外显子的详细注释信息。</p></li><li><p><strong>蛋白质编码分析</strong>: 如果分析涉及到蛋白质编码区域，例如寻找可能影响蛋白质结构的突变，那么编码序列（CDS）注释就很重要。</p></li><li><p><strong>UTR区域分析</strong>: 对于研究转录后调控，比如microRNA的靶向等，5’ UTR和3’ UTR的信息会很关键。</p></li><li><p><strong>调控元件分析</strong>: 如果研究的重点是基因的调控机制，那么启动子、增强子等调控元件的注释就显得非常重要。</p></li></ol></div><div class="tab-item-content" id="注释文件-2"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> *.gtf | grep -v <span class="string">&quot;#&quot;</span> | <span class="built_in">cut</span> -f3 | <span class="built_in">sort</span> | <span class="built_in">uniq</span> -c</span><br><span class="line"></span><br><span class="line">746300 CDS</span><br><span class="line">    120 Selenocysteine</span><br><span class="line">1261907 exon</span><br><span class="line"> 149893 five_prime_utr</span><br><span class="line">  58676 gene</span><br><span class="line">  86423 start_codon</span><br><span class="line">  78536 stop_codon</span><br><span class="line"> 148456 three_prime_utr</span><br><span class="line"> 206534 transcript</span><br></pre></td></tr></table></figure><ol><li><p><strong>CDS (Coding Sequence)</strong>: 编码序列是指基因组中编码蛋白质的部分，这个数字（746300）告诉我们在注释文件中有这么多的编码序列条目。</p></li><li><p><strong>Selenocysteine</strong>: 一种被称为“第21个氨基酸”的罕见氨基酸，它直接参与蛋白质的合成。这个数字（120）表明在注释文件中有120个编码selenocysteine的位点。</p></li><li><p><strong>Exon</strong>: 外显子是成熟mRNA中保留下来的那部分DNA序列，可以转录并翻译成蛋白质。这个数字（1261907）表示注释文件中有这么多外显子。</p></li><li><p><strong>Five_prime_utr (5’ UTR)</strong>: 5’非翻译区（Untranslated Region）是位于起始密码子之前的mRNA序列部分，它不编码蛋白质，但有助于调控翻译过程。这个数字（149893）表示文件中有这么多的5’ UTR条目。</p></li><li><p><strong>Gene</strong>: 基因是遗传的基本物理和功能单位，通常包含编码一个或多个蛋白质的序列。这个数字（58676）表示文件中有这么多基因。</p></li><li><p><strong>Start_codon</strong>: 起始密码子是一段特定的核苷酸序列，它在mRNA上标志着蛋白质合成的开始。这个数字（86423）显示了有这么多的起始密码子被注释。</p></li><li><p><strong>Stop_codon</strong>: 终止密码子是信号蛋白质合成结束的三个核苷酸序列之一。这个数字（78536）表示有这么多的终止密码子。</p></li><li><p><strong>Three_prime_utr (3’ UTR)</strong>: 3’非翻译区（Untranslated Region）是位于终止密码子之后的mRNA序列部分，它同样不编码蛋白质，但含有调控mRNA稳定性和翻译效率的重要元素。这个数字（148456）表示文件中有这么多的3’ UTR条目。</p></li><li><p><strong>Transcript</strong>: 转录物是指DNA序列通过转录过程生成的RNA副本，在这里特指那些最终会被翻译成蛋白质或者具有其他功能的RNA分子。这个数字（206534）表明有这么多的转录物记录在注释文件中。</p></li></ol></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="了解数据"><a href="#了解数据" class="headerlink" title="了解数据"></a>了解数据</h2><p>通常情况下RNA-Seq数据是由fastq文件组成，fastq文件包含了测序仪输出的原始测序数据，每个fastq文件包含了大量的reads，每个read都是一个碱基序列，同时还包含了测序质量信息。我们可以通过查看统计fastq文件来获取数据的一些信息。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 统计fastq文件</span></span><br><span class="line">seqkit stats *.fq</span><br></pre></td></tr></table></figure><p>输出：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">file               format  <span class="built_in">type</span>    num_seqs        sum_len  min_len  avg_len  max_len</span><br><span class="line">chip_HA_1_1.fq     FASTQ   DNA   40,478,593  2,023,929,650       50       50       50</span><br><span class="line">chip_HA_2_1.fq     FASTQ   DNA   37,248,768  1,862,438,400       50       50       50</span><br><span class="line">chip_HA_3_1.fq     FASTQ   DNA   28,160,024  1,408,001,200       50       50       50</span><br><span class="line">chip_input_1_1.fq  FASTQ   DNA   42,065,898  2,103,294,900       50       50       50</span><br><span class="line">chip_plau_1_1.fq   FASTQ   DNA   31,915,339  1,595,766,950       50       50       50</span><br><span class="line">chip_plau_2_1.fq   FASTQ   DNA   43,102,269  2,155,113,450       50       50       50</span><br><span class="line">chip_plau_3_1.fq   FASTQ   DNA   38,000,000  1,900,000,000       50       50       50</span><br></pre></td></tr></table></figure></p><h2 id="比对"><a href="#比对" class="headerlink" title="比对"></a>比对</h2><h3 id="构建索引"><a href="#构建索引" class="headerlink" title="构建索引"></a>构建索引</h3><p>当我们将数据和参考基因组进行比对时，首先需要准备参考基因组的索引文件，不同的参考基因组比对工具需要不同的索引文件，比如STAR需要的索引文件是STAR_index，而HISAT2需要的索引文件是HISAT2_index。<br>以Hisat2为例，我们可以通过以下命令构建索引文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The reference genome.</span></span><br><span class="line">REF=refs/*.fa</span><br><span class="line">GTF=refs/*.gtf</span><br><span class="line"></span><br><span class="line"><span class="comment"># Build the genome index.</span></span><br><span class="line">IDX=refs/genome</span><br><span class="line"></span><br><span class="line">hisat2_extract_splice_sites.py <span class="variable">$&#123;GTF&#125;</span> &gt; <span class="variable">$&#123;IDX&#125;</span>.ss</span><br><span class="line">hisat2_extract_exons.py <span class="variable">$&#123;GTF&#125;</span> &gt; <span class="variable">$&#123;IDX&#125;</span>.exon</span><br><span class="line"></span><br><span class="line">hisat2-build -p 16 --exon <span class="variable">$&#123;IDX&#125;</span>.exon --ss <span class="variable">$&#123;IDX&#125;</span>.ss <span class="variable">$&#123;REF&#125;</span> <span class="variable">$&#123;REF&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Index the reference genome with samtools.</span></span><br><span class="line">samtools faidx <span class="variable">$&#123;REF&#125;</span></span><br></pre></td></tr></table></figure></p><h3 id="比对-1"><a href="#比对-1" class="headerlink" title="比对"></a>比对</h3><div class="tabs" id="比对"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="比对-1">HISAT2比对</button><button type="button" class="tab " data-href="比对-2">HISAT比对率</button></ul><div class="tab-contents"><div class="tab-item-content active" id="比对-1"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create the include sample list file.</span></span><br><span class="line"><span class="built_in">ls</span> reads | <span class="built_in">cut</span> -d <span class="string">&#x27;_&#x27;</span> -f1,2 | <span class="built_in">sort</span> | <span class="built_in">uniq</span> &gt; ids.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># The index name.</span></span><br><span class="line">REF=refs/*.fa</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the BAM folder.</span></span><br><span class="line"><span class="built_in">mkdir</span> -p bam</span><br><span class="line"></span><br><span class="line"><span class="comment"># Align the FASTQ files to the reference genome.</span></span><br><span class="line"><span class="built_in">cat</span> ids.txt | parallel <span class="string">&quot;hisat2 -x <span class="variable">$&#123;REF&#125;</span> -1 reads/&#123;&#125;_R1.fq -2 reads/&#123;&#125;_R2.fq 2&gt;&gt; alignment_summary.txt | \</span></span><br><span class="line"><span class="string">samtools sort &gt; bam/&#123;&#125;.bam&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Index each BAM file.</span></span><br><span class="line"><span class="built_in">cat</span> ids.txt | parallel  <span class="string">&quot;samtools index bam/&#123;&#125;.bam&quot;</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="比对-2"><p><code>双端</code>比对信息解读：<br><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">10000 reads; of these:</span><br><span class="line">10000 (100.00%) were paired; of these:</span><br><span class="line">650 (6.50%) aligned concordantly 0 times</span><br><span class="line">8823 (88.23%) aligned concordantly exactly 1 time</span><br><span class="line">527 (5.27%) aligned concordantly &gt;1 times</span><br><span class="line">----</span><br><span class="line">650 pairs aligned concordantly 0 times; of these:</span><br><span class="line">34 (5.23%) aligned discordantly 1 time</span><br><span class="line">----</span><br><span class="line">616 pairs aligned 0 times concordantly or discordantly; of these:</span><br><span class="line">1232 mates make up the pairs; of these:</span><br><span class="line">660 (53.57%) aligned 0 times</span><br><span class="line">571 (46.35%) aligned exactly 1 time</span><br><span class="line">1 (0.08%) aligned &gt;1 times</span><br></pre></td></tr></table></figure></p><ul><li><p><strong>10000 reads; of these: 10000 (100.00%) were paired</strong>: 总共有10000个读段，所有这些读段都是成对的，意味着每个读段都有相应的配对读段。</p></li><li><p><strong>650 (6.50%) aligned concordantly 0 times</strong>: 有650对读段（占6.50%）没有一起成功比对到参考序列上。”一致比对”（concordantly）意味着两个读段以预期的相对方向和距离成功地比对到参考序列的同一个区域。</p></li><li><p><strong>8823 (88.23%) aligned concordantly exactly 1 time</strong>: 有8823对读段（占88.23%）一致地比对到参考序列的唯一位置一次。</p></li><li><p><strong>527 (5.27%) aligned concordantly &gt;1 times</strong>: 有527对读段（占5.27%）一致地比对到参考序列的多个位置。</p></li></ul><p>接下来的部分提供了关于没有一致比对的读段的更多细节：</p><ul><li><strong>650 pairs aligned concordantly 0 times; of these:</strong></li><li><p><strong>34 (5.23%) aligned discordantly 1 time</strong>: 在没有一致比对的650对读段中，有34对（占5.23%）以不一致的方式比对了一次。”不一致比对”（discordantly）意味着这些读段没有按照预期的相对方向或距离比对到参考序列的同一个区域，但仍然在某处找到了比对位置。</p></li><li><p><strong>616 pairs aligned 0 times concordantly or discordantly; of these:</strong></p></li><li><strong>1232 mates make up the pairs; of these:</strong></li><li><strong>660 (53.57%) aligned 0 times</strong>: 在这616对既没有一致比对也没有不一致比对的读段中，总共有1232个单独的读段，其中660个（占53.57%）没有比对到参考序列。</li><li><strong>571 (46.35%) aligned exactly 1 time</strong>: 有571个读段（占46.35%）比对到了参考序列的唯一位置一次。</li><li><strong>1 (0.08%) aligned &gt;1 times</strong>: 有1个读段（占0.08%）比对到了参考序列的多个位置。</li></ul><p>最后一行提供了总体的比对率：</p><ul><li><strong>96.70% overall alignment rate</strong>: 总体来说，96.70%的读段至少比对到了参考序列的一个位置。这个百分比是基于所有读段的，包括一致比对的、不一致比对的以及那些只有一个读段比对到参考序列的配对读段。</li></ul><p><code>单端</code>比对信息解读：<br><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">62364 reads; of these:</span><br><span class="line">62364 (100.00%) were unpaired; of these:</span><br><span class="line">19 (0.03%) aligned 0 times</span><br><span class="line">62311 (99.92%) aligned exactly 1 time</span><br><span class="line">34 (0.05%) aligned &gt;1 times</span><br></pre></td></tr></table></figure></p><ul><li><p><strong>62364 reads</strong>: 表示总共有62,364个读段(reads)被处理。读段是指从测序实验得到的短序列片段。</p></li><li><p><strong>of these: 62364 (100.00%) were unpaired</strong>: 所有的读段都是单端读段(unpaired)，意味着这些读段不是成对的。在配对端测序中，你通常会得到两个读段（即一对），它们是从同一个DNA片段的两端测序得到的。单端读段意味着每个片段只测序了一端。</p></li><li><p><strong>19 (0.03%) aligned 0 times</strong>: 在这些读段中，有19个（占总数的0.03%）没有比对到参考序列上。</p></li><li><p><strong>62311 (99.92%) aligned exactly 1 time</strong>: 62,311个读段（占总数的99.92%）精确地比对到参考序列上一次。这意味着这些读段在参考序列中有一个唯一的匹配位置。</p></li><li><p><strong>34 (0.05%) aligned &gt;1 times</strong>: 有34个读段（占总数的0.05%）比对到参考序列上多于一次。这表明这些读段可能来自基因组或转录组中重复区域，因此无法确定它们的精确位置。</p></li></ul></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h3 id="bam文件转换"><a href="#bam文件转换" class="headerlink" title="bam文件转换"></a>bam文件转换</h3><p>通常情况下，我们可以将bam文件直接在IGV等可视化软件中查看，但是有时候加载时间很长。当我们只是关注“覆盖率”时，我们可以将文件转换为<code>`bigwig</code>格式，这样加载速度会更快。在这个过程中我们需要将bam文件转换为bedgraph文件，然后再转换为bigwig文件。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The index name.</span></span><br><span class="line">REF = refs/genome.fa</span><br><span class="line"></span><br><span class="line"><span class="comment"># Turn each BAM file into bedGraph coverage. The files will have the .bg extension.</span></span><br><span class="line"><span class="built_in">cat</span> ids.txt | parallel <span class="string">&quot;bedtools genomecov -ibam  bam/&#123;&#125;.bam -split -bg  &gt; bam/&#123;&#125;.bg&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Convert each bedGraph coverage into bigWig coverage. The files will have the .bw extension.</span></span><br><span class="line"><span class="built_in">cat</span> ids.txt | parallel <span class="string">&quot;bedGraphToBigWig bam/&#123;&#125;.bg <span class="variable">$&#123;REF&#125;</span>.fai bam/&#123;&#125;.bw&quot;</span></span><br></pre></td></tr></table></figure><h2 id="计数"><a href="#计数" class="headerlink" title="计数"></a>计数</h2><div class="tabs" id="计数"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="计数-1">featureCounts</button><button type="button" class="tab " data-href="计数-2">featureCounts参数</button><button type="button" class="tab " data-href="计数-3">标准化计数矩阵</button></ul><div class="tab-contents"><div class="tab-item-content active" id="计数-1"><p>得到reads比对文件后，我们需要对比对文件进行计数，得到每个基因的表达量。这里我们可以使用featureCounts工具，featureCounts是Subread软件包的一部分，它可以用于计算基因或转录本的表达量。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GTF = refs/*.gtf</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> ids.txt | parallel -j 1 <span class="built_in">echo</span> <span class="string">&quot;bam/&#123;&#125;.bam&quot;</span> | \</span><br><span class="line">    xargs featureCounts -p  --countReadPairs -a <span class="variable">$&#123;GTF&#125;</span> -o counts.txt</span><br></pre></td></tr></table></figure><p>此时，<code>parallel</code>，命令参数<code>-j 1</code>是必不可少的，我们要确保命令按照文件中列出的顺序执行。每当顺序至关重要时，您必须使用 -j 1，否则，顺序就无法保证。当是双端测序的时候，我们可以设置<code>-p --countReadPairs</code>参数，这样可以计算每对reads的计数（非必选）。</p></div><div class="tab-item-content" id="计数-2"><p>当我们使用featureCounts时，我们会做出许多决定。除了前面提到的命令外，我们还可以使用其他参数来调整计数的方式。下面是一些常用的参数：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-t &lt;string&gt;         Specify feature <span class="built_in">type</span>(s) <span class="keyword">in</span> a GTF annotation. If multiple</span><br><span class="line">                      types are provided, they should be separated by <span class="string">&#x27;,&#x27;</span> with</span><br><span class="line">                      no space <span class="keyword">in</span> between. <span class="string">&#x27;exon&#x27;</span> by default. Rows <span class="keyword">in</span> the</span><br><span class="line">                      annotation with a matched feature will be extracted and</span><br><span class="line">                      used <span class="keyword">for</span> <span class="built_in">read</span> mapping. </span><br><span class="line"></span><br><span class="line">-g &lt;string&gt;         Specify attribute <span class="built_in">type</span> <span class="keyword">in</span> GTF annotation. <span class="string">&#x27;gene_id&#x27;</span> by </span><br><span class="line">                      default. Meta-features used <span class="keyword">for</span> <span class="built_in">read</span> counting will be </span><br><span class="line">                      extracted from annotation using the provided value.</span><br><span class="line"></span><br><span class="line">-T &lt;int&gt;            Number of the threads. 1 by default.</span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="计数-3"><p>生成的counts.txt文件包含了每个基因的表达量信息。可使用自定义脚本<code>format_featurecounts.r</code>来转化为更简单直接的counts数据。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Transform feature counts output to simple counts.</span></span><br><span class="line"><span class="comment"># Adds gene name to a featurecounts output file.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The design file must have a column named &quot;sample&quot;</span></span><br><span class="line">COUNTS_FILE <span class="operator">=</span> <span class="string">&quot;counts.txt&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># The output file name.</span></span><br><span class="line">OUTPUT_FILE<span class="operator">=</span> <span class="string">&quot;counts.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the file that contains transcript to gene mapping(for example: human). </span></span><br><span class="line"><span class="comment">## Lists all datasets available in Ensembl</span></span><br><span class="line"><span class="comment">## mart = useMart(&quot;ensembl&quot;, dataset = species_dataset)</span></span><br><span class="line"><span class="comment">## listDatasets(mart)</span></span><br><span class="line"><span class="comment">## Lists all attributes available in datasets</span></span><br><span class="line"><span class="comment">## listAttributes(mart)</span></span><br><span class="line"></span><br><span class="line">SPECIES_DATASET <span class="operator">=</span> <span class="string">&quot;hsapiens_gene_ensembl&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the required libraries.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span>require<span class="punctuation">(</span><span class="string">&quot;biomaRt&quot;</span><span class="punctuation">,</span> quietly <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  BiocManager<span class="operator">::</span>install<span class="punctuation">(</span><span class="string">&quot;biomaRt&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>biomaRt<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install the optparse package automatically.</span></span><br><span class="line"><span class="keyword">if</span><span class="punctuation">(</span><span class="operator">!</span>require<span class="punctuation">(</span>optparse<span class="punctuation">,</span> quietly<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  install.packages<span class="punctuation">(</span><span class="string">&quot;optparse&quot;</span><span class="punctuation">,</span> repos<span class="operator">=</span><span class="string">&quot;http://cran.us.r-project.org&quot;</span><span class="punctuation">)</span></span><br><span class="line">  library<span class="punctuation">(</span>optparse<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Command line options.</span></span><br><span class="line">option_list <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span></span><br><span class="line">  </span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-c&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--counts&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> action<span class="operator">=</span><span class="string">&quot;store&quot;</span><span class="punctuation">,</span> default<span class="operator">=</span>COUNTS_FILE<span class="punctuation">,</span> dest<span class="operator">=</span><span class="string">&quot;counts_file&quot;</span><span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">,</span></span><br><span class="line">              help<span class="operator">=</span><span class="string">&quot;input count file  [%default]&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  </span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-o&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--output_file&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> action<span class="operator">=</span><span class="string">&quot;store&quot;</span><span class="punctuation">,</span> default<span class="operator">=</span>OUTPUT_FILE<span class="punctuation">,</span> dest<span class="operator">=</span><span class="string">&quot;output_file&quot;</span><span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">,</span></span><br><span class="line">              help<span class="operator">=</span><span class="string">&quot;the design file for the samples [%default]&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  </span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-s&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--species_dataset&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> action<span class="operator">=</span><span class="string">&quot;store&quot;</span><span class="punctuation">,</span> default<span class="operator">=</span>SPECIES_DATASET<span class="punctuation">,</span> dest<span class="operator">=</span><span class="string">&quot;species_dataset&quot;</span><span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">,</span></span><br><span class="line">              help<span class="operator">=</span><span class="string">&quot;the transcript to gene mapping [%default]&quot;</span><span class="punctuation">)</span></span><br><span class="line">  </span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Parse the options.</span></span><br><span class="line">opt <span class="operator">=</span> parse_args<span class="punctuation">(</span>OptionParser<span class="punctuation">(</span>option_list<span class="operator">=</span>option_list<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the file that contains the counts.</span></span><br><span class="line">input_file <span class="operator">=</span> opt<span class="operator">$</span>counts_file</span><br><span class="line"></span><br><span class="line"><span class="comment"># The final result file.</span></span><br><span class="line">output_file <span class="operator">=</span> opt<span class="operator">$</span>output_file</span><br><span class="line"></span><br><span class="line"><span class="comment"># The species dataset to gene mapping file.</span></span><br><span class="line">species_dataset <span class="operator">=</span> opt<span class="operator">$</span>species_dataset</span><br><span class="line"></span><br><span class="line"><span class="comment"># Inform the user.</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Reformating featurecounts.\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Input:&quot;</span><span class="punctuation">,</span> input_file<span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Read the input data</span></span><br><span class="line">data <span class="operator">=</span> read.table<span class="punctuation">(</span>input_file<span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> check.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> header<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;\t&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove certain columns.</span></span><br><span class="line">data <span class="operator">=</span> subset<span class="punctuation">(</span>data<span class="punctuation">,</span> select <span class="operator">=</span> <span class="operator">-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove file related information from the column</span></span><br><span class="line">headers <span class="operator">=</span> sub<span class="punctuation">(</span><span class="string">&quot;\\.bam&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> colnames<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">headers <span class="operator">=</span> sub<span class="punctuation">(</span><span class="string">&quot;^(.*)/&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> headers<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Attach the new names</span></span><br><span class="line">colnames<span class="punctuation">(</span>data<span class="punctuation">)</span> <span class="operator">&lt;-</span> headers</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add columns with specific names</span></span><br><span class="line">data<span class="operator">$</span>name <span class="operator">=</span> data<span class="operator">$</span>Geneid</span><br><span class="line">data<span class="operator">$</span>gene <span class="operator">=</span> data<span class="operator">$</span>Geneid</span><br><span class="line"></span><br><span class="line">targets <span class="operator">=</span>  sub<span class="punctuation">(</span><span class="string">&quot;\\..*&quot;</span><span class="punctuation">,</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> data<span class="operator">$</span>name<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span>SPECIES_DATASET <span class="operator">!=</span> <span class="string">&#x27;&#x27;</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  cat<span class="punctuation">(</span><span class="string">&quot;# Species_dataset:&quot;</span><span class="punctuation">,</span> SPECIES_DATASET<span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># Read the transcript to gene mapping file.</span></span><br><span class="line">  mart <span class="operator">=</span> useMart<span class="punctuation">(</span><span class="string">&quot;ensembl&quot;</span><span class="punctuation">,</span> dataset <span class="operator">=</span> SPECIES_DATASET<span class="punctuation">)</span></span><br><span class="line">  tx2gene <span class="operator">=</span> getBM<span class="punctuation">(</span><span class="built_in">attributes</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;ensembl_gene_id&quot;</span><span class="punctuation">,</span> <span class="string">&quot;external_gene_name&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> mart <span class="operator">=</span> mart<span class="punctuation">)</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># Find the indices where the targets match to the mapping.</span></span><br><span class="line">  indices <span class="operator">=</span> match<span class="punctuation">(</span>targets<span class="punctuation">,</span> tx2gene<span class="operator">$</span>ensembl_gene_id<span class="punctuation">)</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment"># Add the gene name column.</span></span><br><span class="line">  data<span class="operator">$</span>gene <span class="operator">=</span> tx2gene<span class="operator">$</span>external_gene_name<span class="punctuation">[</span>indices<span class="punctuation">]</span></span><br><span class="line">  </span><br><span class="line">  data<span class="operator">$</span>gene<span class="punctuation">[</span><span class="built_in">is.na</span><span class="punctuation">(</span>data<span class="operator">$</span>gene<span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">=</span> targets<span class="punctuation">[</span><span class="built_in">is.na</span><span class="punctuation">(</span>data<span class="operator">$</span>gene<span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">  </span><br><span class="line">  data<span class="operator">$</span>gene<span class="punctuation">[</span>data<span class="operator">$</span>gene <span class="operator">==</span><span class="string">&quot;&quot;</span><span class="punctuation">]</span> <span class="operator">=</span> targets<span class="punctuation">[</span>data<span class="operator">$</span>gene <span class="operator">==</span><span class="string">&quot;&quot;</span><span class="punctuation">]</span></span><br><span class="line">  </span><br><span class="line"><span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">  data<span class="operator">$</span>gene <span class="operator">=</span> targets</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># List the desired column order.</span></span><br><span class="line">cols <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;name&quot;</span><span class="punctuation">,</span> <span class="string">&quot;gene&quot;</span><span class="punctuation">,</span> headers<span class="punctuation">[</span><span class="number">3</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>headers<span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Slice the data.</span></span><br><span class="line">out <span class="operator">=</span> data<span class="punctuation">[</span><span class="punctuation">,</span>cols<span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Save the  resulting summarized counts.</span></span><br><span class="line">write.csv<span class="punctuation">(</span>out<span class="punctuation">,</span> file<span class="operator">=</span>output_file<span class="punctuation">,</span>  row.names <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Output:&quot;</span><span class="punctuation">,</span> output_file<span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h2 id="差异表达分析"><a href="#差异表达分析" class="headerlink" title="差异表达分析"></a>差异表达分析</h2><div class="tabs" id="差异表达分析"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="差异表达分析-1">差异表达分析</button><button type="button" class="tab " data-href="差异表达分析-2">DESeq2</button></ul><div class="tab-contents"><div class="tab-item-content active" id="差异表达分析-1"><p>得到计数矩阵后我们就可以进行差异表达分析了，常用的差异表达分析工具有DESeq2、edgeR、limma等。</p><p>Limma基于线性模型，通过使用贝叶斯方法估计每个基因的差异方差。它使用经验贝叶斯方法来将信息从所有基因中借用，特别是在样本较少时提高估计的稳定性。<br>edgeR基于负二项分布模型。它使用贝叶斯方法通过适应组内变异估计提高估计的稳定性。edgeR考虑了基因的丰度和变异性，使其更适用于RNA-Seq数据。<br>DESeq2基于负二项分布的模型。它通过使用贝叶斯方法来考虑样本间的差异以及基因表达的离散性。</p></div><div class="tab-item-content" id="差异表达分析-2"><p>这里我们使用DESeq2进行差异表达分析，我们需要用到两个文件，一个是<code>counts.csv</code>，且是我们在上一步骤简化过的；另一个是<code>design.csv</code>，它包含了实验设计信息，一列是<code>sample</code>，一列是<code>group</code>，group是我们要比较的分组信息。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Differential expression analysis with the DESeq2 package.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># https://bioconductor.org/packages/release/bioc/html/DESeq2.html</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Command line install: mamba install bioconductor-deseq2</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">DESIGN_FILE <span class="operator">=</span> <span class="string">&quot;design.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the file that contains the counts.</span></span><br><span class="line">COUNTS_FILE <span class="operator">=</span> <span class="string">&quot;counts.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The output file.</span></span><br><span class="line">OUTPUT_FILE <span class="operator">=</span> <span class="string">&quot;deseq2.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install the optparse package automatically.</span></span><br><span class="line"><span class="keyword">if</span><span class="punctuation">(</span><span class="operator">!</span>require<span class="punctuation">(</span>optparse<span class="punctuation">,</span> quietly<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  install.packages<span class="punctuation">(</span><span class="string">&quot;optparse&quot;</span><span class="punctuation">,</span> repos<span class="operator">=</span><span class="string">&quot;http://cran.us.r-project.org&quot;</span><span class="punctuation">)</span></span><br><span class="line">  library<span class="punctuation">(</span>optparse<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Command line options.</span></span><br><span class="line">option_list <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span> </span><br><span class="line">  </span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-d&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--design_file&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> action<span class="operator">=</span><span class="string">&quot;store&quot;</span><span class="punctuation">,</span> default<span class="operator">=</span>DESIGN_FILE<span class="punctuation">,</span> dest<span class="operator">=</span><span class="string">&quot;design_file&quot;</span><span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">,</span></span><br><span class="line">              help<span class="operator">=</span><span class="string">&quot;the design file for the samples [%default]&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  </span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-c&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--counts&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> action<span class="operator">=</span><span class="string">&quot;store&quot;</span><span class="punctuation">,</span> default<span class="operator">=</span>COUNTS_FILE<span class="punctuation">,</span> dest<span class="operator">=</span><span class="string">&quot;counts_file&quot;</span><span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">,</span></span><br><span class="line">              help<span class="operator">=</span><span class="string">&quot;input counts file  [%default]&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  </span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-o&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--out&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> action<span class="operator">=</span><span class="string">&quot;store&quot;</span><span class="punctuation">,</span> default<span class="operator">=</span>OUTPUT_FILE<span class="punctuation">,</span> dest<span class="operator">=</span><span class="string">&quot;output_file&quot;</span><span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">,</span></span><br><span class="line">              help<span class="operator">=</span><span class="string">&quot;the  results file  [%default]&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  </span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-f&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--factor_name&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> action<span class="operator">=</span><span class="string">&quot;store&quot;</span><span class="punctuation">,</span> default<span class="operator">=</span><span class="string">&quot;group&quot;</span><span class="punctuation">,</span> dest<span class="operator">=</span><span class="string">&quot;factor_name&quot;</span><span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">,</span></span><br><span class="line">              help<span class="operator">=</span><span class="string">&quot;the factor column name in the design file [%default]&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  </span><br><span class="line">  make_option<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;-s&quot;</span><span class="punctuation">,</span> <span class="string">&quot;--sample_name&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> action<span class="operator">=</span><span class="string">&quot;store&quot;</span><span class="punctuation">,</span> default<span class="operator">=</span><span class="string">&quot;sample&quot;</span><span class="punctuation">,</span> dest<span class="operator">=</span><span class="string">&quot;sample_name&quot;</span><span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&#x27;character&#x27;</span><span class="punctuation">,</span></span><br><span class="line">              help<span class="operator">=</span><span class="string">&quot;the sample column name in the design file [%default]&quot;</span><span class="punctuation">)</span></span><br><span class="line">  </span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Parse the options.</span></span><br><span class="line">opt <span class="operator">=</span> parse_args<span class="punctuation">(</span>OptionParser<span class="punctuation">(</span>option_list<span class="operator">=</span>option_list<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the file that contains the counts.</span></span><br><span class="line">counts_file <span class="operator">=</span> opt<span class="operator">$</span>counts_file</span><br><span class="line"></span><br><span class="line"><span class="comment"># The sample file is in CSV format and must have the headers &quot;sample&quot; and &quot;condition&quot;.</span></span><br><span class="line">design_file <span class="operator">=</span> opt<span class="operator">$</span>design_file</span><br><span class="line"></span><br><span class="line"><span class="comment"># The output file.</span></span><br><span class="line">output_file <span class="operator">=</span> opt<span class="operator">$</span>output_file</span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the factor column</span></span><br><span class="line">factor_name <span class="operator">=</span> opt<span class="operator">$</span>factor_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the sample column</span></span><br><span class="line">sample_name <span class="operator">=</span> opt<span class="operator">$</span>sample_name</span><br><span class="line"></span><br><span class="line"><span class="comment"># Inform the user.</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Running DESeq2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Design:&quot;</span><span class="punctuation">,</span> design_file<span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Counts:&quot;</span><span class="punctuation">,</span> counts_file<span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Read the design file.</span></span><br><span class="line">inp <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span>design_file<span class="punctuation">,</span> strip.white <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check the sample column name.</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Sample column:&quot;</span><span class="punctuation">,</span> sample_name<span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span>sample_name <span class="operator">%in%</span> colnames<span class="punctuation">(</span>inp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  stop<span class="punctuation">(</span><span class="string">&quot;# Sample column: &quot;</span><span class="punctuation">,</span> sample_name<span class="punctuation">,</span> <span class="string">&quot; not found in design file (use -s).&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Check the factor column name.</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Factor column:&quot;</span><span class="punctuation">,</span> factor_name<span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span>factor_name <span class="operator">%in%</span> colnames<span class="punctuation">(</span>inp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  stop<span class="punctuation">(</span><span class="string">&quot;# Factor column: &quot;</span><span class="punctuation">,</span> factor_name<span class="punctuation">,</span> <span class="string">&quot; not found in design file (use -f).&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new data frame to work with.</span></span><br><span class="line">df <span class="operator">=</span> data.frame<span class="punctuation">(</span></span><br><span class="line">  sample <span class="operator">=</span> inp<span class="punctuation">[</span><span class="punctuation">,</span> sample_name<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  groups <span class="operator">=</span> inp<span class="punctuation">[</span><span class="punctuation">,</span> factor_name<span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The default groups come from the design</span></span><br><span class="line">groups <span class="operator">=</span> unique<span class="punctuation">(</span>df<span class="operator">$</span>group<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a new data frame to work with.</span></span><br><span class="line">df <span class="operator">=</span> data.frame<span class="punctuation">(</span></span><br><span class="line">  sample <span class="operator">=</span> inp<span class="punctuation">[</span><span class="punctuation">,</span> sample_name<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  groups <span class="operator">=</span> inp<span class="punctuation">[</span><span class="punctuation">,</span> factor_name<span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The default groups come from the design</span></span><br><span class="line">groups <span class="operator">=</span> unique<span class="punctuation">(</span>df<span class="operator">$</span>groups <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Print information on the groups</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>grp <span class="keyword">in</span> groups<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  n_grp <span class="operator">&lt;-</span> <span class="built_in">sum</span><span class="punctuation">(</span>df<span class="operator">$</span>groups <span class="operator">==</span> grp<span class="punctuation">)</span></span><br><span class="line">  cat<span class="punctuation">(</span><span class="string">&quot;# Group&quot;</span><span class="punctuation">,</span> grp<span class="punctuation">,</span> <span class="string">&quot;has&quot;</span><span class="punctuation">,</span> n_grp<span class="punctuation">,</span> <span class="string">&quot;samples.\n&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Turn conditions into factors.</span></span><br><span class="line">df<span class="operator">$</span>group <span class="operator">=</span> factor<span class="punctuation">(</span>df<span class="operator">$</span>group<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The first level should correspond to the first entry in the file</span></span><br><span class="line"><span class="comment"># Required later when building a model.</span></span><br><span class="line">df<span class="operator">$</span>group <span class="operator">=</span> relevel<span class="punctuation">(</span>df<span class="operator">$</span>group<span class="punctuation">,</span> toString<span class="punctuation">(</span>df<span class="operator">$</span>group<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Isolate the sample names.</span></span><br><span class="line">sample_names <span class="operator">=</span> df<span class="operator">$</span>sample</span><br><span class="line"></span><br><span class="line"><span class="comment"># Read the data from input file.</span></span><br><span class="line">count_df <span class="operator">=</span> read.csv<span class="punctuation">(</span>counts_file<span class="punctuation">,</span> strip.white <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Created rounded integers for the count data</span></span><br><span class="line">count_data <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>count_df<span class="punctuation">[</span><span class="punctuation">,</span> sample_names<span class="punctuation">,</span> drop<span class="operator">=</span><span class="built_in">F</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Column names should be carried over. Skip sample names and FDR</span></span><br><span class="line">other_cols <span class="operator">=</span> <span class="built_in">names</span><span class="punctuation">(</span>count_df<span class="punctuation">)</span><span class="punctuation">[</span><span class="operator">!</span><span class="built_in">names</span><span class="punctuation">(</span>count_df<span class="punctuation">)</span> <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span>sample_names<span class="punctuation">,</span> <span class="string">&quot;FDR&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Carry over all additional columns not in sample names.</span></span><br><span class="line">row_data <span class="operator">=</span> count_df<span class="punctuation">[</span><span class="punctuation">,</span> other_cols<span class="punctuation">,</span> drop<span class="operator">=</span><span class="built_in">F</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Running DESeq2</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Bioconductor packages used in the script.</span></span><br><span class="line">bio.p <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;DESeq2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tibble&quot;</span><span class="punctuation">,</span> <span class="string">&quot;dplyr&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tools&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load Bioconductor packages</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Initializing &quot;</span><span class="punctuation">,</span> bio.p<span class="punctuation">,</span> <span class="string">&quot;...&quot;</span><span class="punctuation">)</span></span><br><span class="line">status <span class="operator">=</span> suppressPackageStartupMessages<span class="punctuation">(</span></span><br><span class="line">  lapply<span class="punctuation">(</span>bio.p<span class="punctuation">,</span> library<span class="punctuation">,</span> character.only <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot; done\n&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create DESEq2 dataset.</span></span><br><span class="line">dds <span class="operator">=</span> DESeqDataSetFromMatrix<span class="punctuation">(</span></span><br><span class="line">  countData <span class="operator">=</span> count_data<span class="punctuation">,</span></span><br><span class="line">  rowData <span class="operator">=</span> row_data<span class="punctuation">,</span></span><br><span class="line">  colData <span class="operator">=</span> df<span class="punctuation">,</span></span><br><span class="line">  design <span class="operator">=</span> <span class="operator">~</span>group</span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Number of rows before</span></span><br><span class="line">n_start <span class="operator">=</span> nrow<span class="punctuation">(</span>dds<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove rows with no counts</span></span><br><span class="line">keep <span class="operator">&lt;-</span> rowSums<span class="punctuation">(</span>counts<span class="punctuation">(</span>dds<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">&gt;</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># At least 3 samples with a count of 10 or higher</span></span><br><span class="line"><span class="comment"># keep &lt;- rowSums(counts(dds) &gt;= 10) &gt;= 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Apply the filtering</span></span><br><span class="line">dds <span class="operator">&lt;-</span> dds<span class="punctuation">[</span>keep<span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Run deseq</span></span><br><span class="line">dds <span class="operator">=</span> DESeq<span class="punctuation">(</span>dds<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the normalized counts.</span></span><br><span class="line">normed <span class="operator">=</span> counts<span class="punctuation">(</span>dds<span class="punctuation">,</span> normalized<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Round normalized counts to a single digit.</span></span><br><span class="line">normed <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>normed<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Format the results.</span></span><br><span class="line">res <span class="operator">=</span> results<span class="punctuation">(</span>dds<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The rest of the code is about formatting the output dataframe.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The first columns that carry over from the input.</span></span><br><span class="line">start <span class="operator">=</span>  dplyr<span class="operator">::</span>as_tibble<span class="punctuation">(</span>rowData<span class="punctuation">(</span>dds<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="punctuation">,</span> other_cols<span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The main tibble</span></span><br><span class="line">data <span class="operator">=</span> bind_cols<span class="punctuation">(</span>start<span class="punctuation">,</span> as_tibble<span class="punctuation">(</span>res<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the foldChange column.</span></span><br><span class="line">data<span class="operator">$</span>foldChange <span class="operator">=</span> <span class="number">2</span> <span class="operator">^</span> data<span class="operator">$</span>log2FoldChange</span><br><span class="line"></span><br><span class="line"><span class="comment"># Rename the columns.</span></span><br><span class="line">data <span class="operator">=</span>  dplyr<span class="operator">::</span>rename<span class="punctuation">(</span>data<span class="punctuation">,</span> PValue<span class="operator">=</span>pvalue<span class="punctuation">,</span> FDR<span class="operator">=</span>padj<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set all NA values to 1.</span></span><br><span class="line">data<span class="operator">$</span>FDR<span class="punctuation">[</span><span class="built_in">is.na</span><span class="punctuation">(</span>data<span class="operator">$</span>FDR<span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a real adjusted pvalue</span></span><br><span class="line">data<span class="operator">$</span>PAdj <span class="operator">=</span> p.adjust<span class="punctuation">(</span>data<span class="operator">$</span>PValue<span class="punctuation">,</span> method<span class="operator">=</span><span class="string">&quot;hochberg&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the additional columns that we wish to present.</span></span><br><span class="line">data<span class="operator">$</span>baseMeanA <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">data<span class="operator">$</span>baseMeanB <span class="operator">=</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Combine the normed matrix with the results</span></span><br><span class="line">total <span class="operator">&lt;-</span> bind_cols<span class="punctuation">(</span>data<span class="punctuation">,</span> normed<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Sort again by P-value.</span></span><br><span class="line">total <span class="operator">=</span> arrange<span class="punctuation">(</span>total<span class="punctuation">,</span> FDR<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Compute the false discovery counts on the sorted table.</span></span><br><span class="line">total<span class="operator">$</span>falsePos <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span>nrow<span class="punctuation">(</span>total<span class="punctuation">)</span> <span class="operator">*</span> total<span class="operator">$</span>FDR</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sample names for condition A and B</span></span><br><span class="line">col_names_A <span class="operator">&lt;-</span> sample_names <span class="punctuation">[</span>df<span class="operator">$</span>group <span class="operator">==</span> groups<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">col_names_B <span class="operator">&lt;-</span> sample_names <span class="punctuation">[</span>df<span class="operator">$</span>group <span class="operator">==</span> groups<span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#col_names_A = unlist(df %&gt;% filter(group==groups[1]) %&gt;% select(sample))</span></span><br><span class="line"><span class="comment">#col_names_B = unlist(df %&gt;% filter(group==groups[2]) %&gt;% select(sample))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the individual baseMean columns.</span></span><br><span class="line">total<span class="operator">$</span>baseMeanA <span class="operator">=</span> rowMeans<span class="punctuation">(</span>total<span class="punctuation">[</span><span class="punctuation">,</span> col_names_A<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>baseMeanB <span class="operator">=</span> rowMeans<span class="punctuation">(</span>total<span class="punctuation">[</span><span class="punctuation">,</span> col_names_B<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Bringing some sanity to numbers. Round columns to fewer digits.</span></span><br><span class="line">total<span class="operator">$</span>foldChange <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>foldChange<span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>log2FoldChange <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>log2FoldChange<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>baseMean  <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>baseMean<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>baseMeanA <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>baseMeanA<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>baseMeanB <span class="operator">=</span>  <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>baseMeanB<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>lfcSE <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>lfcSE<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>stat <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>stat<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>FDR <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>FDR<span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>falsePos <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>total<span class="operator">$</span>falsePos<span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Reorganize columns names to make more sense.</span></span><br><span class="line">new_cols <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>other_cols<span class="punctuation">,</span> </span><br><span class="line">             <span class="string">&quot;baseMean&quot;</span><span class="punctuation">,</span><span class="string">&quot;baseMeanA&quot;</span><span class="punctuation">,</span><span class="string">&quot;baseMeanB&quot;</span><span class="punctuation">,</span></span><br><span class="line">             <span class="string">&quot;foldChange&quot;</span><span class="punctuation">,</span> <span class="string">&quot;log2FoldChange&quot;</span><span class="punctuation">,</span></span><br><span class="line">             <span class="string">&quot;lfcSE&quot;</span><span class="punctuation">,</span><span class="string">&quot;stat&quot;</span><span class="punctuation">,</span><span class="string">&quot;PValue&quot;</span><span class="punctuation">,</span><span class="string">&quot;PAdj&quot;</span><span class="punctuation">,</span> </span><br><span class="line">             <span class="string">&quot;FDR&quot;</span><span class="punctuation">,</span><span class="string">&quot;falsePos&quot;</span><span class="punctuation">,</span> col_names_A<span class="punctuation">,</span> col_names_B<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Slice the dataframe with new columns.</span></span><br><span class="line">total <span class="operator">=</span> total<span class="punctuation">[</span><span class="punctuation">,</span> new_cols<span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Count the number of significant results.</span></span><br><span class="line">n_total <span class="operator">=</span> nrow<span class="punctuation">(</span>total<span class="punctuation">)</span></span><br><span class="line">fdr_count <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">(</span>total<span class="operator">$</span>FDR <span class="operator">&lt;</span> <span class="number">0.05</span><span class="punctuation">,</span> na.rm<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">fdr_frac <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>fdr_count<span class="operator">/</span>n_total<span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line">pval_count <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">(</span>total<span class="operator">$</span>PValue <span class="operator">&lt;</span> <span class="number">0.05</span><span class="punctuation">,</span> na.rm<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">pval_frac <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>pval_count<span class="operator">/</span>n_total<span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span> <span class="operator">*</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Reformat these columns as string.</span></span><br><span class="line">total<span class="operator">$</span>PAdj <span class="operator">=</span> formatC<span class="punctuation">(</span>total<span class="operator">$</span>PAdj<span class="punctuation">,</span> format <span class="operator">=</span> <span class="string">&quot;e&quot;</span><span class="punctuation">,</span> digits <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">total<span class="operator">$</span>PValue <span class="operator">=</span> formatC<span class="punctuation">(</span>total<span class="operator">$</span>PValue<span class="punctuation">,</span> format <span class="operator">=</span> <span class="string">&quot;e&quot;</span><span class="punctuation">,</span> digits <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Write the results to the standard output.</span></span><br><span class="line">write.csv<span class="punctuation">(</span>total<span class="punctuation">,</span> file<span class="operator">=</span>output_file<span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Inform the user.</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Input:&quot;</span><span class="punctuation">,</span> n_start<span class="punctuation">,</span> <span class="string">&quot;rows\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Removed:&quot;</span><span class="punctuation">,</span> n_start<span class="operator">-</span>n_total<span class="punctuation">,</span> <span class="string">&quot;rows\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Fitted:&quot;</span><span class="punctuation">,</span> n_total<span class="punctuation">,</span> <span class="string">&quot;rows\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Significant PVal:&quot;</span><span class="punctuation">,</span> pval_count<span class="punctuation">,</span> <span class="string">&quot;(&quot;</span><span class="punctuation">,</span> pval_frac<span class="punctuation">,</span> <span class="string">&quot;%)\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Significant FDRs:&quot;</span><span class="punctuation">,</span> fdr_count<span class="punctuation">,</span> <span class="string">&quot;(&quot;</span><span class="punctuation">,</span> fdr_frac<span class="punctuation">,</span> <span class="string">&quot;%)\n&quot;</span><span class="punctuation">)</span></span><br><span class="line">cat<span class="punctuation">(</span><span class="string">&quot;# Results:&quot;</span><span class="punctuation">,</span> output_file<span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div> <h1 id="RNA-Seq分析所遇问题"><a href="#RNA-Seq分析所遇问题" class="headerlink" title="RNA-Seq分析所遇问题"></a>RNA-Seq分析所遇问题</h1><h2 id="比对问题"><a href="#比对问题" class="headerlink" title="比对问题"></a>比对问题</h2><p>编码序列的GC含量（指基因序列中鸟嘌呤（G）和胞嘧啶（C）的比例）通常高于整个基因组的平均GC含量。这是因为编码序列往往需要维持一定的稳定性，GC对之间的氢键比AT对更多，增加了DNA双螺旋的稳定性。在基因组测序和比对分析中，如果一个区域的GC含量远离平均水平，不管是偏高还是偏低，都可能导致测序和分析上的偏差。例如，高GC含量的区域可能因为PCR扩增偏好性或测序平台的偏好性而过度表示。此外，极端的GC含量可能影响测序读段的比对，因为这样的区域在基因组中可能不是唯一的，或者比对算法在处理这些区域时可能不够准确。</p><p>查看序列GC含量：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看序列GC含量</span></span><br><span class="line"><span class="built_in">cat</span> *.fa | seqkit <span class="built_in">seq</span> -s | geecee --filter</span><br><span class="line">samtools faidx *.fa 1 |seqkit <span class="built_in">seq</span> -s | geecee --filter</span><br><span class="line"><span class="built_in">cat</span> *.fq | seqkit <span class="built_in">seq</span> -s | geecee --filter</span><br></pre></td></tr></table></figure></p><p>特别的，当我们发现RNA-Seq数据比对出现长内含子区域时，可能就是由于参考序列中较长的仅有<code>T</code>组成造成的，在HISAT2中，我们可以使用<code>--max-intronlen</code>参数来调整最大内含子长度，以提高比对正确率。经典的内含子长度为500bp，我们可以将这个数值设置为2500.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Make a directory for the bam file.</span></span><br><span class="line"><span class="built_in">mkdir</span> -p bam</span><br><span class="line"></span><br><span class="line"><span class="comment"># Run the hisat aligner for each sample.</span></span><br><span class="line"><span class="built_in">cat</span> ids | parallel <span class="string">&quot;hisat2 --max-intronlen 2500 -x <span class="variable">$IDX</span> -U reads/&#123;&#125;.fq  | samtools sort &gt; bam/&#123;&#125;.bam&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a bam index for each file.</span></span><br><span class="line"><span class="built_in">cat</span> ids | parallel samtools index bam/&#123;&#125;.bam</span><br></pre></td></tr></table></figure></p><h2 id="计数问题"><a href="#计数问题" class="headerlink" title="计数问题"></a>计数问题</h2><p>  在使用featureCount时，默认使用exon进行计数，通常有两种策略，一种是在基因水平分析，一种是在转录本水平分析。在基因水平分析时，外显子只会被计数一次，而在转录本水平时，外显子可能出现在多个转录本中，如果简单的每个外显子计数一次，可能会导致计数的重复，导致从贡献度被过度估计。为了解决这个问题，需要一个过程来确定每个外显子对每个转录本的贡献比例。这个过程称为“解卷积”（deconvolution）。解卷积的目的是分配每个外显子的表达量，确保即使一个外显子在多个转录本中出现，它的总贡献也只被计算一次。解卷积通常涉及到数学和统计方法，可以基于转录本的预期丰度或其他生物信息学数据来估计每个外显子的相对贡献。<br>  一般情况下，建议使用featureCounts进行基因水平分析，使用基于分类/伪比对的方法如kallisto和salmon等工具进行转录水平分析。</p><h2 id="链特异性问题"><a href="#链特异性问题" class="headerlink" title="链特异性问题"></a>链特异性问题</h2><p>  RNA-Seq 文库类型的选择决定了测序的读取方向和 cDNA 链的测序顺序，这意味着来自不同文库类型的 RNA-Seq 读取可能存在显著差异。有关文库类型的信息对于将读取组装成转录组或映射到参考组装非常有用。这是因为文库类型可以帮助通过读取的相对方向和从哪条链测序来帮助辨别转录组中较短的模糊读取属于哪里。不幸的是，有关所用文库类型的信息未包含在测序输出文件中，并且可能在数据组装之前丢失。即使使用来自公共存储库的 RNA-Seq 数据，也不能保证文库类型信息是正确的或根本不存在。<br>  在成对端测序中，每对测序读取包括一个正向（forward）和一个反向（reverse）组分。这些读取对应于 DNA 片段的两端，通常用于提高测序的覆盖率和准确性。然而，当数据是成对的且有方向性时，理解每个读取是如何对应于参考基因组或转录本的变得更加复杂。在有方向性的成对端对齐中，通常第一对中的读取（first in pair）会与反义链（antisense strand）对齐，而第二对中的读取（second in pair）则会与正义链（sense strand）对齐。例如，如果 DNA 来自于反向链（reverse strand）上的一个转录本，那么第一对中的读取会对齐到正向链（forward strand）上，并且会在参考序列上向左移动（leftward shift）；第二对中的读取会对齐到反向链，并且相对于片段会向右移动（rightward shift）。虽然这听起来“简单”，实际上却不是这样。在测序数据的方向性问题上存在很多混淆和误解，以至于有专门的软件工具，例如“<a href="https://github.com/NBISweden/GUESSmyLT">Guess My Library Type</a>”，来帮助研究人员弄清楚他们的数据是否有方向性，以及是哪种类型的方向性。</p><p>  在一些软件中，有参数可以用来指定来链的<a href="https://github.com/igordot/genomics/blob/master/notes/rna-seq-strand.md">方向</a>。</p><h2 id="转录完整性"><a href="#转录完整性" class="headerlink" title="转录完整性"></a>转录完整性</h2><h1 id="RNA-Seq分析流程"><a href="#RNA-Seq分析流程" class="headerlink" title="RNA-Seq分析流程"></a>RNA-Seq分析流程</h1><p><img src="https://bu.dusays.com/2023/06/29/649ce4ac2c1fe.png" alt="分析流程.png"></p><div class="tabs" id="分析流程"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="分析流程-1">比对和组装</button><button type="button" class="tab " data-href="分析流程-2">定量和标准化</button><button type="button" class="tab " data-href="分析流程-3">差异分析</button></ul><div class="tab-contents"><div class="tab-item-content active" id="分析流程-1"><p><img src="https://bu.dusays.com/2023/06/29/649ce8628dc1e.png" alt="比对和组装.png"></p></div><div class="tab-item-content" id="分析流程-2"><p><img src="https://bu.dusays.com/2023/06/29/649ce991c1407.png" alt="定量和标准化.png"></p></div><div class="tab-item-content" id="分析流程-3"><p><strong><a href="https://www.smileszh.cn/posts/1085fed1.html">差异分析</a></strong></p><p><img src="https://bu.dusays.com/2023/06/29/649cea75e840e.png" alt="差异分析.png"></p><p><img src="https://bu.dusays.com/2023/06/29/649d900223506.png" alt="基因过滤.png"></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="基因表达量数据类型"><a href="#基因表达量数据类型" class="headerlink" title="基因表达量数据类型"></a>基因表达量数据类型</h1><div class="tabs" id="数据类型"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="数据类型-1">Counts</button><button type="button" class="tab " data-href="数据类型-2">RPM/CPM</button><button type="button" class="tab " data-href="数据类型-3">RPKM</button><button type="button" class="tab " data-href="数据类型-4">FPKM/FPKM-UQ</button><button type="button" class="tab " data-href="数据类型-5">TPM</button></ul><div class="tab-contents"><div class="tab-item-content active" id="数据类型-1"><p><img src="https://bu.dusays.com/2023/06/30/649e3cab4acae.png" alt="Counts.png"></p></div><div class="tab-item-content" id="数据类型-2"><p><img src="https://bu.dusays.com/2023/06/30/649e3d78cb226.png" alt="RPM.png"></p></div><div class="tab-item-content" id="数据类型-3"><p><img src="https://bu.dusays.com/2023/06/30/649e3db0533fb.png" alt="RPKM.png"></p></div><div class="tab-item-content" id="数据类型-4"><p><img src="https://bu.dusays.com/2023/06/30/649e3ea1474b5.png" alt="FPKM:FPKM-UQ.png"></p></div><div class="tab-item-content" id="数据类型-5"><p><img src="https://bu.dusays.com/2023/06/30/649e3efc298af.png" alt="TPM.png"></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="基因表达量数据转换"><a href="#基因表达量数据转换" class="headerlink" title="基因表达量数据转换"></a>基因表达量数据转换</h1><ul><li>原始Counts数据</li><li>基因长度信息（外显子长度之和）</li><li>如按照protein-coding基因计算mapped reads计算，还需提供基因的分类信息</li></ul><p><img src="https://bu.dusays.com/2023/06/30/649e40f51a9cd.png" alt="基因表达量数据转换.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;RNA-Seq指南&quot;&gt;&lt;a href=&quot;#RNA-Seq指南&quot; class=&quot;headerlink&quot; title=&quot;RNA-Seq指南&quot;&gt;&lt;/a&gt;RNA-Seq指南&lt;/h1&gt;&lt;h2 id=&quot;RNA-Seq参考&quot;&gt;&lt;a href=&quot;#RNA-Seq参考&quot; class</summary>
      
    
    
    
    <category term="生物信息学" scheme="https://smileszh.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/"/>
    
    
    <category term="转录组" scheme="https://smileszh.github.io/tags/%E8%BD%AC%E5%BD%95%E7%BB%84/"/>
    
  </entry>
  
  <entry>
    <title>疑惑当铺</title>
    <link href="https://smileszh.github.io/posts/53f493a2.html"/>
    <id>https://smileszh.github.io/posts/53f493a2.html</id>
    <published>2023-06-28T14:00:00.000Z</published>
    <updated>2024-05-15T02:52:36.936Z</updated>
    
    <content type="html"><![CDATA[<ul><li>什么是有义链/反义链(sense/antisense)？<blockquote><p>有义链是与mRNA具有相同序列的DNA链，又称<strong>编码链</strong>、<strong>有意义链</strong>。在转录过程中以反义链为模版，翻译成蛋白质。</p></blockquote></li></ul><ul><li><p>什么是正链(forward stand; Plus strand)/负链(reverse strand; minus strand)?</p><blockquote><p>人为规定的一条链，DNA的一条链被认为是正链，另一条链就是负链。</p></blockquote></li><li><p>基因结构是什么样的？</p><blockquote><p>转自<a href="https://zhuanlan.zhihu.com/p/49601643">知乎</a></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/07/18/64b64c767db31.jpeg" style="width:600px;"/></div></div></blockquote></li><li><p>核苷酸的歧义代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Y     Pyrimidine (C or T) </span><br><span class="line">R     Purine (A or G) </span><br><span class="line">W     Weak (A or T)</span><br><span class="line">S     Strong (G or C) </span><br><span class="line">K     Keto (T or G) </span><br><span class="line">M     Amino (C or A)     </span><br><span class="line">D     A, G, T (not C - remember as after C)</span><br><span class="line">V     A, C, G (not T - remember as after T/U - We&#x27;ll get to &quot;U&quot; soon) </span><br><span class="line">H     A, C, T (not G - remember as after G)</span><br><span class="line">B     C, G, T (not A - remember as after A)</span><br><span class="line">N     Any base</span><br><span class="line">-     Gap  </span><br></pre></td></tr></table></figure></li><li><p>RNA-Seq标准化：CPM、RPKM/FPKM、TPM</p><blockquote><p>转自<a href="https://mp.weixin.qq.com/s/5mCWL5IveQreNkpo-6XMQA">生物信息技术</a></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/08/27/64ea29a08ce11.png" style="width:600px;"/></div></div></blockquote></li><li><p>RNA概述及其分类</p><div class="tabs" id="rna分类"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="rna分类-1">RNA概述</button><button type="button" class="tab " data-href="rna分类-2">调控RNA</button><button type="button" class="tab " data-href="rna分类-3">管家RNA</button></ul><div class="tab-contents"><div class="tab-item-content active" id="rna分类-1"><p>基因只占人类基因组的3%，其余97%都是非编码序列。非编码序列也是可以表达的，其产物就是非编码RNA。人类基因组中约93%的DNA是能转化为RNA的，其中2%是mRNA,98%是非编码RNA（ncRNA）。非编码RNA(ncRNA)可分为调控RNA 和管家RNA两种。</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2024/05/15/66441cbb3f1f9.png" style="width:300px;"/></div></div></div><div class="tab-item-content" id="rna分类-2"><ul><li>miRNA:微RNA(micoRNA),18-25nt，单链。</li><li>siRNA:小干扰RNA（smallinterferingRNA）,21-23nt，双链。</li><li>piRNA:piwi相互作用RNA（piwi-interacting RNA）,26-35nt，单链，这是动物生殖细胞所特有的小RNA，转座子沉默。</li><li>lncRNA：长非编码RNA(long non-coding RNA),&gt;500nt,比如Xist、PCGEM1等。lncRNA可通过折叠形成一定的空间结构与多种蛋白互作，也可通过碱基互补配对与其它核酸进行识别，这种识别又可将蛋白引导至特定序列位点，这些特点使得lncRNA在发育和癌症中的功能发挥得更加丰富。</li></ul></div><div class="tab-item-content" id="rna分类-3"><ul><li>rRNA：核糖体RNA（ribosome RNA）,26-35nt，单链，是构成核糖体的组织成分，有多种不同的大小，如28S，18S，5S等。</li><li>tRNA：转运RNA（transfer RNA）,70-80nt，单链，三叶草构型，在蛋白质合成过程中起到转运氨基酸的作用。对于不同的物种，其RNA分子的大小和种类都可能有所不同。</li><li>snoRNA：核仁小RNA（smallnucleolarRNA）</li><li>scaRNA：small cajal boby-specific RNAs，是一种特殊的核仁小RNA，专一位于卡哈尔体（cajal boby）上，可以催化核糖核蛋白的生成。</li><li>Telomerase RNA：端粒酶RNA，是端粒酶RNA的一部分，在端粒延伸过程中，作为端粒继续延伸的模板，由端粒酶催化实现端粒的延长。</li></ul></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div></li><li><p>Markdown cheatsheet</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2024/05/15/6644214a2272e.jpg" style="width:600px;"/></div></div></li><li><p>统计学基本概念名词</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2024/05/15/6644231da4b3c.png" style="width:600px;"/></div></div></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;什么是有义链/反义链(sense/antisense)？&lt;blockquote&gt;
&lt;p&gt;有义链是与mRNA具有相同序列的DNA链，又称&lt;strong&gt;编码链&lt;/strong&gt;、&lt;strong&gt;有意义链&lt;/strong&gt;。在转录过程中以反义链为模版，翻译成蛋白质。</summary>
      
    
    
    
    <category term="科研知识" scheme="https://smileszh.github.io/categories/%E7%A7%91%E7%A0%94%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="知识点" scheme="https://smileszh.github.io/tags/%E7%9F%A5%E8%AF%86%E7%82%B9/"/>
    
  </entry>
  
  <entry>
    <title>分子互作</title>
    <link href="https://smileszh.github.io/posts/80184fae.html"/>
    <id>https://smileszh.github.io/posts/80184fae.html</id>
    <published>2023-06-27T02:00:00.000Z</published>
    <updated>2023-07-02T18:57:31.942Z</updated>
    
    <content type="html"><![CDATA[<h1 id="蛋白-DNA"><a href="#蛋白-DNA" class="headerlink" title="蛋白-DNA"></a>蛋白-DNA</h1><ul><li>也称转录因子模式，所有转录因子都包含一段 DNA结合域，结构域能够识别和结合基因启动子特征DNA序列（motif） ，进而影响靶基因从 DNA 转录产生 RNA 的过程，效应结果是 RNA量的多少变化，如果这个RNA是可以编码蛋白的mRNA，那么最终就会造成靶基因蛋白量的上调或者下调。</li><li><p>转录因子上的氨基酸序列和结构结合的 DNA 序列是有一定规律的，这种规律是预测转录因子调控靶基因的理论基础。</p></li><li><p>启动子是一段DNA序列, 启动子里含有 RNA 聚合酶的特异性结合序列，同时可以跟转录因子结合控制基因的转录活性。</p></li></ul><p><img src="https://bu.dusays.com/2023/06/27/6499bea4b4c9b.png" alt="dna-蛋白质.png"></p><h2 id="相关数据库"><a href="#相关数据库" class="headerlink" title="相关数据库"></a>相关数据库</h2><p><img src="https://bu.dusays.com/2023/06/27/6499c1836e9a1.png" alt="蛋白-dna数据库.png"></p><h2 id="转录因子"><a href="#转录因子" class="headerlink" title="转录因子"></a>转录因子</h2><div class="tabs" id="转录因子"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="转录因子-1">转录因子预测原理</button><button type="button" class="tab " data-href="转录因子-2">研究思路</button><button type="button" class="tab " data-href="转录因子-3">预测数据库</button><button type="button" class="tab " data-href="转录因子-4">转录因子验证实验</button></ul><div class="tab-contents"><div class="tab-item-content active" id="转录因子-1"><p><img src="https://bu.dusays.com/2023/06/28/649b8d13b84ce.png" alt="转录因子预测原理.png"></p></div><div class="tab-item-content" id="转录因子-2"><p>纯生信:</p><ul><li>根据测序结果筛选出的关键基因，探索能否找到潜在的转录因子调控这些基因</li><li>可以同时引入与转录因子和靶基因结合的非编码RNA，构建调节网络</li><li>或者识别出的差异表达基存在转录因子，可以以这个转录因子为中心，构建调节网络</li><li>基于转录因子本身的的表达水平、突变状态、甲基化水平、做转录因子与表型的生信分析</li></ul><p>生信+实验:</p><ul><li>基于序列保守性对互作关系进行预筛选，然后再通过EMSA、ChIP等实验验证</li></ul></div><div class="tab-item-content" id="转录因子-3"><p><img src="https://bu.dusays.com/2023/06/28/649b926153d60.png" alt="预测数据库.png"></p><details class="folding-tag" ><summary> JASPAR </summary>              <div class='content'>              <p><a href="https://jaspar.genereg.net/">JASPAR</a></p><p> JASPAR是一个收录转录因子与DNA结合位点以及结合模式的开源公共数据库。JASPAR共包含<strong>9个子数据集</strong>，最常用的是<strong>JASPAR CORE子数据集</strong>，主要收录了六大物种。JASPAR数据库的主要功能是预测目的基因上游结合的转录因子。</p><p><img src="https://bu.dusays.com/2023/06/28/649be997c4510.png" alt="JASPAR home.png"></p><p><img src="https://bu.dusays.com/2023/06/28/649bf85a3a568.png" alt="JASPAR aside.png"></p><p><strong>应用</strong></p><ul><li>预测转录因子与目的基因的结合位点信息</li></ul>              </div>            </details><details class="folding-tag" ><summary> AnimalTFDB 3.0 </summary>              <div class='content'>              <p><a href="http://bioinfo.life.hust.edu.cn/AnimalTFDB/#!/">AnimalTFDB 3.0</a></p><ul><li>旨在为动物转录因子及其辅助因子提供最全面、准确信息资源的数据库</li><li>提供多种搜索浏览方式，比如可以按照 family、species 或自定义方式进 行检索</li><li>可以批量预测转录因子</li><li>可以批量预测 DNA 序列上的转录因子结合位点</li></ul><p><img src="https://bu.dusays.com/2023/06/28/649c54e741ab8.png" alt="animal home.png"></p><p><img src="https://bu.dusays.com/2023/06/28/649c551d3172b.png" alt="animal home1.png"></p><p><strong>应用</strong></p><ul><li>预测与目的基因结合的转录因子</li><li>查询与某个转录因子有交互作用的蛋白</li></ul>              </div>            </details><details class="folding-tag" ><summary> AnimalTFDB 4.0 </summary>              <div class='content'>              <p><a href="http://bioinfo.life.hust.edu.cn/AnimalTFDB4/#/">AnimalTFDB 4.0</a></p><blockquote><p>新版本，待后续补充此文档</p></blockquote>              </div>            </details><details class="folding-tag" ><summary> TRRUST </summary>              <div class='content'>              <p><a href="https://www.grnpedia.org/trrust/">TRRUST</a></p><ul><li>TRRUST数据库是一个记录转录因子调控关系的数据库，不仅包含转录因子对应的靶基因，也包含了转录因子间的调控关系。</li><li>该数据库使用MeSH词汇查询、不断改进的sentence-based文本挖掘算法，加之挖掘后仔细的人工校对，保证了该数据库中的TF-target调控互作都是经过实验验证的。</li><li>目前该数据库只存储了<strong>人和小鼠</strong>相关的调控信息。</li><li>TRRUST数据库主要有三个功能：第一查询转录因子的靶基因，第二查询调控转录因子的其他转录因子，第三查找多个基因的关键转录因子。</li></ul><p><img src="https://bu.dusays.com/2023/06/28/649c586ded44b.png" alt="trust home.png"></p><p><strong>应用</strong></p><ul><li>查询与某个转录因子有相同靶基因的其他转录因子</li><li>查询对一组基因起关键作用的转录因子</li></ul>              </div>            </details><details class="folding-tag" ><summary> Cistrome Data Browser </summary>              <div class='content'>              <p><a href="http://cistrome.org/db/#/">Cistrome Data Browser</a> </p><ul><li><p>来自于人和小鼠的大量ChIP-seq、DNase-seq和ATAC-seq染色质谱分析所得到的数据，然后利用这些获取的资源来绘制转录因子结合位点在全基因组中的位置、组蛋白翻译后修饰等信息，并把每个样本的质量评估、比对结果、峰图数据、结合PEAK和靶基因等数据共享出来。</p></li><li><p>CistromeDB的最大特色就是它自己的质控，所以CistromeDB还可以作为ChIP-seq和DNase-seq实验的质量控制指南。</p></li><li>CistromeDB网站目前包含了以下四个方面的信息：一、针对每个ChIP-seq和DNase-seq数据集都提供了自己编录的信息；二、提供了这些公共数据集的分析结果，包括峰图、reads密度分析和一些注释图例；三、为每个数据集提供了全面的质量控制指标，包括reads方面、ChIP方面和注释方面；四、网站提供了数据集的分析和可视化的功能，用户可以直接将数据发送到CistromeDB，按照他们的标准来进行处理，并且网站还支持通过UCSC和WashU来实现单批数据集的可视化操作。</li></ul><p><img src="https://bu.dusays.com/2023/06/29/649c60503b842.png" alt="CDB1.png"></p><p><img src="https://bu.dusays.com/2023/06/29/649c60c029094.png" alt="CDB2.png"></p><p><strong>应用</strong></p><ul><li>对单个数据集的结果进行整体的查找和查看，比如数据样本具体来自于哪个组织、哪个细胞系</li><li>可以利用这个网站来查找某个数据集的质量控制情况</li><li>利用这个网站来实现转录因子下游靶基因的预测</li><li>可以反向验证自己找的靶基因与某个转录因子结合的可能性。</li></ul>              </div>            </details><details class="folding-tag" ><summary> ChIP-Atla </summary>              <div class='content'>              <p><a href="https://chip-atlas.org/">ChIP-Atla</a></p><p>ChIP-Atlas数据库全面整合了六个代表性模型生物（人类、小鼠、大鼠、果蝇、线虫和酵母）的ChIP-seq和DNase-seq数据。ChIP-Atlas数据库能够显示NCBI网站SRA中存档的所有公共ChIP-seq和DNase-seq数据的对比和峰图结果。</p><p><img src="https://bu.dusays.com/2023/06/29/649c6555eed78.png" alt="chip-at.png"></p><p><strong>应用</strong></p><ul><li>浏览转录因子的结合位点信息</li><li>预测可能与转录因子结合的靶基因</li><li>查找还有哪些其他转录因子结合在这个靶基因上</li></ul>              </div>            </details><details class="folding-tag" ><summary> ChIPBase </summary>              <div class='content'>              <p><a href="https://rnasysu.com/chipbase3/">ChIPBase</a></p>              </div>            </details><details class="folding-tag" ><summary> miRGen </summary>              <div class='content'>              <p><a href="https://diana.e-ce.uth.gr/mirgenv4/tool">miRGen</a></p>              </div>            </details><details class="folding-tag" ><summary> TransmiR </summary>              <div class='content'>              <p><a href="https://www.cuilab.cn/transmir">TransmiR</a></p>              </div>            </details></div><div class="tab-item-content" id="转录因子-4"><details class="folding-tag" ><summary> Luciferase assay 荧光素酶报告基因实验 </summary>              <div class='content'>              <p>研究某个转录因子是否与启动子区 域某段 DNA 序列结合影响基因表达时，通常是将带检测的 DNA 序列插入到荧光素酶报告基因的 5’端，然后加入待检测的转录因子，通过对荧光信号的观测，推断转录因子对报告基因转录的影响。</p><p><img src="https://bu.dusays.com/2023/06/28/649b9d5ca70a3.png" alt="荧光素酶.png" style="zoom:67%;" /></p>              </div>            </details><details class="folding-tag" ><summary> EMSA(Electrophoretic Mobility Shift Assay) 凝胶迁移实验 </summary>              <div class='content'>              <p>研究 DNA 与蛋白质直接结合的常用技术，可用于定性和定量分析。首先让蛋白质与末端标记的 DNA 探针孵育，然后跑 PAGE 胶。结合了蛋白质的 DNA 探针比未结合蛋白质的探针的电泳速率要慢， 进而判断某个蛋白和某段 DNA 能否直接结合。</p><p><img src="https://bu.dusays.com/2023/06/28/649b9dec54b7f.png" alt="EMSA.png"></p>              </div>            </details><details class="folding-tag" ><summary> Chip(Chromatin ImmunoPrecipitation)染色质免疫共沉淀实验 </summary>              <div class='content'>              <p>在生理状态也就是活细胞状态下，把细胞内的 DNA 与蛋白质交联在一起，通过超声或酶处理将其随机切断成一定长 度范围内的染色质小片段后，利用目的蛋白抗体，特异性地富集目的蛋白结合的 DNA 片段。接着，通过多种下游检测技术，如定量 PCR，二代测序等 来检测此富集片段的 DNA 序 列。</p><p><img src="https://bu.dusays.com/2023/06/28/649b9fb4d093e.png" alt="CHIP.png" style="zoom:67%;" /></p>              </div>            </details></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="蛋白-蛋白"><a href="#蛋白-蛋白" class="headerlink" title="蛋白-蛋白"></a>蛋白-蛋白</h1><p>蛋白与蛋白通过生成复合物发挥作用，或通过直接结合效应蛋白，影响效应蛋白的功能</p><p><img src="https://bu.dusays.com/2023/06/27/6499c2c763c64.png" alt="蛋白-蛋白.png" style="zoom:67%;" /></p><h2 id="相关数据库-1"><a href="#相关数据库-1" class="headerlink" title="相关数据库"></a>相关数据库</h2><p><img src="https://bu.dusays.com/2023/06/27/6499c32ac65d4.png" alt="蛋白-蛋白数据库.png"></p><h1 id="RNA-RNA-DNA"><a href="#RNA-RNA-DNA" class="headerlink" title="RNA-RNA/DNA"></a>RNA-RNA/DNA</h1><p>RNA既可以结合到DNA上，影响基因转录等功能。也可以结合到RNA上，在转录水平上影响RNA。</p><p><img src="https://bu.dusays.com/2023/06/27/6499c4dfd14c6.png" alt="RNA- RNA.png" style="zoom:67%;" /></p><h2 id="相关数据库-2"><a href="#相关数据库-2" class="headerlink" title="相关数据库"></a>相关数据库</h2><p><img src="https://bu.dusays.com/2023/06/27/6499c542501f4.png" alt="RNA- RNA数据库.png"></p><h1 id="RNA-蛋白"><a href="#RNA-蛋白" class="headerlink" title="RNA-蛋白"></a>RNA-蛋白</h1><p>RNA能够结合到蛋白上，影响蛋白到功能或者定位。蛋白也可以作用于RNA，影响RNA的功能</p><p><img src="https://bu.dusays.com/2023/06/27/6499c659cecc2.png" alt="protein-RNA.png" style="zoom:67%;" /></p><h2 id="相关数据库-3"><a href="#相关数据库-3" class="headerlink" title="相关数据库"></a>相关数据库</h2><p><img src="https://bu.dusays.com/2023/06/27/6499c659e7267.png" alt="蛋白- RNA database.png"></p><h1 id="化合物-分子"><a href="#化合物-分子" class="headerlink" title="化合物-分子"></a>化合物-分子</h1><p>化合物可以通过直接作用或间接作用影响到细胞内靶分子的表达量及功能活性。</p><p><img src="https://bu.dusays.com/2023/06/27/6499c78653e9b.png" alt="mol-mol.png"></p><h2 id="相关数据库-4"><a href="#相关数据库-4" class="headerlink" title="相关数据库"></a>相关数据库</h2><p><img src="https://bu.dusays.com/2023/06/27/6499c78672683.png" alt="mol-mol database.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;蛋白-DNA&quot;&gt;&lt;a href=&quot;#蛋白-DNA&quot; class=&quot;headerlink&quot; title=&quot;蛋白-DNA&quot;&gt;&lt;/a&gt;蛋白-DNA&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;也称转录因子模式，所有转录因子都包含一段 DNA结合域，结构域能够识别和结合基因启动子特征DNA</summary>
      
    
    
    
    <category term="生物信息学" scheme="https://smileszh.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/"/>
    
    
    <category term="数据库" scheme="https://smileszh.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    <category term="分子互作" scheme="https://smileszh.github.io/tags/%E5%88%86%E5%AD%90%E4%BA%92%E4%BD%9C/"/>
    
  </entry>
  
  <entry>
    <title>WGCNA</title>
    <link href="https://smileszh.github.io/posts/572fa456.html"/>
    <id>https://smileszh.github.io/posts/572fa456.html</id>
    <published>2023-06-26T12:00:00.000Z</published>
    <updated>2023-07-04T11:39:42.505Z</updated>
    
    <content type="html"><![CDATA[<h1 id="WGCNA-入门"><a href="#WGCNA-入门" class="headerlink" title="WGCNA 入门"></a>WGCNA 入门</h1><div class="tabs" id="wgcna入门"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="wgcna入门-1">背景知识</button><button type="button" class="tab " data-href="wgcna入门-2">简介</button><button type="button" class="tab " data-href="wgcna入门-3">原理</button><button type="button" class="tab " data-href="wgcna入门-4">基本分析流程</button><button type="button" class="tab " data-href="wgcna入门-5">计算步骤</button></ul><div class="tab-contents"><div class="tab-item-content active" id="wgcna入门-1"><ul><li>权重(weghted)：基因之间不仅仅是相关与否，还记录着它们的相关性数值，数值就是基因之间的联系的权重(相关性)。</li><li>模块(module)：表达模式相似的基因分为一类，这样的一类基因成为模块。</li><li>Eigengene：基因和样本构成的矩阵。</li><li>邻接矩阵(Adjacency Matrix)：是图的一种存储形式，用一个一维数组存放图中所有顶点数据；用一个二维数组存放顶点间关系（边或弧）的数据，这个二维数组称为邻接矩阵；在WGCNA分析里面指的是基因与基因之间的相关性系数矩阵。 如果用了阈值来判断基因相关与否，那么这个邻近矩阵就是0/1矩阵，只记录基因相关与否。但是WGCNA没有用阈值来卡基因的相关性，而是记录了所有基因之间的相关性。</li><li>拓扑重叠矩阵(TOM，Topological Overlap Matrix)：WGNA认为基因之间的简单的相关性不足以计算共表达，所以它利用邻近矩阵，又计算了一个新的邻近矩阵。一般来说，TOM就是WGCNA分析的最终结果，后续的只是对TOM的下游注释。</li></ul></div><div class="tab-item-content" id="wgcna入门-2"><ul><li>WGCNA（Weighted Gene Co-expression Network Analysis），即加权基因共表达网络分析。 是一种构建基因共表达网络的常用系统生物学算法，与传统的基因表达网络算法的主要差异在WGCNA采用了软阈值β对表达矩阵进行了加权。</li><li>WGCNA的分析目的在于寻找具有协同表达或共表达的基因组成的网络模块，探索这些基因网络模块与研究的表型或性状之间的关系，寻找与外部信息相关的Hub基因。</li></ul></div><div class="tab-item-content" id="wgcna入门-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/26/6498fc8a1d155.png" style="width:1000px;"/></div></div></div><div class="tab-item-content" id="wgcna入门-4"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/26/64990175eb5ee.png" style="width:600px;"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/26/649901e2a74b5.png" style="width:600px;"/></div></div></div><div class="tab-item-content" id="wgcna入门-5"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/26/649902acb2818.png" style="width:600px;"/></div></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="数据要求"><a href="#数据要求" class="headerlink" title="数据要求"></a>数据要求</h1><ul><li>表达矩阵</li><li>表型信息</li></ul><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/26/6498fe959360d.png" style="width:1000px;"/></div></div><h1 id="分析手段"><a href="#分析手段" class="headerlink" title="分析手段"></a>分析手段</h1><details class="folding-tag" cyan><summary> 在线工具 </summary>              <div class='content'>              <ul><li><a href="http://bioinformatics.sdstate.edu/idep/">iDEP</a></li><li><a href="https://bmbls.bmi.osumc.edu/IRIS/">IRIS</a></li></ul>              </div>            </details><details class="folding-tag" cyan><summary> R包 </summary>              <div class='content'>              <ul><li>WGCNA包</li></ul>              </div>            </details><h1 id="结果解读"><a href="#结果解读" class="headerlink" title="结果解读"></a>结果解读</h1><div class="tabs" id="结果解读"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="结果解读-1">样本和性状热图</button><button type="button" class="tab " data-href="结果解读-2">选择软阈值ß</button><button type="button" class="tab " data-href="结果解读-3">验证是否符合无尺度网络</button><button type="button" class="tab " data-href="结果解读-4">TOM矩阵基因聚类图与网络模块图</button><button type="button" class="tab " data-href="结果解读-5">初步构建的网络模块进行合并</button><button type="button" class="tab " data-href="结果解读-6">合并前后基因聚类与网络模块对比图</button><button type="button" class="tab " data-href="结果解读-7">模块与性状关系热图</button><button type="button" class="tab " data-href="结果解读-8">模块GS vs MM</button><button type="button" class="tab " data-href="结果解读-9">网络拓扑结构的可视化</button></ul><div class="tab-contents"><div class="tab-item-content active" id="结果解读-1"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/26/64990343be8a5.png" style="width:800px;"/></div></div></div><div class="tab-item-content" id="结果解读-2"><p>为了衡量两个基因是否具有相似表达模式，一般需要设置阈值来筛选，高于阈值的则认为是相似的。但是假设直接将阈值设为0.8，那么很难说明0.8和0.79两个是有显著差别的。因此，<strong>WGCNA分析时采用相关系数加权值，即对基因相关系数取N次幂</strong>，使得网络中的基因之间的连接服从<strong>无尺度网络分布(scale-freenetworks)</strong>，这种算法更具生物学意义。</p><ul><li>如例图所示，随着ß增大，R^2^增大，网络的连通性降低；ß=9时呢，网络的连通性很低，这时我们考虑降低R^2^的选择，选择ß=5。（R^2^最好不要低于0.8）</li></ul><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/26/649905af0cdbb.png" style="width:800px;"/></div></div></div><div class="tab-item-content" id="结果解读-3"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/26/64995c53a66de.png" style="width:700px;"/></div></div></div><div class="tab-item-content" id="结果解读-4"><p>通过基因之间的相关系数构建分层聚类树，<strong>聚类树的不同分支代表不同的基因模块</strong>，不同颜色代表不同的模块。基于基因的加权相关系数，将基因按照表达模式进行分类，将模式相似的基因归为一个模块。这样就可以将几万个基因通过基因表达模式被分成了几十个模块，是一个提取归纳信息的过程。</p><ul><li>动态剪切树算法对基因拓扑矩阵进行聚类，初步识别网络模块</li><li>Height表示基因之间的相异性程度，越大表示基因协同表达差异越大，不属于一个网络模块</li><li>不同颜色用于表示不同的网络模块 </li></ul><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/26/64995f24b987f.png" style="width:800px;"/></div></div></div><div class="tab-item-content" id="结果解读-5"><p>对初步构建的网络模块进行合并, 左图中红线表示0.25，在红线下面表示：这些模块之间的相异程度小于0.25，即相似程度高于0.75，将这些模块合并为一个模块，如右图所示。 </p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/26/6499610078f57.png" style="width:700px;"/></div></div></div><div class="tab-item-content" id="结果解读-6"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/26/649977698f12e.png" style="width:800px;"/></div></div></div><div class="tab-item-content" id="结果解读-7"><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/26/649977b34c5b4.png" style="width:800px;"/></div></div></div><div class="tab-item-content" id="结果解读-8"><ul><li>GS: (Gene Significance) ，表示基因显著性，定义单个基因与外部信息的关联性，即基因与某个性状的相关性。</li><li>MM: (Module Membership) ，用于描述模块的指标，是基于GS值计算出来。</li><li>GS和MM高度相关, 与某个性状高度相关的基因所在的模块往往也与该性状相关。</li><li>图中的横坐标表示MM值，纵坐标表示GS值，可以看出在brown模块中GS值和MM值高度关联，从p值看也是显著相关的。 </li></ul><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/26/649979963972f.png" style="width:600px;"/></div></div></div><div class="tab-item-content" id="结果解读-9"><p>图中是对网络模块拓扑结构的可视化，使用的数据是网络拓扑（TOM）矩阵，上侧和左侧表示层次聚类结果。从热图可以看出，热图的结果与聚类的树枝一一对应。 </p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/26/64997a4b6359e.png" style="width:600px;"/></div></div></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;WGCNA-入门&quot;&gt;&lt;a href=&quot;#WGCNA-入门&quot; class=&quot;headerlink&quot; title=&quot;WGCNA 入门&quot;&gt;&lt;/a&gt;WGCNA 入门&lt;/h1&gt;&lt;div class=&quot;tabs&quot; id=&quot;wgcna入门&quot;&gt;&lt;ul class=&quot;nav-tab</summary>
      
    
    
    
    <category term="生物信息学" scheme="https://smileszh.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/"/>
    
    
    <category term="聚类分析" scheme="https://smileszh.github.io/tags/%E8%81%9A%E7%B1%BB%E5%88%86%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>生物数据库基因ID</title>
    <link href="https://smileszh.github.io/posts/df5af0f1.html"/>
    <id>https://smileszh.github.io/posts/df5af0f1.html</id>
    <published>2023-06-11T14:00:00.000Z</published>
    <updated>2023-07-04T12:04:57.722Z</updated>
    
    <content type="html"><![CDATA[<p><em>小苏碎碎念：</em></p><p><em>科研分析中经常会遇到各种各样的基因ID类型，了解各种命名的来源和规则有助于我们在不同的数据库之间进行转换和使用。同时因各种各样的数据库越来越多，本文档也会持续完善和更新～～～🍊。</em></p><h1 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h1><ul><li><p>NCBI：National Center for Biotechnology Information, 即美国国家生物技术信息中心，是一个机构名称，不是数据库。</p></li><li><p><a href="https://www.ncbi.nlm.nih.gov/">Entrez</a> 是一个归属于 NCBI 的综合性的生物信息数据检索引擎系统，这个搜索引擎整合了包含核酸、蛋白质、基因、基因组、GEO 等在内的很多常用数据库。</p></li><li>HGNC: HUGO Gene Nomenclature Committee, 即人类基因命名委员会。人类大多基因的命名，是有HGNC完成的。</li><li>小鼠（mouse）的基因命名来源于MGNC；大鼠（rat）基因命名来源于RGNC；斑马鱼（zebrafish）基因命名来源于ZFIN</li><li><a href="https://www.ensembl.org/index.html">Ensembl</a> 基因组数据库项目，是 1999 年启动的，来应对当时即将完成的人类基因组计划的一个科学项目，是科研人员用于检索基因组信息的最常用数据库之一。</li><li>refseq参考序列数据库，是NCBI提供的具有生物学意义上的非冗余的基因和蛋 白等片段序列的数据库。它是目前世界上比较权威的序列数据库，一般可信度是比较高的。</li></ul><h1 id="Entrez-Gene-ID"><a href="#Entrez-Gene-ID" class="headerlink" title="Entrez Gene ID"></a>Entrez Gene ID</h1><blockquote><p>Entrez ID</p></blockquote><p>Entrez gene ID 来源于 Entrez gene 数据库的编号系统。Entrez 基因数据库其实就是我们现在指的 NCBI 中的 Gene 数据库，这两个名字指的是同一个数据库</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/11/6485cd2ea5710.png" style="width:600px;"/></div></div><p>Entrez Gene ID编号的格式就是一串数字。比如说像 <a href="https://www.ncbi.nlm.nih.gov/gene/7157">TP53</a>，他下面的 gene ID:7157</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/11/6485ce4cac856.png" style="width:600px;"/></div></div><h1 id="Gene-Symbol"><a href="#Gene-Symbol" class="headerlink" title="Gene Symbol"></a>Gene Symbol</h1><blockquote><p>official Symbol,  HGNC symbol</p></blockquote><ul><li>Office symbol: 是HGNC组织对基因进行命名的描述的一个缩写标识符</li><li>Office Full Name: 是经HGNC批准的基因名全称</li><li>HGNC ID：是HGNC数据库分配的基因编号，每个标准的symbol都有对应的HGNC ID</li></ul><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/11/6485d13d7e1d7.png" style="width:600px;"/></div></div><p><em>注：并不是所有的基因都有Official Symbol。如果基因缺少基因命名委员会命名的Gene Symbol，Entez Gene数据库中的Official symbol 就会变为Gene Symbol, 并且Gene Symbol的编号会变为LOC前缀加Entrez ID。</em>如：</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/11/6485d3fde40a0.png" style="width:600px;"/></div></div><h1 id="Ensemble-ID"><a href="#Ensemble-ID" class="headerlink" title="Ensemble ID"></a>Ensemble ID</h1><blockquote><p>Ensembl Stable ID </p></blockquote><p>命名规则：ENS[根据不同物种设置的前缀][数据所指类型（如基因，蛋白等）][一段特定的数字] . [版本]</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/11/6485d81a96f6c.png" style="width:600px;"/></div></div><h1 id="RefSeq-Accession-Number"><a href="#RefSeq-Accession-Number" class="headerlink" title="RefSeq Accession Number"></a>RefSeq Accession Number</h1><blockquote><p>RefSeq ID</p></blockquote><p>命名的格式以两个字母开头，后面跟一个下划线和六个或多个字母</p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/11/6485db197eb94.png" style="width:600px;"/></div></div><p><em>注：在 NCBI 的这个检索结果里，refseq status 这一行会显示这条 refseq 的状态。主要状态有:MODEL 指自动被 NCBI 提供的，没有被审核过，INFERRED 指由序列分析预测得到，没有经过实验验证，PREDICTED 指没有经过人工审核，REVIEWED 指已被人工审 核等等，可以根据这条信息认定序列的可信度。</em></p><div class="img-wrap"><div class="img-bg"><img class="img" src="https://bu.dusays.com/2023/06/11/6485d9504d3a7.png" style="width:600px;"/></div></div>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;em&gt;小苏碎碎念：&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;科研分析中经常会遇到各种各样的基因ID类型，了解各种命名的来源和规则有助于我们在不同的数据库之间进行转换和使用。同时因各种各样的数据库越来越多，本文档也会持续完善和更新～～～🍊。&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&quot;背景</summary>
      
    
    
    
    <category term="科研知识" scheme="https://smileszh.github.io/categories/%E7%A7%91%E7%A0%94%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="基因ID" scheme="https://smileszh.github.io/tags/%E5%9F%BA%E5%9B%A0ID/"/>
    
    <category term="生物数据库" scheme="https://smileszh.github.io/tags/%E7%94%9F%E7%89%A9%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>定量引物设计</title>
    <link href="https://smileszh.github.io/posts/e7e9fba0.html"/>
    <id>https://smileszh.github.io/posts/e7e9fba0.html</id>
    <published>2023-06-10T16:00:00.000Z</published>
    <updated>2023-06-11T14:07:35.982Z</updated>
    
    <content type="html"><![CDATA[<h1 id="查找基因"><a href="#查找基因" class="headerlink" title="查找基因"></a>查找基因</h1><h2 id="进入NCBI官网"><a href="#进入NCBI官网" class="headerlink" title="进入NCBI官网"></a>进入<a href="https://www.ncbi.nlm.nih.gov/">NCBI官网</a></h2><p><img src="https://bu.dusays.com/2023/06/11/6484a6b1c4eae.png" alt="官网.png" style="zoom: 35%;" /></p><h2 id="查找序列"><a href="#查找序列" class="headerlink" title="查找序列"></a>查找序列</h2><p><img src="https://bu.dusays.com/2023/06/11/6484a6b1d340a.png" alt="查找基因1.png" style="zoom:35%;" /></p><h2 id="查找基因ID"><a href="#查找基因ID" class="headerlink" title="查找基因ID"></a>查找基因ID</h2><p><img src="https://bu.dusays.com/2023/06/11/6484a6b1d0f51.png" alt="查找基因2.png" style="zoom:35%;" /></p><h1 id="引物设计"><a href="#引物设计" class="headerlink" title="引物设计"></a>引物设计</h1><h2 id="打开Prime-BLAST"><a href="#打开Prime-BLAST" class="headerlink" title="打开Prime-BLAST"></a>打开<a href="https://www.ncbi.nlm.nih.gov/tools/primer-blast/index.cgi?LINK_LOC=BlastHome">Prime-BLAST</a></h2><p><img src="https://bu.dusays.com/2023/06/11/6484a6b1c5396.png" alt="引物1.png" style="zoom:35%;" /></p><h2 id="根据需求填写参数"><a href="#根据需求填写参数" class="headerlink" title="根据需求填写参数"></a>根据需求填写参数</h2><p><img src="https://bu.dusays.com/2023/06/11/6484a6b1dbb3c.png" alt="引物2.png" style="zoom:35%;" /></p><h1 id="结果筛选"><a href="#结果筛选" class="headerlink" title="结果筛选"></a>结果筛选</h1><p><img src="https://bu.dusays.com/2023/06/11/6484a6b1c5b30.png" alt="结果.png" style="zoom:40%;" /></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;查找基因&quot;&gt;&lt;a href=&quot;#查找基因&quot; class=&quot;headerlink&quot; title=&quot;查找基因&quot;&gt;&lt;/a&gt;查找基因&lt;/h1&gt;&lt;h2 id=&quot;进入NCBI官网&quot;&gt;&lt;a href=&quot;#进入NCBI官网&quot; class=&quot;headerlink&quot; title=&quot;进</summary>
      
    
    
    
    <category term="科研知识" scheme="https://smileszh.github.io/categories/%E7%A7%91%E7%A0%94%E7%9F%A5%E8%AF%86/"/>
    
    
    <category term="引物设计" scheme="https://smileszh.github.io/tags/%E5%BC%95%E7%89%A9%E8%AE%BE%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>tidyverse：处理关系数据</title>
    <link href="https://smileszh.github.io/posts/7218365e.html"/>
    <id>https://smileszh.github.io/posts/7218365e.html</id>
    <published>2023-06-10T15:00:00.000Z</published>
    <updated>2023-07-04T08:49:49.778Z</updated>
    
    <content type="html"><![CDATA[<details class="folding-tag" ><summary> 文档使用数据源说明 </summary>              <div class='content'>              <p>文档中举例除了使用自建数据外，我们需要使用 nycflights13。这个数据包含了 2013 年从纽约市出发的所有 336 776次航班的信息。该数据来自于美国交通统计局， 可以使用?nycflights13 查看其说明文档。包括flights, airports, planes, weather, airline五个数据框。 文档中如出现此类数据对象，不再另行说明。</p><ul><li>flights: 包含航班信息</li><li>airlines:可以根据航空公司的缩写码查到公司全名。</li><li>airports:给出了每个机场的信息，通过 faa 机场编码进行标识。</li><li>planes:给出了每架飞机的信息，通过 tailnum 进行标识。</li><li>weather:给出了纽约机场每小时的天气状况。</li></ul><p><img src="https://bu.dusays.com/2023/06/10/64847e2f85887.png" alt="数据关系.png" style="zoom: 25%;" /></p><p>R包使用：<br><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>tidyverse<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>nycflights13<span class="punctuation">)</span></span><br></pre></td></tr></table></figure></p>              </div>            </details><h1 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h1><ul><li><strong>键</strong>：用于连接每对数据表对变量称为键，键是能唯一标识观测的变量（或变量集合）</li><li><strong>主键</strong>：唯一标识其所在数据框的观测</li><li><strong>外键</strong>：唯一标识另一个数据表中的观测</li><li><strong>代理键</strong>：一个表格没有主键时，使用mutate()和row_number()函数人为添加的一个主键称为代理键</li></ul><h1 id="合并连接"><a href="#合并连接" class="headerlink" title="合并连接"></a>合并连接</h1><blockquote><p>合并连接将两个表格中的变量进行组合，通过两个表格中键匹配观测，然后将一个表格中的变量复制到另一个表格中。</p></blockquote><div class="tabs" id="合并连接"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="合并连接-1">内连接</button><button type="button" class="tab " data-href="合并连接-2">外连接</button></ul><div class="tab-contents"><div class="tab-item-content active" id="合并连接-1"><p>内连接 inner_join() </p><blockquote><p>保留X和Y中共有的观测</p></blockquote><p><img src="https://bu.dusays.com/2023/06/10/64843c3112eed.png" alt="内连接.png" style="zoom:50%;" /></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据构造</span></span><br><span class="line"></span><br><span class="line">x <span class="operator">&lt;-</span> tribble<span class="punctuation">(</span></span><br><span class="line">  <span class="operator">~</span>key<span class="punctuation">,</span> <span class="operator">~</span>val_x<span class="punctuation">,</span></span><br><span class="line">  <span class="number">1</span><span class="punctuation">,</span> <span class="string">&quot;x1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="number">2</span><span class="punctuation">,</span> <span class="string">&quot;x2&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="number">3</span><span class="punctuation">,</span> <span class="string">&quot;x3&quot;</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">y <span class="operator">&lt;-</span> tribble<span class="punctuation">(</span></span><br><span class="line">  <span class="operator">~</span>key<span class="punctuation">,</span> <span class="operator">~</span>val_x<span class="punctuation">,</span></span><br><span class="line">  <span class="number">1</span><span class="punctuation">,</span> <span class="string">&quot;y1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="number">2</span><span class="punctuation">,</span> <span class="string">&quot;y2&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="number">4</span><span class="punctuation">,</span> <span class="string">&quot;y3&quot;</span></span><br><span class="line"><span class="punctuation">)</span>  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 内连接</span></span><br><span class="line"></span><br><span class="line">x <span class="operator">%&gt;%</span></span><br><span class="line">  inner_join<span class="punctuation">(</span>y<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&quot;key&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># A tibble: 2 × 3</span></span><br><span class="line">    key val_x.x val_x.y</span><br><span class="line">  <span class="operator">&lt;</span>dbl<span class="operator">&gt;</span> <span class="operator">&lt;</span>chr<span class="operator">&gt;</span>   <span class="operator">&lt;</span>chr<span class="operator">&gt;</span>  </span><br><span class="line"><span class="number">1</span>     <span class="number">1</span> x1      y1     </span><br><span class="line"><span class="number">2</span>     <span class="number">2</span> x2      y2  </span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="合并连接-2"><blockquote><ul><li>左连接：保留x中的所有观测</li><li>右连接：保留Y中的所有观测</li><li>全连接，保留X和Y中所有观测</li></ul></blockquote><p><img src="https://bu.dusays.com/2023/06/10/64843d25c12d6.png" alt="外连接.png" style="zoom:50%;" /></p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 左连接</span></span><br><span class="line">left_join<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 右连接</span></span><br><span class="line">right_join<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 全连接</span></span><br><span class="line">full_join<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="筛选连接"><a href="#筛选连接" class="headerlink" title="筛选连接"></a>筛选连接</h1><blockquote><p>根据匹配的键，筛选数据表中的观测</p></blockquote><div class="tabs" id="筛选连接"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="筛选连接-1">半连接</button><button type="button" class="tab " data-href="筛选连接-2">反连接</button></ul><div class="tab-contents"><div class="tab-item-content active" id="筛选连接-1"><p><strong>半连接 semi_join(x, y)</strong></p><blockquote><p><strong>保留</strong>X表中与Y表中的观测相匹配的所有观测</p></blockquote><p><img src="https://bu.dusays.com/2023/06/10/648475b9ac49d.png" alt="半连接.png" style="zoom:50%;" /></p><p><img src="https://bu.dusays.com/2023/06/10/648475b9ac49d.png" alt="半连接1.png" style="zoom:50%;" /></p><p>例：根据表flights找出飞往最受欢迎的10个目的地的航班信息</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 找出最受欢迎的10个目的地 -----------------------------------------------------------</span></span><br><span class="line">top_dest <span class="operator">&lt;-</span> flights <span class="operator">%&gt;%</span> </span><br><span class="line">  count<span class="punctuation">(</span>dest<span class="punctuation">,</span> sort <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">  head<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">)</span></span><br><span class="line">top_dest</span><br><span class="line"></span><br><span class="line"><span class="comment"># # A tibble: 10 × 2</span></span><br><span class="line"><span class="comment"># dest      n</span></span><br><span class="line"><span class="comment"># &lt;chr&gt; &lt;int&gt;</span></span><br><span class="line"><span class="comment">#   1 ORD   17283</span></span><br><span class="line"><span class="comment"># 2 ATL   17215</span></span><br><span class="line"><span class="comment"># 3 LAX   16174</span></span><br><span class="line"><span class="comment"># 4 BOS   15508</span></span><br><span class="line"><span class="comment"># 5 MCO   14082</span></span><br><span class="line"><span class="comment"># 6 CLT   14064</span></span><br><span class="line"><span class="comment"># 7 SFO   13331</span></span><br><span class="line"><span class="comment"># 8 FLL   12055</span></span><br><span class="line"><span class="comment"># 9 MIA   11728</span></span><br><span class="line"><span class="comment"># 10 DCA    9705</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 找出飞往这些目的地的航班 ------------------------------------------------------------</span></span><br><span class="line">flights <span class="operator">%&gt;%</span></span><br><span class="line">  semi_join<span class="punctuation">(</span>top_dest<span class="punctuation">)</span> <span class="comment"># 默认值by = NULL, 会使用存在于两个表中的所有变量，这种方式称为自然连接</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="筛选连接-2"><p><strong>反连接 anti_join(x, y)</strong></p><blockquote><p><strong>丢弃</strong>X表中与Y表中的观测相匹配的所有观测</p></blockquote><p><img src="https://bu.dusays.com/2023/06/10/648475b9ac49d.png" alt="反连接.png" style="zoom:50%;" /></p><p>例：找出flights 中在 planes 中没有匹配的记录</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flights <span class="operator">%&gt;%</span></span><br><span class="line">  anti_join<span class="punctuation">(</span>planes<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&quot;tailnum&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  count<span class="punctuation">(</span>tailnum<span class="punctuation">,</span> sort <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="集合操作"><a href="#集合操作" class="headerlink" title="集合操作"></a>集合操作</h1><blockquote><p>集合操作要求X和Y具有相同的变量</p></blockquote><p>模拟数据构建:</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">df1 <span class="operator">&lt;-</span> tribble<span class="punctuation">(</span></span><br><span class="line">  <span class="operator">~</span>x<span class="punctuation">,</span> <span class="operator">~</span>y<span class="punctuation">,</span></span><br><span class="line">  <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="number">2</span><span class="punctuation">,</span> <span class="number">1</span> </span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">df2 <span class="operator">&lt;-</span> tribble<span class="punctuation">(</span></span><br><span class="line">  <span class="operator">~</span>x<span class="punctuation">,</span> <span class="operator">~</span>y<span class="punctuation">,</span></span><br><span class="line">  <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span> </span><br><span class="line"><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><div class="tabs" id="集合操作"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="集合操作-1">intersect(x, y)</button><button type="button" class="tab " data-href="集合操作-2">union(x, y)</button><button type="button" class="tab " data-href="集合操作-3">setdiff(x, y)</button></ul><div class="tab-contents"><div class="tab-item-content active" id="集合操作-1"><p><strong>intersect(x, y)</strong></p><blockquote><p>返回既在 x 表，又在 y 表中的观测。 </p></blockquote><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">intersect<span class="punctuation">(</span>df1<span class="punctuation">,</span> df2<span class="punctuation">)</span> </span><br><span class="line"><span class="comment"># # A tibble: 1 × 2</span></span><br><span class="line"><span class="comment">#      x     y</span></span><br><span class="line"><span class="comment">#    &lt;dbl&gt; &lt;dbl&gt;</span></span><br><span class="line"><span class="comment"># 1    1     1</span></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="集合操作-2"><p><strong>union(x, y)</strong></p><blockquote><p>返回 x 表或 y 表中的唯一观测。</p></blockquote><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意，我们得到了3行，而不是4行 </span></span><br><span class="line">union<span class="punctuation">(</span>df1<span class="punctuation">,</span> df2<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># # A tibble: 3 × 2</span></span><br><span class="line"><span class="comment">#       x     y</span></span><br><span class="line"><span class="comment">#     &lt;dbl&gt; &lt;dbl&gt;</span></span><br><span class="line"><span class="comment"># 1     1     1</span></span><br><span class="line"><span class="comment"># 2     2     1</span></span><br><span class="line"><span class="comment"># 3     1     2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="集合操作-3"><p><strong>setdiff(x, y)</strong></p><blockquote><p>返回在 x 表，但不在 y 表中的观测，或反之。</p></blockquote><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">setdiff<span class="punctuation">(</span>df1<span class="punctuation">,</span> df2<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># # A tibble: 1 × 2</span></span><br><span class="line"><span class="comment">#       x     y</span></span><br><span class="line"><span class="comment">#     &lt;dbl&gt; &lt;dbl&gt;</span></span><br><span class="line"><span class="comment"># 1     2     1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">setdiff<span class="punctuation">(</span>df2<span class="punctuation">,</span> df1<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># A tibble: 1 × 2</span></span><br><span class="line"><span class="comment">#       x     y</span></span><br><span class="line"><span class="comment">#     &lt;dbl&gt; &lt;dbl&gt;</span></span><br><span class="line"><span class="comment"># 1     1     2</span></span><br></pre></td></tr></table></figure></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h1><ol><li>找出能唯一标识的主键</li><li>确保主键中没有缺失值</li><li>检查外键是否与另一张表主键匹配</li></ol><details class="folding-tag" yellow><summary> 相关问题 </summary>              <div class='content'>              <ul><li>验证主键是否是唯一标识</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 验证tailnum是否为planes表中的唯一标识</span></span><br><span class="line">planes <span class="operator">%&gt;%</span></span><br><span class="line">  count<span class="punctuation">(</span>tailnum<span class="punctuation">)</span> <span class="operator">%&gt;%</span>  </span><br><span class="line">  filter<span class="punctuation">(</span>n<span class="operator">&gt;</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证组合变量是否为唯一标识</span></span><br><span class="line">flights <span class="operator">%&gt;%</span></span><br><span class="line">  count<span class="punctuation">(</span>year<span class="punctuation">,</span> month<span class="punctuation">,</span> day<span class="punctuation">,</span> flight<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  filter<span class="punctuation">(</span>n <span class="operator">&gt;</span> <span class="number">1</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><ul><li>两个表中变量名不同如何进行连接</li></ul><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 by = c(&quot;a&quot; = &quot;b&quot;) 形式进行连接</span></span><br><span class="line">flights2 <span class="operator">%&gt;%</span></span><br><span class="line">  left_join<span class="punctuation">(</span>airports<span class="punctuation">,</span> by <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;dest&quot;</span> <span class="operator">=</span> <span class="string">&quot;faa&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>              </div>            </details>]]></content>
    
    
      
      
    <summary type="html">&lt;details class=&quot;folding-tag&quot; &gt;&lt;summary&gt; 文档使用数据源说明 &lt;/summary&gt;
              &lt;div class=&#39;content&#39;&gt;
              &lt;p&gt;文档中举例除了使用自建数据外，我们需要使用 nycf</summary>
      
    
    
    
    <category term="生物信息学" scheme="https://smileszh.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/"/>
    
    
    <category term="数据分析" scheme="https://smileszh.github.io/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
    
    <category term="tidyverse" scheme="https://smileszh.github.io/tags/tidyverse/"/>
    
    <category term="R 语言" scheme="https://smileszh.github.io/tags/R-%E8%AF%AD%E8%A8%80/"/>
    
  </entry>
  
  <entry>
    <title>GEO数据库</title>
    <link href="https://smileszh.github.io/posts/56308c9.html"/>
    <id>https://smileszh.github.io/posts/56308c9.html</id>
    <published>2023-06-08T05:00:00.000Z</published>
    <updated>2023-06-11T03:00:01.053Z</updated>
    
    <content type="html"><![CDATA[<h1 id="GEO数据库"><a href="#GEO数据库" class="headerlink" title="GEO数据库"></a><a href="https://www.ncbi.nlm.nih.gov/geo/">GEO数据库</a></h1><p> <em>写在前面的话</em></p><p><em>GEO 数据库是 NCBI 网站下的子数据库，主要收录基于芯片和测序技术的数据，来源于全球众多研究者的上传数据。GEO数据库一直是进行生信挖掘的重要数据库，了解GEO数据库的数据形式，组织类型及下载方式进行数据挖掘的必备技能。</em></p><h2 id="数据存储格式"><a href="#数据存储格式" class="headerlink" title="数据存储格式"></a>数据存储格式</h2><h3 id="SOFT-格式"><a href="#SOFT-格式" class="headerlink" title="SOFT 格式"></a>SOFT 格式</h3><p>SOFT (Simple Omnibus in Text Format)格式，是一种紧凑、简单、基于行的 ASCII(美国信息交换标准代码)文本格式， 包含实验数据和注释数据。</p><h3 id="MINiML-格式"><a href="#MINiML-格式" class="headerlink" title="MINiML 格式"></a>MINiML 格式</h3><p>MINiML (MIAME Notation in Markup Language, pronounced minimal)格式，与 SOFT 格式文件的包含信息完全相同，仅格式不同，为 XML 格式。 XML(eXtensible Markup Language)又称为可扩展标记语言，极其简单，使其易于在任何应用程序中读写数据。MIAME 和 MINSEQE 分别是芯片和测序数据上传的标准指南，指出上传的芯片或测序数据最起码应包含的数据内容。</p><h3 id="Series-Matrix-files"><a href="#Series-Matrix-files" class="headerlink" title="Series Matrix files"></a>Series Matrix files</h3><p>Series Matrix files，是以制表符分隔的包含每个样本具体数值(比如基因表达量) 的文本文件，以包含GSM和GSE描述信息的数据开头，然后是样本为列、探针或者基因为行的表达矩阵。若来源于不同平台则分割为数个单独的文件。</p><h3 id="Supplementary-files"><a href="#Supplementary-files" class="headerlink" title="Supplementary files"></a>Supplementary files</h3><p>Supplementary files，即补充文件，列出 GSM 原始数据或上传者分享的(如临床信息 等)相关文件;GEO 数据库鼓励但不强制要求上传补充文件。GEO 中不同的数据类型，具体 对应的文件格式也有所不同。GEO 存储的数据一般都是 gzip 压缩文件，文件后缀名.gz 或 者.tgz，常用的解压缩工具一般都可以打开。</p><h2 id="数据组织形式-Data-organiation"><a href="#数据组织形式-Data-organiation" class="headerlink" title="数据组织形式(Data organiation)"></a>数据组织形式(Data organiation)</h2><h3 id="GPL-GEO-platform"><a href="#GPL-GEO-platform" class="headerlink" title="GPL(GEO platform)"></a>GPL(GEO platform)</h3><p>GPL,是 GEO platform 的简称，也就是平台，所有的数据都是通过芯片或者测序数据商的平 台产生的，平台数据包括了该平台的主要描述信息，芯片平台数据还包括了芯片涉及的注 释信息。GEO 中包含了 2 万多个平台数据，编号以 GPL 开头，GPL 数据页面列出了 GEO 数据 库中使用该平台的所有样本 GSM 编号和系列 GSE 编号。</p><blockquote><p>GPL 数据主要有四种对应的存储格式。最常用的是 annotation 注释表格文件，将芯片探针名转换为基因名时需 要用到这个文件。然后就是 SOFT 格式和 MINiML 格式的平台数据，存储了使用该平台所有 GSM、GSE 的编号信息，一般文件较大，一般分析不常用到这个数据。部分平台由补充数据文件。比如常见的 <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GPL571">GPL571</a>，有前三种数据格式。</p><ul><li>GPLxxx.annot.gz, 基因序列的注释信息表格文件，不定期更新</li><li>GPLxxx.family.xml.tgz, 压缩的MINIML格式文件，包含使用该平台的所有GSM，GSE的信息</li><li>GPLxxx_soft.gz, 压缩的Soft格式文件，包含使用该平台的所有GSM，GSE的信息</li><li>GPLxxx.xxx.gz, 补充文件，部分数据无补充文件</li></ul></blockquote><p><img src="https://bu.dusays.com/2023/06/08/64815da7310fe.png" alt="GPL.png"></p><h3 id="GSM-GEO-sample"><a href="#GSM-GEO-sample" class="headerlink" title="GSM(GEO sample)"></a>GSM(GEO sample)</h3><p>GSM，全称 GEO sample，即样本数据，记录了单个样本的生物学信息、处理流程以及该样 本在平台上产生的原始数据，编号以 GSM 开头，一个 GSM 样本仅对应一个平台。即使同一 个生物样本在同一个平台或者多个平台内多次检测，就产生多个 GSM 样本数据，每个平台 的每一次检测就会产生一个新的 GSM 样本数据。</p><blockquote><p>GSM 数据对应的是一个单独的压缩文件，列在补充文件条目下。记录了该样本的描述信息和原始数据(raw data)，根据产生数据平台的不同，原 始数据的文件格式有所不同，CEL 格式就是 Affymetrix 芯片的原始数据格式。GSM 原始数据的文件名也反应了一些信息，比如 <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSM18423">GSM18423_PA-D_132.cel.gz</a>，表示:gzip 压缩的 CEL 文件，GSM18423 为样本编号，“PA-D_132”为该样本的简要分组信息。</p><ul><li>GSMxxxxxx.xxx.gz, 单个样本的gzip压缩文件，位于补充文件类别下</li></ul></blockquote><p><img src="https://bu.dusays.com/2023/06/08/64815da72f531.png" alt="GSM.png"></p><h3 id="GSE-GEO-series"><a href="#GSE-GEO-series" class="headerlink" title="GSE(GEO series)"></a>GSE(GEO series)</h3><p>GSE，是 GEO series 的简称，系列数据是把相关联的 GSM 样本数据集合在一起，通常是一 项研究中的所有样本数据的集合，编号以 GSE 开头。一个 GSE 系列数据中包含的样本可能 来源于不同平台，同一个样本的数据也可以出现在多个 GSE 中。</p><blockquote><p>GSE 文件的下载链接，一般在 GSE 网页的 下方。如<a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE1145">GSE1145</a></p><ul><li>GSExxx_series_matrix.txt.gz 或 GSExxx- GPLxxx_series_matrix.txt.gz，包含该 GSE 的样本表达矩阵及简要样本、平台信息; 若一 个 GSE 内应用了多个平台则按平台分割为多个 series matrix 文本文件，并按第二种方式 命名。</li><li>GSExxx_family.soft.gz, SOFT格式，包含GSE所涉及的所有样本及平台数据</li><li>GSExxx_family.xml.tgz, MINiML格式，包含该GSE所涉及的所有样本及平台数据</li><li>GSExxx_RAW.tar，该 GSE 所涉及的所有样本的原始数据，如所有样本 的 CEL 压缩文件，或其他补充文件</li></ul></blockquote><p><img src="https://bu.dusays.com/2023/06/08/64815da72dee9.png" alt="GSE.png"></p><h3 id="GDS-GEO-DataSet"><a href="#GDS-GEO-DataSet" class="headerlink" title="GDS(GEO DataSet)"></a>GDS(GEO DataSet)</h3><p>GDS，是 GEO DataSet 的简称，是经 GEO 数据库的工作人员挑选整理后的数据集记录，是对很少一部分 GSE 原始数据进行背景校正、均一化等处理后得到的。编号以 GDS 开头，每个 GDS 的数据对应一个平台，使得数据在 GDS 内部具有直接的可比性。</p><blockquote><p>GDS 数据的格式一般为 soft 格式，分为 soft 和 full.soft 文件，其中 full.soft 文件中增加了该 GDS 对应平台的最新基因注释信息。GDS 页面同时还整合了该 GDS 对应的 GSE 和 GPL annotation 数据下载链接。如<a href="https://www.ncbi.nlm.nih.gov/sites/GDSbrowser?acc=GDS2225">GDS2225</a></p><ul><li>GDSxxx.soft.gz, 来源于原始的GSE数据，经GEO处理，具有GDS内数值可比性的数据</li><li>GDSxxx_full.soft.gz, SOFT格式，在GDSxxx.soft.gz基础上，增加了该GDS对应平台的最新基因注释</li></ul></blockquote><p><img src="https://bu.dusays.com/2023/06/08/64815da72ea63.png" alt="GDS.png"></p><h3 id="GEO-Profile"><a href="#GEO-Profile" class="headerlink" title="GEO Profile"></a>GEO Profile</h3><p>GEO Profile 数据，直接来源于 GDS 数据，只是呈现的形式不同，重点关注单个基因的水平。从单个基因角度直观地以图表展示特定基因在 GDS 不同分组、所有样本中的表达水 平，网页内可以直接下载整理好 Profile 数据。</p><blockquote><p> GEO profile 文件下载的文件命名为 profile_data.txt，没有特定的编号，文件内包含了所查询基因的信息以及在各个样本中的表达值数据，推荐用 Excel 打开这个文本文件。如<a href="https://www.ncbi.nlm.nih.gov/geoprofiles/28483590">GDS2225中Herpud1基因的profile数据</a></p><p>Profile_data.txt, 包含所查询基因的信息及在各个样本中的表达值数据</p></blockquote><p><img src="https://bu.dusays.com/2023/06/08/64815da72db57.png" alt="GEO profile.png"></p><h2 id="数据下载"><a href="#数据下载" class="headerlink" title="数据下载"></a>数据下载</h2><h3 id="网页链接下载"><a href="#网页链接下载" class="headerlink" title="网页链接下载"></a>网页链接下载</h3><p><a href="https://www.ncbi.nlm.nih.gov/geo/">GEO数据库主页</a></p><h3 id="构建ftp链接下载"><a href="#构建ftp链接下载" class="headerlink" title="构建ftp链接下载"></a>构建ftp链接下载</h3><p><a href="ftp://ftp.ncbi.nlm.nih.gov/geo/">GEO数据库ftp站点</a></p><blockquote><p>4种数据类型的子目</p><ul><li>datasets</li><li>platforms</li><li>sample</li><li>Series</li></ul></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;GEO数据库&quot;&gt;&lt;a href=&quot;#GEO数据库&quot; class=&quot;headerlink&quot; title=&quot;GEO数据库&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://www.ncbi.nlm.nih.gov/geo/&quot;&gt;GEO数据库&lt;/a&gt;&lt;/h1&gt;&lt;p&gt; &lt;em&gt;写</summary>
      
    
    
    
    <category term="生物信息学" scheme="https://smileszh.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/"/>
    
    
    <category term="数据库" scheme="https://smileszh.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>R绘图-热图</title>
    <link href="https://smileszh.github.io/posts/5c21bb3.html"/>
    <id>https://smileszh.github.io/posts/5c21bb3.html</id>
    <published>2023-06-07T08:00:00.000Z</published>
    <updated>2023-06-30T17:56:25.134Z</updated>
    
    <content type="html"><![CDATA[<h1 id="差异基因热图绘制"><a href="#差异基因热图绘制" class="headerlink" title="差异基因热图绘制"></a>差异基因热图绘制</h1><div class="tabs" id="差异基因热图"><ul class="nav-tabs"><button type="button" class="tab  active" data-href="差异基因热图-1">所需数据</button><button type="button" class="tab " data-href="差异基因热图-2">代码</button><button type="button" class="tab " data-href="差异基因热图-3">结果展示</button></ul><div class="tab-contents"><div class="tab-item-content active" id="差异基因热图-1"><p><a href="https://tooc.web.xlj0.com/uploads/%E5%B7%AE%E5%BC%82%E8%A1%A8%E8%BE%BE%E5%88%86%E6%9E%90/results.csv">DESeq2或edgeR差异表达分析后数据</a></p></div><div class="tab-item-content" id="差异基因热图-2"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Create heat map from a differential expression count table.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Load the library.</span></span><br><span class="line">suppressPackageStartupMessages<span class="punctuation">(</span>library<span class="punctuation">(</span>gplots<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the file that contains the counts.</span></span><br><span class="line">count_file <span class="operator">=</span> <span class="string">&quot;results.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of the output file.</span></span><br><span class="line">output_file <span class="operator">=</span> <span class="string">&quot;heatmap.pdf&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Inform the user.</span></span><br><span class="line">print<span class="punctuation">(</span><span class="string">&quot;# Tool: Create Heatmap &quot;</span><span class="punctuation">)</span></span><br><span class="line">print<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;# Input: &quot;</span><span class="punctuation">,</span> count_file<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">print<span class="punctuation">(</span>paste<span class="punctuation">(</span><span class="string">&quot;# Output: &quot;</span><span class="punctuation">,</span> output_file<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># FDR cutoff.</span></span><br><span class="line">MIN_FDR <span class="operator">=</span> <span class="number">0.05</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Plot width</span></span><br><span class="line">WIDTH <span class="operator">=</span> <span class="number">12</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Plot height.</span></span><br><span class="line">HEIGHT <span class="operator">=</span> <span class="number">13</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the margins</span></span><br><span class="line">MARGINS <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">9</span><span class="punctuation">,</span> <span class="number">12</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Relative heights of the rows in the plot.</span></span><br><span class="line">LHEI <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Read normalized counts from the standard input.</span></span><br><span class="line">data <span class="operator">=</span> read.csv<span class="punctuation">(</span>count_file<span class="punctuation">,</span> header<span class="operator">=</span><span class="built_in">T</span><span class="punctuation">,</span> as.is<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Subset data for values under a treshold.</span></span><br><span class="line">data <span class="operator">=</span> subset<span class="punctuation">(</span>data<span class="punctuation">,</span> data<span class="operator">$</span>FDR <span class="operator">&lt;=</span> MIN_FDR<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The heatmap row names will be taken from the first column.</span></span><br><span class="line">row_names <span class="operator">=</span> data<span class="punctuation">[</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The code assumes that the normalized data matrix is listed to the right of the falsePos column.</span></span><br><span class="line">idx <span class="operator">=</span> which<span class="punctuation">(</span>colnames<span class="punctuation">(</span>data<span class="punctuation">)</span> <span class="operator">==</span> <span class="string">&quot;falsePos&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The normalized counts are on the right size.</span></span><br><span class="line">counts <span class="operator">=</span> data<span class="punctuation">[</span><span class="punctuation">,</span> idx <span class="operator">:</span> ncol<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Load the data from the second column on.</span></span><br><span class="line">values <span class="operator">=</span> as.matrix<span class="punctuation">(</span>counts<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Adds a little noise to each element to avoid the</span></span><br><span class="line"><span class="comment"># clustering function failure on zero variance rows.</span></span><br><span class="line">values <span class="operator">=</span> jitter<span class="punctuation">(</span>values<span class="punctuation">,</span> factor <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> amount <span class="operator">=</span> <span class="number">0.00001</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Normalize each row to a z-score</span></span><br><span class="line">zscores <span class="operator">=</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span> <span class="operator">:</span> nrow<span class="punctuation">(</span>values<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  row <span class="operator">=</span> values<span class="punctuation">[</span>i<span class="punctuation">,</span><span class="punctuation">]</span></span><br><span class="line">  zrow <span class="operator">=</span> <span class="punctuation">(</span>row <span class="operator">-</span> mean<span class="punctuation">(</span>row<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">/</span> sd<span class="punctuation">(</span>row<span class="punctuation">)</span></span><br><span class="line">  zscores <span class="operator">=</span> rbind<span class="punctuation">(</span>zscores<span class="punctuation">,</span> zrow<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the row names on the zscores.</span></span><br><span class="line">row.names<span class="punctuation">(</span>zscores<span class="punctuation">)</span> <span class="operator">=</span> row_names</span><br><span class="line"></span><br><span class="line"><span class="comment"># Turn the data into a matrix for heatmap2.</span></span><br><span class="line">zscores <span class="operator">=</span> as.matrix<span class="punctuation">(</span>zscores<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the color palette.</span></span><br><span class="line">col <span class="operator">=</span> greenred</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a PDF device</span></span><br><span class="line">pdf<span class="punctuation">(</span>output_file<span class="punctuation">,</span> width <span class="operator">=</span> WIDTH<span class="punctuation">,</span> height <span class="operator">=</span> HEIGHT<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">heatmap.2<span class="punctuation">(</span>zscores<span class="punctuation">,</span> col<span class="operator">=</span>col<span class="punctuation">,</span> density.info<span class="operator">=</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span> Colv<span class="operator">=</span><span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">    dendrogram<span class="operator">=</span><span class="string">&quot;row&quot;</span><span class="punctuation">,</span> trace<span class="operator">=</span><span class="string">&quot;none&quot;</span><span class="punctuation">,</span> margins<span class="operator">=</span>MARGINS<span class="punctuation">,</span> lhei<span class="operator">=</span>LHEI<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="tab-item-content" id="差异基因热图-3"><p><img src="https://bu.dusays.com/2023/07/01/649f167cd0737.png" alt="heatmap.png"></p></div></div><div class="tab-to-top"><button type="button" aria-label="scroll to top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><h1 id="普通热图"><a href="#普通热图" class="headerlink" title="普通热图"></a>普通热图</h1><h2 id="热图效果"><a href="#热图效果" class="headerlink" title="热图效果"></a>热图效果</h2><blockquote><p>横轴为样本类型，纵向为基因ID</p></blockquote><h2 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GeneSample1Sample2Sample3Sample4Sample5Sample6Sample7Sample8Sample9Sample10</span><br><span class="line">Gene10.601.060.000.250.782.050.420.570.410.57</span><br><span class="line">Gene24.034.050.940.004.494.101.940.690.230.98</span><br><span class="line">Gene30.060.190.360.610.640.390.150.200.520.20</span><br><span class="line">Gene42.551.860.160.421.164.390.420.000.350.00</span><br><span class="line">Gene50.890.910.000.000.101.250.350.280.480.28</span><br><span class="line">Gene62.755.020.040.001.415.762.080.000.980.00</span><br><span class="line">Gene70.660.900.000.530.340.590.750.390.400.18</span><br><span class="line">Gene80.902.870.360.170.060.060.970.080.000.26</span><br><span class="line">Gene97.155.970.000.001.708.463.499.880.120.27</span><br><span class="line">Gene103.123.410.520.150.363.440.902.090.152.08</span><br><span class="line">Gene110.240.640.000.000.150.880.310.000.570.08</span><br><span class="line">Gene124.315.320.000.171.883.941.300.970.511.32</span><br><span class="line">Gene132.272.090.080.000.001.781.451.171.201.37</span><br><span class="line">Gene140.870.270.000.000.000.640.000.000.000.00</span><br><span class="line">Gene153.373.631.260.292.414.081.780.060.910.06</span><br><span class="line">Gene160.181.090.150.371.280.720.230.301.560.30</span><br><span class="line">Gene173.563.820.180.001.105.361.484.761.235.31</span><br><span class="line">Gene181.771.541.620.000.204.820.910.250.360.25</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载包</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>pheatmap<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入数据</span></span><br><span class="line">data <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>read.table<span class="punctuation">(</span><span class="string">&quot;data.txt&quot;</span><span class="punctuation">,</span>row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span>sep <span class="operator">=</span> <span class="string">&quot;\t&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建列注释信息</span></span><br><span class="line">annotation_col <span class="operator">=</span> data.frame<span class="punctuation">(</span>CellType <span class="operator">=</span> factor<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;A&quot;</span><span class="punctuation">,</span><span class="string">&quot;B&quot;</span><span class="punctuation">,</span><span class="string">&quot;C&quot;</span><span class="punctuation">,</span><span class="string">&quot;D&quot;</span><span class="punctuation">,</span><span class="string">&quot;E&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                                <span class="string">&quot;F&quot;</span><span class="punctuation">,</span><span class="string">&quot;G&quot;</span><span class="punctuation">,</span><span class="string">&quot;H&quot;</span><span class="punctuation">,</span><span class="string">&quot;I&quot;</span><span class="punctuation">,</span><span class="string">&quot;J&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">rownames<span class="punctuation">(</span>annotation_col<span class="punctuation">)</span> <span class="operator">&lt;-</span> colnames<span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>annotation_col<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定注释信息的颜色列表</span></span><br><span class="line">ann_colors <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span></span><br><span class="line">  CellType <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>A <span class="operator">=</span> <span class="string">&quot;#65B99F&quot;</span><span class="punctuation">,</span> B <span class="operator">=</span> <span class="string">&quot;#F08961&quot;</span><span class="punctuation">,</span> C <span class="operator">=</span> <span class="string">&quot;#8A9BC3&quot;</span><span class="punctuation">,</span> D <span class="operator">=</span> <span class="string">&quot;#DA85B5&quot;</span><span class="punctuation">,</span> E <span class="operator">=</span> <span class="string">&quot;#A1CC56&quot;</span><span class="punctuation">,</span></span><br><span class="line">               <span class="built_in">F</span> <span class="operator">=</span> <span class="string">&quot;#F5D239&quot;</span><span class="punctuation">,</span> G <span class="operator">=</span> <span class="string">&quot;#7CC07B&quot;</span><span class="punctuation">,</span> H <span class="operator">=</span> <span class="string">&quot;#BAABD0&quot;</span><span class="punctuation">,</span> I <span class="operator">=</span> <span class="string">&quot;#3766A4&quot;</span><span class="punctuation">,</span> J <span class="operator">=</span> <span class="string">&quot;#DF3078&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">head<span class="punctuation">(</span>ann_colors<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pheatmap<span class="punctuation">(</span>data<span class="punctuation">,</span></span><br><span class="line">         <span class="comment"># 去掉聚类树：</span></span><br><span class="line">         cluster_cols <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">         cluster_rows <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">         <span class="comment"># 加color bar：列注释信息；</span></span><br><span class="line">         annotation_col <span class="operator">=</span> annotation_col<span class="punctuation">,</span></span><br><span class="line">         <span class="comment"># color bar 颜色设定：</span></span><br><span class="line">         annotation_colors <span class="operator">=</span> ann_colors<span class="punctuation">,</span></span><br><span class="line">         <span class="comment"># 设置单元格颜色渐变；(100)表示分100段渐变；</span></span><br><span class="line">         color <span class="operator">=</span> colorRampPalette<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;#FDEBEA&quot;</span><span class="punctuation">,</span><span class="string">&quot;#D5281F&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">(</span><span class="number">100</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">         <span class="comment"># 行、列标签的字体大小</span></span><br><span class="line">         fontsize_col <span class="operator">=</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">         fontsize_row <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">         <span class="comment"># 是否显示行、列名</span></span><br><span class="line">         show_colnames <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">,</span></span><br><span class="line">         <span class="comment"># 设置每个单元格的宽度和高度</span></span><br><span class="line">         cellwidth <span class="operator">=</span> <span class="number">30</span><span class="punctuation">,</span> </span><br><span class="line">         cellheight <span class="operator">=</span> <span class="number">24</span><span class="punctuation">,</span></span><br><span class="line">         <span class="comment"># 行、列聚类树的高度：</span></span><br><span class="line">         <span class="comment"># treeheight_row = 50, </span></span><br><span class="line">         <span class="comment"># treeheight_col = 30,</span></span><br><span class="line">         <span class="comment"># display_numbers = TRUE参数设定在每个热图格子中显示相应的数值，</span></span><br><span class="line">         <span class="comment"># number_color参数设置数值字体的颜色</span></span><br><span class="line">         display_numbers <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span>number_color <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="comment"># 设置标题：</span></span><br><span class="line">         main <span class="operator">=</span> <span class="string">&quot;Heatmap&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="circle-热图"><a href="#circle-热图" class="headerlink" title="circle 热图"></a>circle 热图</h1><h2 id="热图效果-1"><a href="#热图效果-1" class="headerlink" title="热图效果"></a>热图效果</h2><p><img src="https://s2.loli.net/2023/05/10/Okx86iFDLWtYlRw.png" alt="image-20230510124031974" style="zoom: 33%;" /></p><h2 id="数据准备-1"><a href="#数据准备-1" class="headerlink" title="数据准备"></a>数据准备</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GeneSample1Sample2Sample3Sample4Sample5Sample6Sample7Sample8Sample9Sample10</span><br><span class="line">Gene10.601.060.000.250.782.050.420.570.410.57</span><br><span class="line">Gene24.034.050.940.004.494.101.940.690.230.98</span><br><span class="line">Gene30.060.190.360.610.640.390.150.200.520.20</span><br><span class="line">Gene42.551.860.160.421.164.390.420.000.350.00</span><br><span class="line">Gene50.890.910.000.000.101.250.350.280.480.28</span><br><span class="line">Gene62.755.020.040.001.415.762.080.000.980.00</span><br><span class="line">Gene70.660.900.000.530.340.590.750.390.400.18</span><br><span class="line">Gene80.902.870.360.170.060.060.970.080.000.26</span><br><span class="line">Gene97.155.970.000.001.708.463.499.880.120.27</span><br><span class="line">Gene103.123.410.520.150.363.440.902.090.152.08</span><br><span class="line">Gene110.240.640.000.000.150.880.310.000.570.08</span><br><span class="line">Gene124.315.320.000.171.883.941.300.970.511.32</span><br><span class="line">Gene132.272.090.080.000.001.781.451.171.201.37</span><br><span class="line">Gene140.870.270.000.000.000.640.000.000.000.00</span><br><span class="line">Gene153.373.631.260.292.414.081.780.060.910.06</span><br><span class="line">Gene160.181.090.150.371.280.720.230.301.560.30</span><br><span class="line">Gene173.563.820.180.001.105.361.484.761.235.31</span><br><span class="line">Gene181.771.541.620.000.204.820.910.250.360.25</span><br></pre></td></tr></table></figure><h2 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加载包</span></span><br><span class="line">rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggtree<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入数据</span></span><br><span class="line">data <span class="operator">&lt;-</span> as.matrix<span class="punctuation">(</span>read.table<span class="punctuation">(</span><span class="string">&quot;data.txt&quot;</span><span class="punctuation">,</span>row.names <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span>header <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">,</span>sep <span class="operator">=</span> <span class="string">&quot;\t&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进行层次聚类</span></span><br><span class="line">df <span class="operator">&lt;-</span> hclust<span class="punctuation">(</span>dist<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制进化树</span></span><br><span class="line">p1 <span class="operator">&lt;-</span> ggtree<span class="punctuation">(</span>df<span class="punctuation">)</span></span><br><span class="line">p1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看是否合适</span></span><br><span class="line">gheatmap<span class="punctuation">(</span>p1<span class="punctuation">,</span>data<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将进化树绘制成圆形</span></span><br><span class="line">p2 <span class="operator">&lt;-</span> ggtree<span class="punctuation">(</span>df<span class="punctuation">,</span>layout <span class="operator">=</span> <span class="string">&quot;circular&quot;</span><span class="punctuation">)</span></span><br><span class="line">p2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置开口方向：rotate_tree()</span></span><br><span class="line"><span class="comment"># 顺时针旋转100度</span></span><br><span class="line">p3 <span class="operator">&lt;-</span> rotate_tree<span class="punctuation">(</span>p2<span class="punctuation">,</span><span class="number">100</span><span class="punctuation">)</span></span><br><span class="line">P3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">gheatmap<span class="punctuation">(</span>p3 <span class="operator">+</span> geom_tiplab<span class="punctuation">(</span>offset <span class="operator">=</span> <span class="number">13</span><span class="punctuation">)</span><span class="punctuation">,</span>data<span class="punctuation">,</span></span><br><span class="line">         <span class="comment"># 设置热图的宽度：</span></span><br><span class="line">         width <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span></span><br><span class="line">         <span class="comment"># 设置单元格的颜色：</span></span><br><span class="line">         low <span class="operator">=</span> <span class="string">&quot;#FDEBEA&quot;</span><span class="punctuation">,</span></span><br><span class="line">         high <span class="operator">=</span> <span class="string">&quot;#D5281F&quot;</span><span class="punctuation">,</span></span><br><span class="line">         font.size <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">         colnames_position <span class="operator">=</span> <span class="string">&quot;top&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="comment"># 调整开口大小</span></span><br><span class="line">         colnames_offset_y <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">         <span class="comment"># 调节列名和顶部之间的距离：</span></span><br><span class="line">         hjust <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">         <span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  theme<span class="punctuation">(</span>legend.position <span class="operator">=</span> <span class="string">&quot;right&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文字和图的位置后续可以在Ai中调整；</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;差异基因热图绘制&quot;&gt;&lt;a href=&quot;#差异基因热图绘制&quot; class=&quot;headerlink&quot; title=&quot;差异基因热图绘制&quot;&gt;&lt;/a&gt;差异基因热图绘制&lt;/h1&gt;&lt;div class=&quot;tabs&quot; id=&quot;差异基因热图&quot;&gt;&lt;ul class=&quot;nav-tabs</summary>
      
    
    
    
    <category term="生物信息学" scheme="https://smileszh.github.io/categories/%E7%94%9F%E7%89%A9%E4%BF%A1%E6%81%AF%E5%AD%A6/"/>
    
    
    <category term="R语言" scheme="https://smileszh.github.io/tags/R%E8%AF%AD%E8%A8%80/"/>
    
    <category term="R绘图" scheme="https://smileszh.github.io/tags/R%E7%BB%98%E5%9B%BE/"/>
    
  </entry>
  
</feed>
